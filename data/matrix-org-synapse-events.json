[
    {
        "id": "32897257227",
        "type": "PullRequestReviewEvent",
        "actor": {
            "id": 517124,
            "login": "clokep",
            "display_login": "clokep",
            "gravatar_id": "",
            "url": "https://api.github.com/users/clokep",
            "avatar_url": "https://avatars.githubusercontent.com/u/517124?"
        },
        "repo": {
            "id": 22844864,
            "name": "matrix-org/synapse",
            "url": "https://api.github.com/repos/matrix-org/synapse"
        },
        "payload": {
            "action": "created",
            "review": {
                "id": 1701575327,
                "node_id": "PRR_kwDOAVyVwM5la_qf",
                "user": {
                    "login": "clokep",
                    "id": 517124,
                    "node_id": "MDQ6VXNlcjUxNzEyNA==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/517124?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/clokep",
                    "html_url": "https://github.com/clokep",
                    "followers_url": "https://api.github.com/users/clokep/followers",
                    "following_url": "https://api.github.com/users/clokep/following{/other_user}",
                    "gists_url": "https://api.github.com/users/clokep/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/clokep/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/clokep/subscriptions",
                    "organizations_url": "https://api.github.com/users/clokep/orgs",
                    "repos_url": "https://api.github.com/users/clokep/repos",
                    "events_url": "https://api.github.com/users/clokep/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/clokep/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "I'm fairly certain this is OK.",
                "commit_id": "22b2cca388dc7a59259a686a1dff012206f2dcd4",
                "submitted_at": "2023-10-27T11:34:34Z",
                "state": "approved",
                "html_url": "https://github.com/matrix-org/synapse/pull/16557#pullrequestreview-1701575327",
                "pull_request_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16557",
                "author_association": "MEMBER",
                "_links": {
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16557#pullrequestreview-1701575327"
                    },
                    "pull_request": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16557"
                    }
                }
            },
            "pull_request": {
                "url": "https://api.github.com/repos/matrix-org/synapse/pulls/16557",
                "id": 1574927054,
                "node_id": "PR_kwDOAVyVwM5d33rO",
                "html_url": "https://github.com/matrix-org/synapse/pull/16557",
                "diff_url": "https://github.com/matrix-org/synapse/pull/16557.diff",
                "patch_url": "https://github.com/matrix-org/synapse/pull/16557.patch",
                "issue_url": "https://api.github.com/repos/matrix-org/synapse/issues/16557",
                "number": 16557,
                "state": "open",
                "locked": false,
                "title": "Reduce replication traffic due to reflected cache stream POSITION",
                "user": {
                    "login": "erikjohnston",
                    "id": 8428120,
                    "node_id": "MDQ6VXNlcjg0MjgxMjA=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/8428120?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/erikjohnston",
                    "html_url": "https://github.com/erikjohnston",
                    "followers_url": "https://api.github.com/users/erikjohnston/followers",
                    "following_url": "https://api.github.com/users/erikjohnston/following{/other_user}",
                    "gists_url": "https://api.github.com/users/erikjohnston/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/erikjohnston/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/erikjohnston/subscriptions",
                    "organizations_url": "https://api.github.com/users/erikjohnston/orgs",
                    "repos_url": "https://api.github.com/users/erikjohnston/repos",
                    "events_url": "https://api.github.com/users/erikjohnston/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/erikjohnston/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "This was exacerbated by #16473",
                "created_at": "2023-10-26T13:56:24Z",
                "updated_at": "2023-10-27T11:34:34Z",
                "closed_at": null,
                "merged_at": null,
                "merge_commit_sha": "6b44fbf531ba2258ad90114737d1ede86857d228",
                "assignee": null,
                "assignees": [],
                "requested_reviewers": [],
                "requested_teams": [],
                "labels": [],
                "milestone": null,
                "draft": false,
                "commits_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16557/commits",
                "review_comments_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16557/comments",
                "review_comment_url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}",
                "comments_url": "https://api.github.com/repos/matrix-org/synapse/issues/16557/comments",
                "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/22b2cca388dc7a59259a686a1dff012206f2dcd4",
                "head": {
                    "label": "matrix-org:erikj/reduce_caches_position_traffic",
                    "ref": "erikj/reduce_caches_position_traffic",
                    "sha": "22b2cca388dc7a59259a686a1dff012206f2dcd4",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-27T09:05:12Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 402149,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2162,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1516,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2162,
                        "open_issues": 1516,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "base": {
                    "label": "matrix-org:develop",
                    "ref": "develop",
                    "sha": "c14a7de6af0b8a3cbf2e17afca1cab339bc5912d",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-27T09:05:12Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 402149,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2162,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1516,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2162,
                        "open_issues": 1516,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16557"
                    },
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16557"
                    },
                    "issue": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16557"
                    },
                    "comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16557/comments"
                    },
                    "review_comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16557/comments"
                    },
                    "review_comment": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}"
                    },
                    "commits": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16557/commits"
                    },
                    "statuses": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/statuses/22b2cca388dc7a59259a686a1dff012206f2dcd4"
                    }
                },
                "author_association": "MEMBER",
                "auto_merge": null,
                "active_lock_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-27T11:34:35Z",
        "org": {
            "id": 8418310,
            "login": "matrix-org",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/matrix-org",
            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?"
        }
    },
    {
        "id": "32897181220",
        "type": "PullRequestReviewCommentEvent",
        "actor": {
            "id": 517124,
            "login": "clokep",
            "display_login": "clokep",
            "gravatar_id": "",
            "url": "https://api.github.com/users/clokep",
            "avatar_url": "https://avatars.githubusercontent.com/u/517124?"
        },
        "repo": {
            "id": 22844864,
            "name": "matrix-org/synapse",
            "url": "https://api.github.com/repos/matrix-org/synapse"
        },
        "payload": {
            "action": "created",
            "comment": {
                "url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments/1374439569",
                "pull_request_review_id": 1701569617,
                "id": 1374439569,
                "node_id": "PRRC_kwDOAVyVwM5R7EiR",
                "diff_hunk": "@@ -611,10 +611,14 @@ async def _process_position(\n         # Find where we previously streamed up to.\n         current_token = stream.current_token(cmd.instance_name)\n \n-        # If the position token matches our current token then we're up to\n-        # date and there's nothing to do. Otherwise, fetch all updates\n-        # between then and now.\n-        missing_updates = cmd.prev_token != current_token\n+        # If the position token matches our current token then we're up to date\n+        # and there's nothing to do. Otherwise, fetch all updates between then\n+        # and now.\n+        #\n+        # Note: We have to check that `current_token` is within the range, to\n+        # handle the case where the stream gets \"reset\" (e.g. for `caches` and\n+        # `typing` after the writer's restart).",
                "path": "synapse/replication/tcp/handler.py",
                "commit_id": "b43fc5e9c236d6082bc6c57fcadc58f72edf12b3",
                "original_commit_id": "b43fc5e9c236d6082bc6c57fcadc58f72edf12b3",
                "user": {
                    "login": "clokep",
                    "id": 517124,
                    "node_id": "MDQ6VXNlcjUxNzEyNA==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/517124?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/clokep",
                    "html_url": "https://github.com/clokep",
                    "followers_url": "https://api.github.com/users/clokep/followers",
                    "following_url": "https://api.github.com/users/clokep/following{/other_user}",
                    "gists_url": "https://api.github.com/users/clokep/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/clokep/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/clokep/subscriptions",
                    "organizations_url": "https://api.github.com/users/clokep/orgs",
                    "repos_url": "https://api.github.com/users/clokep/repos",
                    "events_url": "https://api.github.com/users/clokep/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/clokep/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "Does `POSITION` need some better documentation somewhere (either https://matrix-org.github.io/synapse/develop/development/synapse_architecture/streams.html or maybe in the code?) describing how it works? I think I was also under the impression that it told you were it had updates, not where it jumped to *without* updates.",
                "created_at": "2023-10-27T11:31:19Z",
                "updated_at": "2023-10-27T11:31:20Z",
                "html_url": "https://github.com/matrix-org/synapse/pull/16555#discussion_r1374439569",
                "pull_request_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555",
                "author_association": "MEMBER",
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/comments/1374439569"
                    },
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16555#discussion_r1374439569"
                    },
                    "pull_request": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555"
                    }
                },
                "reactions": {
                    "url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments/1374439569/reactions",
                    "total_count": 0,
                    "+1": 0,
                    "-1": 0,
                    "laugh": 0,
                    "hooray": 0,
                    "confused": 0,
                    "heart": 0,
                    "rocket": 0,
                    "eyes": 0
                },
                "start_line": 618,
                "original_start_line": 618,
                "start_side": "RIGHT",
                "line": 620,
                "original_line": 620,
                "side": "RIGHT",
                "in_reply_to_id": 1373639687,
                "original_position": 14,
                "position": 14,
                "subject_type": "line"
            },
            "pull_request": {
                "url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555",
                "id": 1574805820,
                "node_id": "PR_kwDOAVyVwM5d3aE8",
                "html_url": "https://github.com/matrix-org/synapse/pull/16555",
                "diff_url": "https://github.com/matrix-org/synapse/pull/16555.diff",
                "patch_url": "https://github.com/matrix-org/synapse/pull/16555.patch",
                "issue_url": "https://api.github.com/repos/matrix-org/synapse/issues/16555",
                "number": 16555,
                "state": "open",
                "locked": false,
                "title": "Reduce spurious replication catchup",
                "user": {
                    "login": "erikjohnston",
                    "id": 8428120,
                    "node_id": "MDQ6VXNlcjg0MjgxMjA=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/8428120?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/erikjohnston",
                    "html_url": "https://github.com/erikjohnston",
                    "followers_url": "https://api.github.com/users/erikjohnston/followers",
                    "following_url": "https://api.github.com/users/erikjohnston/following{/other_user}",
                    "gists_url": "https://api.github.com/users/erikjohnston/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/erikjohnston/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/erikjohnston/subscriptions",
                    "organizations_url": "https://api.github.com/users/erikjohnston/orgs",
                    "repos_url": "https://api.github.com/users/erikjohnston/repos",
                    "events_url": "https://api.github.com/users/erikjohnston/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/erikjohnston/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "The `POSITION` command includes two tokens, the \"prev\" and \"new\" tokens. The \"new\" token is what we should set the current token for the instance to be, and the \"prev\" token was where it was previously (i.e. the instance produced no rows between the \"prev\" and \"new\" tokens).\r\n\r\nThis means that we can safely relax the condition to only check for missing updates if the current token for the writer is strictly less than the \"prev\" token.\r\n\r\nA common case is receiving something like `POSITIONS event_persister1 events 15 16`, which indicates the writer advanced their events stream token from 15 to 16 (usually as a response to another instance persisting an event with stream ID 16). Usually, the other instances would already have inferred that `event_persister1` must have advanced their token, so the `current_token` would already be set to 16, thus triggering a lookup for missing updates between tokens 16 (`cmd.new_token`) and 16 (`current_token`), which is silly.\r\n\r\nWe also move the logging back into the loop so that we don't log in the common case.",
                "created_at": "2023-10-26T12:56:23Z",
                "updated_at": "2023-10-27T11:31:19Z",
                "closed_at": null,
                "merged_at": null,
                "merge_commit_sha": "77aef34c36fb73645a9598f9758fca579805b825",
                "assignee": null,
                "assignees": [],
                "requested_reviewers": [],
                "requested_teams": [],
                "labels": [],
                "milestone": null,
                "draft": false,
                "commits_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/commits",
                "review_comments_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/comments",
                "review_comment_url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}",
                "comments_url": "https://api.github.com/repos/matrix-org/synapse/issues/16555/comments",
                "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/b43fc5e9c236d6082bc6c57fcadc58f72edf12b3",
                "head": {
                    "label": "matrix-org:erikj/reduce_spurious_fetches",
                    "ref": "erikj/reduce_spurious_fetches",
                    "sha": "b43fc5e9c236d6082bc6c57fcadc58f72edf12b3",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-27T09:05:12Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 402149,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2162,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1516,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2162,
                        "open_issues": 1516,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "base": {
                    "label": "matrix-org:develop",
                    "ref": "develop",
                    "sha": "c14a7de6af0b8a3cbf2e17afca1cab339bc5912d",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-27T09:05:12Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 402149,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2162,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1516,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2162,
                        "open_issues": 1516,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555"
                    },
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16555"
                    },
                    "issue": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16555"
                    },
                    "comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16555/comments"
                    },
                    "review_comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/comments"
                    },
                    "review_comment": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}"
                    },
                    "commits": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/commits"
                    },
                    "statuses": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/statuses/b43fc5e9c236d6082bc6c57fcadc58f72edf12b3"
                    }
                },
                "author_association": "MEMBER",
                "auto_merge": null,
                "active_lock_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-27T11:31:19Z",
        "org": {
            "id": 8418310,
            "login": "matrix-org",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/matrix-org",
            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?"
        }
    },
    {
        "id": "32897181104",
        "type": "PullRequestReviewEvent",
        "actor": {
            "id": 517124,
            "login": "clokep",
            "display_login": "clokep",
            "gravatar_id": "",
            "url": "https://api.github.com/users/clokep",
            "avatar_url": "https://avatars.githubusercontent.com/u/517124?"
        },
        "repo": {
            "id": 22844864,
            "name": "matrix-org/synapse",
            "url": "https://api.github.com/repos/matrix-org/synapse"
        },
        "payload": {
            "action": "created",
            "review": {
                "id": 1701569617,
                "node_id": "PRR_kwDOAVyVwM5la-RR",
                "user": {
                    "login": "clokep",
                    "id": 517124,
                    "node_id": "MDQ6VXNlcjUxNzEyNA==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/517124?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/clokep",
                    "html_url": "https://github.com/clokep",
                    "followers_url": "https://api.github.com/users/clokep/followers",
                    "following_url": "https://api.github.com/users/clokep/following{/other_user}",
                    "gists_url": "https://api.github.com/users/clokep/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/clokep/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/clokep/subscriptions",
                    "organizations_url": "https://api.github.com/users/clokep/orgs",
                    "repos_url": "https://api.github.com/users/clokep/repos",
                    "events_url": "https://api.github.com/users/clokep/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/clokep/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": null,
                "commit_id": "b43fc5e9c236d6082bc6c57fcadc58f72edf12b3",
                "submitted_at": "2023-10-27T11:31:19Z",
                "state": "commented",
                "html_url": "https://github.com/matrix-org/synapse/pull/16555#pullrequestreview-1701569617",
                "pull_request_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555",
                "author_association": "MEMBER",
                "_links": {
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16555#pullrequestreview-1701569617"
                    },
                    "pull_request": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555"
                    }
                }
            },
            "pull_request": {
                "url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555",
                "id": 1574805820,
                "node_id": "PR_kwDOAVyVwM5d3aE8",
                "html_url": "https://github.com/matrix-org/synapse/pull/16555",
                "diff_url": "https://github.com/matrix-org/synapse/pull/16555.diff",
                "patch_url": "https://github.com/matrix-org/synapse/pull/16555.patch",
                "issue_url": "https://api.github.com/repos/matrix-org/synapse/issues/16555",
                "number": 16555,
                "state": "open",
                "locked": false,
                "title": "Reduce spurious replication catchup",
                "user": {
                    "login": "erikjohnston",
                    "id": 8428120,
                    "node_id": "MDQ6VXNlcjg0MjgxMjA=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/8428120?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/erikjohnston",
                    "html_url": "https://github.com/erikjohnston",
                    "followers_url": "https://api.github.com/users/erikjohnston/followers",
                    "following_url": "https://api.github.com/users/erikjohnston/following{/other_user}",
                    "gists_url": "https://api.github.com/users/erikjohnston/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/erikjohnston/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/erikjohnston/subscriptions",
                    "organizations_url": "https://api.github.com/users/erikjohnston/orgs",
                    "repos_url": "https://api.github.com/users/erikjohnston/repos",
                    "events_url": "https://api.github.com/users/erikjohnston/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/erikjohnston/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "The `POSITION` command includes two tokens, the \"prev\" and \"new\" tokens. The \"new\" token is what we should set the current token for the instance to be, and the \"prev\" token was where it was previously (i.e. the instance produced no rows between the \"prev\" and \"new\" tokens).\r\n\r\nThis means that we can safely relax the condition to only check for missing updates if the current token for the writer is strictly less than the \"prev\" token.\r\n\r\nA common case is receiving something like `POSITIONS event_persister1 events 15 16`, which indicates the writer advanced their events stream token from 15 to 16 (usually as a response to another instance persisting an event with stream ID 16). Usually, the other instances would already have inferred that `event_persister1` must have advanced their token, so the `current_token` would already be set to 16, thus triggering a lookup for missing updates between tokens 16 (`cmd.new_token`) and 16 (`current_token`), which is silly.\r\n\r\nWe also move the logging back into the loop so that we don't log in the common case.",
                "created_at": "2023-10-26T12:56:23Z",
                "updated_at": "2023-10-27T11:31:19Z",
                "closed_at": null,
                "merged_at": null,
                "merge_commit_sha": "77aef34c36fb73645a9598f9758fca579805b825",
                "assignee": null,
                "assignees": [],
                "requested_reviewers": [],
                "requested_teams": [],
                "labels": [],
                "milestone": null,
                "draft": false,
                "commits_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/commits",
                "review_comments_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/comments",
                "review_comment_url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}",
                "comments_url": "https://api.github.com/repos/matrix-org/synapse/issues/16555/comments",
                "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/b43fc5e9c236d6082bc6c57fcadc58f72edf12b3",
                "head": {
                    "label": "matrix-org:erikj/reduce_spurious_fetches",
                    "ref": "erikj/reduce_spurious_fetches",
                    "sha": "b43fc5e9c236d6082bc6c57fcadc58f72edf12b3",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-27T09:05:12Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 402149,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2162,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1516,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2162,
                        "open_issues": 1516,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "base": {
                    "label": "matrix-org:develop",
                    "ref": "develop",
                    "sha": "c14a7de6af0b8a3cbf2e17afca1cab339bc5912d",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-27T09:05:12Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 402149,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2162,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1516,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2162,
                        "open_issues": 1516,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555"
                    },
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16555"
                    },
                    "issue": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16555"
                    },
                    "comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16555/comments"
                    },
                    "review_comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/comments"
                    },
                    "review_comment": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}"
                    },
                    "commits": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/commits"
                    },
                    "statuses": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/statuses/b43fc5e9c236d6082bc6c57fcadc58f72edf12b3"
                    }
                },
                "author_association": "MEMBER",
                "auto_merge": null,
                "active_lock_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-27T11:31:20Z",
        "org": {
            "id": 8418310,
            "login": "matrix-org",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/matrix-org",
            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?"
        }
    },
    {
        "id": "32893459949",
        "type": "PushEvent",
        "actor": {
            "id": 41898282,
            "login": "github-actions[bot]",
            "display_login": "github-actions",
            "gravatar_id": "",
            "url": "https://api.github.com/users/github-actions[bot]",
            "avatar_url": "https://avatars.githubusercontent.com/u/41898282?"
        },
        "repo": {
            "id": 22844864,
            "name": "matrix-org/synapse",
            "url": "https://api.github.com/repos/matrix-org/synapse"
        },
        "payload": {
            "repository_id": 22844864,
            "push_id": 15589158050,
            "size": 1,
            "distinct_size": 1,
            "ref": "refs/heads/gh-pages",
            "head": "b1e8ea2b60116e9e5f6a056010a1a57740aaf01a",
            "before": "24dac01b54ab68e2240fdb5b7de5abda30fcfabb",
            "commits": [
                {
                    "sha": "b1e8ea2b60116e9e5f6a056010a1a57740aaf01a",
                    "author": {
                        "email": "erikjohnston@users.noreply.github.com",
                        "name": "erikjohnston"
                    },
                    "message": "deploy: c02406ac711095eedbeeff229af8e368f77196aa",
                    "distinct": true,
                    "url": "https://api.github.com/repos/matrix-org/synapse/commits/b1e8ea2b60116e9e5f6a056010a1a57740aaf01a"
                }
            ]
        },
        "public": true,
        "created_at": "2023-10-27T09:05:14Z",
        "org": {
            "id": 8418310,
            "login": "matrix-org",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/matrix-org",
            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?"
        }
    },
    {
        "id": "32893433837",
        "type": "DeleteEvent",
        "actor": {
            "id": 8428120,
            "login": "erikjohnston",
            "display_login": "erikjohnston",
            "gravatar_id": "",
            "url": "https://api.github.com/users/erikjohnston",
            "avatar_url": "https://avatars.githubusercontent.com/u/8428120?"
        },
        "repo": {
            "id": 22844864,
            "name": "matrix-org/synapse",
            "url": "https://api.github.com/repos/matrix-org/synapse"
        },
        "payload": {
            "ref": "erikj/events_unsigned_module_api",
            "ref_type": "branch",
            "pusher_type": "user"
        },
        "public": true,
        "created_at": "2023-10-27T09:04:14Z",
        "org": {
            "id": 8418310,
            "login": "matrix-org",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/matrix-org",
            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?"
        }
    },
    {
        "id": "32893432253",
        "type": "PushEvent",
        "actor": {
            "id": 8428120,
            "login": "erikjohnston",
            "display_login": "erikjohnston",
            "gravatar_id": "",
            "url": "https://api.github.com/users/erikjohnston",
            "avatar_url": "https://avatars.githubusercontent.com/u/8428120?"
        },
        "repo": {
            "id": 22844864,
            "name": "matrix-org/synapse",
            "url": "https://api.github.com/repos/matrix-org/synapse"
        },
        "payload": {
            "repository_id": 22844864,
            "push_id": 15589144680,
            "size": 1,
            "distinct_size": 1,
            "ref": "refs/heads/develop",
            "head": "c02406ac711095eedbeeff229af8e368f77196aa",
            "before": "679c691f6f7c4f7901e6d075a645a8ade20f44d5",
            "commits": [
                {
                    "sha": "c02406ac711095eedbeeff229af8e368f77196aa",
                    "author": {
                        "email": "erikj@matrix.org",
                        "name": "Erik Johnston"
                    },
                    "message": "Add new module API for adding custom fields to events `unsigned` section (#16549)",
                    "distinct": true,
                    "url": "https://api.github.com/repos/matrix-org/synapse/commits/c02406ac711095eedbeeff229af8e368f77196aa"
                }
            ]
        },
        "public": true,
        "created_at": "2023-10-27T09:04:10Z",
        "org": {
            "id": 8418310,
            "login": "matrix-org",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/matrix-org",
            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?"
        }
    },
    {
        "id": "32893431869",
        "type": "PullRequestEvent",
        "actor": {
            "id": 8428120,
            "login": "erikjohnston",
            "display_login": "erikjohnston",
            "gravatar_id": "",
            "url": "https://api.github.com/users/erikjohnston",
            "avatar_url": "https://avatars.githubusercontent.com/u/8428120?"
        },
        "repo": {
            "id": 22844864,
            "name": "matrix-org/synapse",
            "url": "https://api.github.com/repos/matrix-org/synapse"
        },
        "payload": {
            "action": "closed",
            "number": 16549,
            "pull_request": {
                "url": "https://api.github.com/repos/matrix-org/synapse/pulls/16549",
                "id": 1572563003,
                "node_id": "PR_kwDOAVyVwM5du2g7",
                "html_url": "https://github.com/matrix-org/synapse/pull/16549",
                "diff_url": "https://github.com/matrix-org/synapse/pull/16549.diff",
                "patch_url": "https://github.com/matrix-org/synapse/pull/16549.patch",
                "issue_url": "https://api.github.com/repos/matrix-org/synapse/issues/16549",
                "number": 16549,
                "state": "closed",
                "locked": false,
                "title": "Add new module API for adding custom fields to events `unsigned` section",
                "user": {
                    "login": "erikjohnston",
                    "id": 8428120,
                    "node_id": "MDQ6VXNlcjg0MjgxMjA=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/8428120?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/erikjohnston",
                    "html_url": "https://github.com/erikjohnston",
                    "followers_url": "https://api.github.com/users/erikjohnston/followers",
                    "following_url": "https://api.github.com/users/erikjohnston/following{/other_user}",
                    "gists_url": "https://api.github.com/users/erikjohnston/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/erikjohnston/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/erikjohnston/subscriptions",
                    "organizations_url": "https://api.github.com/users/erikjohnston/orgs",
                    "repos_url": "https://api.github.com/users/erikjohnston/repos",
                    "events_url": "https://api.github.com/users/erikjohnston/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/erikjohnston/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": null,
                "created_at": "2023-10-25T09:53:18Z",
                "updated_at": "2023-10-27T09:04:09Z",
                "closed_at": "2023-10-27T09:04:08Z",
                "merged_at": "2023-10-27T09:04:08Z",
                "merge_commit_sha": "c02406ac711095eedbeeff229af8e368f77196aa",
                "assignee": null,
                "assignees": [],
                "requested_reviewers": [],
                "requested_teams": [],
                "labels": [],
                "milestone": null,
                "draft": false,
                "commits_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16549/commits",
                "review_comments_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16549/comments",
                "review_comment_url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}",
                "comments_url": "https://api.github.com/repos/matrix-org/synapse/issues/16549/comments",
                "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/2d35a23ee4b47d465efdf23e0d39cba1bb9cb4f7",
                "head": {
                    "label": "matrix-org:erikj/events_unsigned_module_api",
                    "ref": "erikj/events_unsigned_module_api",
                    "sha": "2d35a23ee4b47d465efdf23e0d39cba1bb9cb4f7",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-27T09:04:08Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 400535,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2162,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1516,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2162,
                        "open_issues": 1516,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "base": {
                    "label": "matrix-org:develop",
                    "ref": "develop",
                    "sha": "95076f77c1b370ecef780c7bbf631bd34868c982",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-27T09:04:08Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 400535,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2162,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1516,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2162,
                        "open_issues": 1516,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16549"
                    },
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16549"
                    },
                    "issue": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16549"
                    },
                    "comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16549/comments"
                    },
                    "review_comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16549/comments"
                    },
                    "review_comment": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}"
                    },
                    "commits": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16549/commits"
                    },
                    "statuses": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/statuses/2d35a23ee4b47d465efdf23e0d39cba1bb9cb4f7"
                    }
                },
                "author_association": "MEMBER",
                "auto_merge": {
                    "enabled_by": {
                        "login": "erikjohnston",
                        "id": 8428120,
                        "node_id": "MDQ6VXNlcjg0MjgxMjA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8428120?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/erikjohnston",
                        "html_url": "https://github.com/erikjohnston",
                        "followers_url": "https://api.github.com/users/erikjohnston/followers",
                        "following_url": "https://api.github.com/users/erikjohnston/following{/other_user}",
                        "gists_url": "https://api.github.com/users/erikjohnston/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/erikjohnston/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/erikjohnston/subscriptions",
                        "organizations_url": "https://api.github.com/users/erikjohnston/orgs",
                        "repos_url": "https://api.github.com/users/erikjohnston/repos",
                        "events_url": "https://api.github.com/users/erikjohnston/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/erikjohnston/received_events",
                        "type": "User",
                        "site_admin": false
                    },
                    "merge_method": "squash",
                    "commit_title": "Add new module API for adding custom fields to events `unsigned` section (#16549)",
                    "commit_message": ""
                },
                "active_lock_reason": null,
                "merged": true,
                "mergeable": null,
                "rebaseable": null,
                "mergeable_state": "unknown",
                "merged_by": {
                    "login": "erikjohnston",
                    "id": 8428120,
                    "node_id": "MDQ6VXNlcjg0MjgxMjA=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/8428120?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/erikjohnston",
                    "html_url": "https://github.com/erikjohnston",
                    "followers_url": "https://api.github.com/users/erikjohnston/followers",
                    "following_url": "https://api.github.com/users/erikjohnston/following{/other_user}",
                    "gists_url": "https://api.github.com/users/erikjohnston/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/erikjohnston/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/erikjohnston/subscriptions",
                    "organizations_url": "https://api.github.com/users/erikjohnston/orgs",
                    "repos_url": "https://api.github.com/users/erikjohnston/repos",
                    "events_url": "https://api.github.com/users/erikjohnston/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/erikjohnston/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "comments": 0,
                "review_comments": 3,
                "maintainer_can_modify": false,
                "commits": 8,
                "additions": 194,
                "deletions": 44,
                "changed_files": 19
            }
        },
        "public": true,
        "created_at": "2023-10-27T09:04:10Z",
        "org": {
            "id": 8418310,
            "login": "matrix-org",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/matrix-org",
            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?"
        }
    },
    {
        "id": "32893053224",
        "type": "PullRequestReviewCommentEvent",
        "actor": {
            "id": 8428120,
            "login": "erikjohnston",
            "display_login": "erikjohnston",
            "gravatar_id": "",
            "url": "https://api.github.com/users/erikjohnston",
            "avatar_url": "https://avatars.githubusercontent.com/u/8428120?"
        },
        "repo": {
            "id": 22844864,
            "name": "matrix-org/synapse",
            "url": "https://api.github.com/repos/matrix-org/synapse"
        },
        "payload": {
            "action": "created",
            "comment": {
                "url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments/1374268514",
                "pull_request_review_id": 1701300217,
                "id": 1374268514,
                "node_id": "PRRC_kwDOAVyVwM5R6axi",
                "diff_hunk": "@@ -611,10 +611,14 @@ async def _process_position(\n         # Find where we previously streamed up to.\n         current_token = stream.current_token(cmd.instance_name)\n \n-        # If the position token matches our current token then we're up to\n-        # date and there's nothing to do. Otherwise, fetch all updates\n-        # between then and now.\n-        missing_updates = cmd.prev_token != current_token\n+        # If the position token matches our current token then we're up to date\n+        # and there's nothing to do. Otherwise, fetch all updates between then\n+        # and now.\n+        #\n+        # Note: We have to check that `current_token` is within the range, to\n+        # handle the case where the stream gets \"reset\" (e.g. for `caches` and\n+        # `typing` after the writer's restart).",
                "path": "synapse/replication/tcp/handler.py",
                "commit_id": "b43fc5e9c236d6082bc6c57fcadc58f72edf12b3",
                "original_commit_id": "b43fc5e9c236d6082bc6c57fcadc58f72edf12b3",
                "user": {
                    "login": "erikjohnston",
                    "id": 8428120,
                    "node_id": "MDQ6VXNlcjg0MjgxMjA=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/8428120?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/erikjohnston",
                    "html_url": "https://github.com/erikjohnston",
                    "followers_url": "https://api.github.com/users/erikjohnston/followers",
                    "following_url": "https://api.github.com/users/erikjohnston/following{/other_user}",
                    "gists_url": "https://api.github.com/users/erikjohnston/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/erikjohnston/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/erikjohnston/subscriptions",
                    "organizations_url": "https://api.github.com/users/erikjohnston/orgs",
                    "repos_url": "https://api.github.com/users/erikjohnston/repos",
                    "events_url": "https://api.github.com/users/erikjohnston/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/erikjohnston/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "> Uh oh, I might have missed stream entries 11, 12, 13, 14, and 15. Need to rescan for them.\r\n\r\nYou might have missed entries 11 and 12. ",
                "created_at": "2023-10-27T08:50:03Z",
                "updated_at": "2023-10-27T08:50:03Z",
                "html_url": "https://github.com/matrix-org/synapse/pull/16555#discussion_r1374268514",
                "pull_request_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555",
                "author_association": "MEMBER",
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/comments/1374268514"
                    },
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16555#discussion_r1374268514"
                    },
                    "pull_request": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555"
                    }
                },
                "reactions": {
                    "url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments/1374268514/reactions",
                    "total_count": 0,
                    "+1": 0,
                    "-1": 0,
                    "laugh": 0,
                    "hooray": 0,
                    "confused": 0,
                    "heart": 0,
                    "rocket": 0,
                    "eyes": 0
                },
                "start_line": 618,
                "original_start_line": 618,
                "start_side": "RIGHT",
                "line": 620,
                "original_line": 620,
                "side": "RIGHT",
                "in_reply_to_id": 1373639687,
                "original_position": 14,
                "position": 14,
                "subject_type": "line"
            },
            "pull_request": {
                "url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555",
                "id": 1574805820,
                "node_id": "PR_kwDOAVyVwM5d3aE8",
                "html_url": "https://github.com/matrix-org/synapse/pull/16555",
                "diff_url": "https://github.com/matrix-org/synapse/pull/16555.diff",
                "patch_url": "https://github.com/matrix-org/synapse/pull/16555.patch",
                "issue_url": "https://api.github.com/repos/matrix-org/synapse/issues/16555",
                "number": 16555,
                "state": "open",
                "locked": false,
                "title": "Reduce spurious replication catchup",
                "user": {
                    "login": "erikjohnston",
                    "id": 8428120,
                    "node_id": "MDQ6VXNlcjg0MjgxMjA=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/8428120?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/erikjohnston",
                    "html_url": "https://github.com/erikjohnston",
                    "followers_url": "https://api.github.com/users/erikjohnston/followers",
                    "following_url": "https://api.github.com/users/erikjohnston/following{/other_user}",
                    "gists_url": "https://api.github.com/users/erikjohnston/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/erikjohnston/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/erikjohnston/subscriptions",
                    "organizations_url": "https://api.github.com/users/erikjohnston/orgs",
                    "repos_url": "https://api.github.com/users/erikjohnston/repos",
                    "events_url": "https://api.github.com/users/erikjohnston/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/erikjohnston/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "The `POSITION` command includes two tokens, the \"prev\" and \"new\" tokens. The \"new\" token is what we should set the current token for the instance to be, and the \"prev\" token was where it was previously (i.e. the instance produced no rows between the \"prev\" and \"new\" tokens).\r\n\r\nThis means that we can safely relax the condition to only check for missing updates if the current token for the writer is strictly less than the \"prev\" token.\r\n\r\nA common case is receiving something like `POSITIONS event_persister1 events 15 16`, which indicates the writer advanced their events stream token from 15 to 16 (usually as a response to another instance persisting an event with stream ID 16). Usually, the other instances would already have inferred that `event_persister1` must have advanced their token, so the `current_token` would already be set to 16, thus triggering a lookup for missing updates between tokens 16 (`cmd.new_token`) and 16 (`current_token`), which is silly.\r\n\r\nWe also move the logging back into the loop so that we don't log in the common case.",
                "created_at": "2023-10-26T12:56:23Z",
                "updated_at": "2023-10-27T08:50:03Z",
                "closed_at": null,
                "merged_at": null,
                "merge_commit_sha": "b5ac770290c13ddd526d1bf05f651f8cf86ac662",
                "assignee": null,
                "assignees": [],
                "requested_reviewers": [],
                "requested_teams": [],
                "labels": [],
                "milestone": null,
                "draft": false,
                "commits_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/commits",
                "review_comments_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/comments",
                "review_comment_url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}",
                "comments_url": "https://api.github.com/repos/matrix-org/synapse/issues/16555/comments",
                "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/b43fc5e9c236d6082bc6c57fcadc58f72edf12b3",
                "head": {
                    "label": "matrix-org:erikj/reduce_spurious_fetches",
                    "ref": "erikj/reduce_spurious_fetches",
                    "sha": "b43fc5e9c236d6082bc6c57fcadc58f72edf12b3",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-27T08:31:37Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 400535,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2162,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1517,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2162,
                        "open_issues": 1517,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "base": {
                    "label": "matrix-org:develop",
                    "ref": "develop",
                    "sha": "c14a7de6af0b8a3cbf2e17afca1cab339bc5912d",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-27T08:31:37Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 400535,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2162,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1517,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2162,
                        "open_issues": 1517,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555"
                    },
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16555"
                    },
                    "issue": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16555"
                    },
                    "comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16555/comments"
                    },
                    "review_comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/comments"
                    },
                    "review_comment": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}"
                    },
                    "commits": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/commits"
                    },
                    "statuses": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/statuses/b43fc5e9c236d6082bc6c57fcadc58f72edf12b3"
                    }
                },
                "author_association": "MEMBER",
                "auto_merge": null,
                "active_lock_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-27T08:50:03Z",
        "org": {
            "id": 8418310,
            "login": "matrix-org",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/matrix-org",
            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?"
        }
    },
    {
        "id": "32893053121",
        "type": "PullRequestReviewEvent",
        "actor": {
            "id": 8428120,
            "login": "erikjohnston",
            "display_login": "erikjohnston",
            "gravatar_id": "",
            "url": "https://api.github.com/users/erikjohnston",
            "avatar_url": "https://avatars.githubusercontent.com/u/8428120?"
        },
        "repo": {
            "id": 22844864,
            "name": "matrix-org/synapse",
            "url": "https://api.github.com/repos/matrix-org/synapse"
        },
        "payload": {
            "action": "created",
            "review": {
                "id": 1701300217,
                "node_id": "PRR_kwDOAVyVwM5lZ8f5",
                "user": {
                    "login": "erikjohnston",
                    "id": 8428120,
                    "node_id": "MDQ6VXNlcjg0MjgxMjA=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/8428120?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/erikjohnston",
                    "html_url": "https://github.com/erikjohnston",
                    "followers_url": "https://api.github.com/users/erikjohnston/followers",
                    "following_url": "https://api.github.com/users/erikjohnston/following{/other_user}",
                    "gists_url": "https://api.github.com/users/erikjohnston/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/erikjohnston/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/erikjohnston/subscriptions",
                    "organizations_url": "https://api.github.com/users/erikjohnston/orgs",
                    "repos_url": "https://api.github.com/users/erikjohnston/repos",
                    "events_url": "https://api.github.com/users/erikjohnston/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/erikjohnston/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": null,
                "commit_id": "b43fc5e9c236d6082bc6c57fcadc58f72edf12b3",
                "submitted_at": "2023-10-27T08:50:03Z",
                "state": "commented",
                "html_url": "https://github.com/matrix-org/synapse/pull/16555#pullrequestreview-1701300217",
                "pull_request_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555",
                "author_association": "MEMBER",
                "_links": {
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16555#pullrequestreview-1701300217"
                    },
                    "pull_request": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555"
                    }
                }
            },
            "pull_request": {
                "url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555",
                "id": 1574805820,
                "node_id": "PR_kwDOAVyVwM5d3aE8",
                "html_url": "https://github.com/matrix-org/synapse/pull/16555",
                "diff_url": "https://github.com/matrix-org/synapse/pull/16555.diff",
                "patch_url": "https://github.com/matrix-org/synapse/pull/16555.patch",
                "issue_url": "https://api.github.com/repos/matrix-org/synapse/issues/16555",
                "number": 16555,
                "state": "open",
                "locked": false,
                "title": "Reduce spurious replication catchup",
                "user": {
                    "login": "erikjohnston",
                    "id": 8428120,
                    "node_id": "MDQ6VXNlcjg0MjgxMjA=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/8428120?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/erikjohnston",
                    "html_url": "https://github.com/erikjohnston",
                    "followers_url": "https://api.github.com/users/erikjohnston/followers",
                    "following_url": "https://api.github.com/users/erikjohnston/following{/other_user}",
                    "gists_url": "https://api.github.com/users/erikjohnston/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/erikjohnston/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/erikjohnston/subscriptions",
                    "organizations_url": "https://api.github.com/users/erikjohnston/orgs",
                    "repos_url": "https://api.github.com/users/erikjohnston/repos",
                    "events_url": "https://api.github.com/users/erikjohnston/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/erikjohnston/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "The `POSITION` command includes two tokens, the \"prev\" and \"new\" tokens. The \"new\" token is what we should set the current token for the instance to be, and the \"prev\" token was where it was previously (i.e. the instance produced no rows between the \"prev\" and \"new\" tokens).\r\n\r\nThis means that we can safely relax the condition to only check for missing updates if the current token for the writer is strictly less than the \"prev\" token.\r\n\r\nA common case is receiving something like `POSITIONS event_persister1 events 15 16`, which indicates the writer advanced their events stream token from 15 to 16 (usually as a response to another instance persisting an event with stream ID 16). Usually, the other instances would already have inferred that `event_persister1` must have advanced their token, so the `current_token` would already be set to 16, thus triggering a lookup for missing updates between tokens 16 (`cmd.new_token`) and 16 (`current_token`), which is silly.\r\n\r\nWe also move the logging back into the loop so that we don't log in the common case.",
                "created_at": "2023-10-26T12:56:23Z",
                "updated_at": "2023-10-27T08:50:03Z",
                "closed_at": null,
                "merged_at": null,
                "merge_commit_sha": "b5ac770290c13ddd526d1bf05f651f8cf86ac662",
                "assignee": null,
                "assignees": [],
                "requested_reviewers": [],
                "requested_teams": [],
                "labels": [],
                "milestone": null,
                "draft": false,
                "commits_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/commits",
                "review_comments_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/comments",
                "review_comment_url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}",
                "comments_url": "https://api.github.com/repos/matrix-org/synapse/issues/16555/comments",
                "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/b43fc5e9c236d6082bc6c57fcadc58f72edf12b3",
                "head": {
                    "label": "matrix-org:erikj/reduce_spurious_fetches",
                    "ref": "erikj/reduce_spurious_fetches",
                    "sha": "b43fc5e9c236d6082bc6c57fcadc58f72edf12b3",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-27T08:31:37Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 400535,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2162,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1517,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2162,
                        "open_issues": 1517,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "base": {
                    "label": "matrix-org:develop",
                    "ref": "develop",
                    "sha": "c14a7de6af0b8a3cbf2e17afca1cab339bc5912d",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-27T08:31:37Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 400535,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2162,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1517,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2162,
                        "open_issues": 1517,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555"
                    },
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16555"
                    },
                    "issue": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16555"
                    },
                    "comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16555/comments"
                    },
                    "review_comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/comments"
                    },
                    "review_comment": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}"
                    },
                    "commits": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/commits"
                    },
                    "statuses": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/statuses/b43fc5e9c236d6082bc6c57fcadc58f72edf12b3"
                    }
                },
                "author_association": "MEMBER",
                "auto_merge": null,
                "active_lock_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-27T08:50:04Z",
        "org": {
            "id": 8418310,
            "login": "matrix-org",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/matrix-org",
            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?"
        }
    },
    {
        "id": "32893037317",
        "type": "PullRequestReviewCommentEvent",
        "actor": {
            "id": 8428120,
            "login": "erikjohnston",
            "display_login": "erikjohnston",
            "gravatar_id": "",
            "url": "https://api.github.com/users/erikjohnston",
            "avatar_url": "https://avatars.githubusercontent.com/u/8428120?"
        },
        "repo": {
            "id": 22844864,
            "name": "matrix-org/synapse",
            "url": "https://api.github.com/repos/matrix-org/synapse"
        },
        "payload": {
            "action": "created",
            "comment": {
                "url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments/1374267814",
                "pull_request_review_id": 1701298779,
                "id": 1374267814,
                "node_id": "PRRC_kwDOAVyVwM5R6amm",
                "diff_hunk": "@@ -611,10 +611,14 @@ async def _process_position(\n         # Find where we previously streamed up to.\n         current_token = stream.current_token(cmd.instance_name)\n \n-        # If the position token matches our current token then we're up to\n-        # date and there's nothing to do. Otherwise, fetch all updates\n-        # between then and now.\n-        missing_updates = cmd.prev_token != current_token\n+        # If the position token matches our current token then we're up to date\n+        # and there's nothing to do. Otherwise, fetch all updates between then\n+        # and now.",
                "path": "synapse/replication/tcp/handler.py",
                "commit_id": "b43fc5e9c236d6082bc6c57fcadc58f72edf12b3",
                "original_commit_id": "b43fc5e9c236d6082bc6c57fcadc58f72edf12b3",
                "user": {
                    "login": "erikjohnston",
                    "id": 8428120,
                    "node_id": "MDQ6VXNlcjg0MjgxMjA=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/8428120?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/erikjohnston",
                    "html_url": "https://github.com/erikjohnston",
                    "followers_url": "https://api.github.com/users/erikjohnston/followers",
                    "following_url": "https://api.github.com/users/erikjohnston/following{/other_user}",
                    "gists_url": "https://api.github.com/users/erikjohnston/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/erikjohnston/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/erikjohnston/subscriptions",
                    "organizations_url": "https://api.github.com/users/erikjohnston/orgs",
                    "repos_url": "https://api.github.com/users/erikjohnston/repos",
                    "events_url": "https://api.github.com/users/erikjohnston/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/erikjohnston/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "```suggestion\r\n        # If the incoming previous position is less than our current position\r\n\t    # then we're  up to date and there's nothing to do. Otherwise, fetch\r\n\t    # all updates between then and now.\r\n```\r\n\r\nMaybe?",
                "created_at": "2023-10-27T08:49:26Z",
                "updated_at": "2023-10-27T08:49:27Z",
                "html_url": "https://github.com/matrix-org/synapse/pull/16555#discussion_r1374267814",
                "pull_request_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555",
                "author_association": "MEMBER",
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/comments/1374267814"
                    },
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16555#discussion_r1374267814"
                    },
                    "pull_request": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555"
                    }
                },
                "reactions": {
                    "url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments/1374267814/reactions",
                    "total_count": 0,
                    "+1": 0,
                    "-1": 0,
                    "laugh": 0,
                    "hooray": 0,
                    "confused": 0,
                    "heart": 0,
                    "rocket": 0,
                    "eyes": 0
                },
                "start_line": 614,
                "original_start_line": 614,
                "start_side": "RIGHT",
                "line": 616,
                "original_line": 616,
                "side": "RIGHT",
                "in_reply_to_id": 1373634825,
                "original_position": 10,
                "position": 10,
                "subject_type": "line"
            },
            "pull_request": {
                "url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555",
                "id": 1574805820,
                "node_id": "PR_kwDOAVyVwM5d3aE8",
                "html_url": "https://github.com/matrix-org/synapse/pull/16555",
                "diff_url": "https://github.com/matrix-org/synapse/pull/16555.diff",
                "patch_url": "https://github.com/matrix-org/synapse/pull/16555.patch",
                "issue_url": "https://api.github.com/repos/matrix-org/synapse/issues/16555",
                "number": 16555,
                "state": "open",
                "locked": false,
                "title": "Reduce spurious replication catchup",
                "user": {
                    "login": "erikjohnston",
                    "id": 8428120,
                    "node_id": "MDQ6VXNlcjg0MjgxMjA=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/8428120?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/erikjohnston",
                    "html_url": "https://github.com/erikjohnston",
                    "followers_url": "https://api.github.com/users/erikjohnston/followers",
                    "following_url": "https://api.github.com/users/erikjohnston/following{/other_user}",
                    "gists_url": "https://api.github.com/users/erikjohnston/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/erikjohnston/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/erikjohnston/subscriptions",
                    "organizations_url": "https://api.github.com/users/erikjohnston/orgs",
                    "repos_url": "https://api.github.com/users/erikjohnston/repos",
                    "events_url": "https://api.github.com/users/erikjohnston/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/erikjohnston/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "The `POSITION` command includes two tokens, the \"prev\" and \"new\" tokens. The \"new\" token is what we should set the current token for the instance to be, and the \"prev\" token was where it was previously (i.e. the instance produced no rows between the \"prev\" and \"new\" tokens).\r\n\r\nThis means that we can safely relax the condition to only check for missing updates if the current token for the writer is strictly less than the \"prev\" token.\r\n\r\nA common case is receiving something like `POSITIONS event_persister1 events 15 16`, which indicates the writer advanced their events stream token from 15 to 16 (usually as a response to another instance persisting an event with stream ID 16). Usually, the other instances would already have inferred that `event_persister1` must have advanced their token, so the `current_token` would already be set to 16, thus triggering a lookup for missing updates between tokens 16 (`cmd.new_token`) and 16 (`current_token`), which is silly.\r\n\r\nWe also move the logging back into the loop so that we don't log in the common case.",
                "created_at": "2023-10-26T12:56:23Z",
                "updated_at": "2023-10-27T08:49:27Z",
                "closed_at": null,
                "merged_at": null,
                "merge_commit_sha": "b5ac770290c13ddd526d1bf05f651f8cf86ac662",
                "assignee": null,
                "assignees": [],
                "requested_reviewers": [],
                "requested_teams": [],
                "labels": [],
                "milestone": null,
                "draft": false,
                "commits_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/commits",
                "review_comments_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/comments",
                "review_comment_url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}",
                "comments_url": "https://api.github.com/repos/matrix-org/synapse/issues/16555/comments",
                "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/b43fc5e9c236d6082bc6c57fcadc58f72edf12b3",
                "head": {
                    "label": "matrix-org:erikj/reduce_spurious_fetches",
                    "ref": "erikj/reduce_spurious_fetches",
                    "sha": "b43fc5e9c236d6082bc6c57fcadc58f72edf12b3",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-27T08:31:37Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 400535,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2162,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1517,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2162,
                        "open_issues": 1517,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "base": {
                    "label": "matrix-org:develop",
                    "ref": "develop",
                    "sha": "c14a7de6af0b8a3cbf2e17afca1cab339bc5912d",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-27T08:31:37Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 400535,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2162,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1517,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2162,
                        "open_issues": 1517,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555"
                    },
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16555"
                    },
                    "issue": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16555"
                    },
                    "comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16555/comments"
                    },
                    "review_comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/comments"
                    },
                    "review_comment": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}"
                    },
                    "commits": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/commits"
                    },
                    "statuses": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/statuses/b43fc5e9c236d6082bc6c57fcadc58f72edf12b3"
                    }
                },
                "author_association": "MEMBER",
                "auto_merge": null,
                "active_lock_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-27T08:49:26Z",
        "org": {
            "id": 8418310,
            "login": "matrix-org",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/matrix-org",
            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?"
        }
    },
    {
        "id": "32893037249",
        "type": "PullRequestReviewEvent",
        "actor": {
            "id": 8428120,
            "login": "erikjohnston",
            "display_login": "erikjohnston",
            "gravatar_id": "",
            "url": "https://api.github.com/users/erikjohnston",
            "avatar_url": "https://avatars.githubusercontent.com/u/8428120?"
        },
        "repo": {
            "id": 22844864,
            "name": "matrix-org/synapse",
            "url": "https://api.github.com/repos/matrix-org/synapse"
        },
        "payload": {
            "action": "created",
            "review": {
                "id": 1701298779,
                "node_id": "PRR_kwDOAVyVwM5lZ8Jb",
                "user": {
                    "login": "erikjohnston",
                    "id": 8428120,
                    "node_id": "MDQ6VXNlcjg0MjgxMjA=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/8428120?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/erikjohnston",
                    "html_url": "https://github.com/erikjohnston",
                    "followers_url": "https://api.github.com/users/erikjohnston/followers",
                    "following_url": "https://api.github.com/users/erikjohnston/following{/other_user}",
                    "gists_url": "https://api.github.com/users/erikjohnston/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/erikjohnston/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/erikjohnston/subscriptions",
                    "organizations_url": "https://api.github.com/users/erikjohnston/orgs",
                    "repos_url": "https://api.github.com/users/erikjohnston/repos",
                    "events_url": "https://api.github.com/users/erikjohnston/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/erikjohnston/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": null,
                "commit_id": "b43fc5e9c236d6082bc6c57fcadc58f72edf12b3",
                "submitted_at": "2023-10-27T08:49:27Z",
                "state": "commented",
                "html_url": "https://github.com/matrix-org/synapse/pull/16555#pullrequestreview-1701298779",
                "pull_request_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555",
                "author_association": "MEMBER",
                "_links": {
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16555#pullrequestreview-1701298779"
                    },
                    "pull_request": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555"
                    }
                }
            },
            "pull_request": {
                "url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555",
                "id": 1574805820,
                "node_id": "PR_kwDOAVyVwM5d3aE8",
                "html_url": "https://github.com/matrix-org/synapse/pull/16555",
                "diff_url": "https://github.com/matrix-org/synapse/pull/16555.diff",
                "patch_url": "https://github.com/matrix-org/synapse/pull/16555.patch",
                "issue_url": "https://api.github.com/repos/matrix-org/synapse/issues/16555",
                "number": 16555,
                "state": "open",
                "locked": false,
                "title": "Reduce spurious replication catchup",
                "user": {
                    "login": "erikjohnston",
                    "id": 8428120,
                    "node_id": "MDQ6VXNlcjg0MjgxMjA=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/8428120?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/erikjohnston",
                    "html_url": "https://github.com/erikjohnston",
                    "followers_url": "https://api.github.com/users/erikjohnston/followers",
                    "following_url": "https://api.github.com/users/erikjohnston/following{/other_user}",
                    "gists_url": "https://api.github.com/users/erikjohnston/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/erikjohnston/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/erikjohnston/subscriptions",
                    "organizations_url": "https://api.github.com/users/erikjohnston/orgs",
                    "repos_url": "https://api.github.com/users/erikjohnston/repos",
                    "events_url": "https://api.github.com/users/erikjohnston/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/erikjohnston/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "The `POSITION` command includes two tokens, the \"prev\" and \"new\" tokens. The \"new\" token is what we should set the current token for the instance to be, and the \"prev\" token was where it was previously (i.e. the instance produced no rows between the \"prev\" and \"new\" tokens).\r\n\r\nThis means that we can safely relax the condition to only check for missing updates if the current token for the writer is strictly less than the \"prev\" token.\r\n\r\nA common case is receiving something like `POSITIONS event_persister1 events 15 16`, which indicates the writer advanced their events stream token from 15 to 16 (usually as a response to another instance persisting an event with stream ID 16). Usually, the other instances would already have inferred that `event_persister1` must have advanced their token, so the `current_token` would already be set to 16, thus triggering a lookup for missing updates between tokens 16 (`cmd.new_token`) and 16 (`current_token`), which is silly.\r\n\r\nWe also move the logging back into the loop so that we don't log in the common case.",
                "created_at": "2023-10-26T12:56:23Z",
                "updated_at": "2023-10-27T08:49:27Z",
                "closed_at": null,
                "merged_at": null,
                "merge_commit_sha": "b5ac770290c13ddd526d1bf05f651f8cf86ac662",
                "assignee": null,
                "assignees": [],
                "requested_reviewers": [],
                "requested_teams": [],
                "labels": [],
                "milestone": null,
                "draft": false,
                "commits_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/commits",
                "review_comments_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/comments",
                "review_comment_url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}",
                "comments_url": "https://api.github.com/repos/matrix-org/synapse/issues/16555/comments",
                "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/b43fc5e9c236d6082bc6c57fcadc58f72edf12b3",
                "head": {
                    "label": "matrix-org:erikj/reduce_spurious_fetches",
                    "ref": "erikj/reduce_spurious_fetches",
                    "sha": "b43fc5e9c236d6082bc6c57fcadc58f72edf12b3",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-27T08:31:37Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 400535,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2162,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1517,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2162,
                        "open_issues": 1517,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "base": {
                    "label": "matrix-org:develop",
                    "ref": "develop",
                    "sha": "c14a7de6af0b8a3cbf2e17afca1cab339bc5912d",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-27T08:31:37Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 400535,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2162,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1517,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2162,
                        "open_issues": 1517,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555"
                    },
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16555"
                    },
                    "issue": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16555"
                    },
                    "comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16555/comments"
                    },
                    "review_comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/comments"
                    },
                    "review_comment": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}"
                    },
                    "commits": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/commits"
                    },
                    "statuses": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/statuses/b43fc5e9c236d6082bc6c57fcadc58f72edf12b3"
                    }
                },
                "author_association": "MEMBER",
                "auto_merge": null,
                "active_lock_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-27T08:49:27Z",
        "org": {
            "id": 8418310,
            "login": "matrix-org",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/matrix-org",
            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?"
        }
    },
    {
        "id": "32892892934",
        "type": "PullRequestReviewCommentEvent",
        "actor": {
            "id": 8428120,
            "login": "erikjohnston",
            "display_login": "erikjohnston",
            "gravatar_id": "",
            "url": "https://api.github.com/users/erikjohnston",
            "avatar_url": "https://avatars.githubusercontent.com/u/8428120?"
        },
        "repo": {
            "id": 22844864,
            "name": "matrix-org/synapse",
            "url": "https://api.github.com/repos/matrix-org/synapse"
        },
        "payload": {
            "action": "created",
            "comment": {
                "url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments/1374261662",
                "pull_request_review_id": 1701288969,
                "id": 1374261662,
                "node_id": "PRRC_kwDOAVyVwM5R6ZGe",
                "diff_hunk": "@@ -611,10 +611,14 @@ async def _process_position(\n         # Find where we previously streamed up to.\n         current_token = stream.current_token(cmd.instance_name)\n \n-        # If the position token matches our current token then we're up to\n-        # date and there's nothing to do. Otherwise, fetch all updates\n-        # between then and now.\n-        missing_updates = cmd.prev_token != current_token\n+        # If the position token matches our current token then we're up to date\n+        # and there's nothing to do. Otherwise, fetch all updates between then\n+        # and now.\n+        #\n+        # Note: We have to check that `current_token` is within the range, to\n+        # handle the case where the stream gets \"reset\" (e.g. for `caches` and\n+        # `typing` after the writer's restart).\n+        missing_updates = not (cmd.prev_token <= current_token <= cmd.new_token)",
                "path": "synapse/replication/tcp/handler.py",
                "commit_id": "b43fc5e9c236d6082bc6c57fcadc58f72edf12b3",
                "original_commit_id": "b43fc5e9c236d6082bc6c57fcadc58f72edf12b3",
                "user": {
                    "login": "erikjohnston",
                    "id": 8428120,
                    "node_id": "MDQ6VXNlcjg0MjgxMjA=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/8428120?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/erikjohnston",
                    "html_url": "https://github.com/erikjohnston",
                    "followers_url": "https://api.github.com/users/erikjohnston/followers",
                    "following_url": "https://api.github.com/users/erikjohnston/following{/other_user}",
                    "gists_url": "https://api.github.com/users/erikjohnston/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/erikjohnston/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/erikjohnston/subscriptions",
                    "organizations_url": "https://api.github.com/users/erikjohnston/orgs",
                    "repos_url": "https://api.github.com/users/erikjohnston/repos",
                    "events_url": "https://api.github.com/users/erikjohnston/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/erikjohnston/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "Good point that it looks weird. But I think they're right as we're comparing \"upper bounds\"",
                "created_at": "2023-10-27T08:43:51Z",
                "updated_at": "2023-10-27T08:43:52Z",
                "html_url": "https://github.com/matrix-org/synapse/pull/16555#discussion_r1374261662",
                "pull_request_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555",
                "author_association": "MEMBER",
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/comments/1374261662"
                    },
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16555#discussion_r1374261662"
                    },
                    "pull_request": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555"
                    }
                },
                "reactions": {
                    "url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments/1374261662/reactions",
                    "total_count": 0,
                    "+1": 0,
                    "-1": 0,
                    "laugh": 0,
                    "hooray": 0,
                    "confused": 0,
                    "heart": 0,
                    "rocket": 0,
                    "eyes": 0
                },
                "start_line": null,
                "original_start_line": null,
                "start_side": null,
                "line": 621,
                "original_line": 621,
                "side": "RIGHT",
                "in_reply_to_id": 1373659934,
                "original_position": 15,
                "position": 15,
                "subject_type": "line"
            },
            "pull_request": {
                "url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555",
                "id": 1574805820,
                "node_id": "PR_kwDOAVyVwM5d3aE8",
                "html_url": "https://github.com/matrix-org/synapse/pull/16555",
                "diff_url": "https://github.com/matrix-org/synapse/pull/16555.diff",
                "patch_url": "https://github.com/matrix-org/synapse/pull/16555.patch",
                "issue_url": "https://api.github.com/repos/matrix-org/synapse/issues/16555",
                "number": 16555,
                "state": "open",
                "locked": false,
                "title": "Reduce spurious replication catchup",
                "user": {
                    "login": "erikjohnston",
                    "id": 8428120,
                    "node_id": "MDQ6VXNlcjg0MjgxMjA=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/8428120?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/erikjohnston",
                    "html_url": "https://github.com/erikjohnston",
                    "followers_url": "https://api.github.com/users/erikjohnston/followers",
                    "following_url": "https://api.github.com/users/erikjohnston/following{/other_user}",
                    "gists_url": "https://api.github.com/users/erikjohnston/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/erikjohnston/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/erikjohnston/subscriptions",
                    "organizations_url": "https://api.github.com/users/erikjohnston/orgs",
                    "repos_url": "https://api.github.com/users/erikjohnston/repos",
                    "events_url": "https://api.github.com/users/erikjohnston/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/erikjohnston/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "The `POSITION` command includes two tokens, the \"prev\" and \"new\" tokens. The \"new\" token is what we should set the current token for the instance to be, and the \"prev\" token was where it was previously (i.e. the instance produced no rows between the \"prev\" and \"new\" tokens).\r\n\r\nThis means that we can safely relax the condition to only check for missing updates if the current token for the writer is strictly less than the \"prev\" token.\r\n\r\nA common case is receiving something like `POSITIONS event_persister1 events 15 16`, which indicates the writer advanced their events stream token from 15 to 16 (usually as a response to another instance persisting an event with stream ID 16). Usually, the other instances would already have inferred that `event_persister1` must have advanced their token, so the `current_token` would already be set to 16, thus triggering a lookup for missing updates between tokens 16 (`cmd.new_token`) and 16 (`current_token`), which is silly.\r\n\r\nWe also move the logging back into the loop so that we don't log in the common case.",
                "created_at": "2023-10-26T12:56:23Z",
                "updated_at": "2023-10-27T08:43:51Z",
                "closed_at": null,
                "merged_at": null,
                "merge_commit_sha": "b5ac770290c13ddd526d1bf05f651f8cf86ac662",
                "assignee": null,
                "assignees": [],
                "requested_reviewers": [],
                "requested_teams": [],
                "labels": [],
                "milestone": null,
                "draft": false,
                "commits_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/commits",
                "review_comments_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/comments",
                "review_comment_url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}",
                "comments_url": "https://api.github.com/repos/matrix-org/synapse/issues/16555/comments",
                "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/b43fc5e9c236d6082bc6c57fcadc58f72edf12b3",
                "head": {
                    "label": "matrix-org:erikj/reduce_spurious_fetches",
                    "ref": "erikj/reduce_spurious_fetches",
                    "sha": "b43fc5e9c236d6082bc6c57fcadc58f72edf12b3",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-27T08:31:37Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 400535,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2162,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1517,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2162,
                        "open_issues": 1517,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "base": {
                    "label": "matrix-org:develop",
                    "ref": "develop",
                    "sha": "c14a7de6af0b8a3cbf2e17afca1cab339bc5912d",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-27T08:31:37Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 400535,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2162,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1517,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2162,
                        "open_issues": 1517,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555"
                    },
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16555"
                    },
                    "issue": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16555"
                    },
                    "comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16555/comments"
                    },
                    "review_comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/comments"
                    },
                    "review_comment": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}"
                    },
                    "commits": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/commits"
                    },
                    "statuses": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/statuses/b43fc5e9c236d6082bc6c57fcadc58f72edf12b3"
                    }
                },
                "author_association": "MEMBER",
                "auto_merge": null,
                "active_lock_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-27T08:43:51Z",
        "org": {
            "id": 8418310,
            "login": "matrix-org",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/matrix-org",
            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?"
        }
    },
    {
        "id": "32892892840",
        "type": "PullRequestReviewEvent",
        "actor": {
            "id": 8428120,
            "login": "erikjohnston",
            "display_login": "erikjohnston",
            "gravatar_id": "",
            "url": "https://api.github.com/users/erikjohnston",
            "avatar_url": "https://avatars.githubusercontent.com/u/8428120?"
        },
        "repo": {
            "id": 22844864,
            "name": "matrix-org/synapse",
            "url": "https://api.github.com/repos/matrix-org/synapse"
        },
        "payload": {
            "action": "created",
            "review": {
                "id": 1701288969,
                "node_id": "PRR_kwDOAVyVwM5lZ5wJ",
                "user": {
                    "login": "erikjohnston",
                    "id": 8428120,
                    "node_id": "MDQ6VXNlcjg0MjgxMjA=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/8428120?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/erikjohnston",
                    "html_url": "https://github.com/erikjohnston",
                    "followers_url": "https://api.github.com/users/erikjohnston/followers",
                    "following_url": "https://api.github.com/users/erikjohnston/following{/other_user}",
                    "gists_url": "https://api.github.com/users/erikjohnston/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/erikjohnston/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/erikjohnston/subscriptions",
                    "organizations_url": "https://api.github.com/users/erikjohnston/orgs",
                    "repos_url": "https://api.github.com/users/erikjohnston/repos",
                    "events_url": "https://api.github.com/users/erikjohnston/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/erikjohnston/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": null,
                "commit_id": "b43fc5e9c236d6082bc6c57fcadc58f72edf12b3",
                "submitted_at": "2023-10-27T08:43:51Z",
                "state": "commented",
                "html_url": "https://github.com/matrix-org/synapse/pull/16555#pullrequestreview-1701288969",
                "pull_request_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555",
                "author_association": "MEMBER",
                "_links": {
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16555#pullrequestreview-1701288969"
                    },
                    "pull_request": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555"
                    }
                }
            },
            "pull_request": {
                "url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555",
                "id": 1574805820,
                "node_id": "PR_kwDOAVyVwM5d3aE8",
                "html_url": "https://github.com/matrix-org/synapse/pull/16555",
                "diff_url": "https://github.com/matrix-org/synapse/pull/16555.diff",
                "patch_url": "https://github.com/matrix-org/synapse/pull/16555.patch",
                "issue_url": "https://api.github.com/repos/matrix-org/synapse/issues/16555",
                "number": 16555,
                "state": "open",
                "locked": false,
                "title": "Reduce spurious replication catchup",
                "user": {
                    "login": "erikjohnston",
                    "id": 8428120,
                    "node_id": "MDQ6VXNlcjg0MjgxMjA=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/8428120?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/erikjohnston",
                    "html_url": "https://github.com/erikjohnston",
                    "followers_url": "https://api.github.com/users/erikjohnston/followers",
                    "following_url": "https://api.github.com/users/erikjohnston/following{/other_user}",
                    "gists_url": "https://api.github.com/users/erikjohnston/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/erikjohnston/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/erikjohnston/subscriptions",
                    "organizations_url": "https://api.github.com/users/erikjohnston/orgs",
                    "repos_url": "https://api.github.com/users/erikjohnston/repos",
                    "events_url": "https://api.github.com/users/erikjohnston/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/erikjohnston/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "The `POSITION` command includes two tokens, the \"prev\" and \"new\" tokens. The \"new\" token is what we should set the current token for the instance to be, and the \"prev\" token was where it was previously (i.e. the instance produced no rows between the \"prev\" and \"new\" tokens).\r\n\r\nThis means that we can safely relax the condition to only check for missing updates if the current token for the writer is strictly less than the \"prev\" token.\r\n\r\nA common case is receiving something like `POSITIONS event_persister1 events 15 16`, which indicates the writer advanced their events stream token from 15 to 16 (usually as a response to another instance persisting an event with stream ID 16). Usually, the other instances would already have inferred that `event_persister1` must have advanced their token, so the `current_token` would already be set to 16, thus triggering a lookup for missing updates between tokens 16 (`cmd.new_token`) and 16 (`current_token`), which is silly.\r\n\r\nWe also move the logging back into the loop so that we don't log in the common case.",
                "created_at": "2023-10-26T12:56:23Z",
                "updated_at": "2023-10-27T08:43:51Z",
                "closed_at": null,
                "merged_at": null,
                "merge_commit_sha": "b5ac770290c13ddd526d1bf05f651f8cf86ac662",
                "assignee": null,
                "assignees": [],
                "requested_reviewers": [],
                "requested_teams": [],
                "labels": [],
                "milestone": null,
                "draft": false,
                "commits_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/commits",
                "review_comments_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/comments",
                "review_comment_url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}",
                "comments_url": "https://api.github.com/repos/matrix-org/synapse/issues/16555/comments",
                "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/b43fc5e9c236d6082bc6c57fcadc58f72edf12b3",
                "head": {
                    "label": "matrix-org:erikj/reduce_spurious_fetches",
                    "ref": "erikj/reduce_spurious_fetches",
                    "sha": "b43fc5e9c236d6082bc6c57fcadc58f72edf12b3",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-27T08:31:37Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 400535,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2162,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1517,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2162,
                        "open_issues": 1517,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "base": {
                    "label": "matrix-org:develop",
                    "ref": "develop",
                    "sha": "c14a7de6af0b8a3cbf2e17afca1cab339bc5912d",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-27T08:31:37Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 400535,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2162,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1517,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2162,
                        "open_issues": 1517,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555"
                    },
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16555"
                    },
                    "issue": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16555"
                    },
                    "comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16555/comments"
                    },
                    "review_comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/comments"
                    },
                    "review_comment": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}"
                    },
                    "commits": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/commits"
                    },
                    "statuses": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/statuses/b43fc5e9c236d6082bc6c57fcadc58f72edf12b3"
                    }
                },
                "author_association": "MEMBER",
                "auto_merge": null,
                "active_lock_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-27T08:43:52Z",
        "org": {
            "id": 8418310,
            "login": "matrix-org",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/matrix-org",
            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?"
        }
    },
    {
        "id": "32892823525",
        "type": "PullRequestReviewCommentEvent",
        "actor": {
            "id": 8428120,
            "login": "erikjohnston",
            "display_login": "erikjohnston",
            "gravatar_id": "",
            "url": "https://api.github.com/users/erikjohnston",
            "avatar_url": "https://avatars.githubusercontent.com/u/8428120?"
        },
        "repo": {
            "id": 22844864,
            "name": "matrix-org/synapse",
            "url": "https://api.github.com/repos/matrix-org/synapse"
        },
        "payload": {
            "action": "created",
            "comment": {
                "url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments/1374258618",
                "pull_request_review_id": 1701284347,
                "id": 1374258618,
                "node_id": "PRRC_kwDOAVyVwM5R6YW6",
                "diff_hunk": "@@ -611,10 +611,14 @@ async def _process_position(\n         # Find where we previously streamed up to.\n         current_token = stream.current_token(cmd.instance_name)\n \n-        # If the position token matches our current token then we're up to\n-        # date and there's nothing to do. Otherwise, fetch all updates\n-        # between then and now.\n-        missing_updates = cmd.prev_token != current_token\n+        # If the position token matches our current token then we're up to date\n+        # and there's nothing to do. Otherwise, fetch all updates between then\n+        # and now.",
                "path": "synapse/replication/tcp/handler.py",
                "commit_id": "b43fc5e9c236d6082bc6c57fcadc58f72edf12b3",
                "original_commit_id": "b43fc5e9c236d6082bc6c57fcadc58f72edf12b3",
                "user": {
                    "login": "erikjohnston",
                    "id": 8428120,
                    "node_id": "MDQ6VXNlcjg0MjgxMjA=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/8428120?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/erikjohnston",
                    "html_url": "https://github.com/erikjohnston",
                    "followers_url": "https://api.github.com/users/erikjohnston/followers",
                    "following_url": "https://api.github.com/users/erikjohnston/following{/other_user}",
                    "gists_url": "https://api.github.com/users/erikjohnston/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/erikjohnston/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/erikjohnston/subscriptions",
                    "organizations_url": "https://api.github.com/users/erikjohnston/orgs",
                    "repos_url": "https://api.github.com/users/erikjohnston/repos",
                    "events_url": "https://api.github.com/users/erikjohnston/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/erikjohnston/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "Ah, no. `POSITION 4 8` means that the new token for that instance should be set to 8, and nothing has happened between 4 and 8 from that instance. (The reason for this is that normally we'd just get a stream of  `RDATA`  from the instance, which implicitly bumps the token. If for some reason the token has advanced *without* any updates to send, it sends a `POSITION`, hence why it gives the range where things have *not* happened).",
                "created_at": "2023-10-27T08:41:10Z",
                "updated_at": "2023-10-27T08:41:10Z",
                "html_url": "https://github.com/matrix-org/synapse/pull/16555#discussion_r1374258618",
                "pull_request_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555",
                "author_association": "MEMBER",
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/comments/1374258618"
                    },
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16555#discussion_r1374258618"
                    },
                    "pull_request": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555"
                    }
                },
                "reactions": {
                    "url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments/1374258618/reactions",
                    "total_count": 0,
                    "+1": 0,
                    "-1": 0,
                    "laugh": 0,
                    "hooray": 0,
                    "confused": 0,
                    "heart": 0,
                    "rocket": 0,
                    "eyes": 0
                },
                "start_line": 614,
                "original_start_line": 614,
                "start_side": "RIGHT",
                "line": 616,
                "original_line": 616,
                "side": "RIGHT",
                "in_reply_to_id": 1373634825,
                "original_position": 10,
                "position": 10,
                "subject_type": "line"
            },
            "pull_request": {
                "url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555",
                "id": 1574805820,
                "node_id": "PR_kwDOAVyVwM5d3aE8",
                "html_url": "https://github.com/matrix-org/synapse/pull/16555",
                "diff_url": "https://github.com/matrix-org/synapse/pull/16555.diff",
                "patch_url": "https://github.com/matrix-org/synapse/pull/16555.patch",
                "issue_url": "https://api.github.com/repos/matrix-org/synapse/issues/16555",
                "number": 16555,
                "state": "open",
                "locked": false,
                "title": "Reduce spurious replication catchup",
                "user": {
                    "login": "erikjohnston",
                    "id": 8428120,
                    "node_id": "MDQ6VXNlcjg0MjgxMjA=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/8428120?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/erikjohnston",
                    "html_url": "https://github.com/erikjohnston",
                    "followers_url": "https://api.github.com/users/erikjohnston/followers",
                    "following_url": "https://api.github.com/users/erikjohnston/following{/other_user}",
                    "gists_url": "https://api.github.com/users/erikjohnston/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/erikjohnston/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/erikjohnston/subscriptions",
                    "organizations_url": "https://api.github.com/users/erikjohnston/orgs",
                    "repos_url": "https://api.github.com/users/erikjohnston/repos",
                    "events_url": "https://api.github.com/users/erikjohnston/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/erikjohnston/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "The `POSITION` command includes two tokens, the \"prev\" and \"new\" tokens. The \"new\" token is what we should set the current token for the instance to be, and the \"prev\" token was where it was previously (i.e. the instance produced no rows between the \"prev\" and \"new\" tokens).\r\n\r\nThis means that we can safely relax the condition to only check for missing updates if the current token for the writer is strictly less than the \"prev\" token.\r\n\r\nA common case is receiving something like `POSITIONS event_persister1 events 15 16`, which indicates the writer advanced their events stream token from 15 to 16 (usually as a response to another instance persisting an event with stream ID 16). Usually, the other instances would already have inferred that `event_persister1` must have advanced their token, so the `current_token` would already be set to 16, thus triggering a lookup for missing updates between tokens 16 (`cmd.new_token`) and 16 (`current_token`), which is silly.\r\n\r\nWe also move the logging back into the loop so that we don't log in the common case.",
                "created_at": "2023-10-26T12:56:23Z",
                "updated_at": "2023-10-27T08:41:10Z",
                "closed_at": null,
                "merged_at": null,
                "merge_commit_sha": "b5ac770290c13ddd526d1bf05f651f8cf86ac662",
                "assignee": null,
                "assignees": [],
                "requested_reviewers": [],
                "requested_teams": [],
                "labels": [],
                "milestone": null,
                "draft": false,
                "commits_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/commits",
                "review_comments_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/comments",
                "review_comment_url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}",
                "comments_url": "https://api.github.com/repos/matrix-org/synapse/issues/16555/comments",
                "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/b43fc5e9c236d6082bc6c57fcadc58f72edf12b3",
                "head": {
                    "label": "matrix-org:erikj/reduce_spurious_fetches",
                    "ref": "erikj/reduce_spurious_fetches",
                    "sha": "b43fc5e9c236d6082bc6c57fcadc58f72edf12b3",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-27T08:31:37Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 400535,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2162,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1517,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2162,
                        "open_issues": 1517,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "base": {
                    "label": "matrix-org:develop",
                    "ref": "develop",
                    "sha": "c14a7de6af0b8a3cbf2e17afca1cab339bc5912d",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-27T08:31:37Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 400535,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2162,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1517,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2162,
                        "open_issues": 1517,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555"
                    },
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16555"
                    },
                    "issue": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16555"
                    },
                    "comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16555/comments"
                    },
                    "review_comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/comments"
                    },
                    "review_comment": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}"
                    },
                    "commits": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/commits"
                    },
                    "statuses": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/statuses/b43fc5e9c236d6082bc6c57fcadc58f72edf12b3"
                    }
                },
                "author_association": "MEMBER",
                "auto_merge": null,
                "active_lock_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-27T08:41:10Z",
        "org": {
            "id": 8418310,
            "login": "matrix-org",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/matrix-org",
            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?"
        }
    },
    {
        "id": "32892823373",
        "type": "PullRequestReviewEvent",
        "actor": {
            "id": 8428120,
            "login": "erikjohnston",
            "display_login": "erikjohnston",
            "gravatar_id": "",
            "url": "https://api.github.com/users/erikjohnston",
            "avatar_url": "https://avatars.githubusercontent.com/u/8428120?"
        },
        "repo": {
            "id": 22844864,
            "name": "matrix-org/synapse",
            "url": "https://api.github.com/repos/matrix-org/synapse"
        },
        "payload": {
            "action": "created",
            "review": {
                "id": 1701284347,
                "node_id": "PRR_kwDOAVyVwM5lZ4n7",
                "user": {
                    "login": "erikjohnston",
                    "id": 8428120,
                    "node_id": "MDQ6VXNlcjg0MjgxMjA=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/8428120?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/erikjohnston",
                    "html_url": "https://github.com/erikjohnston",
                    "followers_url": "https://api.github.com/users/erikjohnston/followers",
                    "following_url": "https://api.github.com/users/erikjohnston/following{/other_user}",
                    "gists_url": "https://api.github.com/users/erikjohnston/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/erikjohnston/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/erikjohnston/subscriptions",
                    "organizations_url": "https://api.github.com/users/erikjohnston/orgs",
                    "repos_url": "https://api.github.com/users/erikjohnston/repos",
                    "events_url": "https://api.github.com/users/erikjohnston/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/erikjohnston/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": null,
                "commit_id": "b43fc5e9c236d6082bc6c57fcadc58f72edf12b3",
                "submitted_at": "2023-10-27T08:41:10Z",
                "state": "commented",
                "html_url": "https://github.com/matrix-org/synapse/pull/16555#pullrequestreview-1701284347",
                "pull_request_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555",
                "author_association": "MEMBER",
                "_links": {
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16555#pullrequestreview-1701284347"
                    },
                    "pull_request": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555"
                    }
                }
            },
            "pull_request": {
                "url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555",
                "id": 1574805820,
                "node_id": "PR_kwDOAVyVwM5d3aE8",
                "html_url": "https://github.com/matrix-org/synapse/pull/16555",
                "diff_url": "https://github.com/matrix-org/synapse/pull/16555.diff",
                "patch_url": "https://github.com/matrix-org/synapse/pull/16555.patch",
                "issue_url": "https://api.github.com/repos/matrix-org/synapse/issues/16555",
                "number": 16555,
                "state": "open",
                "locked": false,
                "title": "Reduce spurious replication catchup",
                "user": {
                    "login": "erikjohnston",
                    "id": 8428120,
                    "node_id": "MDQ6VXNlcjg0MjgxMjA=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/8428120?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/erikjohnston",
                    "html_url": "https://github.com/erikjohnston",
                    "followers_url": "https://api.github.com/users/erikjohnston/followers",
                    "following_url": "https://api.github.com/users/erikjohnston/following{/other_user}",
                    "gists_url": "https://api.github.com/users/erikjohnston/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/erikjohnston/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/erikjohnston/subscriptions",
                    "organizations_url": "https://api.github.com/users/erikjohnston/orgs",
                    "repos_url": "https://api.github.com/users/erikjohnston/repos",
                    "events_url": "https://api.github.com/users/erikjohnston/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/erikjohnston/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "The `POSITION` command includes two tokens, the \"prev\" and \"new\" tokens. The \"new\" token is what we should set the current token for the instance to be, and the \"prev\" token was where it was previously (i.e. the instance produced no rows between the \"prev\" and \"new\" tokens).\r\n\r\nThis means that we can safely relax the condition to only check for missing updates if the current token for the writer is strictly less than the \"prev\" token.\r\n\r\nA common case is receiving something like `POSITIONS event_persister1 events 15 16`, which indicates the writer advanced their events stream token from 15 to 16 (usually as a response to another instance persisting an event with stream ID 16). Usually, the other instances would already have inferred that `event_persister1` must have advanced their token, so the `current_token` would already be set to 16, thus triggering a lookup for missing updates between tokens 16 (`cmd.new_token`) and 16 (`current_token`), which is silly.\r\n\r\nWe also move the logging back into the loop so that we don't log in the common case.",
                "created_at": "2023-10-26T12:56:23Z",
                "updated_at": "2023-10-27T08:41:10Z",
                "closed_at": null,
                "merged_at": null,
                "merge_commit_sha": "b5ac770290c13ddd526d1bf05f651f8cf86ac662",
                "assignee": null,
                "assignees": [],
                "requested_reviewers": [],
                "requested_teams": [],
                "labels": [],
                "milestone": null,
                "draft": false,
                "commits_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/commits",
                "review_comments_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/comments",
                "review_comment_url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}",
                "comments_url": "https://api.github.com/repos/matrix-org/synapse/issues/16555/comments",
                "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/b43fc5e9c236d6082bc6c57fcadc58f72edf12b3",
                "head": {
                    "label": "matrix-org:erikj/reduce_spurious_fetches",
                    "ref": "erikj/reduce_spurious_fetches",
                    "sha": "b43fc5e9c236d6082bc6c57fcadc58f72edf12b3",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-27T08:31:37Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 400535,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2162,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1517,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2162,
                        "open_issues": 1517,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "base": {
                    "label": "matrix-org:develop",
                    "ref": "develop",
                    "sha": "c14a7de6af0b8a3cbf2e17afca1cab339bc5912d",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-27T08:31:37Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 400535,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2162,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1517,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2162,
                        "open_issues": 1517,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555"
                    },
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16555"
                    },
                    "issue": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16555"
                    },
                    "comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16555/comments"
                    },
                    "review_comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/comments"
                    },
                    "review_comment": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}"
                    },
                    "commits": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16555/commits"
                    },
                    "statuses": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/statuses/b43fc5e9c236d6082bc6c57fcadc58f72edf12b3"
                    }
                },
                "author_association": "MEMBER",
                "auto_merge": null,
                "active_lock_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-27T08:41:11Z",
        "org": {
            "id": 8418310,
            "login": "matrix-org",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/matrix-org",
            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?"
        }
    },
    {
        "id": "32892630158",
        "type": "PullRequestReviewEvent",
        "actor": {
            "id": 8428120,
            "login": "erikjohnston",
            "display_login": "erikjohnston",
            "gravatar_id": "",
            "url": "https://api.github.com/users/erikjohnston",
            "avatar_url": "https://avatars.githubusercontent.com/u/8428120?"
        },
        "repo": {
            "id": 22844864,
            "name": "matrix-org/synapse",
            "url": "https://api.github.com/repos/matrix-org/synapse"
        },
        "payload": {
            "action": "created",
            "review": {
                "id": 1701271408,
                "node_id": "PRR_kwDOAVyVwM5lZ1dw",
                "user": {
                    "login": "erikjohnston",
                    "id": 8428120,
                    "node_id": "MDQ6VXNlcjg0MjgxMjA=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/8428120?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/erikjohnston",
                    "html_url": "https://github.com/erikjohnston",
                    "followers_url": "https://api.github.com/users/erikjohnston/followers",
                    "following_url": "https://api.github.com/users/erikjohnston/following{/other_user}",
                    "gists_url": "https://api.github.com/users/erikjohnston/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/erikjohnston/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/erikjohnston/subscriptions",
                    "organizations_url": "https://api.github.com/users/erikjohnston/orgs",
                    "repos_url": "https://api.github.com/users/erikjohnston/repos",
                    "events_url": "https://api.github.com/users/erikjohnston/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/erikjohnston/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": null,
                "commit_id": "eb5a0f6ca600ecf83f139e562ed5b8760524be83",
                "submitted_at": "2023-10-27T08:33:40Z",
                "state": "commented",
                "html_url": "https://github.com/matrix-org/synapse/pull/16558#pullrequestreview-1701271408",
                "pull_request_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558",
                "author_association": "MEMBER",
                "_links": {
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16558#pullrequestreview-1701271408"
                    },
                    "pull_request": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558"
                    }
                }
            },
            "pull_request": {
                "url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558",
                "id": 1575119529,
                "node_id": "PR_kwDOAVyVwM5d4mqp",
                "html_url": "https://github.com/matrix-org/synapse/pull/16558",
                "diff_url": "https://github.com/matrix-org/synapse/pull/16558.diff",
                "patch_url": "https://github.com/matrix-org/synapse/pull/16558.patch",
                "issue_url": "https://api.github.com/repos/matrix-org/synapse/issues/16558",
                "number": 16558,
                "state": "open",
                "locked": false,
                "title": "Fix cross-worker ratelimiting",
                "user": {
                    "login": "erikjohnston",
                    "id": 8428120,
                    "node_id": "MDQ6VXNlcjg0MjgxMjA=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/8428120?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/erikjohnston",
                    "html_url": "https://github.com/erikjohnston",
                    "followers_url": "https://api.github.com/users/erikjohnston/followers",
                    "following_url": "https://api.github.com/users/erikjohnston/following{/other_user}",
                    "gists_url": "https://api.github.com/users/erikjohnston/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/erikjohnston/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/erikjohnston/subscriptions",
                    "organizations_url": "https://api.github.com/users/erikjohnston/orgs",
                    "repos_url": "https://api.github.com/users/erikjohnston/repos",
                    "events_url": "https://api.github.com/users/erikjohnston/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/erikjohnston/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "c.f. #16481",
                "created_at": "2023-10-26T15:43:56Z",
                "updated_at": "2023-10-27T08:33:40Z",
                "closed_at": null,
                "merged_at": null,
                "merge_commit_sha": "6d6ed609f7b8f74106056403bdce08ca3d9eb2ea",
                "assignee": null,
                "assignees": [],
                "requested_reviewers": [],
                "requested_teams": [],
                "labels": [],
                "milestone": null,
                "draft": false,
                "commits_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/commits",
                "review_comments_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/comments",
                "review_comment_url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}",
                "comments_url": "https://api.github.com/repos/matrix-org/synapse/issues/16558/comments",
                "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/a2981a0bdc2ac35a991c64f189041c878576cf34",
                "head": {
                    "label": "matrix-org:erikj/fix_worker_ratelimits",
                    "ref": "erikj/fix_worker_ratelimits",
                    "sha": "a2981a0bdc2ac35a991c64f189041c878576cf34",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-27T08:31:37Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 400535,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2162,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1517,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2162,
                        "open_issues": 1517,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "base": {
                    "label": "matrix-org:develop",
                    "ref": "develop",
                    "sha": "c14a7de6af0b8a3cbf2e17afca1cab339bc5912d",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-27T08:31:37Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 400535,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2162,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1517,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2162,
                        "open_issues": 1517,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558"
                    },
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16558"
                    },
                    "issue": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16558"
                    },
                    "comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16558/comments"
                    },
                    "review_comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/comments"
                    },
                    "review_comment": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}"
                    },
                    "commits": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/commits"
                    },
                    "statuses": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/statuses/a2981a0bdc2ac35a991c64f189041c878576cf34"
                    }
                },
                "author_association": "MEMBER",
                "auto_merge": null,
                "active_lock_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-27T08:33:41Z",
        "org": {
            "id": 8418310,
            "login": "matrix-org",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/matrix-org",
            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?"
        }
    },
    {
        "id": "32892630225",
        "type": "PullRequestReviewCommentEvent",
        "actor": {
            "id": 8428120,
            "login": "erikjohnston",
            "display_login": "erikjohnston",
            "gravatar_id": "",
            "url": "https://api.github.com/users/erikjohnston",
            "avatar_url": "https://avatars.githubusercontent.com/u/8428120?"
        },
        "repo": {
            "id": 22844864,
            "name": "matrix-org/synapse",
            "url": "https://api.github.com/repos/matrix-org/synapse"
        },
        "payload": {
            "action": "created",
            "comment": {
                "url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments/1374250180",
                "pull_request_review_id": 1701271408,
                "id": 1374250180,
                "node_id": "PRRC_kwDOAVyVwM5R6WTE",
                "diff_hunk": "@@ -1508,6 +1527,18 @@ async def _persist_events(\n                 first_event.room_id\n             )\n             if writer_instance != self._instance_name:\n+                # Ratelimit before sending to the other event persister, to\n+                # ensure that we correctly have ratelimits on both the event\n+                # creators and event persiters.",
                "path": "synapse/handlers/message.py",
                "commit_id": "a2981a0bdc2ac35a991c64f189041c878576cf34",
                "original_commit_id": "eb5a0f6ca600ecf83f139e562ed5b8760524be83",
                "user": {
                    "login": "erikjohnston",
                    "id": 8428120,
                    "node_id": "MDQ6VXNlcjg0MjgxMjA=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/8428120?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/erikjohnston",
                    "html_url": "https://github.com/erikjohnston",
                    "followers_url": "https://api.github.com/users/erikjohnston/followers",
                    "following_url": "https://api.github.com/users/erikjohnston/following{/other_user}",
                    "gists_url": "https://api.github.com/users/erikjohnston/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/erikjohnston/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/erikjohnston/subscriptions",
                    "organizations_url": "https://api.github.com/users/erikjohnston/orgs",
                    "repos_url": "https://api.github.com/users/erikjohnston/repos",
                    "events_url": "https://api.github.com/users/erikjohnston/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/erikjohnston/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "Yeah, these can totally get out of sync. However, if they do get out of sync then the worst that is going to happen is that you're being ratelimited when you're already over the threshold, so :shrug: ",
                "created_at": "2023-10-27T08:33:40Z",
                "updated_at": "2023-10-27T08:33:40Z",
                "html_url": "https://github.com/matrix-org/synapse/pull/16558#discussion_r1374250180",
                "pull_request_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558",
                "author_association": "MEMBER",
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/comments/1374250180"
                    },
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16558#discussion_r1374250180"
                    },
                    "pull_request": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558"
                    }
                },
                "reactions": {
                    "url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments/1374250180/reactions",
                    "total_count": 0,
                    "+1": 0,
                    "-1": 0,
                    "laugh": 0,
                    "hooray": 0,
                    "confused": 0,
                    "heart": 0,
                    "rocket": 0,
                    "eyes": 0
                },
                "start_line": null,
                "original_start_line": null,
                "start_side": null,
                "line": null,
                "original_line": 1532,
                "side": "RIGHT",
                "in_reply_to_id": 1373753967,
                "original_position": 34,
                "position": null,
                "subject_type": "line"
            },
            "pull_request": {
                "url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558",
                "id": 1575119529,
                "node_id": "PR_kwDOAVyVwM5d4mqp",
                "html_url": "https://github.com/matrix-org/synapse/pull/16558",
                "diff_url": "https://github.com/matrix-org/synapse/pull/16558.diff",
                "patch_url": "https://github.com/matrix-org/synapse/pull/16558.patch",
                "issue_url": "https://api.github.com/repos/matrix-org/synapse/issues/16558",
                "number": 16558,
                "state": "open",
                "locked": false,
                "title": "Fix cross-worker ratelimiting",
                "user": {
                    "login": "erikjohnston",
                    "id": 8428120,
                    "node_id": "MDQ6VXNlcjg0MjgxMjA=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/8428120?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/erikjohnston",
                    "html_url": "https://github.com/erikjohnston",
                    "followers_url": "https://api.github.com/users/erikjohnston/followers",
                    "following_url": "https://api.github.com/users/erikjohnston/following{/other_user}",
                    "gists_url": "https://api.github.com/users/erikjohnston/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/erikjohnston/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/erikjohnston/subscriptions",
                    "organizations_url": "https://api.github.com/users/erikjohnston/orgs",
                    "repos_url": "https://api.github.com/users/erikjohnston/repos",
                    "events_url": "https://api.github.com/users/erikjohnston/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/erikjohnston/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "c.f. #16481",
                "created_at": "2023-10-26T15:43:56Z",
                "updated_at": "2023-10-27T08:33:40Z",
                "closed_at": null,
                "merged_at": null,
                "merge_commit_sha": "6d6ed609f7b8f74106056403bdce08ca3d9eb2ea",
                "assignee": null,
                "assignees": [],
                "requested_reviewers": [],
                "requested_teams": [],
                "labels": [],
                "milestone": null,
                "draft": false,
                "commits_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/commits",
                "review_comments_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/comments",
                "review_comment_url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}",
                "comments_url": "https://api.github.com/repos/matrix-org/synapse/issues/16558/comments",
                "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/a2981a0bdc2ac35a991c64f189041c878576cf34",
                "head": {
                    "label": "matrix-org:erikj/fix_worker_ratelimits",
                    "ref": "erikj/fix_worker_ratelimits",
                    "sha": "a2981a0bdc2ac35a991c64f189041c878576cf34",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-27T08:31:37Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 400535,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2162,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1517,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2162,
                        "open_issues": 1517,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "base": {
                    "label": "matrix-org:develop",
                    "ref": "develop",
                    "sha": "c14a7de6af0b8a3cbf2e17afca1cab339bc5912d",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-27T08:31:37Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 400535,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2162,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1517,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2162,
                        "open_issues": 1517,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558"
                    },
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16558"
                    },
                    "issue": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16558"
                    },
                    "comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16558/comments"
                    },
                    "review_comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/comments"
                    },
                    "review_comment": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}"
                    },
                    "commits": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/commits"
                    },
                    "statuses": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/statuses/a2981a0bdc2ac35a991c64f189041c878576cf34"
                    }
                },
                "author_association": "MEMBER",
                "auto_merge": null,
                "active_lock_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-27T08:33:40Z",
        "org": {
            "id": 8418310,
            "login": "matrix-org",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/matrix-org",
            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?"
        }
    },
    {
        "id": "32892600408",
        "type": "PullRequestReviewCommentEvent",
        "actor": {
            "id": 8428120,
            "login": "erikjohnston",
            "display_login": "erikjohnston",
            "gravatar_id": "",
            "url": "https://api.github.com/users/erikjohnston",
            "avatar_url": "https://avatars.githubusercontent.com/u/8428120?"
        },
        "repo": {
            "id": 22844864,
            "name": "matrix-org/synapse",
            "url": "https://api.github.com/repos/matrix-org/synapse"
        },
        "payload": {
            "action": "created",
            "comment": {
                "url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments/1374248845",
                "pull_request_review_id": 1701269411,
                "id": 1374248845,
                "node_id": "PRRC_kwDOAVyVwM5R6V-N",
                "diff_hunk": "@@ -999,7 +999,26 @@ async def create_and_send_nonmember_event(\n             raise ShadowBanError()\n \n         if ratelimit:\n-            await self.request_ratelimiter.ratelimit(requester, update=False)\n+            room_id = event_dict[\"room_id\"]\n+            try:\n+                room_version = await self.store.get_room_version(room_id)\n+            except NotFoundError:\n+                # If the room doesnt' exist.\n+                raise AuthError(403, f\"User {requester.user} not in room {room_id}\")",
                "path": "synapse/handlers/message.py",
                "commit_id": "a2981a0bdc2ac35a991c64f189041c878576cf34",
                "original_commit_id": "eb5a0f6ca600ecf83f139e562ed5b8760524be83",
                "user": {
                    "login": "erikjohnston",
                    "id": 8428120,
                    "node_id": "MDQ6VXNlcjg0MjgxMjA=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/8428120?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/erikjohnston",
                    "html_url": "https://github.com/erikjohnston",
                    "followers_url": "https://api.github.com/users/erikjohnston/followers",
                    "following_url": "https://api.github.com/users/erikjohnston/following{/other_user}",
                    "gists_url": "https://api.github.com/users/erikjohnston/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/erikjohnston/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/erikjohnston/subscriptions",
                    "organizations_url": "https://api.github.com/users/erikjohnston/orgs",
                    "repos_url": "https://api.github.com/users/erikjohnston/repos",
                    "events_url": "https://api.github.com/users/erikjohnston/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/erikjohnston/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "It matches the current error message I believe. There's probably some argument about not wanting to leak the existence of rooms or something :shrug: ",
                "created_at": "2023-10-27T08:32:29Z",
                "updated_at": "2023-10-27T08:32:30Z",
                "html_url": "https://github.com/matrix-org/synapse/pull/16558#discussion_r1374248845",
                "pull_request_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558",
                "author_association": "MEMBER",
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/comments/1374248845"
                    },
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16558#discussion_r1374248845"
                    },
                    "pull_request": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558"
                    }
                },
                "reactions": {
                    "url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments/1374248845/reactions",
                    "total_count": 0,
                    "+1": 0,
                    "-1": 0,
                    "laugh": 0,
                    "hooray": 0,
                    "confused": 0,
                    "heart": 0,
                    "rocket": 0,
                    "eyes": 0
                },
                "start_line": null,
                "original_start_line": null,
                "start_side": null,
                "line": 1007,
                "original_line": 1007,
                "side": "RIGHT",
                "in_reply_to_id": 1373753123,
                "original_position": 10,
                "position": 10,
                "subject_type": "line"
            },
            "pull_request": {
                "url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558",
                "id": 1575119529,
                "node_id": "PR_kwDOAVyVwM5d4mqp",
                "html_url": "https://github.com/matrix-org/synapse/pull/16558",
                "diff_url": "https://github.com/matrix-org/synapse/pull/16558.diff",
                "patch_url": "https://github.com/matrix-org/synapse/pull/16558.patch",
                "issue_url": "https://api.github.com/repos/matrix-org/synapse/issues/16558",
                "number": 16558,
                "state": "open",
                "locked": false,
                "title": "Fix cross-worker ratelimiting",
                "user": {
                    "login": "erikjohnston",
                    "id": 8428120,
                    "node_id": "MDQ6VXNlcjg0MjgxMjA=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/8428120?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/erikjohnston",
                    "html_url": "https://github.com/erikjohnston",
                    "followers_url": "https://api.github.com/users/erikjohnston/followers",
                    "following_url": "https://api.github.com/users/erikjohnston/following{/other_user}",
                    "gists_url": "https://api.github.com/users/erikjohnston/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/erikjohnston/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/erikjohnston/subscriptions",
                    "organizations_url": "https://api.github.com/users/erikjohnston/orgs",
                    "repos_url": "https://api.github.com/users/erikjohnston/repos",
                    "events_url": "https://api.github.com/users/erikjohnston/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/erikjohnston/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "c.f. #16481",
                "created_at": "2023-10-26T15:43:56Z",
                "updated_at": "2023-10-27T08:32:30Z",
                "closed_at": null,
                "merged_at": null,
                "merge_commit_sha": "6d6ed609f7b8f74106056403bdce08ca3d9eb2ea",
                "assignee": null,
                "assignees": [],
                "requested_reviewers": [],
                "requested_teams": [],
                "labels": [],
                "milestone": null,
                "draft": false,
                "commits_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/commits",
                "review_comments_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/comments",
                "review_comment_url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}",
                "comments_url": "https://api.github.com/repos/matrix-org/synapse/issues/16558/comments",
                "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/a2981a0bdc2ac35a991c64f189041c878576cf34",
                "head": {
                    "label": "matrix-org:erikj/fix_worker_ratelimits",
                    "ref": "erikj/fix_worker_ratelimits",
                    "sha": "a2981a0bdc2ac35a991c64f189041c878576cf34",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-27T08:31:37Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 400535,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2162,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1517,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2162,
                        "open_issues": 1517,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "base": {
                    "label": "matrix-org:develop",
                    "ref": "develop",
                    "sha": "c14a7de6af0b8a3cbf2e17afca1cab339bc5912d",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-27T08:31:37Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 400535,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2162,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1517,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2162,
                        "open_issues": 1517,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558"
                    },
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16558"
                    },
                    "issue": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16558"
                    },
                    "comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16558/comments"
                    },
                    "review_comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/comments"
                    },
                    "review_comment": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}"
                    },
                    "commits": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/commits"
                    },
                    "statuses": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/statuses/a2981a0bdc2ac35a991c64f189041c878576cf34"
                    }
                },
                "author_association": "MEMBER",
                "auto_merge": null,
                "active_lock_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-27T08:32:29Z",
        "org": {
            "id": 8418310,
            "login": "matrix-org",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/matrix-org",
            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?"
        }
    },
    {
        "id": "32892600327",
        "type": "PullRequestReviewEvent",
        "actor": {
            "id": 8428120,
            "login": "erikjohnston",
            "display_login": "erikjohnston",
            "gravatar_id": "",
            "url": "https://api.github.com/users/erikjohnston",
            "avatar_url": "https://avatars.githubusercontent.com/u/8428120?"
        },
        "repo": {
            "id": 22844864,
            "name": "matrix-org/synapse",
            "url": "https://api.github.com/repos/matrix-org/synapse"
        },
        "payload": {
            "action": "created",
            "review": {
                "id": 1701269411,
                "node_id": "PRR_kwDOAVyVwM5lZ0-j",
                "user": {
                    "login": "erikjohnston",
                    "id": 8428120,
                    "node_id": "MDQ6VXNlcjg0MjgxMjA=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/8428120?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/erikjohnston",
                    "html_url": "https://github.com/erikjohnston",
                    "followers_url": "https://api.github.com/users/erikjohnston/followers",
                    "following_url": "https://api.github.com/users/erikjohnston/following{/other_user}",
                    "gists_url": "https://api.github.com/users/erikjohnston/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/erikjohnston/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/erikjohnston/subscriptions",
                    "organizations_url": "https://api.github.com/users/erikjohnston/orgs",
                    "repos_url": "https://api.github.com/users/erikjohnston/repos",
                    "events_url": "https://api.github.com/users/erikjohnston/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/erikjohnston/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": null,
                "commit_id": "a2981a0bdc2ac35a991c64f189041c878576cf34",
                "submitted_at": "2023-10-27T08:32:30Z",
                "state": "commented",
                "html_url": "https://github.com/matrix-org/synapse/pull/16558#pullrequestreview-1701269411",
                "pull_request_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558",
                "author_association": "MEMBER",
                "_links": {
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16558#pullrequestreview-1701269411"
                    },
                    "pull_request": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558"
                    }
                }
            },
            "pull_request": {
                "url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558",
                "id": 1575119529,
                "node_id": "PR_kwDOAVyVwM5d4mqp",
                "html_url": "https://github.com/matrix-org/synapse/pull/16558",
                "diff_url": "https://github.com/matrix-org/synapse/pull/16558.diff",
                "patch_url": "https://github.com/matrix-org/synapse/pull/16558.patch",
                "issue_url": "https://api.github.com/repos/matrix-org/synapse/issues/16558",
                "number": 16558,
                "state": "open",
                "locked": false,
                "title": "Fix cross-worker ratelimiting",
                "user": {
                    "login": "erikjohnston",
                    "id": 8428120,
                    "node_id": "MDQ6VXNlcjg0MjgxMjA=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/8428120?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/erikjohnston",
                    "html_url": "https://github.com/erikjohnston",
                    "followers_url": "https://api.github.com/users/erikjohnston/followers",
                    "following_url": "https://api.github.com/users/erikjohnston/following{/other_user}",
                    "gists_url": "https://api.github.com/users/erikjohnston/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/erikjohnston/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/erikjohnston/subscriptions",
                    "organizations_url": "https://api.github.com/users/erikjohnston/orgs",
                    "repos_url": "https://api.github.com/users/erikjohnston/repos",
                    "events_url": "https://api.github.com/users/erikjohnston/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/erikjohnston/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "c.f. #16481",
                "created_at": "2023-10-26T15:43:56Z",
                "updated_at": "2023-10-27T08:32:30Z",
                "closed_at": null,
                "merged_at": null,
                "merge_commit_sha": "6d6ed609f7b8f74106056403bdce08ca3d9eb2ea",
                "assignee": null,
                "assignees": [],
                "requested_reviewers": [],
                "requested_teams": [],
                "labels": [],
                "milestone": null,
                "draft": false,
                "commits_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/commits",
                "review_comments_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/comments",
                "review_comment_url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}",
                "comments_url": "https://api.github.com/repos/matrix-org/synapse/issues/16558/comments",
                "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/a2981a0bdc2ac35a991c64f189041c878576cf34",
                "head": {
                    "label": "matrix-org:erikj/fix_worker_ratelimits",
                    "ref": "erikj/fix_worker_ratelimits",
                    "sha": "a2981a0bdc2ac35a991c64f189041c878576cf34",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-27T08:31:37Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 400535,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2162,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1517,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2162,
                        "open_issues": 1517,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "base": {
                    "label": "matrix-org:develop",
                    "ref": "develop",
                    "sha": "c14a7de6af0b8a3cbf2e17afca1cab339bc5912d",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-27T08:31:37Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 400535,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2162,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1517,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2162,
                        "open_issues": 1517,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558"
                    },
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16558"
                    },
                    "issue": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16558"
                    },
                    "comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16558/comments"
                    },
                    "review_comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/comments"
                    },
                    "review_comment": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}"
                    },
                    "commits": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/commits"
                    },
                    "statuses": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/statuses/a2981a0bdc2ac35a991c64f189041c878576cf34"
                    }
                },
                "author_association": "MEMBER",
                "auto_merge": null,
                "active_lock_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-27T08:32:31Z",
        "org": {
            "id": 8418310,
            "login": "matrix-org",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/matrix-org",
            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?"
        }
    },
    {
        "id": "32892578038",
        "type": "PushEvent",
        "actor": {
            "id": 8428120,
            "login": "erikjohnston",
            "display_login": "erikjohnston",
            "gravatar_id": "",
            "url": "https://api.github.com/users/erikjohnston",
            "avatar_url": "https://avatars.githubusercontent.com/u/8428120?"
        },
        "repo": {
            "id": 22844864,
            "name": "matrix-org/synapse",
            "url": "https://api.github.com/repos/matrix-org/synapse"
        },
        "payload": {
            "repository_id": 22844864,
            "push_id": 15588737412,
            "size": 1,
            "distinct_size": 1,
            "ref": "refs/heads/erikj/fix_worker_ratelimits",
            "head": "a2981a0bdc2ac35a991c64f189041c878576cf34",
            "before": "eb5a0f6ca600ecf83f139e562ed5b8760524be83",
            "commits": [
                {
                    "sha": "a2981a0bdc2ac35a991c64f189041c878576cf34",
                    "author": {
                        "email": "erikj@matrix.org",
                        "name": "Erik Johnston"
                    },
                    "message": "Apply suggestions from code review\n\nCo-authored-by: Patrick Cloke <clokep@users.noreply.github.com>",
                    "distinct": true,
                    "url": "https://api.github.com/repos/matrix-org/synapse/commits/a2981a0bdc2ac35a991c64f189041c878576cf34"
                }
            ]
        },
        "public": true,
        "created_at": "2023-10-27T08:31:38Z",
        "org": {
            "id": 8418310,
            "login": "matrix-org",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/matrix-org",
            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?"
        }
    },
    {
        "id": "32887855047",
        "type": "ForkEvent",
        "actor": {
            "id": 129481069,
            "login": "ClarifiedLabs",
            "display_login": "ClarifiedLabs",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ClarifiedLabs",
            "avatar_url": "https://avatars.githubusercontent.com/u/129481069?"
        },
        "repo": {
            "id": 22844864,
            "name": "matrix-org/synapse",
            "url": "https://api.github.com/repos/matrix-org/synapse"
        },
        "payload": {
            "forkee": {
                "id": 710614116,
                "node_id": "R_kgDOKlscZA",
                "name": "synapse",
                "full_name": "ClarifiedLabs/synapse",
                "private": false,
                "owner": {
                    "login": "ClarifiedLabs",
                    "id": 129481069,
                    "node_id": "O_kgDOB7e5bQ",
                    "avatar_url": "https://avatars.githubusercontent.com/u/129481069?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/ClarifiedLabs",
                    "html_url": "https://github.com/ClarifiedLabs",
                    "followers_url": "https://api.github.com/users/ClarifiedLabs/followers",
                    "following_url": "https://api.github.com/users/ClarifiedLabs/following{/other_user}",
                    "gists_url": "https://api.github.com/users/ClarifiedLabs/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/ClarifiedLabs/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/ClarifiedLabs/subscriptions",
                    "organizations_url": "https://api.github.com/users/ClarifiedLabs/orgs",
                    "repos_url": "https://api.github.com/users/ClarifiedLabs/repos",
                    "events_url": "https://api.github.com/users/ClarifiedLabs/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/ClarifiedLabs/received_events",
                    "type": "Organization",
                    "site_admin": false
                },
                "html_url": "https://github.com/ClarifiedLabs/synapse",
                "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                "fork": true,
                "url": "https://api.github.com/repos/ClarifiedLabs/synapse",
                "forks_url": "https://api.github.com/repos/ClarifiedLabs/synapse/forks",
                "keys_url": "https://api.github.com/repos/ClarifiedLabs/synapse/keys{/key_id}",
                "collaborators_url": "https://api.github.com/repos/ClarifiedLabs/synapse/collaborators{/collaborator}",
                "teams_url": "https://api.github.com/repos/ClarifiedLabs/synapse/teams",
                "hooks_url": "https://api.github.com/repos/ClarifiedLabs/synapse/hooks",
                "issue_events_url": "https://api.github.com/repos/ClarifiedLabs/synapse/issues/events{/number}",
                "events_url": "https://api.github.com/repos/ClarifiedLabs/synapse/events",
                "assignees_url": "https://api.github.com/repos/ClarifiedLabs/synapse/assignees{/user}",
                "branches_url": "https://api.github.com/repos/ClarifiedLabs/synapse/branches{/branch}",
                "tags_url": "https://api.github.com/repos/ClarifiedLabs/synapse/tags",
                "blobs_url": "https://api.github.com/repos/ClarifiedLabs/synapse/git/blobs{/sha}",
                "git_tags_url": "https://api.github.com/repos/ClarifiedLabs/synapse/git/tags{/sha}",
                "git_refs_url": "https://api.github.com/repos/ClarifiedLabs/synapse/git/refs{/sha}",
                "trees_url": "https://api.github.com/repos/ClarifiedLabs/synapse/git/trees{/sha}",
                "statuses_url": "https://api.github.com/repos/ClarifiedLabs/synapse/statuses/{sha}",
                "languages_url": "https://api.github.com/repos/ClarifiedLabs/synapse/languages",
                "stargazers_url": "https://api.github.com/repos/ClarifiedLabs/synapse/stargazers",
                "contributors_url": "https://api.github.com/repos/ClarifiedLabs/synapse/contributors",
                "subscribers_url": "https://api.github.com/repos/ClarifiedLabs/synapse/subscribers",
                "subscription_url": "https://api.github.com/repos/ClarifiedLabs/synapse/subscription",
                "commits_url": "https://api.github.com/repos/ClarifiedLabs/synapse/commits{/sha}",
                "git_commits_url": "https://api.github.com/repos/ClarifiedLabs/synapse/git/commits{/sha}",
                "comments_url": "https://api.github.com/repos/ClarifiedLabs/synapse/comments{/number}",
                "issue_comment_url": "https://api.github.com/repos/ClarifiedLabs/synapse/issues/comments{/number}",
                "contents_url": "https://api.github.com/repos/ClarifiedLabs/synapse/contents/{+path}",
                "compare_url": "https://api.github.com/repos/ClarifiedLabs/synapse/compare/{base}...{head}",
                "merges_url": "https://api.github.com/repos/ClarifiedLabs/synapse/merges",
                "archive_url": "https://api.github.com/repos/ClarifiedLabs/synapse/{archive_format}{/ref}",
                "downloads_url": "https://api.github.com/repos/ClarifiedLabs/synapse/downloads",
                "issues_url": "https://api.github.com/repos/ClarifiedLabs/synapse/issues{/number}",
                "pulls_url": "https://api.github.com/repos/ClarifiedLabs/synapse/pulls{/number}",
                "milestones_url": "https://api.github.com/repos/ClarifiedLabs/synapse/milestones{/number}",
                "notifications_url": "https://api.github.com/repos/ClarifiedLabs/synapse/notifications{?since,all,participating}",
                "labels_url": "https://api.github.com/repos/ClarifiedLabs/synapse/labels{/name}",
                "releases_url": "https://api.github.com/repos/ClarifiedLabs/synapse/releases{/id}",
                "deployments_url": "https://api.github.com/repos/ClarifiedLabs/synapse/deployments",
                "created_at": "2023-10-27T04:20:59Z",
                "updated_at": "2023-10-27T04:20:59Z",
                "pushed_at": "2023-10-26T19:12:33Z",
                "git_url": "git://github.com/ClarifiedLabs/synapse.git",
                "ssh_url": "git@github.com:ClarifiedLabs/synapse.git",
                "clone_url": "https://github.com/ClarifiedLabs/synapse.git",
                "svn_url": "https://github.com/ClarifiedLabs/synapse",
                "homepage": "https://matrix-org.github.io/synapse",
                "size": 400535,
                "stargazers_count": 0,
                "watchers_count": 0,
                "language": null,
                "has_issues": false,
                "has_projects": true,
                "has_downloads": true,
                "has_wiki": true,
                "has_pages": false,
                "has_discussions": false,
                "forks_count": 0,
                "mirror_url": null,
                "archived": false,
                "disabled": false,
                "open_issues_count": 0,
                "license": null,
                "allow_forking": true,
                "is_template": false,
                "web_commit_signoff_required": false,
                "topics": [],
                "visibility": "public",
                "forks": 0,
                "open_issues": 0,
                "watchers": 0,
                "default_branch": "main",
                "public": true
            }
        },
        "public": true,
        "created_at": "2023-10-27T04:21:00Z",
        "org": {
            "id": 8418310,
            "login": "matrix-org",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/matrix-org",
            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?"
        }
    },
    {
        "id": "32880567607",
        "type": "PullRequestReviewCommentEvent",
        "actor": {
            "id": 517124,
            "login": "clokep",
            "display_login": "clokep",
            "gravatar_id": "",
            "url": "https://api.github.com/users/clokep",
            "avatar_url": "https://avatars.githubusercontent.com/u/517124?"
        },
        "repo": {
            "id": 22844864,
            "name": "matrix-org/synapse",
            "url": "https://api.github.com/repos/matrix-org/synapse"
        },
        "payload": {
            "action": "created",
            "comment": {
                "url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments/1373752906",
                "pull_request_review_id": 1700552438,
                "id": 1373752906,
                "node_id": "PRRC_kwDOAVyVwM5R4c5K",
                "diff_hunk": "@@ -999,7 +999,26 @@ async def create_and_send_nonmember_event(\n             raise ShadowBanError()\n \n         if ratelimit:\n-            await self.request_ratelimiter.ratelimit(requester, update=False)\n+            room_id = event_dict[\"room_id\"]\n+            try:\n+                room_version = await self.store.get_room_version(room_id)\n+            except NotFoundError:\n+                # If the room doesnt' exist.",
                "path": "synapse/handlers/message.py",
                "commit_id": "eb5a0f6ca600ecf83f139e562ed5b8760524be83",
                "original_commit_id": "eb5a0f6ca600ecf83f139e562ed5b8760524be83",
                "user": {
                    "login": "clokep",
                    "id": 517124,
                    "node_id": "MDQ6VXNlcjUxNzEyNA==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/517124?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/clokep",
                    "html_url": "https://github.com/clokep",
                    "followers_url": "https://api.github.com/users/clokep/followers",
                    "following_url": "https://api.github.com/users/clokep/following{/other_user}",
                    "gists_url": "https://api.github.com/users/clokep/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/clokep/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/clokep/subscriptions",
                    "organizations_url": "https://api.github.com/users/clokep/orgs",
                    "repos_url": "https://api.github.com/users/clokep/repos",
                    "events_url": "https://api.github.com/users/clokep/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/clokep/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "```suggestion\r\n                # The room doesn't exist.\r\n```",
                "created_at": "2023-10-26T20:00:33Z",
                "updated_at": "2023-10-26T20:04:19Z",
                "html_url": "https://github.com/matrix-org/synapse/pull/16558#discussion_r1373752906",
                "pull_request_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558",
                "author_association": "MEMBER",
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/comments/1373752906"
                    },
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16558#discussion_r1373752906"
                    },
                    "pull_request": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558"
                    }
                },
                "reactions": {
                    "url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments/1373752906/reactions",
                    "total_count": 0,
                    "+1": 0,
                    "-1": 0,
                    "laugh": 0,
                    "hooray": 0,
                    "confused": 0,
                    "heart": 0,
                    "rocket": 0,
                    "eyes": 0
                },
                "start_line": null,
                "original_start_line": null,
                "start_side": null,
                "line": 1006,
                "original_line": 1006,
                "side": "RIGHT",
                "original_position": 9,
                "position": 9,
                "subject_type": "line"
            },
            "pull_request": {
                "url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558",
                "id": 1575119529,
                "node_id": "PR_kwDOAVyVwM5d4mqp",
                "html_url": "https://github.com/matrix-org/synapse/pull/16558",
                "diff_url": "https://github.com/matrix-org/synapse/pull/16558.diff",
                "patch_url": "https://github.com/matrix-org/synapse/pull/16558.patch",
                "issue_url": "https://api.github.com/repos/matrix-org/synapse/issues/16558",
                "number": 16558,
                "state": "open",
                "locked": false,
                "title": "Fix cross-worker ratelimiting",
                "user": {
                    "login": "erikjohnston",
                    "id": 8428120,
                    "node_id": "MDQ6VXNlcjg0MjgxMjA=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/8428120?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/erikjohnston",
                    "html_url": "https://github.com/erikjohnston",
                    "followers_url": "https://api.github.com/users/erikjohnston/followers",
                    "following_url": "https://api.github.com/users/erikjohnston/following{/other_user}",
                    "gists_url": "https://api.github.com/users/erikjohnston/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/erikjohnston/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/erikjohnston/subscriptions",
                    "organizations_url": "https://api.github.com/users/erikjohnston/orgs",
                    "repos_url": "https://api.github.com/users/erikjohnston/repos",
                    "events_url": "https://api.github.com/users/erikjohnston/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/erikjohnston/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "c.f. #16481",
                "created_at": "2023-10-26T15:43:56Z",
                "updated_at": "2023-10-26T20:04:19Z",
                "closed_at": null,
                "merged_at": null,
                "merge_commit_sha": "2bff48eed8a304931624d217279fe48063d9fbca",
                "assignee": null,
                "assignees": [],
                "requested_reviewers": [],
                "requested_teams": [],
                "labels": [],
                "milestone": null,
                "draft": false,
                "commits_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/commits",
                "review_comments_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/comments",
                "review_comment_url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}",
                "comments_url": "https://api.github.com/repos/matrix-org/synapse/issues/16558/comments",
                "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/eb5a0f6ca600ecf83f139e562ed5b8760524be83",
                "head": {
                    "label": "matrix-org:erikj/fix_worker_ratelimits",
                    "ref": "erikj/fix_worker_ratelimits",
                    "sha": "eb5a0f6ca600ecf83f139e562ed5b8760524be83",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-26T19:12:33Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 400535,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2163,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1517,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2163,
                        "open_issues": 1517,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "base": {
                    "label": "matrix-org:develop",
                    "ref": "develop",
                    "sha": "c14a7de6af0b8a3cbf2e17afca1cab339bc5912d",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-26T19:12:33Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 400535,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2163,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1517,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2163,
                        "open_issues": 1517,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558"
                    },
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16558"
                    },
                    "issue": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16558"
                    },
                    "comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16558/comments"
                    },
                    "review_comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/comments"
                    },
                    "review_comment": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}"
                    },
                    "commits": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/commits"
                    },
                    "statuses": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/statuses/eb5a0f6ca600ecf83f139e562ed5b8760524be83"
                    }
                },
                "author_association": "MEMBER",
                "auto_merge": null,
                "active_lock_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-26T20:00:33Z",
        "org": {
            "id": 8418310,
            "login": "matrix-org",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/matrix-org",
            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?"
        }
    },
    {
        "id": "32880567623",
        "type": "PullRequestReviewCommentEvent",
        "actor": {
            "id": 517124,
            "login": "clokep",
            "display_login": "clokep",
            "gravatar_id": "",
            "url": "https://api.github.com/users/clokep",
            "avatar_url": "https://avatars.githubusercontent.com/u/517124?"
        },
        "repo": {
            "id": 22844864,
            "name": "matrix-org/synapse",
            "url": "https://api.github.com/repos/matrix-org/synapse"
        },
        "payload": {
            "action": "created",
            "comment": {
                "url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments/1373753123",
                "pull_request_review_id": 1700552438,
                "id": 1373753123,
                "node_id": "PRRC_kwDOAVyVwM5R4c8j",
                "diff_hunk": "@@ -999,7 +999,26 @@ async def create_and_send_nonmember_event(\n             raise ShadowBanError()\n \n         if ratelimit:\n-            await self.request_ratelimiter.ratelimit(requester, update=False)\n+            room_id = event_dict[\"room_id\"]\n+            try:\n+                room_version = await self.store.get_room_version(room_id)\n+            except NotFoundError:\n+                # If the room doesnt' exist.\n+                raise AuthError(403, f\"User {requester.user} not in room {room_id}\")",
                "path": "synapse/handlers/message.py",
                "commit_id": "eb5a0f6ca600ecf83f139e562ed5b8760524be83",
                "original_commit_id": "eb5a0f6ca600ecf83f139e562ed5b8760524be83",
                "user": {
                    "login": "clokep",
                    "id": 517124,
                    "node_id": "MDQ6VXNlcjUxNzEyNA==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/517124?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/clokep",
                    "html_url": "https://github.com/clokep",
                    "followers_url": "https://api.github.com/users/clokep/followers",
                    "following_url": "https://api.github.com/users/clokep/following{/other_user}",
                    "gists_url": "https://api.github.com/users/clokep/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/clokep/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/clokep/subscriptions",
                    "organizations_url": "https://api.github.com/users/clokep/orgs",
                    "repos_url": "https://api.github.com/users/clokep/repos",
                    "events_url": "https://api.github.com/users/clokep/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/clokep/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "Is this the right error message?",
                "created_at": "2023-10-26T20:00:46Z",
                "updated_at": "2023-10-26T20:04:19Z",
                "html_url": "https://github.com/matrix-org/synapse/pull/16558#discussion_r1373753123",
                "pull_request_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558",
                "author_association": "MEMBER",
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/comments/1373753123"
                    },
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16558#discussion_r1373753123"
                    },
                    "pull_request": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558"
                    }
                },
                "reactions": {
                    "url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments/1373753123/reactions",
                    "total_count": 0,
                    "+1": 0,
                    "-1": 0,
                    "laugh": 0,
                    "hooray": 0,
                    "confused": 0,
                    "heart": 0,
                    "rocket": 0,
                    "eyes": 0
                },
                "start_line": null,
                "original_start_line": null,
                "start_side": null,
                "line": 1007,
                "original_line": 1007,
                "side": "RIGHT",
                "original_position": 10,
                "position": 10,
                "subject_type": "line"
            },
            "pull_request": {
                "url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558",
                "id": 1575119529,
                "node_id": "PR_kwDOAVyVwM5d4mqp",
                "html_url": "https://github.com/matrix-org/synapse/pull/16558",
                "diff_url": "https://github.com/matrix-org/synapse/pull/16558.diff",
                "patch_url": "https://github.com/matrix-org/synapse/pull/16558.patch",
                "issue_url": "https://api.github.com/repos/matrix-org/synapse/issues/16558",
                "number": 16558,
                "state": "open",
                "locked": false,
                "title": "Fix cross-worker ratelimiting",
                "user": {
                    "login": "erikjohnston",
                    "id": 8428120,
                    "node_id": "MDQ6VXNlcjg0MjgxMjA=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/8428120?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/erikjohnston",
                    "html_url": "https://github.com/erikjohnston",
                    "followers_url": "https://api.github.com/users/erikjohnston/followers",
                    "following_url": "https://api.github.com/users/erikjohnston/following{/other_user}",
                    "gists_url": "https://api.github.com/users/erikjohnston/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/erikjohnston/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/erikjohnston/subscriptions",
                    "organizations_url": "https://api.github.com/users/erikjohnston/orgs",
                    "repos_url": "https://api.github.com/users/erikjohnston/repos",
                    "events_url": "https://api.github.com/users/erikjohnston/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/erikjohnston/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "c.f. #16481",
                "created_at": "2023-10-26T15:43:56Z",
                "updated_at": "2023-10-26T20:04:19Z",
                "closed_at": null,
                "merged_at": null,
                "merge_commit_sha": "2bff48eed8a304931624d217279fe48063d9fbca",
                "assignee": null,
                "assignees": [],
                "requested_reviewers": [],
                "requested_teams": [],
                "labels": [],
                "milestone": null,
                "draft": false,
                "commits_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/commits",
                "review_comments_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/comments",
                "review_comment_url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}",
                "comments_url": "https://api.github.com/repos/matrix-org/synapse/issues/16558/comments",
                "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/eb5a0f6ca600ecf83f139e562ed5b8760524be83",
                "head": {
                    "label": "matrix-org:erikj/fix_worker_ratelimits",
                    "ref": "erikj/fix_worker_ratelimits",
                    "sha": "eb5a0f6ca600ecf83f139e562ed5b8760524be83",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-26T19:12:33Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 400535,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2163,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1517,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2163,
                        "open_issues": 1517,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "base": {
                    "label": "matrix-org:develop",
                    "ref": "develop",
                    "sha": "c14a7de6af0b8a3cbf2e17afca1cab339bc5912d",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-26T19:12:33Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 400535,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2163,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1517,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2163,
                        "open_issues": 1517,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558"
                    },
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16558"
                    },
                    "issue": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16558"
                    },
                    "comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16558/comments"
                    },
                    "review_comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/comments"
                    },
                    "review_comment": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}"
                    },
                    "commits": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/commits"
                    },
                    "statuses": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/statuses/eb5a0f6ca600ecf83f139e562ed5b8760524be83"
                    }
                },
                "author_association": "MEMBER",
                "auto_merge": null,
                "active_lock_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-26T20:00:46Z",
        "org": {
            "id": 8418310,
            "login": "matrix-org",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/matrix-org",
            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?"
        }
    },
    {
        "id": "32880567644",
        "type": "PullRequestReviewCommentEvent",
        "actor": {
            "id": 517124,
            "login": "clokep",
            "display_login": "clokep",
            "gravatar_id": "",
            "url": "https://api.github.com/users/clokep",
            "avatar_url": "https://avatars.githubusercontent.com/u/517124?"
        },
        "repo": {
            "id": 22844864,
            "name": "matrix-org/synapse",
            "url": "https://api.github.com/repos/matrix-org/synapse"
        },
        "payload": {
            "action": "created",
            "comment": {
                "url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments/1373756269",
                "pull_request_review_id": 1700552438,
                "id": 1373756269,
                "node_id": "PRRC_kwDOAVyVwM5R4dtt",
                "diff_hunk": "@@ -1508,6 +1527,18 @@ async def _persist_events(\n                 first_event.room_id\n             )\n             if writer_instance != self._instance_name:\n+                # Ratelimit before sending to the other event persister, to\n+                # ensure that we correctly have ratelimits on both the event\n+                # creators and event persiters.",
                "path": "synapse/handlers/message.py",
                "commit_id": "eb5a0f6ca600ecf83f139e562ed5b8760524be83",
                "original_commit_id": "eb5a0f6ca600ecf83f139e562ed5b8760524be83",
                "user": {
                    "login": "clokep",
                    "id": 517124,
                    "node_id": "MDQ6VXNlcjUxNzEyNA==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/517124?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/clokep",
                    "html_url": "https://github.com/clokep",
                    "followers_url": "https://api.github.com/users/clokep/followers",
                    "following_url": "https://api.github.com/users/clokep/following{/other_user}",
                    "gists_url": "https://api.github.com/users/clokep/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/clokep/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/clokep/subscriptions",
                    "organizations_url": "https://api.github.com/users/clokep/orgs",
                    "repos_url": "https://api.github.com/users/clokep/repos",
                    "events_url": "https://api.github.com/users/clokep/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/clokep/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "If there are multiple creators going to the same persister (Is that possible?) than we *might* pass this rate check, but fail the one on the persister.\r\n\r\nI think the opposite isn't true since persisters are sharded by room so we either have a 1-to-1 mapping or a many-to-1 mapping? But the creater could fill the bucket faster if for some reason the `send_events` below fails (e.g. the persister is offline for a period?)\r\n\r\nI guess restarts would also make these go out of sync?",
                "created_at": "2023-10-26T20:04:01Z",
                "updated_at": "2023-10-26T20:04:19Z",
                "html_url": "https://github.com/matrix-org/synapse/pull/16558#discussion_r1373756269",
                "pull_request_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558",
                "author_association": "MEMBER",
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/comments/1373756269"
                    },
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16558#discussion_r1373756269"
                    },
                    "pull_request": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558"
                    }
                },
                "reactions": {
                    "url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments/1373756269/reactions",
                    "total_count": 0,
                    "+1": 0,
                    "-1": 0,
                    "laugh": 0,
                    "hooray": 0,
                    "confused": 0,
                    "heart": 0,
                    "rocket": 0,
                    "eyes": 0
                },
                "start_line": null,
                "original_start_line": null,
                "start_side": null,
                "line": 1532,
                "original_line": 1532,
                "side": "RIGHT",
                "in_reply_to_id": 1373753967,
                "original_position": 34,
                "position": 34,
                "subject_type": "line"
            },
            "pull_request": {
                "url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558",
                "id": 1575119529,
                "node_id": "PR_kwDOAVyVwM5d4mqp",
                "html_url": "https://github.com/matrix-org/synapse/pull/16558",
                "diff_url": "https://github.com/matrix-org/synapse/pull/16558.diff",
                "patch_url": "https://github.com/matrix-org/synapse/pull/16558.patch",
                "issue_url": "https://api.github.com/repos/matrix-org/synapse/issues/16558",
                "number": 16558,
                "state": "open",
                "locked": false,
                "title": "Fix cross-worker ratelimiting",
                "user": {
                    "login": "erikjohnston",
                    "id": 8428120,
                    "node_id": "MDQ6VXNlcjg0MjgxMjA=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/8428120?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/erikjohnston",
                    "html_url": "https://github.com/erikjohnston",
                    "followers_url": "https://api.github.com/users/erikjohnston/followers",
                    "following_url": "https://api.github.com/users/erikjohnston/following{/other_user}",
                    "gists_url": "https://api.github.com/users/erikjohnston/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/erikjohnston/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/erikjohnston/subscriptions",
                    "organizations_url": "https://api.github.com/users/erikjohnston/orgs",
                    "repos_url": "https://api.github.com/users/erikjohnston/repos",
                    "events_url": "https://api.github.com/users/erikjohnston/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/erikjohnston/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "c.f. #16481",
                "created_at": "2023-10-26T15:43:56Z",
                "updated_at": "2023-10-26T20:04:19Z",
                "closed_at": null,
                "merged_at": null,
                "merge_commit_sha": "2bff48eed8a304931624d217279fe48063d9fbca",
                "assignee": null,
                "assignees": [],
                "requested_reviewers": [],
                "requested_teams": [],
                "labels": [],
                "milestone": null,
                "draft": false,
                "commits_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/commits",
                "review_comments_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/comments",
                "review_comment_url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}",
                "comments_url": "https://api.github.com/repos/matrix-org/synapse/issues/16558/comments",
                "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/eb5a0f6ca600ecf83f139e562ed5b8760524be83",
                "head": {
                    "label": "matrix-org:erikj/fix_worker_ratelimits",
                    "ref": "erikj/fix_worker_ratelimits",
                    "sha": "eb5a0f6ca600ecf83f139e562ed5b8760524be83",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-26T19:12:33Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 400535,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2163,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1517,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2163,
                        "open_issues": 1517,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "base": {
                    "label": "matrix-org:develop",
                    "ref": "develop",
                    "sha": "c14a7de6af0b8a3cbf2e17afca1cab339bc5912d",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-26T19:12:33Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 400535,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2163,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1517,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2163,
                        "open_issues": 1517,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558"
                    },
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16558"
                    },
                    "issue": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16558"
                    },
                    "comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16558/comments"
                    },
                    "review_comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/comments"
                    },
                    "review_comment": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}"
                    },
                    "commits": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/commits"
                    },
                    "statuses": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/statuses/eb5a0f6ca600ecf83f139e562ed5b8760524be83"
                    }
                },
                "author_association": "MEMBER",
                "auto_merge": null,
                "active_lock_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-26T20:04:01Z",
        "org": {
            "id": 8418310,
            "login": "matrix-org",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/matrix-org",
            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?"
        }
    },
    {
        "id": "32880567624",
        "type": "PullRequestReviewCommentEvent",
        "actor": {
            "id": 517124,
            "login": "clokep",
            "display_login": "clokep",
            "gravatar_id": "",
            "url": "https://api.github.com/users/clokep",
            "avatar_url": "https://avatars.githubusercontent.com/u/517124?"
        },
        "repo": {
            "id": 22844864,
            "name": "matrix-org/synapse",
            "url": "https://api.github.com/repos/matrix-org/synapse"
        },
        "payload": {
            "action": "created",
            "comment": {
                "url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments/1373753967",
                "pull_request_review_id": 1700552438,
                "id": 1373753967,
                "node_id": "PRRC_kwDOAVyVwM5R4dJv",
                "diff_hunk": "@@ -1508,6 +1527,18 @@ async def _persist_events(\n                 first_event.room_id\n             )\n             if writer_instance != self._instance_name:\n+                # Ratelimit before sending to the other event persister, to\n+                # ensure that we correctly have ratelimits on both the event\n+                # creators and event persiters.",
                "path": "synapse/handlers/message.py",
                "commit_id": "eb5a0f6ca600ecf83f139e562ed5b8760524be83",
                "original_commit_id": "eb5a0f6ca600ecf83f139e562ed5b8760524be83",
                "user": {
                    "login": "clokep",
                    "id": 517124,
                    "node_id": "MDQ6VXNlcjUxNzEyNA==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/517124?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/clokep",
                    "html_url": "https://github.com/clokep",
                    "followers_url": "https://api.github.com/users/clokep/followers",
                    "following_url": "https://api.github.com/users/clokep/following{/other_user}",
                    "gists_url": "https://api.github.com/users/clokep/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/clokep/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/clokep/subscriptions",
                    "organizations_url": "https://api.github.com/users/clokep/orgs",
                    "repos_url": "https://api.github.com/users/clokep/repos",
                    "events_url": "https://api.github.com/users/clokep/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/clokep/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "```suggestion\r\n                # creators and event persisters.\r\n```",
                "created_at": "2023-10-26T20:01:44Z",
                "updated_at": "2023-10-26T20:04:19Z",
                "html_url": "https://github.com/matrix-org/synapse/pull/16558#discussion_r1373753967",
                "pull_request_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558",
                "author_association": "MEMBER",
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/comments/1373753967"
                    },
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16558#discussion_r1373753967"
                    },
                    "pull_request": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558"
                    }
                },
                "reactions": {
                    "url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments/1373753967/reactions",
                    "total_count": 0,
                    "+1": 0,
                    "-1": 0,
                    "laugh": 0,
                    "hooray": 0,
                    "confused": 0,
                    "heart": 0,
                    "rocket": 0,
                    "eyes": 0
                },
                "start_line": null,
                "original_start_line": null,
                "start_side": null,
                "line": 1532,
                "original_line": 1532,
                "side": "RIGHT",
                "original_position": 34,
                "position": 34,
                "subject_type": "line"
            },
            "pull_request": {
                "url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558",
                "id": 1575119529,
                "node_id": "PR_kwDOAVyVwM5d4mqp",
                "html_url": "https://github.com/matrix-org/synapse/pull/16558",
                "diff_url": "https://github.com/matrix-org/synapse/pull/16558.diff",
                "patch_url": "https://github.com/matrix-org/synapse/pull/16558.patch",
                "issue_url": "https://api.github.com/repos/matrix-org/synapse/issues/16558",
                "number": 16558,
                "state": "open",
                "locked": false,
                "title": "Fix cross-worker ratelimiting",
                "user": {
                    "login": "erikjohnston",
                    "id": 8428120,
                    "node_id": "MDQ6VXNlcjg0MjgxMjA=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/8428120?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/erikjohnston",
                    "html_url": "https://github.com/erikjohnston",
                    "followers_url": "https://api.github.com/users/erikjohnston/followers",
                    "following_url": "https://api.github.com/users/erikjohnston/following{/other_user}",
                    "gists_url": "https://api.github.com/users/erikjohnston/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/erikjohnston/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/erikjohnston/subscriptions",
                    "organizations_url": "https://api.github.com/users/erikjohnston/orgs",
                    "repos_url": "https://api.github.com/users/erikjohnston/repos",
                    "events_url": "https://api.github.com/users/erikjohnston/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/erikjohnston/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "c.f. #16481",
                "created_at": "2023-10-26T15:43:56Z",
                "updated_at": "2023-10-26T20:04:19Z",
                "closed_at": null,
                "merged_at": null,
                "merge_commit_sha": "2bff48eed8a304931624d217279fe48063d9fbca",
                "assignee": null,
                "assignees": [],
                "requested_reviewers": [],
                "requested_teams": [],
                "labels": [],
                "milestone": null,
                "draft": false,
                "commits_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/commits",
                "review_comments_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/comments",
                "review_comment_url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}",
                "comments_url": "https://api.github.com/repos/matrix-org/synapse/issues/16558/comments",
                "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/eb5a0f6ca600ecf83f139e562ed5b8760524be83",
                "head": {
                    "label": "matrix-org:erikj/fix_worker_ratelimits",
                    "ref": "erikj/fix_worker_ratelimits",
                    "sha": "eb5a0f6ca600ecf83f139e562ed5b8760524be83",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-26T19:12:33Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 400535,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2163,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1517,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2163,
                        "open_issues": 1517,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "base": {
                    "label": "matrix-org:develop",
                    "ref": "develop",
                    "sha": "c14a7de6af0b8a3cbf2e17afca1cab339bc5912d",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-26T19:12:33Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 400535,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2163,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1517,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2163,
                        "open_issues": 1517,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558"
                    },
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16558"
                    },
                    "issue": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16558"
                    },
                    "comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16558/comments"
                    },
                    "review_comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/comments"
                    },
                    "review_comment": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}"
                    },
                    "commits": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/commits"
                    },
                    "statuses": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/statuses/eb5a0f6ca600ecf83f139e562ed5b8760524be83"
                    }
                },
                "author_association": "MEMBER",
                "auto_merge": null,
                "active_lock_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-26T20:01:44Z",
        "org": {
            "id": 8418310,
            "login": "matrix-org",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/matrix-org",
            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?"
        }
    },
    {
        "id": "32880567558",
        "type": "PullRequestReviewEvent",
        "actor": {
            "id": 517124,
            "login": "clokep",
            "display_login": "clokep",
            "gravatar_id": "",
            "url": "https://api.github.com/users/clokep",
            "avatar_url": "https://avatars.githubusercontent.com/u/517124?"
        },
        "repo": {
            "id": 22844864,
            "name": "matrix-org/synapse",
            "url": "https://api.github.com/repos/matrix-org/synapse"
        },
        "payload": {
            "action": "created",
            "review": {
                "id": 1700552438,
                "node_id": "PRR_kwDOAVyVwM5lXF72",
                "user": {
                    "login": "clokep",
                    "id": 517124,
                    "node_id": "MDQ6VXNlcjUxNzEyNA==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/517124?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/clokep",
                    "html_url": "https://github.com/clokep",
                    "followers_url": "https://api.github.com/users/clokep/followers",
                    "following_url": "https://api.github.com/users/clokep/following{/other_user}",
                    "gists_url": "https://api.github.com/users/clokep/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/clokep/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/clokep/subscriptions",
                    "organizations_url": "https://api.github.com/users/clokep/orgs",
                    "repos_url": "https://api.github.com/users/clokep/repos",
                    "events_url": "https://api.github.com/users/clokep/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/clokep/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "Overall seems reasonable, but a couple sanity checks.",
                "commit_id": "eb5a0f6ca600ecf83f139e562ed5b8760524be83",
                "submitted_at": "2023-10-26T20:04:19Z",
                "state": "approved",
                "html_url": "https://github.com/matrix-org/synapse/pull/16558#pullrequestreview-1700552438",
                "pull_request_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558",
                "author_association": "MEMBER",
                "_links": {
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16558#pullrequestreview-1700552438"
                    },
                    "pull_request": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558"
                    }
                }
            },
            "pull_request": {
                "url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558",
                "id": 1575119529,
                "node_id": "PR_kwDOAVyVwM5d4mqp",
                "html_url": "https://github.com/matrix-org/synapse/pull/16558",
                "diff_url": "https://github.com/matrix-org/synapse/pull/16558.diff",
                "patch_url": "https://github.com/matrix-org/synapse/pull/16558.patch",
                "issue_url": "https://api.github.com/repos/matrix-org/synapse/issues/16558",
                "number": 16558,
                "state": "open",
                "locked": false,
                "title": "Fix cross-worker ratelimiting",
                "user": {
                    "login": "erikjohnston",
                    "id": 8428120,
                    "node_id": "MDQ6VXNlcjg0MjgxMjA=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/8428120?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/erikjohnston",
                    "html_url": "https://github.com/erikjohnston",
                    "followers_url": "https://api.github.com/users/erikjohnston/followers",
                    "following_url": "https://api.github.com/users/erikjohnston/following{/other_user}",
                    "gists_url": "https://api.github.com/users/erikjohnston/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/erikjohnston/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/erikjohnston/subscriptions",
                    "organizations_url": "https://api.github.com/users/erikjohnston/orgs",
                    "repos_url": "https://api.github.com/users/erikjohnston/repos",
                    "events_url": "https://api.github.com/users/erikjohnston/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/erikjohnston/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "c.f. #16481",
                "created_at": "2023-10-26T15:43:56Z",
                "updated_at": "2023-10-26T20:04:19Z",
                "closed_at": null,
                "merged_at": null,
                "merge_commit_sha": "2bff48eed8a304931624d217279fe48063d9fbca",
                "assignee": null,
                "assignees": [],
                "requested_reviewers": [],
                "requested_teams": [],
                "labels": [],
                "milestone": null,
                "draft": false,
                "commits_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/commits",
                "review_comments_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/comments",
                "review_comment_url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}",
                "comments_url": "https://api.github.com/repos/matrix-org/synapse/issues/16558/comments",
                "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/eb5a0f6ca600ecf83f139e562ed5b8760524be83",
                "head": {
                    "label": "matrix-org:erikj/fix_worker_ratelimits",
                    "ref": "erikj/fix_worker_ratelimits",
                    "sha": "eb5a0f6ca600ecf83f139e562ed5b8760524be83",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-26T19:12:33Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 400535,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2163,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1517,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2163,
                        "open_issues": 1517,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "base": {
                    "label": "matrix-org:develop",
                    "ref": "develop",
                    "sha": "c14a7de6af0b8a3cbf2e17afca1cab339bc5912d",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-26T19:12:33Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 400535,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2163,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1517,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2163,
                        "open_issues": 1517,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558"
                    },
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16558"
                    },
                    "issue": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16558"
                    },
                    "comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16558/comments"
                    },
                    "review_comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/comments"
                    },
                    "review_comment": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}"
                    },
                    "commits": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/commits"
                    },
                    "statuses": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/statuses/eb5a0f6ca600ecf83f139e562ed5b8760524be83"
                    }
                },
                "author_association": "MEMBER",
                "auto_merge": null,
                "active_lock_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-26T20:04:20Z",
        "org": {
            "id": 8418310,
            "login": "matrix-org",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/matrix-org",
            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?"
        }
    },
    {
        "id": "32880567501",
        "type": "PullRequestReviewEvent",
        "actor": {
            "id": 517124,
            "login": "clokep",
            "display_login": "clokep",
            "gravatar_id": "",
            "url": "https://api.github.com/users/clokep",
            "avatar_url": "https://avatars.githubusercontent.com/u/517124?"
        },
        "repo": {
            "id": 22844864,
            "name": "matrix-org/synapse",
            "url": "https://api.github.com/repos/matrix-org/synapse"
        },
        "payload": {
            "action": "created",
            "review": {
                "id": 1700552438,
                "node_id": "PRR_kwDOAVyVwM5lXF72",
                "user": {
                    "login": "clokep",
                    "id": 517124,
                    "node_id": "MDQ6VXNlcjUxNzEyNA==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/517124?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/clokep",
                    "html_url": "https://github.com/clokep",
                    "followers_url": "https://api.github.com/users/clokep/followers",
                    "following_url": "https://api.github.com/users/clokep/following{/other_user}",
                    "gists_url": "https://api.github.com/users/clokep/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/clokep/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/clokep/subscriptions",
                    "organizations_url": "https://api.github.com/users/clokep/orgs",
                    "repos_url": "https://api.github.com/users/clokep/repos",
                    "events_url": "https://api.github.com/users/clokep/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/clokep/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "Overall seems reasonable, but a couple sanity checks.",
                "commit_id": "eb5a0f6ca600ecf83f139e562ed5b8760524be83",
                "submitted_at": "2023-10-26T20:04:19Z",
                "state": "approved",
                "html_url": "https://github.com/matrix-org/synapse/pull/16558#pullrequestreview-1700552438",
                "pull_request_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558",
                "author_association": "MEMBER",
                "_links": {
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16558#pullrequestreview-1700552438"
                    },
                    "pull_request": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558"
                    }
                }
            },
            "pull_request": {
                "url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558",
                "id": 1575119529,
                "node_id": "PR_kwDOAVyVwM5d4mqp",
                "html_url": "https://github.com/matrix-org/synapse/pull/16558",
                "diff_url": "https://github.com/matrix-org/synapse/pull/16558.diff",
                "patch_url": "https://github.com/matrix-org/synapse/pull/16558.patch",
                "issue_url": "https://api.github.com/repos/matrix-org/synapse/issues/16558",
                "number": 16558,
                "state": "open",
                "locked": false,
                "title": "Fix cross-worker ratelimiting",
                "user": {
                    "login": "erikjohnston",
                    "id": 8428120,
                    "node_id": "MDQ6VXNlcjg0MjgxMjA=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/8428120?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/erikjohnston",
                    "html_url": "https://github.com/erikjohnston",
                    "followers_url": "https://api.github.com/users/erikjohnston/followers",
                    "following_url": "https://api.github.com/users/erikjohnston/following{/other_user}",
                    "gists_url": "https://api.github.com/users/erikjohnston/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/erikjohnston/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/erikjohnston/subscriptions",
                    "organizations_url": "https://api.github.com/users/erikjohnston/orgs",
                    "repos_url": "https://api.github.com/users/erikjohnston/repos",
                    "events_url": "https://api.github.com/users/erikjohnston/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/erikjohnston/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "c.f. #16481",
                "created_at": "2023-10-26T15:43:56Z",
                "updated_at": "2023-10-26T20:04:19Z",
                "closed_at": null,
                "merged_at": null,
                "merge_commit_sha": "2bff48eed8a304931624d217279fe48063d9fbca",
                "assignee": null,
                "assignees": [],
                "requested_reviewers": [],
                "requested_teams": [],
                "labels": [],
                "milestone": null,
                "draft": false,
                "commits_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/commits",
                "review_comments_url": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/comments",
                "review_comment_url": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}",
                "comments_url": "https://api.github.com/repos/matrix-org/synapse/issues/16558/comments",
                "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/eb5a0f6ca600ecf83f139e562ed5b8760524be83",
                "head": {
                    "label": "matrix-org:erikj/fix_worker_ratelimits",
                    "ref": "erikj/fix_worker_ratelimits",
                    "sha": "eb5a0f6ca600ecf83f139e562ed5b8760524be83",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-26T19:12:33Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 400535,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2163,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1517,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2163,
                        "open_issues": 1517,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "base": {
                    "label": "matrix-org:develop",
                    "ref": "develop",
                    "sha": "c14a7de6af0b8a3cbf2e17afca1cab339bc5912d",
                    "user": {
                        "login": "matrix-org",
                        "id": 8418310,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/matrix-org",
                        "html_url": "https://github.com/matrix-org",
                        "followers_url": "https://api.github.com/users/matrix-org/followers",
                        "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                        "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                        "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                        "repos_url": "https://api.github.com/users/matrix-org/repos",
                        "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 22844864,
                        "node_id": "MDEwOlJlcG9zaXRvcnkyMjg0NDg2NA==",
                        "name": "synapse",
                        "full_name": "matrix-org/synapse",
                        "private": false,
                        "owner": {
                            "login": "matrix-org",
                            "id": 8418310,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjg0MTgzMTA=",
                            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/matrix-org",
                            "html_url": "https://github.com/matrix-org",
                            "followers_url": "https://api.github.com/users/matrix-org/followers",
                            "following_url": "https://api.github.com/users/matrix-org/following{/other_user}",
                            "gists_url": "https://api.github.com/users/matrix-org/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/matrix-org/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/matrix-org/subscriptions",
                            "organizations_url": "https://api.github.com/users/matrix-org/orgs",
                            "repos_url": "https://api.github.com/users/matrix-org/repos",
                            "events_url": "https://api.github.com/users/matrix-org/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/matrix-org/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/matrix-org/synapse",
                        "description": "Synapse: Matrix homeserver written in Python/Twisted.",
                        "fork": false,
                        "url": "https://api.github.com/repos/matrix-org/synapse",
                        "forks_url": "https://api.github.com/repos/matrix-org/synapse/forks",
                        "keys_url": "https://api.github.com/repos/matrix-org/synapse/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/matrix-org/synapse/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/matrix-org/synapse/teams",
                        "hooks_url": "https://api.github.com/repos/matrix-org/synapse/hooks",
                        "issue_events_url": "https://api.github.com/repos/matrix-org/synapse/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/matrix-org/synapse/events",
                        "assignees_url": "https://api.github.com/repos/matrix-org/synapse/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/matrix-org/synapse/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/matrix-org/synapse/tags",
                        "blobs_url": "https://api.github.com/repos/matrix-org/synapse/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/matrix-org/synapse/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/matrix-org/synapse/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/matrix-org/synapse/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/matrix-org/synapse/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/matrix-org/synapse/languages",
                        "stargazers_url": "https://api.github.com/repos/matrix-org/synapse/stargazers",
                        "contributors_url": "https://api.github.com/repos/matrix-org/synapse/contributors",
                        "subscribers_url": "https://api.github.com/repos/matrix-org/synapse/subscribers",
                        "subscription_url": "https://api.github.com/repos/matrix-org/synapse/subscription",
                        "commits_url": "https://api.github.com/repos/matrix-org/synapse/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/matrix-org/synapse/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/matrix-org/synapse/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/matrix-org/synapse/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/matrix-org/synapse/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/matrix-org/synapse/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/matrix-org/synapse/merges",
                        "archive_url": "https://api.github.com/repos/matrix-org/synapse/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/matrix-org/synapse/downloads",
                        "issues_url": "https://api.github.com/repos/matrix-org/synapse/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/matrix-org/synapse/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/matrix-org/synapse/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/matrix-org/synapse/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/matrix-org/synapse/labels{/name}",
                        "releases_url": "https://api.github.com/repos/matrix-org/synapse/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/matrix-org/synapse/deployments",
                        "created_at": "2014-08-11T15:51:42Z",
                        "updated_at": "2023-10-26T12:47:53Z",
                        "pushed_at": "2023-10-26T19:12:33Z",
                        "git_url": "git://github.com/matrix-org/synapse.git",
                        "ssh_url": "git@github.com:matrix-org/synapse.git",
                        "clone_url": "https://github.com/matrix-org/synapse.git",
                        "svn_url": "https://github.com/matrix-org/synapse",
                        "homepage": "https://matrix-org.github.io/synapse",
                        "size": 400535,
                        "stargazers_count": 11516,
                        "watchers_count": 11516,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": false,
                        "forks_count": 2163,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 1517,
                        "license": {
                            "key": "apache-2.0",
                            "name": "Apache License 2.0",
                            "spdx_id": "Apache-2.0",
                            "url": "https://api.github.com/licenses/apache-2.0",
                            "node_id": "MDc6TGljZW5zZTI="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "matrix-org",
                            "python"
                        ],
                        "visibility": "public",
                        "forks": 2163,
                        "open_issues": 1517,
                        "watchers": 11516,
                        "default_branch": "develop"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558"
                    },
                    "html": {
                        "href": "https://github.com/matrix-org/synapse/pull/16558"
                    },
                    "issue": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16558"
                    },
                    "comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/issues/16558/comments"
                    },
                    "review_comments": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/comments"
                    },
                    "review_comment": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/comments{/number}"
                    },
                    "commits": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/pulls/16558/commits"
                    },
                    "statuses": {
                        "href": "https://api.github.com/repos/matrix-org/synapse/statuses/eb5a0f6ca600ecf83f139e562ed5b8760524be83"
                    }
                },
                "author_association": "MEMBER",
                "auto_merge": null,
                "active_lock_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-26T20:04:20Z",
        "org": {
            "id": 8418310,
            "login": "matrix-org",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/matrix-org",
            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?"
        }
    },
    {
        "id": "32879404914",
        "type": "PushEvent",
        "actor": {
            "id": 41898282,
            "login": "github-actions[bot]",
            "display_login": "github-actions",
            "gravatar_id": "",
            "url": "https://api.github.com/users/github-actions[bot]",
            "avatar_url": "https://avatars.githubusercontent.com/u/41898282?"
        },
        "repo": {
            "id": 22844864,
            "name": "matrix-org/synapse",
            "url": "https://api.github.com/repos/matrix-org/synapse"
        },
        "payload": {
            "repository_id": 22844864,
            "push_id": 15581943467,
            "size": 1,
            "distinct_size": 1,
            "ref": "refs/heads/gh-pages",
            "head": "24dac01b54ab68e2240fdb5b7de5abda30fcfabb",
            "before": "a71cf8000279540abe77a0b408759b1509719ca7",
            "commits": [
                {
                    "sha": "24dac01b54ab68e2240fdb5b7de5abda30fcfabb",
                    "author": {
                        "email": "clokep@users.noreply.github.com",
                        "name": "clokep"
                    },
                    "message": "deploy: 85e5f2dc252b866d67c8da2ddbfdb84974db1807",
                    "distinct": true,
                    "url": "https://api.github.com/repos/matrix-org/synapse/commits/24dac01b54ab68e2240fdb5b7de5abda30fcfabb"
                }
            ]
        },
        "public": true,
        "created_at": "2023-10-26T19:12:34Z",
        "org": {
            "id": 8418310,
            "login": "matrix-org",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/matrix-org",
            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?"
        }
    },
    {
        "id": "32879403886",
        "type": "DeleteEvent",
        "actor": {
            "id": 517124,
            "login": "clokep",
            "display_login": "clokep",
            "gravatar_id": "",
            "url": "https://api.github.com/users/clokep",
            "avatar_url": "https://avatars.githubusercontent.com/u/517124?"
        },
        "repo": {
            "id": 22844864,
            "name": "matrix-org/synapse",
            "url": "https://api.github.com/repos/matrix-org/synapse"
        },
        "payload": {
            "ref": "clokep/axe-cursor-to-dict-6",
            "ref_type": "branch",
            "pusher_type": "user"
        },
        "public": true,
        "created_at": "2023-10-26T19:12:31Z",
        "org": {
            "id": 8418310,
            "login": "matrix-org",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/matrix-org",
            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?"
        }
    },
    {
        "id": "32879403566",
        "type": "PushEvent",
        "actor": {
            "id": 517124,
            "login": "clokep",
            "display_login": "clokep",
            "gravatar_id": "",
            "url": "https://api.github.com/users/clokep",
            "avatar_url": "https://avatars.githubusercontent.com/u/517124?"
        },
        "repo": {
            "id": 22844864,
            "name": "matrix-org/synapse",
            "url": "https://api.github.com/repos/matrix-org/synapse"
        },
        "payload": {
            "repository_id": 22844864,
            "push_id": 15581942808,
            "size": 1,
            "distinct_size": 1,
            "ref": "refs/heads/develop",
            "head": "679c691f6f7c4f7901e6d075a645a8ade20f44d5",
            "before": "85e5f2dc252b866d67c8da2ddbfdb84974db1807",
            "commits": [
                {
                    "sha": "679c691f6f7c4f7901e6d075a645a8ade20f44d5",
                    "author": {
                        "email": "clokep@users.noreply.github.com",
                        "name": "Patrick Cloke"
                    },
                    "message": "Remove more usages of cursor_to_dict. (#16551)\n\nMostly to improve type safety.",
                    "distinct": true,
                    "url": "https://api.github.com/repos/matrix-org/synapse/commits/679c691f6f7c4f7901e6d075a645a8ade20f44d5"
                }
            ]
        },
        "public": true,
        "created_at": "2023-10-26T19:12:31Z",
        "org": {
            "id": 8418310,
            "login": "matrix-org",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/matrix-org",
            "avatar_url": "https://avatars.githubusercontent.com/u/8418310?"
        }
    }
]