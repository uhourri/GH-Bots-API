[
    {
        "id": "32891162384",
        "type": "IssuesEvent",
        "actor": {
            "id": 51957443,
            "login": "rdjouder",
            "display_login": "rdjouder",
            "gravatar_id": "",
            "url": "https://api.github.com/users/rdjouder",
            "avatar_url": "https://avatars.githubusercontent.com/u/51957443?"
        },
        "repo": {
            "id": 735498,
            "name": "celery/kombu",
            "url": "https://api.github.com/repos/celery/kombu"
        },
        "payload": {
            "action": "opened",
            "issue": {
                "url": "https://api.github.com/repos/celery/kombu/issues/1815",
                "repository_url": "https://api.github.com/repos/celery/kombu",
                "labels_url": "https://api.github.com/repos/celery/kombu/issues/1815/labels{/name}",
                "comments_url": "https://api.github.com/repos/celery/kombu/issues/1815/comments",
                "events_url": "https://api.github.com/repos/celery/kombu/issues/1815/events",
                "html_url": "https://github.com/celery/kombu/issues/1815",
                "id": 1964941424,
                "node_id": "I_kwDOAAs5Cs51HqBw",
                "number": 1815,
                "title": "import exception raised in transport/redis  \"module 'redis' has no attribute 'client' \"",
                "user": {
                    "login": "rdjouder",
                    "id": 51957443,
                    "node_id": "MDQ6VXNlcjUxOTU3NDQz",
                    "avatar_url": "https://avatars.githubusercontent.com/u/51957443?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/rdjouder",
                    "html_url": "https://github.com/rdjouder",
                    "followers_url": "https://api.github.com/users/rdjouder/followers",
                    "following_url": "https://api.github.com/users/rdjouder/following{/other_user}",
                    "gists_url": "https://api.github.com/users/rdjouder/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/rdjouder/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/rdjouder/subscriptions",
                    "organizations_url": "https://api.github.com/users/rdjouder/orgs",
                    "repos_url": "https://api.github.com/users/rdjouder/repos",
                    "events_url": "https://api.github.com/users/rdjouder/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/rdjouder/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "labels": [],
                "state": "open",
                "locked": false,
                "assignee": null,
                "assignees": [],
                "milestone": null,
                "comments": 0,
                "created_at": "2023-10-27T07:34:37Z",
                "updated_at": "2023-10-27T07:34:37Z",
                "closed_at": null,
                "author_association": "NONE",
                "active_lock_reason": null,
                "body": "Hi,\r\nDebugging dynamic imports is really beyond my skills. Although the issue occurs in Airflow pipeline execution, from the stack trace it looks like the kombu utils import is having troubles. I also made sure the redis client is properly installed.\r\n\r\nPython 3.8.6\r\n\r\nName: kombu \r\nVersion: 5.3.2 \r\n\r\nName: apache-airflow \r\nVersion: 2.7.2 \r\n\r\nName: redis \r\nVersion: 4.6.0 \r\n\r\nTraceback (most recent call last):\r\n  File \"/home/airflow/.local/lib/python3.8/site-packages/airflow/providers/celery/executors/celery_executor_utils.py\", line 199, in send_task_to_executor\r\n    result = task_to_run.apply_async(args=[command], queue=queue)\r\n  File \"/home/airflow/.local/lib/python3.8/site-packages/celery/app/task.py\", line 594, in apply_async\r\n    return app.send_task(\r\n  File \"/home/airflow/.local/lib/python3.8/site-packages/celery/app/base.py\", line 794, in send_task\r\n    with self.producer_or_acquire(producer) as P:\r\n  File \"/home/airflow/.local/lib/python3.8/site-packages/celery/app/base.py\", line 929, in producer_or_acquire\r\n    producer, self.producer_pool.acquire, block=True,\r\n  File \"/home/airflow/.local/lib/python3.8/site-packages/celery/app/base.py\", line 1344, in producer_pool\r\n    return self.amqp.producer_pool\r\n  File \"/home/airflow/.local/lib/python3.8/site-packages/celery/app/amqp.py\", line 590, in producer_pool\r\n    self.app.connection_for_write()]\r\n  File \"/home/airflow/.local/lib/python3.8/site-packages/celery/app/base.py\", line 826, in connection_for_write\r\n    return self._connection(url or self.conf.broker_write_url, **kwargs)\r\n  File \"/home/airflow/.local/lib/python3.8/site-packages/celery/app/base.py\", line 877, in _connection\r\n    return self.amqp.Connection(\r\n  File \"/home/airflow/.local/lib/python3.8/site-packages/kombu/connection.py\", line 201, in __init__\r\n    if not get_transport_cls(transport).can_parse_url:\r\n  File \"/home/airflow/.local/lib/python3.8/site-packages/kombu/transport/__init__.py\", line 90, in get_transport_cls\r\n    _transport_cache[transport] = resolve_transport(transport)\r\n  File \"/home/airflow/.local/lib/python3.8/site-packages/kombu/transport/__init__.py\", line 75, in resolve_transport\r\n    return symbol_by_name(transport)\r\n  File \"/home/airflow/.local/lib/python3.8/site-packages/kombu/utils/imports.py\", line 59, in symbol_by_name\r\n    module = imp(module_name, package=package, **kwargs)\r\n  File \"/usr/local/lib/python3.8/importlib/__init__.py\", line 127, in import_module\r\n    return _bootstrap._gcd_import(name[level:], package, level)\r\n  File \"<frozen importlib._bootstrap>\", line 1014, in _gcd_import\r\n  File \"<frozen importlib._bootstrap>\", line 991, in _find_and_load\r\n  File \"<frozen importlib._bootstrap>\", line 975, in _find_and_load_unlocked\r\n  File \"<frozen importlib._bootstrap>\", line 671, in _load_unlocked\r\n  File \"<frozen importlib._bootstrap_external>\", line 783, in exec_module\r\n  File \"<frozen importlib._bootstrap>\", line 219, in _call_with_frames_removed\r\n  File \"/home/airflow/.local/lib/python3.8/site-packages/kombu/transport/redis.py\", line 281, in <module>\r\n    class PrefixedRedisPipeline(GlobalKeyPrefixMixin, redis.client.Pipeline):\r\nAttributeError: module 'redis' has no attribute 'client'\r\n\r\n[airflow@xxxxx-scheduler-1 airflow]$ ls /home/airflow/.local/lib/python3.8/site-packages/redis \r\n__init__.py __pycache__ asyncio backoff.py client.py cluster.py commands compat.py connection.py crc.py credentials.py exceptions.py lock.py ocsp.py retry.py sentinel.py typing.py utils.py \r\n[airflow@xxxx-scheduler-1 airflow]$ vi /home/airflow/.local/lib/python3.8/site-packages/kombu/transport/redis.py \r\n\r\n\r\n\r\n",
                "reactions": {
                    "url": "https://api.github.com/repos/celery/kombu/issues/1815/reactions",
                    "total_count": 0,
                    "+1": 0,
                    "-1": 0,
                    "laugh": 0,
                    "hooray": 0,
                    "confused": 0,
                    "heart": 0,
                    "rocket": 0,
                    "eyes": 0
                },
                "timeline_url": "https://api.github.com/repos/celery/kombu/issues/1815/timeline",
                "performed_via_github_app": null,
                "state_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-27T07:34:38Z",
        "org": {
            "id": 319983,
            "login": "celery",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/celery",
            "avatar_url": "https://avatars.githubusercontent.com/u/319983?"
        }
    },
    {
        "id": "32846560768",
        "type": "WatchEvent",
        "actor": {
            "id": 31446439,
            "login": "yan0f",
            "display_login": "yan0f",
            "gravatar_id": "",
            "url": "https://api.github.com/users/yan0f",
            "avatar_url": "https://avatars.githubusercontent.com/u/31446439?"
        },
        "repo": {
            "id": 735498,
            "name": "celery/kombu",
            "url": "https://api.github.com/repos/celery/kombu"
        },
        "payload": {
            "action": "started"
        },
        "public": true,
        "created_at": "2023-10-25T19:03:17Z",
        "org": {
            "id": 319983,
            "login": "celery",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/celery",
            "avatar_url": "https://avatars.githubusercontent.com/u/319983?"
        }
    },
    {
        "id": "32820120879",
        "type": "WatchEvent",
        "actor": {
            "id": 1922026,
            "login": "Leon0824",
            "display_login": "Leon0824",
            "gravatar_id": "",
            "url": "https://api.github.com/users/Leon0824",
            "avatar_url": "https://avatars.githubusercontent.com/u/1922026?"
        },
        "repo": {
            "id": 735498,
            "name": "celery/kombu",
            "url": "https://api.github.com/repos/celery/kombu"
        },
        "payload": {
            "action": "started"
        },
        "public": true,
        "created_at": "2023-10-25T01:03:17Z",
        "org": {
            "id": 319983,
            "login": "celery",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/celery",
            "avatar_url": "https://avatars.githubusercontent.com/u/319983?"
        }
    },
    {
        "id": "32815605322",
        "type": "PullRequestReviewCommentEvent",
        "actor": {
            "id": 65743084,
            "login": "o-nikolas",
            "display_login": "o-nikolas",
            "gravatar_id": "",
            "url": "https://api.github.com/users/o-nikolas",
            "avatar_url": "https://avatars.githubusercontent.com/u/65743084?"
        },
        "repo": {
            "id": 735498,
            "name": "celery/kombu",
            "url": "https://api.github.com/repos/celery/kombu"
        },
        "payload": {
            "action": "created",
            "comment": {
                "url": "https://api.github.com/repos/celery/kombu/pulls/comments/1370774321",
                "pull_request_review_id": 1695820185,
                "id": 1370774321,
                "node_id": "PRRC_kwDOAAs5Cs5RtFsx",
                "diff_hunk": "@@ -25,6 +29,76 @@ def __init__(self, sqs_connection, debug=0, region=None, **kwargs):\n             **kwargs\n         )\n \n+    def _create_query_request(self, operation, params, queue_url, method):\n+        params = params.copy()\n+        if operation:\n+            params['Action'] = operation\n+\n+        # defaults for non-get\n+        param_payload = {'data': params}\n+        if method.lower() == 'get':\n+            # query-based opts\n+            param_payload = {'params': params}\n+\n+        return AWSRequest(method=method, url=queue_url, **param_payload)\n+\n+    def _create_json_request(self, operation, params, queue_url):\n+        params = params.copy()\n+        params['QueueUrl'] = queue_url\n+\n+        service_model = self.sqs_connection.meta.service_model\n+        operation_model = service_model.operation_model(operation)\n+\n+        url = self.sqs_connection._endpoint.host\n+\n+        headers = {}\n+        # Content-Type\n+        json_version = operation_model.metadata['jsonVersion']\n+        content_type = f'application/x-amz-json-{json_version}'\n+        headers['Content-Type'] = content_type\n+\n+        # X-Amz-Target\n+        target = '{}.{}'.format(\n+            operation_model.metadata['targetPrefix'],\n+            operation_model.name,\n+        )\n+        headers['X-Amz-Target'] = target",
                "path": "kombu/asynchronous/aws/sqs/connection.py",
                "commit_id": "267028503beb03fa549ebd56d829ca7fb0c564c0",
                "original_commit_id": "9e903aa9116fa345a68897f67979a4f8a367a71c",
                "user": {
                    "login": "o-nikolas",
                    "id": 65743084,
                    "node_id": "MDQ6VXNlcjY1NzQzMDg0",
                    "avatar_url": "https://avatars.githubusercontent.com/u/65743084?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/o-nikolas",
                    "html_url": "https://github.com/o-nikolas",
                    "followers_url": "https://api.github.com/users/o-nikolas/followers",
                    "following_url": "https://api.github.com/users/o-nikolas/following{/other_user}",
                    "gists_url": "https://api.github.com/users/o-nikolas/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/o-nikolas/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/o-nikolas/subscriptions",
                    "organizations_url": "https://api.github.com/users/o-nikolas/orgs",
                    "repos_url": "https://api.github.com/users/o-nikolas/repos",
                    "events_url": "https://api.github.com/users/o-nikolas/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/o-nikolas/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "I'll find the docs, I think they were in a slack thread that I will share with you.",
                "created_at": "2023-10-24T20:25:34Z",
                "updated_at": "2023-10-24T20:25:34Z",
                "html_url": "https://github.com/celery/kombu/pull/1807#discussion_r1370774321",
                "pull_request_url": "https://api.github.com/repos/celery/kombu/pulls/1807",
                "author_association": "NONE",
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/comments/1370774321"
                    },
                    "html": {
                        "href": "https://github.com/celery/kombu/pull/1807#discussion_r1370774321"
                    },
                    "pull_request": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807"
                    }
                },
                "reactions": {
                    "url": "https://api.github.com/repos/celery/kombu/pulls/comments/1370774321/reactions",
                    "total_count": 0,
                    "+1": 0,
                    "-1": 0,
                    "laugh": 0,
                    "hooray": 0,
                    "confused": 0,
                    "heart": 0,
                    "rocket": 0,
                    "eyes": 0
                },
                "start_line": null,
                "original_start_line": null,
                "start_side": null,
                "line": 65,
                "original_line": 66,
                "side": "RIGHT",
                "in_reply_to_id": 1365948322,
                "original_position": 51,
                "position": 51,
                "subject_type": "line"
            },
            "pull_request": {
                "url": "https://api.github.com/repos/celery/kombu/pulls/1807",
                "id": 1548262937,
                "node_id": "PR_kwDOAAs5Cs5cSJ4Z",
                "html_url": "https://github.com/celery/kombu/pull/1807",
                "diff_url": "https://github.com/celery/kombu/pull/1807.diff",
                "patch_url": "https://github.com/celery/kombu/pull/1807.patch",
                "issue_url": "https://api.github.com/repos/celery/kombu/issues/1807",
                "number": 1807,
                "state": "open",
                "locked": false,
                "title": "Use the correct protocol for SQS requests",
                "user": {
                    "login": "rafidka",
                    "id": 442447,
                    "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/rafidka",
                    "html_url": "https://github.com/rafidka",
                    "followers_url": "https://api.github.com/users/rafidka/followers",
                    "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                    "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                    "organizations_url": "https://api.github.com/users/rafidka/orgs",
                    "repos_url": "https://api.github.com/users/rafidka/repos",
                    "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/rafidka/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "TL;DR - The use of boto3 in #1759 resulted in relying on blocking (synchronous) HTTP requests, which caused the performance issue reported in #1783.\r\n\r\n`kombu` previously used to craft AWS requests manually as explained in detail in #1726, which resulted in an outage when botocore temporarily changed the default protocol to JSON (before rolling back due to the impact on celery and airflow.) To fix the issue, I submitted #1759, which changes `kombu` to use `boto3` instead of manually crafting AWS requests. This way when boto3 changes the default protocol, kombu won't be impacted.\r\n\r\nWhile working on #1759, I did extensive debugging to understand the multi-threading nature of kombu. What I discovered is that there isn't an actual multi-threading in the true sense of the word, but an event loop that runs on the same thread and process and orchestrate the communication with SQS. As such, it didn't appear to me that there is anything to worry about my change, and the testing I did didn't discover any issue. However, it turns out that while kombu's event loop doesn't have actual multi-threading, its [reliance on pycurl](https://github.com/celery/kombu/blob/main/kombu/asynchronous/http/curl.py#L48) (and thus libcurl) meant that the requests to AWS were being done asynchronously. On the other hand, boto3 requests are always done synchronously, i.e. they are blocking requests.\r\n\r\nThe above meant that my change introduced blocking on the event loop of kombu. This is fine in most of the cases, since the requests to SQS are pretty fast. However, in the case of using long-polling, a call to SQS's ReceiveMessage can last up to 20 seconds (depending on the user configuration).\r\n\r\nTo solve this problem, I rolled back my earlier changes and, instead, to address the issue reported in #1726, I now changed the `AsyncSQSConnection` class such that it crafts either a `query` or a `json` request depending on the protocol used by the SQS client. Thus, when botocore changes the default protocol of SQS to JSON, kombu won't be impacted, since it crafts its own request and, after my change, it uses a hard-coded protocol based on the crafted requests.\r\n\r\nThis solution shouldn't be the final solution, and it is more of a workaround that does the job for now. The final solution should be to completely rely on boto3 for any communication with AWS, and ensuring that all requests are async in nature (non-blocking.) This, however, is a fundamental change that requires a lot of testing, in particular performance testing.\r\n",
                "created_at": "2023-10-09T17:36:06Z",
                "updated_at": "2023-10-24T20:25:34Z",
                "closed_at": null,
                "merged_at": null,
                "merge_commit_sha": "df494cfcd2ede713124133e2c426f21772dda204",
                "assignee": null,
                "assignees": [],
                "requested_reviewers": [],
                "requested_teams": [],
                "labels": [],
                "milestone": null,
                "draft": false,
                "commits_url": "https://api.github.com/repos/celery/kombu/pulls/1807/commits",
                "review_comments_url": "https://api.github.com/repos/celery/kombu/pulls/1807/comments",
                "review_comment_url": "https://api.github.com/repos/celery/kombu/pulls/comments{/number}",
                "comments_url": "https://api.github.com/repos/celery/kombu/issues/1807/comments",
                "statuses_url": "https://api.github.com/repos/celery/kombu/statuses/267028503beb03fa549ebd56d829ca7fb0c564c0",
                "head": {
                    "label": "rafidka:fix-1783",
                    "ref": "fix-1783",
                    "sha": "267028503beb03fa549ebd56d829ca7fb0c564c0",
                    "user": {
                        "login": "rafidka",
                        "id": 442447,
                        "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                        "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/rafidka",
                        "html_url": "https://github.com/rafidka",
                        "followers_url": "https://api.github.com/users/rafidka/followers",
                        "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                        "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                        "organizations_url": "https://api.github.com/users/rafidka/orgs",
                        "repos_url": "https://api.github.com/users/rafidka/repos",
                        "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/rafidka/received_events",
                        "type": "User",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 655909423,
                        "node_id": "R_kgDOJxhiLw",
                        "name": "kombu",
                        "full_name": "rafidka/kombu",
                        "private": false,
                        "owner": {
                            "login": "rafidka",
                            "id": 442447,
                            "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                            "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/rafidka",
                            "html_url": "https://github.com/rafidka",
                            "followers_url": "https://api.github.com/users/rafidka/followers",
                            "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                            "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                            "organizations_url": "https://api.github.com/users/rafidka/orgs",
                            "repos_url": "https://api.github.com/users/rafidka/repos",
                            "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/rafidka/received_events",
                            "type": "User",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/rafidka/kombu",
                        "description": "Messaging library for Python.",
                        "fork": true,
                        "url": "https://api.github.com/repos/rafidka/kombu",
                        "forks_url": "https://api.github.com/repos/rafidka/kombu/forks",
                        "keys_url": "https://api.github.com/repos/rafidka/kombu/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/rafidka/kombu/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/rafidka/kombu/teams",
                        "hooks_url": "https://api.github.com/repos/rafidka/kombu/hooks",
                        "issue_events_url": "https://api.github.com/repos/rafidka/kombu/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/rafidka/kombu/events",
                        "assignees_url": "https://api.github.com/repos/rafidka/kombu/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/rafidka/kombu/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/rafidka/kombu/tags",
                        "blobs_url": "https://api.github.com/repos/rafidka/kombu/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/rafidka/kombu/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/rafidka/kombu/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/rafidka/kombu/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/rafidka/kombu/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/rafidka/kombu/languages",
                        "stargazers_url": "https://api.github.com/repos/rafidka/kombu/stargazers",
                        "contributors_url": "https://api.github.com/repos/rafidka/kombu/contributors",
                        "subscribers_url": "https://api.github.com/repos/rafidka/kombu/subscribers",
                        "subscription_url": "https://api.github.com/repos/rafidka/kombu/subscription",
                        "commits_url": "https://api.github.com/repos/rafidka/kombu/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/rafidka/kombu/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/rafidka/kombu/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/rafidka/kombu/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/rafidka/kombu/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/rafidka/kombu/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/rafidka/kombu/merges",
                        "archive_url": "https://api.github.com/repos/rafidka/kombu/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/rafidka/kombu/downloads",
                        "issues_url": "https://api.github.com/repos/rafidka/kombu/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/rafidka/kombu/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/rafidka/kombu/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/rafidka/kombu/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/rafidka/kombu/labels{/name}",
                        "releases_url": "https://api.github.com/repos/rafidka/kombu/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/rafidka/kombu/deployments",
                        "created_at": "2023-06-19T21:48:27Z",
                        "updated_at": "2023-10-06T01:42:46Z",
                        "pushed_at": "2023-10-23T09:46:24Z",
                        "git_url": "git://github.com/rafidka/kombu.git",
                        "ssh_url": "git@github.com:rafidka/kombu.git",
                        "clone_url": "https://github.com/rafidka/kombu.git",
                        "svn_url": "https://github.com/rafidka/kombu",
                        "homepage": "http://kombu.readthedocs.org/",
                        "size": 6593,
                        "stargazers_count": 0,
                        "watchers_count": 0,
                        "language": "Python",
                        "has_issues": false,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": false,
                        "has_discussions": false,
                        "forks_count": 0,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 0,
                        "license": {
                            "key": "bsd-3-clause",
                            "name": "BSD 3-Clause \"New\" or \"Revised\" License",
                            "spdx_id": "BSD-3-Clause",
                            "url": "https://api.github.com/licenses/bsd-3-clause",
                            "node_id": "MDc6TGljZW5zZTU="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [],
                        "visibility": "public",
                        "forks": 0,
                        "open_issues": 0,
                        "watchers": 0,
                        "default_branch": "main"
                    }
                },
                "base": {
                    "label": "celery:main",
                    "ref": "main",
                    "sha": "7187021ecc9f65601c50754d0fc6ec6c5264eea1",
                    "user": {
                        "login": "celery",
                        "id": 319983,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjMxOTk4Mw==",
                        "avatar_url": "https://avatars.githubusercontent.com/u/319983?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/celery",
                        "html_url": "https://github.com/celery",
                        "followers_url": "https://api.github.com/users/celery/followers",
                        "following_url": "https://api.github.com/users/celery/following{/other_user}",
                        "gists_url": "https://api.github.com/users/celery/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/celery/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/celery/subscriptions",
                        "organizations_url": "https://api.github.com/users/celery/orgs",
                        "repos_url": "https://api.github.com/users/celery/repos",
                        "events_url": "https://api.github.com/users/celery/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/celery/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 735498,
                        "node_id": "MDEwOlJlcG9zaXRvcnk3MzU0OTg=",
                        "name": "kombu",
                        "full_name": "celery/kombu",
                        "private": false,
                        "owner": {
                            "login": "celery",
                            "id": 319983,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjMxOTk4Mw==",
                            "avatar_url": "https://avatars.githubusercontent.com/u/319983?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/celery",
                            "html_url": "https://github.com/celery",
                            "followers_url": "https://api.github.com/users/celery/followers",
                            "following_url": "https://api.github.com/users/celery/following{/other_user}",
                            "gists_url": "https://api.github.com/users/celery/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/celery/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/celery/subscriptions",
                            "organizations_url": "https://api.github.com/users/celery/orgs",
                            "repos_url": "https://api.github.com/users/celery/repos",
                            "events_url": "https://api.github.com/users/celery/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/celery/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/celery/kombu",
                        "description": "Messaging library for Python.",
                        "fork": false,
                        "url": "https://api.github.com/repos/celery/kombu",
                        "forks_url": "https://api.github.com/repos/celery/kombu/forks",
                        "keys_url": "https://api.github.com/repos/celery/kombu/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/celery/kombu/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/celery/kombu/teams",
                        "hooks_url": "https://api.github.com/repos/celery/kombu/hooks",
                        "issue_events_url": "https://api.github.com/repos/celery/kombu/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/celery/kombu/events",
                        "assignees_url": "https://api.github.com/repos/celery/kombu/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/celery/kombu/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/celery/kombu/tags",
                        "blobs_url": "https://api.github.com/repos/celery/kombu/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/celery/kombu/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/celery/kombu/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/celery/kombu/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/celery/kombu/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/celery/kombu/languages",
                        "stargazers_url": "https://api.github.com/repos/celery/kombu/stargazers",
                        "contributors_url": "https://api.github.com/repos/celery/kombu/contributors",
                        "subscribers_url": "https://api.github.com/repos/celery/kombu/subscribers",
                        "subscription_url": "https://api.github.com/repos/celery/kombu/subscription",
                        "commits_url": "https://api.github.com/repos/celery/kombu/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/celery/kombu/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/celery/kombu/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/celery/kombu/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/celery/kombu/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/celery/kombu/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/celery/kombu/merges",
                        "archive_url": "https://api.github.com/repos/celery/kombu/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/celery/kombu/downloads",
                        "issues_url": "https://api.github.com/repos/celery/kombu/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/celery/kombu/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/celery/kombu/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/celery/kombu/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/celery/kombu/labels{/name}",
                        "releases_url": "https://api.github.com/repos/celery/kombu/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/celery/kombu/deployments",
                        "created_at": "2010-06-23T10:10:24Z",
                        "updated_at": "2023-10-23T11:02:03Z",
                        "pushed_at": "2023-10-23T09:46:26Z",
                        "git_url": "git://github.com/celery/kombu.git",
                        "ssh_url": "git@github.com:celery/kombu.git",
                        "clone_url": "https://github.com/celery/kombu.git",
                        "svn_url": "https://github.com/celery/kombu",
                        "homepage": "http://kombu.readthedocs.org/",
                        "size": 8758,
                        "stargazers_count": 2628,
                        "watchers_count": 2628,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": true,
                        "forks_count": 934,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 192,
                        "license": {
                            "key": "bsd-3-clause",
                            "name": "BSD 3-Clause \"New\" or \"Revised\" License",
                            "spdx_id": "BSD-3-Clause",
                            "url": "https://api.github.com/licenses/bsd-3-clause",
                            "node_id": "MDc6TGljZW5zZTU="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "celery",
                            "kombu",
                            "message-queue",
                            "messaging",
                            "python",
                            "python-3",
                            "python-library",
                            "python3",
                            "rabbitmq",
                            "redis",
                            "sqs"
                        ],
                        "visibility": "public",
                        "forks": 934,
                        "open_issues": 192,
                        "watchers": 2628,
                        "default_branch": "main"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807"
                    },
                    "html": {
                        "href": "https://github.com/celery/kombu/pull/1807"
                    },
                    "issue": {
                        "href": "https://api.github.com/repos/celery/kombu/issues/1807"
                    },
                    "comments": {
                        "href": "https://api.github.com/repos/celery/kombu/issues/1807/comments"
                    },
                    "review_comments": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807/comments"
                    },
                    "review_comment": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/comments{/number}"
                    },
                    "commits": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807/commits"
                    },
                    "statuses": {
                        "href": "https://api.github.com/repos/celery/kombu/statuses/267028503beb03fa549ebd56d829ca7fb0c564c0"
                    }
                },
                "author_association": "CONTRIBUTOR",
                "auto_merge": null,
                "active_lock_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-24T20:25:34Z",
        "org": {
            "id": 319983,
            "login": "celery",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/celery",
            "avatar_url": "https://avatars.githubusercontent.com/u/319983?"
        }
    },
    {
        "id": "32815605230",
        "type": "PullRequestReviewEvent",
        "actor": {
            "id": 65743084,
            "login": "o-nikolas",
            "display_login": "o-nikolas",
            "gravatar_id": "",
            "url": "https://api.github.com/users/o-nikolas",
            "avatar_url": "https://avatars.githubusercontent.com/u/65743084?"
        },
        "repo": {
            "id": 735498,
            "name": "celery/kombu",
            "url": "https://api.github.com/repos/celery/kombu"
        },
        "payload": {
            "action": "created",
            "review": {
                "id": 1695820185,
                "node_id": "PRR_kwDOAAs5Cs5lFCmZ",
                "user": {
                    "login": "o-nikolas",
                    "id": 65743084,
                    "node_id": "MDQ6VXNlcjY1NzQzMDg0",
                    "avatar_url": "https://avatars.githubusercontent.com/u/65743084?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/o-nikolas",
                    "html_url": "https://github.com/o-nikolas",
                    "followers_url": "https://api.github.com/users/o-nikolas/followers",
                    "following_url": "https://api.github.com/users/o-nikolas/following{/other_user}",
                    "gists_url": "https://api.github.com/users/o-nikolas/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/o-nikolas/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/o-nikolas/subscriptions",
                    "organizations_url": "https://api.github.com/users/o-nikolas/orgs",
                    "repos_url": "https://api.github.com/users/o-nikolas/repos",
                    "events_url": "https://api.github.com/users/o-nikolas/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/o-nikolas/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": null,
                "commit_id": "9e903aa9116fa345a68897f67979a4f8a367a71c",
                "submitted_at": "2023-10-24T20:25:34Z",
                "state": "commented",
                "html_url": "https://github.com/celery/kombu/pull/1807#pullrequestreview-1695820185",
                "pull_request_url": "https://api.github.com/repos/celery/kombu/pulls/1807",
                "author_association": "NONE",
                "_links": {
                    "html": {
                        "href": "https://github.com/celery/kombu/pull/1807#pullrequestreview-1695820185"
                    },
                    "pull_request": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807"
                    }
                }
            },
            "pull_request": {
                "url": "https://api.github.com/repos/celery/kombu/pulls/1807",
                "id": 1548262937,
                "node_id": "PR_kwDOAAs5Cs5cSJ4Z",
                "html_url": "https://github.com/celery/kombu/pull/1807",
                "diff_url": "https://github.com/celery/kombu/pull/1807.diff",
                "patch_url": "https://github.com/celery/kombu/pull/1807.patch",
                "issue_url": "https://api.github.com/repos/celery/kombu/issues/1807",
                "number": 1807,
                "state": "open",
                "locked": false,
                "title": "Use the correct protocol for SQS requests",
                "user": {
                    "login": "rafidka",
                    "id": 442447,
                    "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/rafidka",
                    "html_url": "https://github.com/rafidka",
                    "followers_url": "https://api.github.com/users/rafidka/followers",
                    "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                    "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                    "organizations_url": "https://api.github.com/users/rafidka/orgs",
                    "repos_url": "https://api.github.com/users/rafidka/repos",
                    "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/rafidka/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "TL;DR - The use of boto3 in #1759 resulted in relying on blocking (synchronous) HTTP requests, which caused the performance issue reported in #1783.\r\n\r\n`kombu` previously used to craft AWS requests manually as explained in detail in #1726, which resulted in an outage when botocore temporarily changed the default protocol to JSON (before rolling back due to the impact on celery and airflow.) To fix the issue, I submitted #1759, which changes `kombu` to use `boto3` instead of manually crafting AWS requests. This way when boto3 changes the default protocol, kombu won't be impacted.\r\n\r\nWhile working on #1759, I did extensive debugging to understand the multi-threading nature of kombu. What I discovered is that there isn't an actual multi-threading in the true sense of the word, but an event loop that runs on the same thread and process and orchestrate the communication with SQS. As such, it didn't appear to me that there is anything to worry about my change, and the testing I did didn't discover any issue. However, it turns out that while kombu's event loop doesn't have actual multi-threading, its [reliance on pycurl](https://github.com/celery/kombu/blob/main/kombu/asynchronous/http/curl.py#L48) (and thus libcurl) meant that the requests to AWS were being done asynchronously. On the other hand, boto3 requests are always done synchronously, i.e. they are blocking requests.\r\n\r\nThe above meant that my change introduced blocking on the event loop of kombu. This is fine in most of the cases, since the requests to SQS are pretty fast. However, in the case of using long-polling, a call to SQS's ReceiveMessage can last up to 20 seconds (depending on the user configuration).\r\n\r\nTo solve this problem, I rolled back my earlier changes and, instead, to address the issue reported in #1726, I now changed the `AsyncSQSConnection` class such that it crafts either a `query` or a `json` request depending on the protocol used by the SQS client. Thus, when botocore changes the default protocol of SQS to JSON, kombu won't be impacted, since it crafts its own request and, after my change, it uses a hard-coded protocol based on the crafted requests.\r\n\r\nThis solution shouldn't be the final solution, and it is more of a workaround that does the job for now. The final solution should be to completely rely on boto3 for any communication with AWS, and ensuring that all requests are async in nature (non-blocking.) This, however, is a fundamental change that requires a lot of testing, in particular performance testing.\r\n",
                "created_at": "2023-10-09T17:36:06Z",
                "updated_at": "2023-10-24T20:25:34Z",
                "closed_at": null,
                "merged_at": null,
                "merge_commit_sha": "df494cfcd2ede713124133e2c426f21772dda204",
                "assignee": null,
                "assignees": [],
                "requested_reviewers": [],
                "requested_teams": [],
                "labels": [],
                "milestone": null,
                "draft": false,
                "commits_url": "https://api.github.com/repos/celery/kombu/pulls/1807/commits",
                "review_comments_url": "https://api.github.com/repos/celery/kombu/pulls/1807/comments",
                "review_comment_url": "https://api.github.com/repos/celery/kombu/pulls/comments{/number}",
                "comments_url": "https://api.github.com/repos/celery/kombu/issues/1807/comments",
                "statuses_url": "https://api.github.com/repos/celery/kombu/statuses/267028503beb03fa549ebd56d829ca7fb0c564c0",
                "head": {
                    "label": "rafidka:fix-1783",
                    "ref": "fix-1783",
                    "sha": "267028503beb03fa549ebd56d829ca7fb0c564c0",
                    "user": {
                        "login": "rafidka",
                        "id": 442447,
                        "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                        "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/rafidka",
                        "html_url": "https://github.com/rafidka",
                        "followers_url": "https://api.github.com/users/rafidka/followers",
                        "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                        "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                        "organizations_url": "https://api.github.com/users/rafidka/orgs",
                        "repos_url": "https://api.github.com/users/rafidka/repos",
                        "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/rafidka/received_events",
                        "type": "User",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 655909423,
                        "node_id": "R_kgDOJxhiLw",
                        "name": "kombu",
                        "full_name": "rafidka/kombu",
                        "private": false,
                        "owner": {
                            "login": "rafidka",
                            "id": 442447,
                            "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                            "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/rafidka",
                            "html_url": "https://github.com/rafidka",
                            "followers_url": "https://api.github.com/users/rafidka/followers",
                            "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                            "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                            "organizations_url": "https://api.github.com/users/rafidka/orgs",
                            "repos_url": "https://api.github.com/users/rafidka/repos",
                            "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/rafidka/received_events",
                            "type": "User",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/rafidka/kombu",
                        "description": "Messaging library for Python.",
                        "fork": true,
                        "url": "https://api.github.com/repos/rafidka/kombu",
                        "forks_url": "https://api.github.com/repos/rafidka/kombu/forks",
                        "keys_url": "https://api.github.com/repos/rafidka/kombu/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/rafidka/kombu/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/rafidka/kombu/teams",
                        "hooks_url": "https://api.github.com/repos/rafidka/kombu/hooks",
                        "issue_events_url": "https://api.github.com/repos/rafidka/kombu/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/rafidka/kombu/events",
                        "assignees_url": "https://api.github.com/repos/rafidka/kombu/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/rafidka/kombu/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/rafidka/kombu/tags",
                        "blobs_url": "https://api.github.com/repos/rafidka/kombu/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/rafidka/kombu/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/rafidka/kombu/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/rafidka/kombu/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/rafidka/kombu/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/rafidka/kombu/languages",
                        "stargazers_url": "https://api.github.com/repos/rafidka/kombu/stargazers",
                        "contributors_url": "https://api.github.com/repos/rafidka/kombu/contributors",
                        "subscribers_url": "https://api.github.com/repos/rafidka/kombu/subscribers",
                        "subscription_url": "https://api.github.com/repos/rafidka/kombu/subscription",
                        "commits_url": "https://api.github.com/repos/rafidka/kombu/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/rafidka/kombu/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/rafidka/kombu/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/rafidka/kombu/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/rafidka/kombu/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/rafidka/kombu/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/rafidka/kombu/merges",
                        "archive_url": "https://api.github.com/repos/rafidka/kombu/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/rafidka/kombu/downloads",
                        "issues_url": "https://api.github.com/repos/rafidka/kombu/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/rafidka/kombu/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/rafidka/kombu/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/rafidka/kombu/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/rafidka/kombu/labels{/name}",
                        "releases_url": "https://api.github.com/repos/rafidka/kombu/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/rafidka/kombu/deployments",
                        "created_at": "2023-06-19T21:48:27Z",
                        "updated_at": "2023-10-06T01:42:46Z",
                        "pushed_at": "2023-10-23T09:46:24Z",
                        "git_url": "git://github.com/rafidka/kombu.git",
                        "ssh_url": "git@github.com:rafidka/kombu.git",
                        "clone_url": "https://github.com/rafidka/kombu.git",
                        "svn_url": "https://github.com/rafidka/kombu",
                        "homepage": "http://kombu.readthedocs.org/",
                        "size": 6593,
                        "stargazers_count": 0,
                        "watchers_count": 0,
                        "language": "Python",
                        "has_issues": false,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": false,
                        "has_discussions": false,
                        "forks_count": 0,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 0,
                        "license": {
                            "key": "bsd-3-clause",
                            "name": "BSD 3-Clause \"New\" or \"Revised\" License",
                            "spdx_id": "BSD-3-Clause",
                            "url": "https://api.github.com/licenses/bsd-3-clause",
                            "node_id": "MDc6TGljZW5zZTU="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [],
                        "visibility": "public",
                        "forks": 0,
                        "open_issues": 0,
                        "watchers": 0,
                        "default_branch": "main"
                    }
                },
                "base": {
                    "label": "celery:main",
                    "ref": "main",
                    "sha": "7187021ecc9f65601c50754d0fc6ec6c5264eea1",
                    "user": {
                        "login": "celery",
                        "id": 319983,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjMxOTk4Mw==",
                        "avatar_url": "https://avatars.githubusercontent.com/u/319983?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/celery",
                        "html_url": "https://github.com/celery",
                        "followers_url": "https://api.github.com/users/celery/followers",
                        "following_url": "https://api.github.com/users/celery/following{/other_user}",
                        "gists_url": "https://api.github.com/users/celery/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/celery/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/celery/subscriptions",
                        "organizations_url": "https://api.github.com/users/celery/orgs",
                        "repos_url": "https://api.github.com/users/celery/repos",
                        "events_url": "https://api.github.com/users/celery/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/celery/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 735498,
                        "node_id": "MDEwOlJlcG9zaXRvcnk3MzU0OTg=",
                        "name": "kombu",
                        "full_name": "celery/kombu",
                        "private": false,
                        "owner": {
                            "login": "celery",
                            "id": 319983,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjMxOTk4Mw==",
                            "avatar_url": "https://avatars.githubusercontent.com/u/319983?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/celery",
                            "html_url": "https://github.com/celery",
                            "followers_url": "https://api.github.com/users/celery/followers",
                            "following_url": "https://api.github.com/users/celery/following{/other_user}",
                            "gists_url": "https://api.github.com/users/celery/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/celery/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/celery/subscriptions",
                            "organizations_url": "https://api.github.com/users/celery/orgs",
                            "repos_url": "https://api.github.com/users/celery/repos",
                            "events_url": "https://api.github.com/users/celery/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/celery/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/celery/kombu",
                        "description": "Messaging library for Python.",
                        "fork": false,
                        "url": "https://api.github.com/repos/celery/kombu",
                        "forks_url": "https://api.github.com/repos/celery/kombu/forks",
                        "keys_url": "https://api.github.com/repos/celery/kombu/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/celery/kombu/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/celery/kombu/teams",
                        "hooks_url": "https://api.github.com/repos/celery/kombu/hooks",
                        "issue_events_url": "https://api.github.com/repos/celery/kombu/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/celery/kombu/events",
                        "assignees_url": "https://api.github.com/repos/celery/kombu/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/celery/kombu/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/celery/kombu/tags",
                        "blobs_url": "https://api.github.com/repos/celery/kombu/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/celery/kombu/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/celery/kombu/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/celery/kombu/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/celery/kombu/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/celery/kombu/languages",
                        "stargazers_url": "https://api.github.com/repos/celery/kombu/stargazers",
                        "contributors_url": "https://api.github.com/repos/celery/kombu/contributors",
                        "subscribers_url": "https://api.github.com/repos/celery/kombu/subscribers",
                        "subscription_url": "https://api.github.com/repos/celery/kombu/subscription",
                        "commits_url": "https://api.github.com/repos/celery/kombu/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/celery/kombu/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/celery/kombu/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/celery/kombu/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/celery/kombu/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/celery/kombu/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/celery/kombu/merges",
                        "archive_url": "https://api.github.com/repos/celery/kombu/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/celery/kombu/downloads",
                        "issues_url": "https://api.github.com/repos/celery/kombu/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/celery/kombu/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/celery/kombu/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/celery/kombu/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/celery/kombu/labels{/name}",
                        "releases_url": "https://api.github.com/repos/celery/kombu/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/celery/kombu/deployments",
                        "created_at": "2010-06-23T10:10:24Z",
                        "updated_at": "2023-10-23T11:02:03Z",
                        "pushed_at": "2023-10-23T09:46:26Z",
                        "git_url": "git://github.com/celery/kombu.git",
                        "ssh_url": "git@github.com:celery/kombu.git",
                        "clone_url": "https://github.com/celery/kombu.git",
                        "svn_url": "https://github.com/celery/kombu",
                        "homepage": "http://kombu.readthedocs.org/",
                        "size": 8758,
                        "stargazers_count": 2628,
                        "watchers_count": 2628,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": true,
                        "forks_count": 934,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 192,
                        "license": {
                            "key": "bsd-3-clause",
                            "name": "BSD 3-Clause \"New\" or \"Revised\" License",
                            "spdx_id": "BSD-3-Clause",
                            "url": "https://api.github.com/licenses/bsd-3-clause",
                            "node_id": "MDc6TGljZW5zZTU="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "celery",
                            "kombu",
                            "message-queue",
                            "messaging",
                            "python",
                            "python-3",
                            "python-library",
                            "python3",
                            "rabbitmq",
                            "redis",
                            "sqs"
                        ],
                        "visibility": "public",
                        "forks": 934,
                        "open_issues": 192,
                        "watchers": 2628,
                        "default_branch": "main"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807"
                    },
                    "html": {
                        "href": "https://github.com/celery/kombu/pull/1807"
                    },
                    "issue": {
                        "href": "https://api.github.com/repos/celery/kombu/issues/1807"
                    },
                    "comments": {
                        "href": "https://api.github.com/repos/celery/kombu/issues/1807/comments"
                    },
                    "review_comments": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807/comments"
                    },
                    "review_comment": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/comments{/number}"
                    },
                    "commits": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807/commits"
                    },
                    "statuses": {
                        "href": "https://api.github.com/repos/celery/kombu/statuses/267028503beb03fa549ebd56d829ca7fb0c564c0"
                    }
                },
                "author_association": "CONTRIBUTOR",
                "auto_merge": null,
                "active_lock_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-24T20:25:35Z",
        "org": {
            "id": 319983,
            "login": "celery",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/celery",
            "avatar_url": "https://avatars.githubusercontent.com/u/319983?"
        }
    },
    {
        "id": "32806722914",
        "type": "IssuesEvent",
        "actor": {
            "id": 3996366,
            "login": "F1ashhimself",
            "display_login": "F1ashhimself",
            "gravatar_id": "",
            "url": "https://api.github.com/users/F1ashhimself",
            "avatar_url": "https://avatars.githubusercontent.com/u/3996366?"
        },
        "repo": {
            "id": 735498,
            "name": "celery/kombu",
            "url": "https://api.github.com/repos/celery/kombu"
        },
        "payload": {
            "action": "opened",
            "issue": {
                "url": "https://api.github.com/repos/celery/kombu/issues/1814",
                "repository_url": "https://api.github.com/repos/celery/kombu",
                "labels_url": "https://api.github.com/repos/celery/kombu/issues/1814/labels{/name}",
                "comments_url": "https://api.github.com/repos/celery/kombu/issues/1814/comments",
                "events_url": "https://api.github.com/repos/celery/kombu/issues/1814/events",
                "html_url": "https://github.com/celery/kombu/issues/1814",
                "id": 1959428742,
                "node_id": "I_kwDOAAs5Cs50yoKG",
                "number": 1814,
                "title": "Delivery info have no ApproximateReceiveCount",
                "user": {
                    "login": "F1ashhimself",
                    "id": 3996366,
                    "node_id": "MDQ6VXNlcjM5OTYzNjY=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/3996366?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/F1ashhimself",
                    "html_url": "https://github.com/F1ashhimself",
                    "followers_url": "https://api.github.com/users/F1ashhimself/followers",
                    "following_url": "https://api.github.com/users/F1ashhimself/following{/other_user}",
                    "gists_url": "https://api.github.com/users/F1ashhimself/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/F1ashhimself/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/F1ashhimself/subscriptions",
                    "organizations_url": "https://api.github.com/users/F1ashhimself/orgs",
                    "repos_url": "https://api.github.com/users/F1ashhimself/repos",
                    "events_url": "https://api.github.com/users/F1ashhimself/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/F1ashhimself/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "labels": [],
                "state": "open",
                "locked": false,
                "assignee": null,
                "assignees": [],
                "milestone": null,
                "comments": 0,
                "created_at": "2023-10-24T14:43:51Z",
                "updated_at": "2023-10-24T14:43:51Z",
                "closed_at": null,
                "author_association": "NONE",
                "active_lock_reason": null,
                "body": "Versions:\r\n\r\n- Python 3.10\r\n- Celery 5.3.4\r\n- Kombu 5.3.2\r\n\r\n***\r\nAfter updating celery and kombu to latest versions I have stopped receiving ApproximateReceiveCount in delivery_info properties. With celery 5.3.1 and kombu 5.3.1 all works fine and properties contains ApproximateReceiveCount field.\r\n\r\n```json\r\n{\r\n    \"body_encoding\": \"base64\",\r\n    \"correlation_id\": \"<correlation_id_hidden>\",\r\n    \"delivery_info\": {\r\n        \"exchange\": \"\",\r\n        \"routing_key\": \"celery\",\r\n        \"sqs_message\": {\r\n            \"Attributes\": {\r\n                \"ApproximateReceiveCount\": \"1\"\r\n            },\r\n            \"Body\": \"<body_hidden>\"\r\n        },\r\n        \"sqs_queue\": \"<sqs_hidden>\"\r\n    },\r\n    \"delivery_mode\": 2,\r\n    \"delivery_tag\": \"<delivery_tag_hidden>\",\r\n    \"priority\": 0,\r\n    \"reply_to\": \"<reply_to_hidden>\"\r\n}\r\n```\r\n",
                "reactions": {
                    "url": "https://api.github.com/repos/celery/kombu/issues/1814/reactions",
                    "total_count": 0,
                    "+1": 0,
                    "-1": 0,
                    "laugh": 0,
                    "hooray": 0,
                    "confused": 0,
                    "heart": 0,
                    "rocket": 0,
                    "eyes": 0
                },
                "timeline_url": "https://api.github.com/repos/celery/kombu/issues/1814/timeline",
                "performed_via_github_app": null,
                "state_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-24T14:43:52Z",
        "org": {
            "id": 319983,
            "login": "celery",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/celery",
            "avatar_url": "https://avatars.githubusercontent.com/u/319983?"
        }
    },
    {
        "id": "32794965581",
        "type": "IssueCommentEvent",
        "actor": {
            "id": 1930167,
            "login": "petroslamb",
            "display_login": "petroslamb",
            "gravatar_id": "",
            "url": "https://api.github.com/users/petroslamb",
            "avatar_url": "https://avatars.githubusercontent.com/u/1930167?"
        },
        "repo": {
            "id": 735498,
            "name": "celery/kombu",
            "url": "https://api.github.com/repos/celery/kombu"
        },
        "payload": {
            "action": "created",
            "issue": {
                "url": "https://api.github.com/repos/celery/kombu/issues/621",
                "repository_url": "https://api.github.com/repos/celery/kombu",
                "labels_url": "https://api.github.com/repos/celery/kombu/issues/621/labels{/name}",
                "comments_url": "https://api.github.com/repos/celery/kombu/issues/621/comments",
                "events_url": "https://api.github.com/repos/celery/kombu/issues/621/events",
                "html_url": "https://github.com/celery/kombu/issues/621",
                "id": 175476632,
                "node_id": "MDU6SXNzdWUxNzU0NzY2MzI=",
                "number": 621,
                "title": "Heartbeats, correct implementation?",
                "user": {
                    "login": "agalera",
                    "id": 3725538,
                    "node_id": "MDQ6VXNlcjM3MjU1Mzg=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/3725538?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/agalera",
                    "html_url": "https://github.com/agalera",
                    "followers_url": "https://api.github.com/users/agalera/followers",
                    "following_url": "https://api.github.com/users/agalera/following{/other_user}",
                    "gists_url": "https://api.github.com/users/agalera/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/agalera/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/agalera/subscriptions",
                    "organizations_url": "https://api.github.com/users/agalera/orgs",
                    "repos_url": "https://api.github.com/users/agalera/repos",
                    "events_url": "https://api.github.com/users/agalera/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/agalera/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "labels": [],
                "state": "open",
                "locked": false,
                "assignee": null,
                "assignees": [],
                "milestone": {
                    "url": "https://api.github.com/repos/celery/kombu/milestones/8",
                    "html_url": "https://github.com/celery/kombu/milestone/8",
                    "labels_url": "https://api.github.com/repos/celery/kombu/milestones/8/labels",
                    "id": 6584873,
                    "node_id": "MDk6TWlsZXN0b25lNjU4NDg3Mw==",
                    "number": 8,
                    "title": "6.0",
                    "description": "Async await compatible new kombu",
                    "creator": {
                        "login": "auvipy",
                        "id": 6212603,
                        "node_id": "MDQ6VXNlcjYyMTI2MDM=",
                        "avatar_url": "https://avatars.githubusercontent.com/u/6212603?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/auvipy",
                        "html_url": "https://github.com/auvipy",
                        "followers_url": "https://api.github.com/users/auvipy/followers",
                        "following_url": "https://api.github.com/users/auvipy/following{/other_user}",
                        "gists_url": "https://api.github.com/users/auvipy/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/auvipy/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/auvipy/subscriptions",
                        "organizations_url": "https://api.github.com/users/auvipy/orgs",
                        "repos_url": "https://api.github.com/users/auvipy/repos",
                        "events_url": "https://api.github.com/users/auvipy/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/auvipy/received_events",
                        "type": "User",
                        "site_admin": false
                    },
                    "open_issues": 29,
                    "closed_issues": 2,
                    "state": "open",
                    "created_at": "2021-03-24T06:35:07Z",
                    "updated_at": "2023-09-03T20:18:48Z",
                    "due_on": "2024-07-30T07:00:00Z",
                    "closed_at": null
                },
                "comments": 9,
                "created_at": "2016-09-07T11:15:41Z",
                "updated_at": "2023-10-24T07:43:03Z",
                "closed_at": null,
                "author_association": "NONE",
                "active_lock_reason": null,
                "body": "I'm trying to send the heartbeat because sometimes I close the connection, I've been doing some tests and does not seem to work. what am I doing wrong?\n\nThx!\n\nroot@sb1:~/work/RocketTM/examples# python3 bla2.py\n\n``` python\nDEBUG:amqp:Start from server, version: 0.9, properties: {'cluster_name': 'rabbit@sb1', 'information': 'Licensed under the MPL.  See http://www.rabbitmq.com/', 'copyright': 'Copyright (C) 2007-2014 GoPivotal, Inc.', 'capabilities': {'publisher_confirms': True, 'consumer_cancel_notify': True, 'connection.blocked': True, 'consumer_priorities': True, 'authentication_failure_close': True, 'per_consumer_qos': True, 'basic.nack': True, 'exchange_exchange_bindings': True}, 'version': '3.3.5', 'product': 'RabbitMQ', 'platform': 'Erlang/OTP'}, mechanisms: ['AMQPLAIN', 'PLAIN'], locales: ['en_US']\nDEBUG:amqp:heartbeat_tick : for connection d2661778529a41bea4d377d61a7daab6\nDEBUG:amqp:using channel_id: 1\nDEBUG:amqp:heartbeat_tick : Prev sent/recv: None/None, now - 3/3, monotonic - 6827158.980075557, last_heartbeat_sent - 6827158.980069186, heartbeat int. - 10.0 for connection d2661778529a41bea4d377d61a7daab6\nHEARTBEAT OK\nDEBUG:amqp:Channel open\nINFO:root:create queue: rocket1 durable: True\nDEBUG:amqp:using channel_id: 2\nDEBUG:amqp:Channel open\nINFO:root:<Consumer: [<Queue rocket1 -> <Exchange rocket1(direct) bound to chan:2> -> rocket1 bound to chan:2>]>\nINFO:root:<Consumer: [<Queue rocket1 -> <Exchange rocket1(direct) bound to chan:2> -> rocket1 bound to chan:2>]>\nINFO:root:<Consumer: [<Queue rocket1 -> <Exchange rocket1(direct) bound to chan:2> -> rocket1 bound to chan:2>]>\n0\n1\n2\n3\n4\nDEBUG:amqp:heartbeat_tick : for connection d2661778529a41bea4d377d61a7daab6\nDEBUG:amqp:heartbeat_tick : Prev sent/recv: 3/3, now - 14/16, monotonic - 6827163.986512617, last_heartbeat_sent - 6827163.986500512, heartbeat int. - 10.0 for connection d2661778529a41bea4d377d61a7daab6\nHEARTBEAT OK\n5\n6\n7\n8\n9\nDEBUG:amqp:heartbeat_tick : for connection d2661778529a41bea4d377d61a7daab6\nDEBUG:amqp:heartbeat_tick : Prev sent/recv: 14/16, now - 14/16, monotonic - 6827168.992872438, last_heartbeat_sent - 6827163.986500512, heartbeat int. - 10.0 for connection d2661778529a41bea4d377d61a7daab6\nHEARTBEAT OK\n10\n11\n12\n13\n14\nDEBUG:amqp:heartbeat_tick : for connection d2661778529a41bea4d377d61a7daab6\nDEBUG:amqp:heartbeat_tick : Prev sent/recv: 14/16, now - 14/16, monotonic - 6827173.997195548, last_heartbeat_sent - 6827163.986500512, heartbeat int. - 10.0 for connection d2661778529a41bea4d377d61a7daab6\nDEBUG:amqp:heartbeat_tick: sending heartbeat for connection d2661778529a41bea4d377d61a7daab6\nHEARTBEAT OK\n15\n16\n17\n18\n19\nDEBUG:amqp:heartbeat_tick : for connection d2661778529a41bea4d377d61a7daab6\nDEBUG:amqp:heartbeat_tick : Prev sent/recv: 14/16, now - 15/16, monotonic - 6827179.001209586, last_heartbeat_sent - 6827179.001199761, heartbeat int. - 10.0 for connection d2661778529a41bea4d377d61a7daab6\nHEARTBEAT OK\n20\n21\n22\n23\n24\nDEBUG:amqp:heartbeat_tick : for connection d2661778529a41bea4d377d61a7daab6\nDEBUG:amqp:heartbeat_tick : Prev sent/recv: 15/16, now - 15/16, monotonic - 6827184.007938261, last_heartbeat_sent - 6827179.001199761, heartbeat int. - 10.0 for connection d2661778529a41bea4d377d61a7daab6\nHEARTBEAT FAILED\n25\nDEBUG:amqp:heartbeat_tick : for connection d2661778529a41bea4d377d61a7daab6\nDEBUG:amqp:heartbeat_tick : Prev sent/recv: 15/16, now - 15/16, monotonic - 6827185.010983692, last_heartbeat_sent - 6827179.001199761, heartbeat int. - 10.0 for connection d2661778529a41bea4d377d61a7daab6\nHEARTBEAT FAILED\n26\nDEBUG:amqp:heartbeat_tick : for connection d2661778529a41bea4d377d61a7daab6\nDEBUG:amqp:heartbeat_tick : Prev sent/recv: 15/16, now - 15/16, monotonic - 6827186.013820113, last_heartbeat_sent - 6827179.001199761, heartbeat int. - 10.0 for connection d2661778529a41bea4d377d61a7daab6\nHEARTBEAT FAILED\n27\nDEBUG:amqp:heartbeat_tick : for connection d2661778529a41bea4d377d61a7daab6\nDEBUG:amqp:heartbeat_tick : Prev sent/recv: 15/16, now - 15/16, monotonic - 6827187.016858898, last_heartbeat_sent - 6827179.001199761, heartbeat int. - 10.0 for connection d2661778529a41bea4d377d61a7daab6\nHEARTBEAT FAILED\n28\nDEBUG:amqp:heartbeat_tick : for connection d2661778529a41bea4d377d61a7daab6\nDEBUG:amqp:heartbeat_tick : Prev sent/recv: 15/16, now - 15/16, monotonic - 6827188.019653773, last_heartbeat_sent - 6827179.001199761, heartbeat int. - 10.0 for connection d2661778529a41bea4d377d61a7daab6\nHEARTBEAT FAILED\n29\nDEBUG:amqp:heartbeat_tick : for connection d2661778529a41bea4d377d61a7daab6\nDEBUG:amqp:heartbeat_tick : Prev sent/recv: 15/16, now - 15/16, monotonic - 6827189.022403865, last_heartbeat_sent - 6827179.001199761, heartbeat int. - 10.0 for connection d2661778529a41bea4d377d61a7daab6\nDEBUG:amqp:heartbeat_tick: sending heartbeat for connection d2661778529a41bea4d377d61a7daab6\nHEARTBEAT FAILED\n30\nDEBUG:amqp:heartbeat_tick : for connection d2661778529a41bea4d377d61a7daab6\nDEBUG:amqp:heartbeat_tick : Prev sent/recv: 15/16, now - 16/16, monotonic - 6827190.024884635, last_heartbeat_sent - 6827190.024876723, heartbeat int. - 10.0 for connection d2661778529a41bea4d377d61a7daab6\nHEARTBEAT FAILED\n31\nDEBUG:amqp:heartbeat_tick : for connection d2661778529a41bea4d377d61a7daab6\nDEBUG:amqp:heartbeat_tick : Prev sent/recv: 16/16, now - 16/16, monotonic - 6827191.027322521, last_heartbeat_sent - 6827190.024876723, heartbeat int. - 10.0 for connection d2661778529a41bea4d377d61a7daab6\nHEARTBEAT FAILED\n32\nDEBUG:amqp:heartbeat_tick : for connection d2661778529a41bea4d377d61a7daab6\nDEBUG:amqp:heartbeat_tick : Prev sent/recv: 16/16, now - 16/16, monotonic - 6827192.029842284, last_heartbeat_sent - 6827190.024876723, heartbeat int. - 10.0 for connection d2661778529a41bea4d377d61a7daab6\nHEARTBEAT FAILED\n33\nDEBUG:amqp:heartbeat_tick : for connection d2661778529a41bea4d377d61a7daab6\nDEBUG:amqp:heartbeat_tick : Prev sent/recv: 16/16, now - 16/16, monotonic - 6827193.032489108, last_heartbeat_sent - 6827190.024876723, heartbeat int. - 10.0 for connection d2661778529a41bea4d377d61a7daab6\nHEARTBEAT FAILED\n34\nDEBUG:amqp:heartbeat_tick : for connection d2661778529a41bea4d377d61a7daab6\nDEBUG:amqp:heartbeat_tick : Prev sent/recv: 16/16, now - 16/16, monotonic - 6827194.035081419, last_heartbeat_sent - 6827190.024876723, heartbeat int. - 10.0 for connection d2661778529a41bea4d377d61a7daab6\nHEARTBEAT FAILED\n35\nDEBUG:amqp:heartbeat_tick : for connection d2661778529a41bea4d377d61a7daab6\nDEBUG:amqp:heartbeat_tick : Prev sent/recv: 16/16, now - 16/16, monotonic - 6827195.036884144, last_heartbeat_sent - 6827190.024876723, heartbeat int. - 10.0 for connection d2661778529a41bea4d377d61a7daab6\nHEARTBEAT FAILED\n36\nDEBUG:amqp:heartbeat_tick : for connection d2661778529a41bea4d377d61a7daab6\nDEBUG:amqp:heartbeat_tick : Prev sent/recv: 16/16, now - 16/16, monotonic - 6827196.039481093, last_heartbeat_sent - 6827190.024876723, heartbeat int. - 10.0 for connection d2661778529a41bea4d377d61a7daab6\nHEARTBEAT FAILED\n37\nDEBUG:amqp:heartbeat_tick : for connection d2661778529a41bea4d377d61a7daab6\nDEBUG:amqp:heartbeat_tick : Prev sent/recv: 16/16, now - 16/16, monotonic - 6827197.042221926, last_heartbeat_sent - 6827190.024876723, heartbeat int. - 10.0 for connection d2661778529a41bea4d377d61a7daab6\nHEARTBEAT FAILED\n38\nDEBUG:amqp:heartbeat_tick : for connection d2661778529a41bea4d377d61a7daab6\nDEBUG:amqp:heartbeat_tick : Prev sent/recv: 16/16, now - 16/16, monotonic - 6827198.04424532, last_heartbeat_sent - 6827190.024876723, heartbeat int. - 10.0 for connection d2661778529a41bea4d377d61a7daab6\nHEARTBEAT FAILED\n39\nDEBUG:amqp:heartbeat_tick : for connection d2661778529a41bea4d377d61a7daab6\nDEBUG:amqp:heartbeat_tick : Prev sent/recv: 16/16, now - 16/16, monotonic - 6827199.047431084, last_heartbeat_sent - 6827190.024876723, heartbeat int. - 10.0 for connection d2661778529a41bea4d377d61a7daab6\nHEARTBEAT FAILED\n40\nDEBUG:amqp:heartbeat_tick : for connection d2661778529a41bea4d377d61a7daab6\nDEBUG:amqp:heartbeat_tick : Prev sent/recv: 16/16, now - 16/16, monotonic - 6827200.050093538, last_heartbeat_sent - 6827190.024876723, heartbeat int. - 10.0 for connection d2661778529a41bea4d377d61a7daab6\nDEBUG:amqp:heartbeat_tick: sending heartbeat for connection d2661778529a41bea4d377d61a7daab6\nHEARTBEAT FAILED\n41\nDEBUG:amqp:heartbeat_tick : for connection d2661778529a41bea4d377d61a7daab6\nDEBUG:amqp:heartbeat_tick : Prev sent/recv: 16/16, now - 17/16, monotonic - 6827201.05386609, last_heartbeat_sent - 6827201.053860754, heartbeat int. - 10.0 for connection d2661778529a41bea4d377d61a7daab6\nHEARTBEAT FAILED\n42\nDEBUG:amqp:heartbeat_tick : for connection d2661778529a41bea4d377d61a7daab6\nDEBUG:amqp:heartbeat_tick : Prev sent/recv: 17/16, now - 17/16, monotonic - 6827202.056305858, last_heartbeat_sent - 6827201.053860754, heartbeat int. - 10.0 for connection d2661778529a41bea4d377d61a7daab6\nHEARTBEAT FAILED\n43\nDEBUG:amqp:heartbeat_tick : for connection d2661778529a41bea4d377d61a7daab6\nDEBUG:amqp:heartbeat_tick : Prev sent/recv: 17/16, now - 17/16, monotonic - 6827203.05815703, last_heartbeat_sent - 6827201.053860754, heartbeat int. - 10.0 for connection d2661778529a41bea4d377d61a7daab6\nHEARTBEAT FAILED\n44\nDEBUG:amqp:heartbeat_tick : for connection d2661778529a41bea4d377d61a7daab6\nDEBUG:amqp:heartbeat_tick : Prev sent/recv: 17/16, now - 17/16, monotonic - 6827204.060817594, last_heartbeat_sent - 6827201.053860754, heartbeat int. - 10.0 for connection d2661778529a41bea4d377d61a7daab6\nHEARTBEAT FAILED\n45\nDEBUG:amqp:heartbeat_tick : for connection d2661778529a41bea4d377d61a7daab6\nDEBUG:amqp:heartbeat_tick : Prev sent/recv: 17/16, now - 17/16, monotonic - 6827205.063507986, last_heartbeat_sent - 6827201.053860754, heartbeat int. - 10.0 for connection d2661778529a41bea4d377d61a7daab6\nHEARTBEAT FAILED\n46\nDEBUG:amqp:heartbeat_tick : for connection d2661778529a41bea4d377d61a7daab6\nDEBUG:amqp:heartbeat_tick : Prev sent/recv: 17/16, now - 17/16, monotonic - 6827206.066147127, last_heartbeat_sent - 6827201.053860754, heartbeat int. - 10.0 for connection d2661778529a41bea4d377d61a7daab6\nHEARTBEAT FAILED\n47\nDEBUG:amqp:heartbeat_tick : for connection d2661778529a41bea4d377d61a7daab6\n48\nDEBUG:amqp:heartbeat_tick : Prev sent/recv: 17/16, now - 17/16, monotonic - 6827207.069477861, last_heartbeat_sent - 6827201.053860754, heartbeat int. - 10.0 for connection d2661778529a41bea4d377d61a7daab6\nHEARTBEAT FAILED\n49\nDEBUG:amqp:heartbeat_tick : for connection d2661778529a41bea4d377d61a7daab6\nDEBUG:amqp:heartbeat_tick : Prev sent/recv: 17/16, now - 17/16, monotonic - 6827208.072213321, last_heartbeat_sent - 6827201.053860754, heartbeat int. - 10.0 for connection d2661778529a41bea4d377d61a7daab6\nHEARTBEAT FAILED\nrun task\nINFO:root:<Consumer: [<Queue rocket1 -> <Exchange rocket1(direct) bound to chan:2> -> rocket1 bound to chan:2>]>\nINFO:root:<Consumer: [<Queue rocket1 -> <Exchange rocket1(direct) bound to chan:2> -> rocket1 bound to chan:2>]>\nDEBUG:amqp:heartbeat_tick : for connection d2661778529a41bea4d377d61a7daab6\nINFO:root:<Consumer: [<Queue rocket1 -> <Exchange rocket1(direct) bound to chan:2> -> rocket1 bound to chan:2>]>\nDEBUG:amqp:heartbeat_tick : Prev sent/recv: 17/16, now - 17/18, monotonic - 6827209.075941383, last_heartbeat_sent - 6827201.053860754, heartbeat int. - 10.0 for connection d2661778529a41bea4d377d61a7daab6\nHEARTBEAT OK\nINFO:root:<Consumer: [<Queue rocket1 -> <Exchange rocket1(direct) bound to chan:2> -> rocket1 bound to chan:2>]>\nINFO:root:<Consumer: [<Queue rocket1 -> <Exchange rocket1(direct) bound to chan:2> -> rocket1 bound to chan:2>]>\nINFO:root:<Consumer: [<Queue rocket1 -> <Exchange rocket1(direct) bound to chan:2> -> rocket1 bound to chan:2>]>\nDEBUG:amqp:heartbeat_tick : for connection d2661778529a41bea4d377d61a7daab6\nDEBUG:amqp:heartbeat_tick : Prev sent/recv: 17/18, now - 17/21, monotonic - 6827214.084745324, last_heartbeat_sent - 6827201.053860754, heartbeat int. - 10.0 for connection d2661778529a41bea4d377d61a7daab6\nDEBUG:amqp:heartbeat_tick: sending heartbeat for connection d2661778529a41bea4d377d61a7daab6\nHEARTBEAT OK\nINFO:root:<Consumer: [<Queue rocket1 -> <Exchange rocket1(direct) bound to chan:2> -> rocket1 bound to chan:2>]>\nDEBUG:amqp:heartbeat_tick : for connection d2661778529a41bea4d377d61a7daab6\nDEBUG:amqp:heartbeat_tick : Prev sent/recv: 17/21, now - 18/22, monotonic - 6827219.088833282, last_heartbeat_sent - 6827219.088823367, heartbeat int. - 10.0 for connection d2661778529a41bea4d377d61a7daab6\nHEARTBEAT OK\n^CWARNING:root:server stop!\nDEBUG:amqp:Closed channel #1\nDEBUG:amqp:Closed channel #2\n```\n\nexception:\n\n``` python\nERROR:root:Traceback (most recent call last):\n  File \"bla2.py\", line 28, in monitor_heartbeat\n    conn.heartbeat_check(rate)\n  File \"/usr/local/lib/python3.4/dist-packages/kombu-4.0.0rc3-py3.4.egg/kombu/connection.py\", line 284, in heartbeat_check\n    return self.transport.heartbeat_check(self.connection, rate=rate)\n  File \"/usr/local/lib/python3.4/dist-packages/kombu-4.0.0rc3-py3.4.egg/kombu/transport/pyamqp.py\", line 144, in heartbeat_check\n    return connection.heartbeat_tick(rate=rate)\n  File \"/usr/local/lib/python3.4/dist-packages/amqp/connection.py\", line 663, in heartbeat_tick\n    raise ConnectionForced('Too many heartbeats missed')\namqp.exceptions.ConnectionForced: Too many heartbeats missed\n```\n\nsource:\n\n``` python\nfrom kombu import Connection, Exchange, Queue\nimport logging\nimport time\nfrom threading import Thread\nimport sys\nimport traceback\n\nlogging.basicConfig(level=10, stream=sys.stdout)\n\ndurable = True\nname = 'rocket1'\n\n\ndef callback(body, message):\n    message.ack()\n    for x in range(50):\n        print(x)\n        time.sleep(1)\n    print(\"run task\")\n    return True\n\n\ndef monitor_heartbeat(conn):\n    rate = conn.heartbeat\n    while True:\n        try:\n            #conn.connection.send_heartbeat()\n            conn.heartbeat_check(rate)\n            print(\"HEARTBEAT OK\")\n            time.sleep(rate/2.0)\n        except (KeyboardInterrupt, SystemExit):\n            logging.warning(\"monitor heartbeat stop\")\n            break\n        except:\n            print(\"HEARTBEAT FAILED\")\n            #logging.error(traceback.format_exc())\n            time.sleep(1)\n\nwith Connection('amqp://guest:guest@%s//?heartbeat=10' % 'localhost') as conn:\n    conn.ensure_connection()\n    t = Thread(target=monitor_heartbeat, args=(conn,))\n    t.setDaemon(True)\n    t.start()\n    exchange = Exchange(name, 'direct', durable=durable)\n    queue = Queue(name=name,\n                  exchange=exchange,\n                  durable=durable, routing_key=name)\n    queue(conn).declare()\n    logging.info(\"create queue: %s durable: %s\" % (name, durable))\n    channel = conn.channel()\n    channel.basic_qos(prefetch_size=0, prefetch_count=1, a_global=False)\n    with conn.Consumer(queue, callbacks=[callback], channel=channel) as consumer:\n        while True:\n            try:\n                logging.info(consumer)\n                conn.drain_events()\n\n            except (KeyboardInterrupt, SystemExit):\n                logging.warning(\"server stop!\")\n                break\n\n            except:\n                # logging.error(traceback.format_exc())\n                logging.error(\"connection loss, try reconnect\")\n                time.sleep(5)\n\n```\n",
                "reactions": {
                    "url": "https://api.github.com/repos/celery/kombu/issues/621/reactions",
                    "total_count": 0,
                    "+1": 0,
                    "-1": 0,
                    "laugh": 0,
                    "hooray": 0,
                    "confused": 0,
                    "heart": 0,
                    "rocket": 0,
                    "eyes": 0
                },
                "timeline_url": "https://api.github.com/repos/celery/kombu/issues/621/timeline",
                "performed_via_github_app": null,
                "state_reason": null
            },
            "comment": {
                "url": "https://api.github.com/repos/celery/kombu/issues/comments/1776688654",
                "html_url": "https://github.com/celery/kombu/issues/621#issuecomment-1776688654",
                "issue_url": "https://api.github.com/repos/celery/kombu/issues/621",
                "id": 1776688654,
                "node_id": "IC_kwDOAAs5Cs5p5h4O",
                "user": {
                    "login": "petroslamb",
                    "id": 1930167,
                    "node_id": "MDQ6VXNlcjE5MzAxNjc=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/1930167?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/petroslamb",
                    "html_url": "https://github.com/petroslamb",
                    "followers_url": "https://api.github.com/users/petroslamb/followers",
                    "following_url": "https://api.github.com/users/petroslamb/following{/other_user}",
                    "gists_url": "https://api.github.com/users/petroslamb/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/petroslamb/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/petroslamb/subscriptions",
                    "organizations_url": "https://api.github.com/users/petroslamb/orgs",
                    "repos_url": "https://api.github.com/users/petroslamb/repos",
                    "events_url": "https://api.github.com/users/petroslamb/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/petroslamb/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "created_at": "2023-10-24T07:43:02Z",
                "updated_at": "2023-10-24T07:43:02Z",
                "author_association": "NONE",
                "body": "Hello, also facing this problem several years later, not sure what is the proper way to handle my rpc using kombu and RMQ, for long running tasks. \r\n\r\nI cannot make the heartbeat too long, as the RMQ cluster is shared and disabling it does little favour to my application.\r\n\r\nTrying to make use of the existing `Connection` interface and using `py-amqp`, i also centered around looping the `heartbeat_check` method in the main thread and launching a second thread with the actual task, (but this thread must join to return a result). \r\n\r\nI seems as if the `heartbeat_check` method has no effect. I tried coupling it with `drain_events` on a short timeout, but still I was not able to find a solution.\r\n\r\n@ask It would be great to know what is the official way to deal with this. Should I not mess with the heartbeat, is it for internal use only? Is this issue planned to be solved in the future, or is it a non-issue/wont-fix? Am I missing the solution in one of the other bug reports?\r\n\r\nThe code, which did not work:\r\n```python\r\nfrom kombu import Connection, Exchange, Queue\r\nfrom kombu.mixins import ConsumerMixin\r\nfrom threading import Thread, Event\r\nimport time\r\nimport logging\r\n\r\nrabbit_url = \"amqp://guest:guest@localhost:5672//\"\r\nexchange = Exchange(\"example-exchange\", type=\"direct\")\r\nqueue = Queue(name=\"example-queue\", exchange=exchange, routing_key=\"BOB\")\r\nheartbeat_rate = 2\r\n\r\n\r\nclass ThreadReturningValue(Thread):\r\n    def __init__(self, *args, **kwargs):\r\n        super().__init__(*args, **kwargs)\r\n        self.result = None\r\n\r\n    def run(self):\r\n        self.result = self._target(*self._args, **self._kwargs)\r\n\r\n    def join(self, *args, **kwargs):\r\n        super().join(*args, **kwargs)\r\n        return self.result\r\n\r\n\r\ndef process_task(message, done_event):\r\n    print('Processing task that takes 10 seconds...')\r\n    time.sleep(10)\r\n    done_event.set()\r\n    print('event set')\r\n    return 'worker done'\r\n\r\nclass Worker(ConsumerMixin):\r\n    def __init__(self, connection, queues):\r\n        self.connection = connection\r\n        self.queues = queues\r\n        self.thread_done = Event()\r\n        self.worker_thread = None\r\n\r\n    def get_consumers(self, Consumer, channel):\r\n        return [Consumer(queues=self.queues, callbacks=[self.on_message])]\r\n\r\n    def on_message(self, body, message):\r\n        print('Received message: {0}'.format(body))\r\n        self.worker_thread = ThreadReturningValue(target=process_task, args=(message, self.thread_done))\r\n        self.worker_thread.start()\r\n        while not self.thread_done.is_set():\r\n            try:\r\n                self.connection.drain_events(timeout=0.1)\r\n            except Exception as e:\r\n                print(e)\r\n            self.connection.heartbeat_check()\r\n            print('heartbeat check')\r\n            time.sleep(1)\r\n        print('Task completed.')\r\n        self.worker_thread.join()\r\n        self.thread_done.clear()\r\n        message.ack()\r\n        print('Message acknowledged.')\r\n        reply = self.worker_thread.result\r\n        print('Reply: {0}'.format(reply)) \r\n\r\nwith Connection(rabbit_url, heartbeat=heartbeat_rate) as conn:\r\n    conn.ensure_connection()\r\n    print('Connection supports heartbeats: {0}'.format(conn.supports_heartbeats))\r\n\r\n    worker = Worker(conn, [queue])\r\n    worker.run()\r\n\r\n```",
                "reactions": {
                    "url": "https://api.github.com/repos/celery/kombu/issues/comments/1776688654/reactions",
                    "total_count": 0,
                    "+1": 0,
                    "-1": 0,
                    "laugh": 0,
                    "hooray": 0,
                    "confused": 0,
                    "heart": 0,
                    "rocket": 0,
                    "eyes": 0
                },
                "performed_via_github_app": null
            }
        },
        "public": true,
        "created_at": "2023-10-24T07:43:03Z",
        "org": {
            "id": 319983,
            "login": "celery",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/celery",
            "avatar_url": "https://avatars.githubusercontent.com/u/319983?"
        }
    },
    {
        "id": "32794891799",
        "type": "IssueCommentEvent",
        "actor": {
            "id": 15754068,
            "login": "nathanieldavidson916",
            "display_login": "nathanieldavidson916",
            "gravatar_id": "",
            "url": "https://api.github.com/users/nathanieldavidson916",
            "avatar_url": "https://avatars.githubusercontent.com/u/15754068?"
        },
        "repo": {
            "id": 735498,
            "name": "celery/kombu",
            "url": "https://api.github.com/repos/celery/kombu"
        },
        "payload": {
            "action": "created",
            "issue": {
                "url": "https://api.github.com/repos/celery/kombu/issues/1582",
                "repository_url": "https://api.github.com/repos/celery/kombu",
                "labels_url": "https://api.github.com/repos/celery/kombu/issues/1582/labels{/name}",
                "comments_url": "https://api.github.com/repos/celery/kombu/issues/1582/comments",
                "events_url": "https://api.github.com/repos/celery/kombu/issues/1582/events",
                "html_url": "https://github.com/celery/kombu/issues/1582",
                "id": 1338002698,
                "node_id": "I_kwDOAAs5Cs5PwE0K",
                "number": 1582,
                "title": "Currently using celery for my django  but get error kombu.exceptions.OperationalError: [Errno 111] Connection refused",
                "user": {
                    "login": "codertjay",
                    "id": 63492224,
                    "node_id": "MDQ6VXNlcjYzNDkyMjI0",
                    "avatar_url": "https://avatars.githubusercontent.com/u/63492224?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/codertjay",
                    "html_url": "https://github.com/codertjay",
                    "followers_url": "https://api.github.com/users/codertjay/followers",
                    "following_url": "https://api.github.com/users/codertjay/following{/other_user}",
                    "gists_url": "https://api.github.com/users/codertjay/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/codertjay/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/codertjay/subscriptions",
                    "organizations_url": "https://api.github.com/users/codertjay/orgs",
                    "repos_url": "https://api.github.com/users/codertjay/repos",
                    "events_url": "https://api.github.com/users/codertjay/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/codertjay/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "labels": [],
                "state": "closed",
                "locked": false,
                "assignee": null,
                "assignees": [],
                "milestone": null,
                "comments": 5,
                "created_at": "2022-08-13T16:28:08Z",
                "updated_at": "2023-10-24T07:40:00Z",
                "closed_at": "2022-08-14T09:45:08Z",
                "author_association": "NONE",
                "active_lock_reason": null,
                "body": "I am  currently using django, celery and redis    i am always getting this  error  \r\n`kombu.exceptions.OperationalError: [Errno 111] Connection refused`    But if I run the code on windows it work perfectly where i have rabbitmql but  it doesn\u2019t work in my linux (wsl) and my Ubuntu server . if i run the task in django shell it works  but it doesn't work if i call the task in a view function \r\nI have also checked my redis server and it\u2019s currently responding I even restart  to verify \r\n\r\nand my celery.py in my django project is \r\nPlease can someone help me to know what I am missing \r\n\r\n```\r\n`import os\r\n\r\nfrom celery import Celery\r\nfrom django.conf import settings\r\n\r\n\r\nos.environ.setdefault('DJANGO_SETTINGS_MODULE', 'Gimsap.settings')\r\n\r\nBROKER_URL = \"redis://localhost:6379\"\r\n\r\n# used redis broker if it exists\r\napp = Celery('Gimsap', namespace='CELERY')\r\n\r\napp.config_from_object('django.conf:settings')\r\n\r\n# Load task modules from all registered Django app configs.\r\napp.autodiscover_tasks(settings.INSTALLED_APPS)\r\n\r\napp.conf.broker_url = BROKER_URL\r\nCELERY_BROKER_URL = BROKER_URL\r\n\r\napp.conf.beat_schedule = {\r\n\r\n    \"\"\"'\r\n    Test celery worker\r\n    send_admin_message': {\r\n        'task': 'home.tasks.test_task',\r\n        'schedule': 3,\r\n    },\"\"\"\r\n}\r\n\r\n\r\n@app.task(bind=True)\r\ndef debug_task(self):\r\n    print(f'Request: {self.request!r}')\r\n`\r\n```\r\nI have also tried using external redis server but it doesnt work well\r\n\r\nthis is also my setting.py  i know it might be  wrong posting this much  code but i have been on this for hours but still cant fixed it \r\n\r\n\r\n```\r\n\"\"\"\r\nDjango settings for Gimsap project.\r\n\r\nGenerated by 'django-admin startproject' using Django 4.0.5.\r\n\r\nFor more information on this file, see\r\nhttps://docs.djangoproject.com/en/4.0/topics/settings/\r\n\r\nFor the full list of settings and their values, see\r\nhttps://docs.djangoproject.com/en/4.0/ref/settings/\r\n\"\"\"\r\nimport datetime\r\nfrom pathlib import Path\r\nimport os\r\nfrom decouple import config\r\n\r\nBASE_DIR = Path(__file__).resolve().parent.parent\r\n\r\n# Quick-start development settings - unsuitable for production\r\n# See https://docs.djangoproject.com/en/4.0/howto/deployment/checklist/\r\n\r\n# SECURITY WARNING: keep the secret key used in production secret!\r\nSECRET_KEY = config('SECRET_KEY')\r\n\r\n# SECURITY WARNING: don't run with debug turned on in production!\r\nDEBUG = config('DEBUG')\r\nif DEBUG == \"True\":\r\n    DEBUG = True\r\nelse:\r\n    DEBUG = False\r\nif not DEBUG:\r\n    pass\r\n    # todo : uncomment after adding domain name\r\n    # CSRF_COOKIE_SECURE = True\r\n    # SESSION_COOKIE_SECURE = True\r\n    # SECURE_SSL_REDIRECT = True\r\n    # SECURE_HSTS_SECONDS = 31536000  # One year in seconds\r\n    # SECURE_HSTS_INCLUDE_SUBDOMAINS = True\r\n    # SECURE_HSTS_PRELOAD = True\r\n    # SECURE_CONTENT_TYPE_NOSNIFF = True\r\n    #  todo remove when doamin is added\r\n    SECURE_SSL_REDIRECT = False\r\n    SESSION_COOKIE_SECURE = False\r\n    CSRF_COOKIE_SECURE = False\r\n\r\nif DEBUG:\r\n    ALLOWED_HOSTS = [\"*\", ]\r\nelse:\r\n    ALLOWED_HOSTS = [\"*.domain.com\"]\r\n\r\n# Application definition\r\n\r\nINSTALLED_APPS = [\r\n    'django.contrib.admin',\r\n    'django.contrib.auth',\r\n    'django.contrib.contenttypes',\r\n    'django.contrib.sessions',\r\n    'django.contrib.messages',\r\n    'django.contrib.staticfiles',\r\n\r\n    'django.contrib.sites',\r\n\r\n    #  third party\r\n    'allauth',\r\n    'allauth.account',\r\n    'allauth.socialaccount',\r\n    'crispy_forms',\r\n    'django_celery_beat',\r\n    'post_office',\r\n\r\n    # my apps\r\n    'orders',\r\n    '\r\n]\r\n\r\nMIDDLEWARE = [\r\n    # Todo : for heroku will be removed later\r\n    'whitenoise.middleware.WhiteNoiseMiddleware',\r\n\r\n    'django.middleware.security.SecurityMiddleware',\r\n    'django.contrib.sessions.middleware.SessionMiddleware',\r\n    'django.middleware.common.CommonMiddleware',\r\n    'django.middleware.csrf.CsrfViewMiddleware',\r\n    'django.contrib.auth.middleware.AuthenticationMiddleware',\r\n    'django.contrib.messages.middleware.MessageMiddleware',\r\n    'django.middleware.clickjacking.XFrameOptionsMiddleware',\r\n]\r\n\r\nROOT_URLCONF = 'Gimsap.urls'\r\n\r\nTEMPLATES = [\r\n    {\r\n        'BACKEND': 'django.template.backends.django.DjangoTemplates',\r\n        'DIRS': [BASE_DIR / 'templates']\r\n        ,\r\n        'APP_DIRS': True,\r\n        'OPTIONS': {\r\n            'context_processors': [\r\n                'django.template.context_processors.debug',\r\n                'django.template.context_processors.request',\r\n                'django.contrib.auth.context_processors.auth',\r\n                'django.contrib.messages.context_processors.messages',\r\n                'items.context_processors.add_variable_to_context',\r\n            ],\r\n        },\r\n    },\r\n]\r\n\r\nWSGI_APPLICATION = 'Gimsap.wsgi.application'\r\n\r\n# Database\r\n# https://docs.djangoproject.com/en/4.0/ref/settings/#databases\r\n\r\nif DEBUG:\r\n    DATABASES = {\r\n        'default': {\r\n            'ENGINE': 'django.db.backends.sqlite3',\r\n            'NAME': BASE_DIR / 'db.sqlite3',\r\n        }\r\n    }\r\nelse:\r\n    DATABASES = {\r\n        'default': {\r\n            'ENGINE': 'django.db.backends.postgresql_psycopg2',\r\n            'NAME': config('POSTGRESDB_NAME', default=''),\r\n            'USER': config('POSTGRESDB_USER', default=''),\r\n            'PASSWORD': config('POSTGRESDB_PASSWORD', default=''),\r\n            'HOST': config('POSTGRESDB_HOST', default=''),\r\n            'PORT': '',\r\n        }\r\n    }\r\n\r\n# Password validation\r\n# https://docs.djangoproject.com/en/4.0/ref/settings/#auth-password-validators\r\n\r\nAUTH_PASSWORD_VALIDATORS = [\r\n    {\r\n        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',\r\n    },\r\n    {\r\n        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',\r\n    },\r\n    {\r\n        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',\r\n    },\r\n    {\r\n        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',\r\n    },\r\n]\r\n\r\n# Internationalization\r\n# https://docs.djangoproject.com/en/4.0/topics/i18n/\r\n\r\nLANGUAGE_CODE = 'en-us'\r\n\r\nTIME_ZONE = 'UTC'\r\n\r\nUSE_I18N = True\r\n\r\nUSE_TZ = True\r\n\r\n# Static files (CSS, JavaScript, Images)\r\n# https://docs.djangoproject.com/en/4.0/howto/static-files/\r\n\r\nSTATIC_URL = '/static/'\r\nMEDIA_URL = '/media/'\r\n#  Add configuration for static files storage using whitenoise\r\n# Todo: note i installed  gunicorn dj-database-url whitenoise psycopg2 for heroku\r\nSTATICFILES_STORAGE = 'whitenoise.storage.CompressedStaticFilesStorage'\r\n\r\nSTATICFILES_DIRS = [\r\n    os.path.join(BASE_DIR, 'staticfiles')\r\n]\r\nSTATIC_ROOT = os.path.join(BASE_DIR, 'static')\r\nMEDIA_ROOT = os.path.join(BASE_DIR, 'media')\r\n\r\n# Default primary key field type\r\n# https://docs.djangoproject.com/en/4.0/ref/settings/#default-auto-field\r\n\r\nDEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'\r\n\r\n# django allauth\r\nACCOUNT_USER_MODEL_USERNAME_FIELD = 'username'\r\nACCOUNT_USERNAME_REQUIRED = False\r\nACCOUNT_EMAIL_REQUIRED = True\r\nACCOUNT_AUTHENTICATION_METHOD = 'email'\r\nLOGIN_REDIRECT_URL = '/'\r\nSOCIALACCOUNT_QUERY_EMAIL = True\r\n\r\nSIGNUP_REDIRECT_URL = LOGIN_REDIRECT_URL\r\nACCOUNT_AUTHENTICATED_LOGIN_REDIRECTS = True\r\nACCOUNT_SIGNUP_REDIRECT_URL = LOGIN_REDIRECT_URL\r\nACCOUNT_EMAIL_VERIFICATION = 'optional'\r\nACCOUNT_UNIQUE_EMAIL = True\r\nACCOUNT_EMAIL_SUBJECT_PREFIX = ''\r\nACCOUNT_LOGIN_ATTEMPTS_TIMEOUT = 300\r\n\r\nAUTHENTICATION_BACKENDS = (\r\n    # Needed to log in by username in Django admin, regardless of `allauth`\r\n    \"django.contrib.auth.backends.ModelBackend\",\r\n    # `allauth` specific authentication methods, such as login by e-mail\r\n    \"allauth.account.auth_backends.AuthenticationBackend\"\r\n)\r\n\r\n# EMAIL_BACKEND = \"post_office.EmailBackend\"\r\nEMAIL_BACKEND = \"post_office.EmailBackend\"\r\nEMAIL_HOST = config('EMAIL_HOST')\r\nEMAIL_HOST_USER = config('EMAIL_HOST_USER')\r\nEMAIL_HOST_PASSWORD = config('EMAIL_HOST_PASSWORD')\r\nEMAIL_PORT = config('EMAIL_PORT')\r\nEMAIL_USE_TLS = True\r\nDEFAULT_FROM_EMAIL = config('EMAIL_HOST_USER')\r\n\r\nPOST_OFFICE = {\r\n    # 'DEFAULT_PRIORITY': 'now',\r\n    'CELERY_ENABLED': True,\r\n    'MESSAGE_ID_ENABLED': True,\r\n    'MAX_RETRIES': 5,\r\n    'RETRY_INTERVAL': datetime.timedelta(minutes=15),  # Schedule to be retried 15 minutes later\r\n    'THREADS_PER_PROCESS': 10,\r\n}\r\n\r\nADMINS = [('Afenikhena Favour', config('ADMIN_MAIL'),)]\r\n\r\nSITE_ID = 1\r\n\r\nCRISPY_TEMPLATE_PACK = 'bootstrap4'\r\n\r\nDOMAIN_URL = config('DOMAIN_URL', default=\"https://domain.com\")\r\n\r\n# change the credentials if on debug\r\nif DEBUG:\r\n    PAYPAL_CLIENT_ID = config('DEBUG_PAYPAL_CLIENT_ID')\r\n    PAYPAL_SECRET_KEY = config('DEBUG_PAYPAL_SECRET_KEY')\r\n    PAYPAL_URL = config('DEBUG_PAYPAL_URL')\r\nelse:\r\n    PAYPAL_CLIENT_ID = config('PAYPAL_CLIENT_ID')\r\n    PAYPAL_SECRET_KEY = config('PAYPAL_SECRET_KEY')\r\n    PAYPAL_URL = config('PAYPAL_URL')\r\n\r\nGOOGLE_API_KEY = config('GOOGLE_API_KEY')\r\n\r\nCELERY_ENABLED = True\r\nCELERY_BROKER_URL = \"redis://localhost:6379\"\r\nCELERY_RESULT_BACKEND = \"redis://localhost:6379\"\r\n```\r\n\r\nAnd the full error i have been having \r\n\r\n\r\n```\r\n`Internal Server Error: /contact/\r\nTraceback (most recent call last):\r\n  File \"/home/codertjay/.virtualenvs/Gimsap-Ecommerce/lib/python3.9/site-packages/kombu/utils/functional.py\", line 30, in __call__\r\n    return self.__value__\r\nAttributeError: 'ChannelPromise' object has no attribute '__value__'\r\nDuring handling of the above exception, another exception occurred:\r\nTraceback (most recent call last):\r\n  File \"/home/codertjay/.virtualenvs/Gimsap-Ecommerce/lib/python3.9/site-packages/kombu/connection.py\", line 446, in _reraise_as_library_errors\r\n    yield\r\n  File \"/home/codertjay/.virtualenvs/Gimsap-Ecommerce/lib/python3.9/site-packages/kombu/connection.py\", line 433, in _ensure_connection\r\n    return retry_over_time(\r\n  File \"/home/codertjay/.virtualenvs/Gimsap-Ecommerce/lib/python3.9/site-packages/kombu/utils/functional.py\", line 312, in retry_over_time\r\n    return fun(*args, **kwargs)\r\n  File \"/home/codertjay/.virtualenvs/Gimsap-Ecommerce/lib/python3.9/site-packages/kombu/connection.py\", line 877, in _connection_factory\r\n    self._connection = self._establish_connection()\r\n  File \"/home/codertjay/.virtualenvs/Gimsap-Ecommerce/lib/python3.9/site-packages/kombu/connection.py\", line 812, in _establish_connection\r\n    conn = self.transport.establish_connection()\r\n  File \"/home/codertjay/.virtualenvs/Gimsap-Ecommerce/lib/python3.9/site-packages/kombu/transport/pyamqp.py\", line 201, in establish_connection\r\n    conn.connect()\r\n  File \"/home/codertjay/.virtualenvs/Gimsap-Ecommerce/lib/python3.9/site-packages/amqp/connection.py\", line 323, in connect\r\n    self.transport.connect()\r\n  File \"/home/codertjay/.virtualenvs/Gimsap-Ecommerce/lib/python3.9/site-packages/amqp/transport.py\", line 129, in connect\r\n    self._connect(self.host, self.port, self.connect_timeout)\r\n  File \"/home/codertjay/.virtualenvs/Gimsap-Ecommerce/lib/python3.9/site-packages/amqp/transport.py\", line 184, in _connect\r\n    self.sock.connect(sa)\r\nConnectionRefusedError: [Errno 111] Connection refused\r\nThe above exception was the direct cause of the following exception:\r\nTraceback (most recent call last):\r\n  File \"/home/codertjay/.virtualenvs/Gimsap-Ecommerce/lib/python3.9/site-packages/django/core/handlers/exception.py\", line 55, in inner\r\n    response = get_response(request)\r\n  File \"/home/codertjay/.virtualenvs/Gimsap-Ecommerce/lib/python3.9/site-packages/django/core/handlers/base.py\", line 197, in _get_response\r\n    response = wrapped_callback(request, *callback_args, **callback_kwargs)\r\n  File \"/home/codertjay/.virtualenvs/Gimsap-Ecommerce/lib/python3.9/site-packages/django/views/generic/base.py\", line 84, in view\r\n    return self.dispatch(request, *args, **kwargs)\r\n  File \"/home/codertjay/.virtualenvs/Gimsap-Ecommerce/lib/python3.9/site-packages/django/views/generic/base.py\", line 119, in dispatch\r\n    return handler(request, *args, **kwargs)\r\n  File \"/mnt/c/Users/Codertjay/PycharmProjects/freelance/Gimsap-Ecommerce/home/views.py\", line 95, in get\r\n    test_task.delay()\r\n  File \"/home/codertjay/.virtualenvs/Gimsap-Ecommerce/lib/python3.9/site-packages/celery/app/task.py\", line 425, in delay\r\n    return self.apply_async(args, kwargs)\r\n  File \"/home/codertjay/.virtualenvs/Gimsap-Ecommerce/lib/python3.9/site-packages/celery/app/task.py\", line 575, in apply_async\r\n    return app.send_task(\r\n  File \"/home/codertjay/.virtualenvs/Gimsap-Ecommerce/lib/python3.9/site-packages/celery/app/base.py\", line 788, in send_task\r\n    amqp.send_task_message(P, name, message, **options)\r\n  File \"/home/codertjay/.virtualenvs/Gimsap-Ecommerce/lib/python3.9/site-packages/celery/app/amqp.py\", line 510, in send_task_message\r\n    ret = producer.publish(\r\n  File \"/home/codertjay/.virtualenvs/Gimsap-Ecommerce/lib/python3.9/site-packages/kombu/messaging.py\", line 177, in publish\r\n    return _publish(\r\n  File \"/home/codertjay/.virtualenvs/Gimsap-Ecommerce/lib/python3.9/site-packages/kombu/connection.py\", line 523, in _ensured\r\n    return fun(*args, **kwargs)\r\n  File \"/home/codertjay/.virtualenvs/Gimsap-Ecommerce/lib/python3.9/site-packages/kombu/messaging.py\", line 186, in _publish\r\n    channel = self.channel\r\n  File \"/home/codertjay/.virtualenvs/Gimsap-Ecommerce/lib/python3.9/site-packages/kombu/messaging.py\", line 209, in _get_channel\r\n    channel = self._channel = channel()\r\n  File \"/home/codertjay/.virtualenvs/Gimsap-Ecommerce/lib/python3.9/site-packages/kombu/utils/functional.py\", line 32, in __call__\r\n    value = self.__value__ = self.__contract__()\r\n  File \"/home/codertjay/.virtualenvs/Gimsap-Ecommerce/lib/python3.9/site-packages/kombu/messaging.py\", line 225, in <lambda>\r\n    channel = ChannelPromise(lambda: connection.default_channel)\r\n  File \"/home/codertjay/.virtualenvs/Gimsap-Ecommerce/lib/python3.9/site-packages/kombu/connection.py\", line 895, in default_channel\r\n    self._ensure_connection(**conn_opts)\r\n  File \"/home/codertjay/.virtualenvs/Gimsap-Ecommerce/lib/python3.9/site-packages/kombu/connection.py\", line 433, in _ensure_connection\r\n    return retry_over_time(\r\n  File \"/usr/local/lib/python3.9/contextlib.py\", line 135, in __exit__\r\n    self.gen.throw(type, value, traceback)\r\n  File \"/home/codertjay/.virtualenvs/Gimsap-Ecommerce/lib/python3.9/site-packages/kombu/connection.py\", line 450, in _reraise_as_library_errors\r\n    raise ConnectionError(str(exc)) from exc\r\nkombu.exceptions.OperationalError: [Errno 111] Connection refused\r\n[13/Aug/2022 15:56:40] \"GET /contact/ HTTP/1.1\" 500 228751\r\n`\r\n\r\n\r\n```\r\n\r\nThis is my requirements.txt\r\n\r\n```\r\n`amqp==5.1.1\r\nasgiref==3.5.2\r\nasync-timeout==4.0.2\r\nbilliard==3.6.4.0\r\nbleach==5.0.1\r\ncelery==5.2.7\r\ncertifi==2022.6.15\r\ncffi==1.15.0\r\ncharset-normalizer==2.1.0\r\nclick==8.1.3\r\nclick-didyoumean==0.3.0\r\nclick-plugins==1.1.1\r\nclick-repl==0.2.0\r\ncolorama==0.4.5\r\ncryptography==37.0.2\r\ndefusedxml==0.7.1\r\nDeprecated==1.2.13\r\nDjango==4.0.7\r\ndjango-allauth==0.51.0\r\ndjango-celery-beat==2.3.0\r\ndjango-crispy-forms==1.14.0\r\ndjango-post-office==3.6.1\r\ndjango-timezone-field==5.0\r\ngooglemaps==4.6.0\r\ngunicorn==20.1.0\r\nidna==3.3\r\njoblib==1.1.0\r\njsonfield==3.1.0\r\nkombu==5.2.4\r\nnltk==3.7\r\nnumpy==1.23.1\r\noauthlib==3.2.0\r\norder==1.3.5\r\npackaging==21.3\r\nPillow==9.1.1\r\nprompt-toolkit==3.0.30\r\npsycopg2-binary==2.9.3\r\npycparser==2.21\r\nPyJWT==2.4.0\r\npyparsing==3.0.9\r\npython-crontab==2.6.0\r\npython-dateutil==2.8.2\r\npython-decouple==3.6\r\npython3-openid==3.2.0\r\npytz==2022.1\r\nredis==4.3.4\r\nregex==2022.7.25\r\nrequests==2.28.1\r\nrequests-oauthlib==1.3.1\r\nscinum==1.4.1\r\nsix==1.16.0\r\nsqlparse==0.4.2\r\ntextblob==0.17.1\r\ntinycss2==1.1.1\r\ntqdm==4.64.0\r\ntzdata==2022.1\r\nurllib3==1.26.11\r\nvine==5.0.0\r\nwcwidth==0.2.5\r\nwebencodings==0.5.1\r\nwhitenoise==6.2.0\r\nwrapt==1.14.1\r\n`\r\n```\r\n\r\n",
                "reactions": {
                    "url": "https://api.github.com/repos/celery/kombu/issues/1582/reactions",
                    "total_count": 1,
                    "+1": 0,
                    "-1": 0,
                    "laugh": 0,
                    "hooray": 0,
                    "confused": 0,
                    "heart": 0,
                    "rocket": 1,
                    "eyes": 0
                },
                "timeline_url": "https://api.github.com/repos/celery/kombu/issues/1582/timeline",
                "performed_via_github_app": null,
                "state_reason": "completed"
            },
            "comment": {
                "url": "https://api.github.com/repos/celery/kombu/issues/comments/1776684664",
                "html_url": "https://github.com/celery/kombu/issues/1582#issuecomment-1776684664",
                "issue_url": "https://api.github.com/repos/celery/kombu/issues/1582",
                "id": 1776684664,
                "node_id": "IC_kwDOAAs5Cs5p5g54",
                "user": {
                    "login": "nathanieldavidson916",
                    "id": 15754068,
                    "node_id": "MDQ6VXNlcjE1NzU0MDY4",
                    "avatar_url": "https://avatars.githubusercontent.com/u/15754068?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/nathanieldavidson916",
                    "html_url": "https://github.com/nathanieldavidson916",
                    "followers_url": "https://api.github.com/users/nathanieldavidson916/followers",
                    "following_url": "https://api.github.com/users/nathanieldavidson916/following{/other_user}",
                    "gists_url": "https://api.github.com/users/nathanieldavidson916/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/nathanieldavidson916/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/nathanieldavidson916/subscriptions",
                    "organizations_url": "https://api.github.com/users/nathanieldavidson916/orgs",
                    "repos_url": "https://api.github.com/users/nathanieldavidson916/repos",
                    "events_url": "https://api.github.com/users/nathanieldavidson916/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/nathanieldavidson916/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "created_at": "2023-10-24T07:39:59Z",
                "updated_at": "2023-10-24T07:39:59Z",
                "author_association": "NONE",
                "body": "> ```python\r\n> from .celery import app as CRM_CELERY_APP\r\n> \r\n> __all__ = [\"CRM_CELERY_APP\"]\r\n> ```\r\n\r\nFor anyone curious as to why this is required like myself there's an explanation for it on celery's [\"First steps with Django\" guide](https://docs.celeryq.dev/en/latest/django/first-steps-with-django.html)\r\n\r\n> Then you need to import this app in your proj/proj/__init__.py module. This ensures that the app is loaded when Django starts so that the @shared_task decorator (mentioned later) will use it:\r\n\r\n> proj/proj/__init__.py:\r\n```python\r\n# This will make sure the app is always imported when\r\n# Django starts so that shared_task will use this app.\r\nfrom .celery import app as celery_app\r\n\r\n__all__ = ('celery_app',)\r\n```",
                "reactions": {
                    "url": "https://api.github.com/repos/celery/kombu/issues/comments/1776684664/reactions",
                    "total_count": 0,
                    "+1": 0,
                    "-1": 0,
                    "laugh": 0,
                    "hooray": 0,
                    "confused": 0,
                    "heart": 0,
                    "rocket": 0,
                    "eyes": 0
                },
                "performed_via_github_app": null
            }
        },
        "public": true,
        "created_at": "2023-10-24T07:40:00Z",
        "org": {
            "id": 319983,
            "login": "celery",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/celery",
            "avatar_url": "https://avatars.githubusercontent.com/u/319983?"
        }
    },
    {
        "id": "32769248948",
        "type": "IssueCommentEvent",
        "actor": {
            "id": 6212603,
            "login": "auvipy",
            "display_login": "auvipy",
            "gravatar_id": "",
            "url": "https://api.github.com/users/auvipy",
            "avatar_url": "https://avatars.githubusercontent.com/u/6212603?"
        },
        "repo": {
            "id": 735498,
            "name": "celery/kombu",
            "url": "https://api.github.com/repos/celery/kombu"
        },
        "payload": {
            "action": "created",
            "issue": {
                "url": "https://api.github.com/repos/celery/kombu/issues/1807",
                "repository_url": "https://api.github.com/repos/celery/kombu",
                "labels_url": "https://api.github.com/repos/celery/kombu/issues/1807/labels{/name}",
                "comments_url": "https://api.github.com/repos/celery/kombu/issues/1807/comments",
                "events_url": "https://api.github.com/repos/celery/kombu/issues/1807/events",
                "html_url": "https://github.com/celery/kombu/pull/1807",
                "id": 1933514281,
                "node_id": "PR_kwDOAAs5Cs5cSJ4Z",
                "number": 1807,
                "title": "Use the correct protocol for SQS requests",
                "user": {
                    "login": "rafidka",
                    "id": 442447,
                    "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/rafidka",
                    "html_url": "https://github.com/rafidka",
                    "followers_url": "https://api.github.com/users/rafidka/followers",
                    "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                    "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                    "organizations_url": "https://api.github.com/users/rafidka/orgs",
                    "repos_url": "https://api.github.com/users/rafidka/repos",
                    "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/rafidka/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "labels": [],
                "state": "open",
                "locked": false,
                "assignee": null,
                "assignees": [],
                "milestone": null,
                "comments": 12,
                "created_at": "2023-10-09T17:36:06Z",
                "updated_at": "2023-10-23T11:37:11Z",
                "closed_at": null,
                "author_association": "CONTRIBUTOR",
                "active_lock_reason": null,
                "draft": false,
                "pull_request": {
                    "url": "https://api.github.com/repos/celery/kombu/pulls/1807",
                    "html_url": "https://github.com/celery/kombu/pull/1807",
                    "diff_url": "https://github.com/celery/kombu/pull/1807.diff",
                    "patch_url": "https://github.com/celery/kombu/pull/1807.patch",
                    "merged_at": null
                },
                "body": "TL;DR - The use of boto3 in #1759 resulted in relying on blocking (synchronous) HTTP requests, which caused the performance issue reported in #1783.\r\n\r\n`kombu` previously used to craft AWS requests manually as explained in detail in #1726, which resulted in an outage when botocore temporarily changed the default protocol to JSON (before rolling back due to the impact on celery and airflow.) To fix the issue, I submitted #1759, which changes `kombu` to use `boto3` instead of manually crafting AWS requests. This way when boto3 changes the default protocol, kombu won't be impacted.\r\n\r\nWhile working on #1759, I did extensive debugging to understand the multi-threading nature of kombu. What I discovered is that there isn't an actual multi-threading in the true sense of the word, but an event loop that runs on the same thread and process and orchestrate the communication with SQS. As such, it didn't appear to me that there is anything to worry about my change, and the testing I did didn't discover any issue. However, it turns out that while kombu's event loop doesn't have actual multi-threading, its [reliance on pycurl](https://github.com/celery/kombu/blob/main/kombu/asynchronous/http/curl.py#L48) (and thus libcurl) meant that the requests to AWS were being done asynchronously. On the other hand, boto3 requests are always done synchronously, i.e. they are blocking requests.\r\n\r\nThe above meant that my change introduced blocking on the event loop of kombu. This is fine in most of the cases, since the requests to SQS are pretty fast. However, in the case of using long-polling, a call to SQS's ReceiveMessage can last up to 20 seconds (depending on the user configuration).\r\n\r\nTo solve this problem, I rolled back my earlier changes and, instead, to address the issue reported in #1726, I now changed the `AsyncSQSConnection` class such that it crafts either a `query` or a `json` request depending on the protocol used by the SQS client. Thus, when botocore changes the default protocol of SQS to JSON, kombu won't be impacted, since it crafts its own request and, after my change, it uses a hard-coded protocol based on the crafted requests.\r\n\r\nThis solution shouldn't be the final solution, and it is more of a workaround that does the job for now. The final solution should be to completely rely on boto3 for any communication with AWS, and ensuring that all requests are async in nature (non-blocking.) This, however, is a fundamental change that requires a lot of testing, in particular performance testing.\r\n",
                "reactions": {
                    "url": "https://api.github.com/repos/celery/kombu/issues/1807/reactions",
                    "total_count": 0,
                    "+1": 0,
                    "-1": 0,
                    "laugh": 0,
                    "hooray": 0,
                    "confused": 0,
                    "heart": 0,
                    "rocket": 0,
                    "eyes": 0
                },
                "timeline_url": "https://api.github.com/repos/celery/kombu/issues/1807/timeline",
                "performed_via_github_app": null,
                "state_reason": null
            },
            "comment": {
                "url": "https://api.github.com/repos/celery/kombu/issues/comments/1775001414",
                "html_url": "https://github.com/celery/kombu/pull/1807#issuecomment-1775001414",
                "issue_url": "https://api.github.com/repos/celery/kombu/issues/1807",
                "id": 1775001414,
                "node_id": "IC_kwDOAAs5Cs5pzF9G",
                "user": {
                    "login": "auvipy",
                    "id": 6212603,
                    "node_id": "MDQ6VXNlcjYyMTI2MDM=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/6212603?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/auvipy",
                    "html_url": "https://github.com/auvipy",
                    "followers_url": "https://api.github.com/users/auvipy/followers",
                    "following_url": "https://api.github.com/users/auvipy/following{/other_user}",
                    "gists_url": "https://api.github.com/users/auvipy/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/auvipy/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/auvipy/subscriptions",
                    "organizations_url": "https://api.github.com/users/auvipy/orgs",
                    "repos_url": "https://api.github.com/users/auvipy/repos",
                    "events_url": "https://api.github.com/users/auvipy/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/auvipy/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "created_at": "2023-10-23T11:37:10Z",
                "updated_at": "2023-10-23T11:37:10Z",
                "author_association": "MEMBER",
                "body": "You are right. I fixed most of the Python 3.12 test failures but the kafka driver seems not to support python 3.12 as of yet. You can ignore this for now.",
                "reactions": {
                    "url": "https://api.github.com/repos/celery/kombu/issues/comments/1775001414/reactions",
                    "total_count": 0,
                    "+1": 0,
                    "-1": 0,
                    "laugh": 0,
                    "hooray": 0,
                    "confused": 0,
                    "heart": 0,
                    "rocket": 0,
                    "eyes": 0
                },
                "performed_via_github_app": null
            }
        },
        "public": true,
        "created_at": "2023-10-23T11:37:11Z",
        "org": {
            "id": 319983,
            "login": "celery",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/celery",
            "avatar_url": "https://avatars.githubusercontent.com/u/319983?"
        }
    },
    {
        "id": "32769185350",
        "type": "IssueCommentEvent",
        "actor": {
            "id": 442447,
            "login": "rafidka",
            "display_login": "rafidka",
            "gravatar_id": "",
            "url": "https://api.github.com/users/rafidka",
            "avatar_url": "https://avatars.githubusercontent.com/u/442447?"
        },
        "repo": {
            "id": 735498,
            "name": "celery/kombu",
            "url": "https://api.github.com/repos/celery/kombu"
        },
        "payload": {
            "action": "created",
            "issue": {
                "url": "https://api.github.com/repos/celery/kombu/issues/1807",
                "repository_url": "https://api.github.com/repos/celery/kombu",
                "labels_url": "https://api.github.com/repos/celery/kombu/issues/1807/labels{/name}",
                "comments_url": "https://api.github.com/repos/celery/kombu/issues/1807/comments",
                "events_url": "https://api.github.com/repos/celery/kombu/issues/1807/events",
                "html_url": "https://github.com/celery/kombu/pull/1807",
                "id": 1933514281,
                "node_id": "PR_kwDOAAs5Cs5cSJ4Z",
                "number": 1807,
                "title": "Use the correct protocol for SQS requests",
                "user": {
                    "login": "rafidka",
                    "id": 442447,
                    "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/rafidka",
                    "html_url": "https://github.com/rafidka",
                    "followers_url": "https://api.github.com/users/rafidka/followers",
                    "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                    "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                    "organizations_url": "https://api.github.com/users/rafidka/orgs",
                    "repos_url": "https://api.github.com/users/rafidka/repos",
                    "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/rafidka/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "labels": [],
                "state": "open",
                "locked": false,
                "assignee": null,
                "assignees": [],
                "milestone": null,
                "comments": 11,
                "created_at": "2023-10-09T17:36:06Z",
                "updated_at": "2023-10-23T11:34:40Z",
                "closed_at": null,
                "author_association": "CONTRIBUTOR",
                "active_lock_reason": null,
                "draft": false,
                "pull_request": {
                    "url": "https://api.github.com/repos/celery/kombu/pulls/1807",
                    "html_url": "https://github.com/celery/kombu/pull/1807",
                    "diff_url": "https://github.com/celery/kombu/pull/1807.diff",
                    "patch_url": "https://github.com/celery/kombu/pull/1807.patch",
                    "merged_at": null
                },
                "body": "TL;DR - The use of boto3 in #1759 resulted in relying on blocking (synchronous) HTTP requests, which caused the performance issue reported in #1783.\r\n\r\n`kombu` previously used to craft AWS requests manually as explained in detail in #1726, which resulted in an outage when botocore temporarily changed the default protocol to JSON (before rolling back due to the impact on celery and airflow.) To fix the issue, I submitted #1759, which changes `kombu` to use `boto3` instead of manually crafting AWS requests. This way when boto3 changes the default protocol, kombu won't be impacted.\r\n\r\nWhile working on #1759, I did extensive debugging to understand the multi-threading nature of kombu. What I discovered is that there isn't an actual multi-threading in the true sense of the word, but an event loop that runs on the same thread and process and orchestrate the communication with SQS. As such, it didn't appear to me that there is anything to worry about my change, and the testing I did didn't discover any issue. However, it turns out that while kombu's event loop doesn't have actual multi-threading, its [reliance on pycurl](https://github.com/celery/kombu/blob/main/kombu/asynchronous/http/curl.py#L48) (and thus libcurl) meant that the requests to AWS were being done asynchronously. On the other hand, boto3 requests are always done synchronously, i.e. they are blocking requests.\r\n\r\nThe above meant that my change introduced blocking on the event loop of kombu. This is fine in most of the cases, since the requests to SQS are pretty fast. However, in the case of using long-polling, a call to SQS's ReceiveMessage can last up to 20 seconds (depending on the user configuration).\r\n\r\nTo solve this problem, I rolled back my earlier changes and, instead, to address the issue reported in #1726, I now changed the `AsyncSQSConnection` class such that it crafts either a `query` or a `json` request depending on the protocol used by the SQS client. Thus, when botocore changes the default protocol of SQS to JSON, kombu won't be impacted, since it crafts its own request and, after my change, it uses a hard-coded protocol based on the crafted requests.\r\n\r\nThis solution shouldn't be the final solution, and it is more of a workaround that does the job for now. The final solution should be to completely rely on boto3 for any communication with AWS, and ensuring that all requests are async in nature (non-blocking.) This, however, is a fundamental change that requires a lot of testing, in particular performance testing.\r\n",
                "reactions": {
                    "url": "https://api.github.com/repos/celery/kombu/issues/1807/reactions",
                    "total_count": 0,
                    "+1": 0,
                    "-1": 0,
                    "laugh": 0,
                    "hooray": 0,
                    "confused": 0,
                    "heart": 0,
                    "rocket": 0,
                    "eyes": 0
                },
                "timeline_url": "https://api.github.com/repos/celery/kombu/issues/1807/timeline",
                "performed_via_github_app": null,
                "state_reason": null
            },
            "comment": {
                "url": "https://api.github.com/repos/celery/kombu/issues/comments/1774997582",
                "html_url": "https://github.com/celery/kombu/pull/1807#issuecomment-1774997582",
                "issue_url": "https://api.github.com/repos/celery/kombu/issues/1807",
                "id": 1774997582,
                "node_id": "IC_kwDOAAs5Cs5pzFBO",
                "user": {
                    "login": "rafidka",
                    "id": 442447,
                    "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/rafidka",
                    "html_url": "https://github.com/rafidka",
                    "followers_url": "https://api.github.com/users/rafidka/followers",
                    "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                    "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                    "organizations_url": "https://api.github.com/users/rafidka/orgs",
                    "repos_url": "https://api.github.com/users/rafidka/repos",
                    "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/rafidka/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "created_at": "2023-10-23T11:34:40Z",
                "updated_at": "2023-10-23T11:34:40Z",
                "author_association": "CONTRIBUTOR",
                "body": "@auvipy , the build is failing with the following error for Python 3.12:\r\n\r\n```\r\n=========================== short test summary info ============================\r\nERROR t/integration/test_kafka.py::test_KafkaBasicFunctionality::test_connect\r\n!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!\r\n======================== 18 warnings, 1 error in 1.01s =========================\r\n3.12-linux-integration-py-kafka: exit 1 (1.43 seconds) /home/runner/work/kombu/kombu> pytest -xv -E kafka t/integration -v pid=6605\r\n3.12-linux-integration-py-kafka: docker> remove '186dc5efa430' (from 'zookeeper')\r\n3.12-linux-integration-py-kafka: docker> remove 'dcbc798a422b' (from 'kafka')\r\n.pkg: _exit> python /opt/hostedtoolcache/Python/3.12.0/x64/lib/python3.12/site-packages/pyproject_api/_backend.py True setuptools.build_meta __legacy__\r\n.pkg: exit None (0.00 seconds) /home/runner/work/kombu/kombu> python /opt/hostedtoolcache/Python/3.12.0/x64/lib/python3.12/site-packages/pyproject_api/_backend.py True setuptools.build_meta __legacy__ pid=5315\r\n  3.12-linux-integration-py-kafka: FAIL code 1 (62.26=setup[60.83]+cmd[1.43] seconds)\r\n  evaluation failed :( (62.42 seconds)\r\n```\r\n\r\nThis doesn't seem related to my changes, so I presume Python 3.12 support is still having issues?\r\n\r\nPlease advise.",
                "reactions": {
                    "url": "https://api.github.com/repos/celery/kombu/issues/comments/1774997582/reactions",
                    "total_count": 0,
                    "+1": 0,
                    "-1": 0,
                    "laugh": 0,
                    "hooray": 0,
                    "confused": 0,
                    "heart": 0,
                    "rocket": 0,
                    "eyes": 0
                },
                "performed_via_github_app": null
            }
        },
        "public": true,
        "created_at": "2023-10-23T11:34:41Z",
        "org": {
            "id": 319983,
            "login": "celery",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/celery",
            "avatar_url": "https://avatars.githubusercontent.com/u/319983?"
        }
    },
    {
        "id": "32766464908",
        "type": "IssueCommentEvent",
        "actor": {
            "id": 442447,
            "login": "rafidka",
            "display_login": "rafidka",
            "gravatar_id": "",
            "url": "https://api.github.com/users/rafidka",
            "avatar_url": "https://avatars.githubusercontent.com/u/442447?"
        },
        "repo": {
            "id": 735498,
            "name": "celery/kombu",
            "url": "https://api.github.com/repos/celery/kombu"
        },
        "payload": {
            "action": "created",
            "issue": {
                "url": "https://api.github.com/repos/celery/kombu/issues/1807",
                "repository_url": "https://api.github.com/repos/celery/kombu",
                "labels_url": "https://api.github.com/repos/celery/kombu/issues/1807/labels{/name}",
                "comments_url": "https://api.github.com/repos/celery/kombu/issues/1807/comments",
                "events_url": "https://api.github.com/repos/celery/kombu/issues/1807/events",
                "html_url": "https://github.com/celery/kombu/pull/1807",
                "id": 1933514281,
                "node_id": "PR_kwDOAAs5Cs5cSJ4Z",
                "number": 1807,
                "title": "Use the correct protocol for SQS requests",
                "user": {
                    "login": "rafidka",
                    "id": 442447,
                    "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/rafidka",
                    "html_url": "https://github.com/rafidka",
                    "followers_url": "https://api.github.com/users/rafidka/followers",
                    "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                    "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                    "organizations_url": "https://api.github.com/users/rafidka/orgs",
                    "repos_url": "https://api.github.com/users/rafidka/repos",
                    "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/rafidka/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "labels": [],
                "state": "open",
                "locked": false,
                "assignee": null,
                "assignees": [],
                "milestone": null,
                "comments": 10,
                "created_at": "2023-10-09T17:36:06Z",
                "updated_at": "2023-10-23T09:53:07Z",
                "closed_at": null,
                "author_association": "CONTRIBUTOR",
                "active_lock_reason": null,
                "draft": false,
                "pull_request": {
                    "url": "https://api.github.com/repos/celery/kombu/pulls/1807",
                    "html_url": "https://github.com/celery/kombu/pull/1807",
                    "diff_url": "https://github.com/celery/kombu/pull/1807.diff",
                    "patch_url": "https://github.com/celery/kombu/pull/1807.patch",
                    "merged_at": null
                },
                "body": "TL;DR - The use of boto3 in #1759 resulted in relying on blocking (synchronous) HTTP requests, which caused the performance issue reported in #1783.\r\n\r\n`kombu` previously used to craft AWS requests manually as explained in detail in #1726, which resulted in an outage when botocore temporarily changed the default protocol to JSON (before rolling back due to the impact on celery and airflow.) To fix the issue, I submitted #1759, which changes `kombu` to use `boto3` instead of manually crafting AWS requests. This way when boto3 changes the default protocol, kombu won't be impacted.\r\n\r\nWhile working on #1759, I did extensive debugging to understand the multi-threading nature of kombu. What I discovered is that there isn't an actual multi-threading in the true sense of the word, but an event loop that runs on the same thread and process and orchestrate the communication with SQS. As such, it didn't appear to me that there is anything to worry about my change, and the testing I did didn't discover any issue. However, it turns out that while kombu's event loop doesn't have actual multi-threading, its [reliance on pycurl](https://github.com/celery/kombu/blob/main/kombu/asynchronous/http/curl.py#L48) (and thus libcurl) meant that the requests to AWS were being done asynchronously. On the other hand, boto3 requests are always done synchronously, i.e. they are blocking requests.\r\n\r\nThe above meant that my change introduced blocking on the event loop of kombu. This is fine in most of the cases, since the requests to SQS are pretty fast. However, in the case of using long-polling, a call to SQS's ReceiveMessage can last up to 20 seconds (depending on the user configuration).\r\n\r\nTo solve this problem, I rolled back my earlier changes and, instead, to address the issue reported in #1726, I now changed the `AsyncSQSConnection` class such that it crafts either a `query` or a `json` request depending on the protocol used by the SQS client. Thus, when botocore changes the default protocol of SQS to JSON, kombu won't be impacted, since it crafts its own request and, after my change, it uses a hard-coded protocol based on the crafted requests.\r\n\r\nThis solution shouldn't be the final solution, and it is more of a workaround that does the job for now. The final solution should be to completely rely on boto3 for any communication with AWS, and ensuring that all requests are async in nature (non-blocking.) This, however, is a fundamental change that requires a lot of testing, in particular performance testing.\r\n",
                "reactions": {
                    "url": "https://api.github.com/repos/celery/kombu/issues/1807/reactions",
                    "total_count": 0,
                    "+1": 0,
                    "-1": 0,
                    "laugh": 0,
                    "hooray": 0,
                    "confused": 0,
                    "heart": 0,
                    "rocket": 0,
                    "eyes": 0
                },
                "timeline_url": "https://api.github.com/repos/celery/kombu/issues/1807/timeline",
                "performed_via_github_app": null,
                "state_reason": null
            },
            "comment": {
                "url": "https://api.github.com/repos/celery/kombu/issues/comments/1774828924",
                "html_url": "https://github.com/celery/kombu/pull/1807#issuecomment-1774828924",
                "issue_url": "https://api.github.com/repos/celery/kombu/issues/1807",
                "id": 1774828924,
                "node_id": "IC_kwDOAAs5Cs5pyb18",
                "user": {
                    "login": "rafidka",
                    "id": 442447,
                    "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/rafidka",
                    "html_url": "https://github.com/rafidka",
                    "followers_url": "https://api.github.com/users/rafidka/followers",
                    "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                    "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                    "organizations_url": "https://api.github.com/users/rafidka/orgs",
                    "repos_url": "https://api.github.com/users/rafidka/repos",
                    "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/rafidka/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "created_at": "2023-10-23T09:53:06Z",
                "updated_at": "2023-10-23T09:53:06Z",
                "author_association": "CONTRIBUTOR",
                "body": "While at this, does Celery/Kombu have automated performance tests? In my opinion, this is important. Had Kombu had some performance tests, we wouldn't have missed the performance degradation issue following my previous PR.",
                "reactions": {
                    "url": "https://api.github.com/repos/celery/kombu/issues/comments/1774828924/reactions",
                    "total_count": 0,
                    "+1": 0,
                    "-1": 0,
                    "laugh": 0,
                    "hooray": 0,
                    "confused": 0,
                    "heart": 0,
                    "rocket": 0,
                    "eyes": 0
                },
                "performed_via_github_app": null
            }
        },
        "public": true,
        "created_at": "2023-10-23T09:53:07Z",
        "org": {
            "id": 319983,
            "login": "celery",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/celery",
            "avatar_url": "https://avatars.githubusercontent.com/u/319983?"
        }
    },
    {
        "id": "32766439911",
        "type": "IssueCommentEvent",
        "actor": {
            "id": 442447,
            "login": "rafidka",
            "display_login": "rafidka",
            "gravatar_id": "",
            "url": "https://api.github.com/users/rafidka",
            "avatar_url": "https://avatars.githubusercontent.com/u/442447?"
        },
        "repo": {
            "id": 735498,
            "name": "celery/kombu",
            "url": "https://api.github.com/repos/celery/kombu"
        },
        "payload": {
            "action": "created",
            "issue": {
                "url": "https://api.github.com/repos/celery/kombu/issues/1807",
                "repository_url": "https://api.github.com/repos/celery/kombu",
                "labels_url": "https://api.github.com/repos/celery/kombu/issues/1807/labels{/name}",
                "comments_url": "https://api.github.com/repos/celery/kombu/issues/1807/comments",
                "events_url": "https://api.github.com/repos/celery/kombu/issues/1807/events",
                "html_url": "https://github.com/celery/kombu/pull/1807",
                "id": 1933514281,
                "node_id": "PR_kwDOAAs5Cs5cSJ4Z",
                "number": 1807,
                "title": "Use the correct protocol for SQS requests",
                "user": {
                    "login": "rafidka",
                    "id": 442447,
                    "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/rafidka",
                    "html_url": "https://github.com/rafidka",
                    "followers_url": "https://api.github.com/users/rafidka/followers",
                    "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                    "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                    "organizations_url": "https://api.github.com/users/rafidka/orgs",
                    "repos_url": "https://api.github.com/users/rafidka/repos",
                    "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/rafidka/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "labels": [],
                "state": "open",
                "locked": false,
                "assignee": null,
                "assignees": [],
                "milestone": null,
                "comments": 9,
                "created_at": "2023-10-09T17:36:06Z",
                "updated_at": "2023-10-23T09:52:12Z",
                "closed_at": null,
                "author_association": "CONTRIBUTOR",
                "active_lock_reason": null,
                "draft": false,
                "pull_request": {
                    "url": "https://api.github.com/repos/celery/kombu/pulls/1807",
                    "html_url": "https://github.com/celery/kombu/pull/1807",
                    "diff_url": "https://github.com/celery/kombu/pull/1807.diff",
                    "patch_url": "https://github.com/celery/kombu/pull/1807.patch",
                    "merged_at": null
                },
                "body": "TL;DR - The use of boto3 in #1759 resulted in relying on blocking (synchronous) HTTP requests, which caused the performance issue reported in #1783.\r\n\r\n`kombu` previously used to craft AWS requests manually as explained in detail in #1726, which resulted in an outage when botocore temporarily changed the default protocol to JSON (before rolling back due to the impact on celery and airflow.) To fix the issue, I submitted #1759, which changes `kombu` to use `boto3` instead of manually crafting AWS requests. This way when boto3 changes the default protocol, kombu won't be impacted.\r\n\r\nWhile working on #1759, I did extensive debugging to understand the multi-threading nature of kombu. What I discovered is that there isn't an actual multi-threading in the true sense of the word, but an event loop that runs on the same thread and process and orchestrate the communication with SQS. As such, it didn't appear to me that there is anything to worry about my change, and the testing I did didn't discover any issue. However, it turns out that while kombu's event loop doesn't have actual multi-threading, its [reliance on pycurl](https://github.com/celery/kombu/blob/main/kombu/asynchronous/http/curl.py#L48) (and thus libcurl) meant that the requests to AWS were being done asynchronously. On the other hand, boto3 requests are always done synchronously, i.e. they are blocking requests.\r\n\r\nThe above meant that my change introduced blocking on the event loop of kombu. This is fine in most of the cases, since the requests to SQS are pretty fast. However, in the case of using long-polling, a call to SQS's ReceiveMessage can last up to 20 seconds (depending on the user configuration).\r\n\r\nTo solve this problem, I rolled back my earlier changes and, instead, to address the issue reported in #1726, I now changed the `AsyncSQSConnection` class such that it crafts either a `query` or a `json` request depending on the protocol used by the SQS client. Thus, when botocore changes the default protocol of SQS to JSON, kombu won't be impacted, since it crafts its own request and, after my change, it uses a hard-coded protocol based on the crafted requests.\r\n\r\nThis solution shouldn't be the final solution, and it is more of a workaround that does the job for now. The final solution should be to completely rely on boto3 for any communication with AWS, and ensuring that all requests are async in nature (non-blocking.) This, however, is a fundamental change that requires a lot of testing, in particular performance testing.\r\n",
                "reactions": {
                    "url": "https://api.github.com/repos/celery/kombu/issues/1807/reactions",
                    "total_count": 0,
                    "+1": 0,
                    "-1": 0,
                    "laugh": 0,
                    "hooray": 0,
                    "confused": 0,
                    "heart": 0,
                    "rocket": 0,
                    "eyes": 0
                },
                "timeline_url": "https://api.github.com/repos/celery/kombu/issues/1807/timeline",
                "performed_via_github_app": null,
                "state_reason": null
            },
            "comment": {
                "url": "https://api.github.com/repos/celery/kombu/issues/comments/1774827468",
                "html_url": "https://github.com/celery/kombu/pull/1807#issuecomment-1774827468",
                "issue_url": "https://api.github.com/repos/celery/kombu/issues/1807",
                "id": 1774827468,
                "node_id": "IC_kwDOAAs5Cs5pybfM",
                "user": {
                    "login": "rafidka",
                    "id": 442447,
                    "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/rafidka",
                    "html_url": "https://github.com/rafidka",
                    "followers_url": "https://api.github.com/users/rafidka/followers",
                    "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                    "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                    "organizations_url": "https://api.github.com/users/rafidka/orgs",
                    "repos_url": "https://api.github.com/users/rafidka/repos",
                    "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/rafidka/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "created_at": "2023-10-23T09:52:12Z",
                "updated_at": "2023-10-23T09:52:12Z",
                "author_association": "CONTRIBUTOR",
                "body": "> additional unit test coverage for the new code. and if possible Integration tests. we do not have anything exclusive for SQS right now https://github.com/celery/kombu/tree/main/t/integration\r\n\r\nI added unit tests to the PR. Integration would be a bit more difficult, since we would need to use two different versions of botocore, meaning that we will need to create virtual environments, which is gonna require some time. If you think you have some guidance to expedite working on this, then I am more than happy to give it a try.",
                "reactions": {
                    "url": "https://api.github.com/repos/celery/kombu/issues/comments/1774827468/reactions",
                    "total_count": 0,
                    "+1": 0,
                    "-1": 0,
                    "laugh": 0,
                    "hooray": 0,
                    "confused": 0,
                    "heart": 0,
                    "rocket": 0,
                    "eyes": 0
                },
                "performed_via_github_app": null
            }
        },
        "public": true,
        "created_at": "2023-10-23T09:52:13Z",
        "org": {
            "id": 319983,
            "login": "celery",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/celery",
            "avatar_url": "https://avatars.githubusercontent.com/u/319983?"
        }
    },
    {
        "id": "32766359567",
        "type": "PullRequestReviewCommentEvent",
        "actor": {
            "id": 442447,
            "login": "rafidka",
            "display_login": "rafidka",
            "gravatar_id": "",
            "url": "https://api.github.com/users/rafidka",
            "avatar_url": "https://avatars.githubusercontent.com/u/442447?"
        },
        "repo": {
            "id": 735498,
            "name": "celery/kombu",
            "url": "https://api.github.com/repos/celery/kombu"
        },
        "payload": {
            "action": "created",
            "comment": {
                "url": "https://api.github.com/repos/celery/kombu/pulls/comments/1368405965",
                "pull_request_review_id": 1692129536,
                "id": 1368405965,
                "node_id": "PRRC_kwDOAAs5Cs5RkDfN",
                "diff_hunk": "@@ -25,6 +29,76 @@ def __init__(self, sqs_connection, debug=0, region=None, **kwargs):\n             **kwargs\n         )\n \n+    def _create_query_request(self, operation, params, queue_url, method):\n+        params = params.copy()\n+        if operation:\n+            params['Action'] = operation\n+\n+        # defaults for non-get\n+        param_payload = {'data': params}\n+        if method.lower() == 'get':\n+            # query-based opts\n+            param_payload = {'params': params}\n+\n+        return AWSRequest(method=method, url=queue_url, **param_payload)\n+\n+    def _create_json_request(self, operation, params, queue_url):\n+        params = params.copy()\n+        params['QueueUrl'] = queue_url\n+\n+        service_model = self.sqs_connection.meta.service_model\n+        operation_model = service_model.operation_model(operation)\n+\n+        url = self.sqs_connection._endpoint.host\n+\n+        headers = {}\n+        # Content-Type\n+        json_version = operation_model.metadata['jsonVersion']\n+        content_type = f'application/x-amz-json-{json_version}'\n+        headers['Content-Type'] = content_type\n+\n+        # X-Amz-Target\n+        target = '{}.{}'.format(",
                "path": "kombu/asynchronous/aws/sqs/connection.py",
                "commit_id": "267028503beb03fa549ebd56d829ca7fb0c564c0",
                "original_commit_id": "9e903aa9116fa345a68897f67979a4f8a367a71c",
                "user": {
                    "login": "rafidka",
                    "id": 442447,
                    "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/rafidka",
                    "html_url": "https://github.com/rafidka",
                    "followers_url": "https://api.github.com/users/rafidka/followers",
                    "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                    "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                    "organizations_url": "https://api.github.com/users/rafidka/orgs",
                    "repos_url": "https://api.github.com/users/rafidka/repos",
                    "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/rafidka/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "To be honest, I think this is cleaner, since the placeholders would be long, making it hard to read:\r\n\r\n```\r\nf'{operation_model.metadata['targetPrefix']}.{operation_model.name}'\r\n```\r\n\r\nespecially since that it would make the line longer than 80 chars, meaning that we will need to split the line, or otherwise define variables to make it shorter.\r\n\r\nLet me know if you feel strongly about it.",
                "created_at": "2023-10-23T09:49:03Z",
                "updated_at": "2023-10-23T09:49:21Z",
                "html_url": "https://github.com/celery/kombu/pull/1807#discussion_r1368405965",
                "pull_request_url": "https://api.github.com/repos/celery/kombu/pulls/1807",
                "author_association": "CONTRIBUTOR",
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/comments/1368405965"
                    },
                    "html": {
                        "href": "https://github.com/celery/kombu/pull/1807#discussion_r1368405965"
                    },
                    "pull_request": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807"
                    }
                },
                "reactions": {
                    "url": "https://api.github.com/repos/celery/kombu/pulls/comments/1368405965/reactions",
                    "total_count": 0,
                    "+1": 0,
                    "-1": 0,
                    "laugh": 0,
                    "hooray": 0,
                    "confused": 0,
                    "heart": 0,
                    "rocket": 0,
                    "eyes": 0
                },
                "start_line": null,
                "original_start_line": null,
                "start_side": null,
                "line": 61,
                "original_line": 62,
                "side": "RIGHT",
                "in_reply_to_id": 1367881744,
                "original_position": 47,
                "position": 47,
                "subject_type": "line"
            },
            "pull_request": {
                "url": "https://api.github.com/repos/celery/kombu/pulls/1807",
                "id": 1548262937,
                "node_id": "PR_kwDOAAs5Cs5cSJ4Z",
                "html_url": "https://github.com/celery/kombu/pull/1807",
                "diff_url": "https://github.com/celery/kombu/pull/1807.diff",
                "patch_url": "https://github.com/celery/kombu/pull/1807.patch",
                "issue_url": "https://api.github.com/repos/celery/kombu/issues/1807",
                "number": 1807,
                "state": "open",
                "locked": false,
                "title": "Use the correct protocol for SQS requests",
                "user": {
                    "login": "rafidka",
                    "id": 442447,
                    "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/rafidka",
                    "html_url": "https://github.com/rafidka",
                    "followers_url": "https://api.github.com/users/rafidka/followers",
                    "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                    "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                    "organizations_url": "https://api.github.com/users/rafidka/orgs",
                    "repos_url": "https://api.github.com/users/rafidka/repos",
                    "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/rafidka/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "TL;DR - The use of boto3 in #1759 resulted in relying on blocking (synchronous) HTTP requests, which caused the performance issue reported in #1783.\r\n\r\n`kombu` previously used to craft AWS requests manually as explained in detail in #1726, which resulted in an outage when botocore temporarily changed the default protocol to JSON (before rolling back due to the impact on celery and airflow.) To fix the issue, I submitted #1759, which changes `kombu` to use `boto3` instead of manually crafting AWS requests. This way when boto3 changes the default protocol, kombu won't be impacted.\r\n\r\nWhile working on #1759, I did extensive debugging to understand the multi-threading nature of kombu. What I discovered is that there isn't an actual multi-threading in the true sense of the word, but an event loop that runs on the same thread and process and orchestrate the communication with SQS. As such, it didn't appear to me that there is anything to worry about my change, and the testing I did didn't discover any issue. However, it turns out that while kombu's event loop doesn't have actual multi-threading, its [reliance on pycurl](https://github.com/celery/kombu/blob/main/kombu/asynchronous/http/curl.py#L48) (and thus libcurl) meant that the requests to AWS were being done asynchronously. On the other hand, boto3 requests are always done synchronously, i.e. they are blocking requests.\r\n\r\nThe above meant that my change introduced blocking on the event loop of kombu. This is fine in most of the cases, since the requests to SQS are pretty fast. However, in the case of using long-polling, a call to SQS's ReceiveMessage can last up to 20 seconds (depending on the user configuration).\r\n\r\nTo solve this problem, I rolled back my earlier changes and, instead, to address the issue reported in #1726, I now changed the `AsyncSQSConnection` class such that it crafts either a `query` or a `json` request depending on the protocol used by the SQS client. Thus, when botocore changes the default protocol of SQS to JSON, kombu won't be impacted, since it crafts its own request and, after my change, it uses a hard-coded protocol based on the crafted requests.\r\n\r\nThis solution shouldn't be the final solution, and it is more of a workaround that does the job for now. The final solution should be to completely rely on boto3 for any communication with AWS, and ensuring that all requests are async in nature (non-blocking.) This, however, is a fundamental change that requires a lot of testing, in particular performance testing.\r\n",
                "created_at": "2023-10-09T17:36:06Z",
                "updated_at": "2023-10-23T09:49:21Z",
                "closed_at": null,
                "merged_at": null,
                "merge_commit_sha": "df494cfcd2ede713124133e2c426f21772dda204",
                "assignee": null,
                "assignees": [],
                "requested_reviewers": [],
                "requested_teams": [],
                "labels": [],
                "milestone": null,
                "draft": false,
                "commits_url": "https://api.github.com/repos/celery/kombu/pulls/1807/commits",
                "review_comments_url": "https://api.github.com/repos/celery/kombu/pulls/1807/comments",
                "review_comment_url": "https://api.github.com/repos/celery/kombu/pulls/comments{/number}",
                "comments_url": "https://api.github.com/repos/celery/kombu/issues/1807/comments",
                "statuses_url": "https://api.github.com/repos/celery/kombu/statuses/267028503beb03fa549ebd56d829ca7fb0c564c0",
                "head": {
                    "label": "rafidka:fix-1783",
                    "ref": "fix-1783",
                    "sha": "267028503beb03fa549ebd56d829ca7fb0c564c0",
                    "user": {
                        "login": "rafidka",
                        "id": 442447,
                        "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                        "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/rafidka",
                        "html_url": "https://github.com/rafidka",
                        "followers_url": "https://api.github.com/users/rafidka/followers",
                        "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                        "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                        "organizations_url": "https://api.github.com/users/rafidka/orgs",
                        "repos_url": "https://api.github.com/users/rafidka/repos",
                        "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/rafidka/received_events",
                        "type": "User",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 655909423,
                        "node_id": "R_kgDOJxhiLw",
                        "name": "kombu",
                        "full_name": "rafidka/kombu",
                        "private": false,
                        "owner": {
                            "login": "rafidka",
                            "id": 442447,
                            "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                            "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/rafidka",
                            "html_url": "https://github.com/rafidka",
                            "followers_url": "https://api.github.com/users/rafidka/followers",
                            "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                            "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                            "organizations_url": "https://api.github.com/users/rafidka/orgs",
                            "repos_url": "https://api.github.com/users/rafidka/repos",
                            "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/rafidka/received_events",
                            "type": "User",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/rafidka/kombu",
                        "description": "Messaging library for Python.",
                        "fork": true,
                        "url": "https://api.github.com/repos/rafidka/kombu",
                        "forks_url": "https://api.github.com/repos/rafidka/kombu/forks",
                        "keys_url": "https://api.github.com/repos/rafidka/kombu/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/rafidka/kombu/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/rafidka/kombu/teams",
                        "hooks_url": "https://api.github.com/repos/rafidka/kombu/hooks",
                        "issue_events_url": "https://api.github.com/repos/rafidka/kombu/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/rafidka/kombu/events",
                        "assignees_url": "https://api.github.com/repos/rafidka/kombu/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/rafidka/kombu/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/rafidka/kombu/tags",
                        "blobs_url": "https://api.github.com/repos/rafidka/kombu/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/rafidka/kombu/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/rafidka/kombu/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/rafidka/kombu/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/rafidka/kombu/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/rafidka/kombu/languages",
                        "stargazers_url": "https://api.github.com/repos/rafidka/kombu/stargazers",
                        "contributors_url": "https://api.github.com/repos/rafidka/kombu/contributors",
                        "subscribers_url": "https://api.github.com/repos/rafidka/kombu/subscribers",
                        "subscription_url": "https://api.github.com/repos/rafidka/kombu/subscription",
                        "commits_url": "https://api.github.com/repos/rafidka/kombu/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/rafidka/kombu/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/rafidka/kombu/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/rafidka/kombu/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/rafidka/kombu/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/rafidka/kombu/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/rafidka/kombu/merges",
                        "archive_url": "https://api.github.com/repos/rafidka/kombu/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/rafidka/kombu/downloads",
                        "issues_url": "https://api.github.com/repos/rafidka/kombu/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/rafidka/kombu/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/rafidka/kombu/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/rafidka/kombu/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/rafidka/kombu/labels{/name}",
                        "releases_url": "https://api.github.com/repos/rafidka/kombu/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/rafidka/kombu/deployments",
                        "created_at": "2023-06-19T21:48:27Z",
                        "updated_at": "2023-10-06T01:42:46Z",
                        "pushed_at": "2023-10-23T09:46:24Z",
                        "git_url": "git://github.com/rafidka/kombu.git",
                        "ssh_url": "git@github.com:rafidka/kombu.git",
                        "clone_url": "https://github.com/rafidka/kombu.git",
                        "svn_url": "https://github.com/rafidka/kombu",
                        "homepage": "http://kombu.readthedocs.org/",
                        "size": 6589,
                        "stargazers_count": 0,
                        "watchers_count": 0,
                        "language": "Python",
                        "has_issues": false,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": false,
                        "has_discussions": false,
                        "forks_count": 0,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 0,
                        "license": {
                            "key": "bsd-3-clause",
                            "name": "BSD 3-Clause \"New\" or \"Revised\" License",
                            "spdx_id": "BSD-3-Clause",
                            "url": "https://api.github.com/licenses/bsd-3-clause",
                            "node_id": "MDc6TGljZW5zZTU="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [],
                        "visibility": "public",
                        "forks": 0,
                        "open_issues": 0,
                        "watchers": 0,
                        "default_branch": "main"
                    }
                },
                "base": {
                    "label": "celery:main",
                    "ref": "main",
                    "sha": "7187021ecc9f65601c50754d0fc6ec6c5264eea1",
                    "user": {
                        "login": "celery",
                        "id": 319983,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjMxOTk4Mw==",
                        "avatar_url": "https://avatars.githubusercontent.com/u/319983?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/celery",
                        "html_url": "https://github.com/celery",
                        "followers_url": "https://api.github.com/users/celery/followers",
                        "following_url": "https://api.github.com/users/celery/following{/other_user}",
                        "gists_url": "https://api.github.com/users/celery/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/celery/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/celery/subscriptions",
                        "organizations_url": "https://api.github.com/users/celery/orgs",
                        "repos_url": "https://api.github.com/users/celery/repos",
                        "events_url": "https://api.github.com/users/celery/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/celery/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 735498,
                        "node_id": "MDEwOlJlcG9zaXRvcnk3MzU0OTg=",
                        "name": "kombu",
                        "full_name": "celery/kombu",
                        "private": false,
                        "owner": {
                            "login": "celery",
                            "id": 319983,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjMxOTk4Mw==",
                            "avatar_url": "https://avatars.githubusercontent.com/u/319983?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/celery",
                            "html_url": "https://github.com/celery",
                            "followers_url": "https://api.github.com/users/celery/followers",
                            "following_url": "https://api.github.com/users/celery/following{/other_user}",
                            "gists_url": "https://api.github.com/users/celery/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/celery/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/celery/subscriptions",
                            "organizations_url": "https://api.github.com/users/celery/orgs",
                            "repos_url": "https://api.github.com/users/celery/repos",
                            "events_url": "https://api.github.com/users/celery/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/celery/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/celery/kombu",
                        "description": "Messaging library for Python.",
                        "fork": false,
                        "url": "https://api.github.com/repos/celery/kombu",
                        "forks_url": "https://api.github.com/repos/celery/kombu/forks",
                        "keys_url": "https://api.github.com/repos/celery/kombu/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/celery/kombu/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/celery/kombu/teams",
                        "hooks_url": "https://api.github.com/repos/celery/kombu/hooks",
                        "issue_events_url": "https://api.github.com/repos/celery/kombu/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/celery/kombu/events",
                        "assignees_url": "https://api.github.com/repos/celery/kombu/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/celery/kombu/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/celery/kombu/tags",
                        "blobs_url": "https://api.github.com/repos/celery/kombu/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/celery/kombu/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/celery/kombu/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/celery/kombu/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/celery/kombu/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/celery/kombu/languages",
                        "stargazers_url": "https://api.github.com/repos/celery/kombu/stargazers",
                        "contributors_url": "https://api.github.com/repos/celery/kombu/contributors",
                        "subscribers_url": "https://api.github.com/repos/celery/kombu/subscribers",
                        "subscription_url": "https://api.github.com/repos/celery/kombu/subscription",
                        "commits_url": "https://api.github.com/repos/celery/kombu/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/celery/kombu/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/celery/kombu/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/celery/kombu/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/celery/kombu/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/celery/kombu/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/celery/kombu/merges",
                        "archive_url": "https://api.github.com/repos/celery/kombu/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/celery/kombu/downloads",
                        "issues_url": "https://api.github.com/repos/celery/kombu/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/celery/kombu/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/celery/kombu/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/celery/kombu/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/celery/kombu/labels{/name}",
                        "releases_url": "https://api.github.com/repos/celery/kombu/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/celery/kombu/deployments",
                        "created_at": "2010-06-23T10:10:24Z",
                        "updated_at": "2023-10-22T12:55:29Z",
                        "pushed_at": "2023-10-23T09:46:26Z",
                        "git_url": "git://github.com/celery/kombu.git",
                        "ssh_url": "git@github.com:celery/kombu.git",
                        "clone_url": "https://github.com/celery/kombu.git",
                        "svn_url": "https://github.com/celery/kombu",
                        "homepage": "http://kombu.readthedocs.org/",
                        "size": 8758,
                        "stargazers_count": 2628,
                        "watchers_count": 2628,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": true,
                        "forks_count": 934,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 191,
                        "license": {
                            "key": "bsd-3-clause",
                            "name": "BSD 3-Clause \"New\" or \"Revised\" License",
                            "spdx_id": "BSD-3-Clause",
                            "url": "https://api.github.com/licenses/bsd-3-clause",
                            "node_id": "MDc6TGljZW5zZTU="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "celery",
                            "kombu",
                            "message-queue",
                            "messaging",
                            "python",
                            "python-3",
                            "python-library",
                            "python3",
                            "rabbitmq",
                            "redis",
                            "sqs"
                        ],
                        "visibility": "public",
                        "forks": 934,
                        "open_issues": 191,
                        "watchers": 2628,
                        "default_branch": "main"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807"
                    },
                    "html": {
                        "href": "https://github.com/celery/kombu/pull/1807"
                    },
                    "issue": {
                        "href": "https://api.github.com/repos/celery/kombu/issues/1807"
                    },
                    "comments": {
                        "href": "https://api.github.com/repos/celery/kombu/issues/1807/comments"
                    },
                    "review_comments": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807/comments"
                    },
                    "review_comment": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/comments{/number}"
                    },
                    "commits": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807/commits"
                    },
                    "statuses": {
                        "href": "https://api.github.com/repos/celery/kombu/statuses/267028503beb03fa549ebd56d829ca7fb0c564c0"
                    }
                },
                "author_association": "CONTRIBUTOR",
                "auto_merge": null,
                "active_lock_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-23T09:49:03Z",
        "org": {
            "id": 319983,
            "login": "celery",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/celery",
            "avatar_url": "https://avatars.githubusercontent.com/u/319983?"
        }
    },
    {
        "id": "32766359560",
        "type": "PullRequestReviewCommentEvent",
        "actor": {
            "id": 442447,
            "login": "rafidka",
            "display_login": "rafidka",
            "gravatar_id": "",
            "url": "https://api.github.com/users/rafidka",
            "avatar_url": "https://avatars.githubusercontent.com/u/442447?"
        },
        "repo": {
            "id": 735498,
            "name": "celery/kombu",
            "url": "https://api.github.com/repos/celery/kombu"
        },
        "payload": {
            "action": "created",
            "comment": {
                "url": "https://api.github.com/repos/celery/kombu/pulls/comments/1368402628",
                "pull_request_review_id": 1692129536,
                "id": 1368402628,
                "node_id": "PRRC_kwDOAAs5Cs5RkCrE",
                "diff_hunk": "@@ -25,6 +29,76 @@ def __init__(self, sqs_connection, debug=0, region=None, **kwargs):\n             **kwargs\n         )\n \n+    def _create_query_request(self, operation, params, queue_url, method):\n+        params = params.copy()\n+        if operation:\n+            params['Action'] = operation\n+\n+        # defaults for non-get\n+        param_payload = {'data': params}\n+        if method.lower() == 'get':\n+            # query-based opts\n+            param_payload = {'params': params}\n+\n+        return AWSRequest(method=method, url=queue_url, **param_payload)\n+\n+    def _create_json_request(self, operation, params, queue_url):\n+        params = params.copy()\n+        params['QueueUrl'] = queue_url\n+\n+        service_model = self.sqs_connection.meta.service_model\n+        operation_model = service_model.operation_model(operation)\n+\n+        url = self.sqs_connection._endpoint.host\n+\n+        headers = {}\n+        # Content-Type\n+        json_version = operation_model.metadata['jsonVersion']\n+        content_type = f'application/x-amz-json-{json_version}'\n+        headers['Content-Type'] = content_type\n+\n+        # X-Amz-Target\n+        target = '{}.{}'.format(\n+            operation_model.metadata['targetPrefix'],\n+            operation_model.name,\n+        )\n+        headers['X-Amz-Target'] = target\n+\n+        param_payload = {\n+            'data': json.dumps(params),\n+            'headers': headers\n+        }\n+\n+        method = operation_model.http.get('method', Serializer.DEFAULT_METHOD)\n+        return AWSRequest(\n+            method=method,\n+            url=url,\n+            **param_payload\n+        )\n+\n+    def make_request(self, operation_name, params, queue_url, verb, callback=None):  # noqa\n+        signer = self.sqs_connection._request_signer\n+\n+        service_model = self.sqs_connection.meta.service_model\n+        protocol = service_model.protocol\n+",
                "path": "kombu/asynchronous/aws/sqs/connection.py",
                "commit_id": "267028503beb03fa549ebd56d829ca7fb0c564c0",
                "original_commit_id": "9e903aa9116fa345a68897f67979a4f8a367a71c",
                "user": {
                    "login": "rafidka",
                    "id": 442447,
                    "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/rafidka",
                    "html_url": "https://github.com/rafidka",
                    "followers_url": "https://api.github.com/users/rafidka/followers",
                    "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                    "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                    "organizations_url": "https://api.github.com/users/rafidka/orgs",
                    "repos_url": "https://api.github.com/users/rafidka/repos",
                    "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/rafidka/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "Added.",
                "created_at": "2023-10-23T09:46:16Z",
                "updated_at": "2023-10-23T09:49:21Z",
                "html_url": "https://github.com/celery/kombu/pull/1807#discussion_r1368402628",
                "pull_request_url": "https://api.github.com/repos/celery/kombu/pulls/1807",
                "author_association": "CONTRIBUTOR",
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/comments/1368402628"
                    },
                    "html": {
                        "href": "https://github.com/celery/kombu/pull/1807#discussion_r1368402628"
                    },
                    "pull_request": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807"
                    }
                },
                "reactions": {
                    "url": "https://api.github.com/repos/celery/kombu/pulls/comments/1368402628/reactions",
                    "total_count": 0,
                    "+1": 0,
                    "-1": 0,
                    "laugh": 0,
                    "hooray": 0,
                    "confused": 0,
                    "heart": 0,
                    "rocket": 0,
                    "eyes": 0
                },
                "start_line": null,
                "original_start_line": null,
                "start_side": null,
                "line": 92,
                "original_line": 93,
                "side": "RIGHT",
                "in_reply_to_id": 1365939212,
                "original_position": 70,
                "position": 78,
                "subject_type": "line"
            },
            "pull_request": {
                "url": "https://api.github.com/repos/celery/kombu/pulls/1807",
                "id": 1548262937,
                "node_id": "PR_kwDOAAs5Cs5cSJ4Z",
                "html_url": "https://github.com/celery/kombu/pull/1807",
                "diff_url": "https://github.com/celery/kombu/pull/1807.diff",
                "patch_url": "https://github.com/celery/kombu/pull/1807.patch",
                "issue_url": "https://api.github.com/repos/celery/kombu/issues/1807",
                "number": 1807,
                "state": "open",
                "locked": false,
                "title": "Use the correct protocol for SQS requests",
                "user": {
                    "login": "rafidka",
                    "id": 442447,
                    "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/rafidka",
                    "html_url": "https://github.com/rafidka",
                    "followers_url": "https://api.github.com/users/rafidka/followers",
                    "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                    "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                    "organizations_url": "https://api.github.com/users/rafidka/orgs",
                    "repos_url": "https://api.github.com/users/rafidka/repos",
                    "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/rafidka/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "TL;DR - The use of boto3 in #1759 resulted in relying on blocking (synchronous) HTTP requests, which caused the performance issue reported in #1783.\r\n\r\n`kombu` previously used to craft AWS requests manually as explained in detail in #1726, which resulted in an outage when botocore temporarily changed the default protocol to JSON (before rolling back due to the impact on celery and airflow.) To fix the issue, I submitted #1759, which changes `kombu` to use `boto3` instead of manually crafting AWS requests. This way when boto3 changes the default protocol, kombu won't be impacted.\r\n\r\nWhile working on #1759, I did extensive debugging to understand the multi-threading nature of kombu. What I discovered is that there isn't an actual multi-threading in the true sense of the word, but an event loop that runs on the same thread and process and orchestrate the communication with SQS. As such, it didn't appear to me that there is anything to worry about my change, and the testing I did didn't discover any issue. However, it turns out that while kombu's event loop doesn't have actual multi-threading, its [reliance on pycurl](https://github.com/celery/kombu/blob/main/kombu/asynchronous/http/curl.py#L48) (and thus libcurl) meant that the requests to AWS were being done asynchronously. On the other hand, boto3 requests are always done synchronously, i.e. they are blocking requests.\r\n\r\nThe above meant that my change introduced blocking on the event loop of kombu. This is fine in most of the cases, since the requests to SQS are pretty fast. However, in the case of using long-polling, a call to SQS's ReceiveMessage can last up to 20 seconds (depending on the user configuration).\r\n\r\nTo solve this problem, I rolled back my earlier changes and, instead, to address the issue reported in #1726, I now changed the `AsyncSQSConnection` class such that it crafts either a `query` or a `json` request depending on the protocol used by the SQS client. Thus, when botocore changes the default protocol of SQS to JSON, kombu won't be impacted, since it crafts its own request and, after my change, it uses a hard-coded protocol based on the crafted requests.\r\n\r\nThis solution shouldn't be the final solution, and it is more of a workaround that does the job for now. The final solution should be to completely rely on boto3 for any communication with AWS, and ensuring that all requests are async in nature (non-blocking.) This, however, is a fundamental change that requires a lot of testing, in particular performance testing.\r\n",
                "created_at": "2023-10-09T17:36:06Z",
                "updated_at": "2023-10-23T09:49:21Z",
                "closed_at": null,
                "merged_at": null,
                "merge_commit_sha": "df494cfcd2ede713124133e2c426f21772dda204",
                "assignee": null,
                "assignees": [],
                "requested_reviewers": [],
                "requested_teams": [],
                "labels": [],
                "milestone": null,
                "draft": false,
                "commits_url": "https://api.github.com/repos/celery/kombu/pulls/1807/commits",
                "review_comments_url": "https://api.github.com/repos/celery/kombu/pulls/1807/comments",
                "review_comment_url": "https://api.github.com/repos/celery/kombu/pulls/comments{/number}",
                "comments_url": "https://api.github.com/repos/celery/kombu/issues/1807/comments",
                "statuses_url": "https://api.github.com/repos/celery/kombu/statuses/267028503beb03fa549ebd56d829ca7fb0c564c0",
                "head": {
                    "label": "rafidka:fix-1783",
                    "ref": "fix-1783",
                    "sha": "267028503beb03fa549ebd56d829ca7fb0c564c0",
                    "user": {
                        "login": "rafidka",
                        "id": 442447,
                        "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                        "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/rafidka",
                        "html_url": "https://github.com/rafidka",
                        "followers_url": "https://api.github.com/users/rafidka/followers",
                        "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                        "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                        "organizations_url": "https://api.github.com/users/rafidka/orgs",
                        "repos_url": "https://api.github.com/users/rafidka/repos",
                        "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/rafidka/received_events",
                        "type": "User",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 655909423,
                        "node_id": "R_kgDOJxhiLw",
                        "name": "kombu",
                        "full_name": "rafidka/kombu",
                        "private": false,
                        "owner": {
                            "login": "rafidka",
                            "id": 442447,
                            "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                            "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/rafidka",
                            "html_url": "https://github.com/rafidka",
                            "followers_url": "https://api.github.com/users/rafidka/followers",
                            "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                            "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                            "organizations_url": "https://api.github.com/users/rafidka/orgs",
                            "repos_url": "https://api.github.com/users/rafidka/repos",
                            "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/rafidka/received_events",
                            "type": "User",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/rafidka/kombu",
                        "description": "Messaging library for Python.",
                        "fork": true,
                        "url": "https://api.github.com/repos/rafidka/kombu",
                        "forks_url": "https://api.github.com/repos/rafidka/kombu/forks",
                        "keys_url": "https://api.github.com/repos/rafidka/kombu/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/rafidka/kombu/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/rafidka/kombu/teams",
                        "hooks_url": "https://api.github.com/repos/rafidka/kombu/hooks",
                        "issue_events_url": "https://api.github.com/repos/rafidka/kombu/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/rafidka/kombu/events",
                        "assignees_url": "https://api.github.com/repos/rafidka/kombu/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/rafidka/kombu/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/rafidka/kombu/tags",
                        "blobs_url": "https://api.github.com/repos/rafidka/kombu/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/rafidka/kombu/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/rafidka/kombu/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/rafidka/kombu/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/rafidka/kombu/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/rafidka/kombu/languages",
                        "stargazers_url": "https://api.github.com/repos/rafidka/kombu/stargazers",
                        "contributors_url": "https://api.github.com/repos/rafidka/kombu/contributors",
                        "subscribers_url": "https://api.github.com/repos/rafidka/kombu/subscribers",
                        "subscription_url": "https://api.github.com/repos/rafidka/kombu/subscription",
                        "commits_url": "https://api.github.com/repos/rafidka/kombu/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/rafidka/kombu/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/rafidka/kombu/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/rafidka/kombu/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/rafidka/kombu/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/rafidka/kombu/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/rafidka/kombu/merges",
                        "archive_url": "https://api.github.com/repos/rafidka/kombu/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/rafidka/kombu/downloads",
                        "issues_url": "https://api.github.com/repos/rafidka/kombu/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/rafidka/kombu/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/rafidka/kombu/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/rafidka/kombu/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/rafidka/kombu/labels{/name}",
                        "releases_url": "https://api.github.com/repos/rafidka/kombu/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/rafidka/kombu/deployments",
                        "created_at": "2023-06-19T21:48:27Z",
                        "updated_at": "2023-10-06T01:42:46Z",
                        "pushed_at": "2023-10-23T09:46:24Z",
                        "git_url": "git://github.com/rafidka/kombu.git",
                        "ssh_url": "git@github.com:rafidka/kombu.git",
                        "clone_url": "https://github.com/rafidka/kombu.git",
                        "svn_url": "https://github.com/rafidka/kombu",
                        "homepage": "http://kombu.readthedocs.org/",
                        "size": 6589,
                        "stargazers_count": 0,
                        "watchers_count": 0,
                        "language": "Python",
                        "has_issues": false,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": false,
                        "has_discussions": false,
                        "forks_count": 0,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 0,
                        "license": {
                            "key": "bsd-3-clause",
                            "name": "BSD 3-Clause \"New\" or \"Revised\" License",
                            "spdx_id": "BSD-3-Clause",
                            "url": "https://api.github.com/licenses/bsd-3-clause",
                            "node_id": "MDc6TGljZW5zZTU="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [],
                        "visibility": "public",
                        "forks": 0,
                        "open_issues": 0,
                        "watchers": 0,
                        "default_branch": "main"
                    }
                },
                "base": {
                    "label": "celery:main",
                    "ref": "main",
                    "sha": "7187021ecc9f65601c50754d0fc6ec6c5264eea1",
                    "user": {
                        "login": "celery",
                        "id": 319983,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjMxOTk4Mw==",
                        "avatar_url": "https://avatars.githubusercontent.com/u/319983?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/celery",
                        "html_url": "https://github.com/celery",
                        "followers_url": "https://api.github.com/users/celery/followers",
                        "following_url": "https://api.github.com/users/celery/following{/other_user}",
                        "gists_url": "https://api.github.com/users/celery/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/celery/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/celery/subscriptions",
                        "organizations_url": "https://api.github.com/users/celery/orgs",
                        "repos_url": "https://api.github.com/users/celery/repos",
                        "events_url": "https://api.github.com/users/celery/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/celery/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 735498,
                        "node_id": "MDEwOlJlcG9zaXRvcnk3MzU0OTg=",
                        "name": "kombu",
                        "full_name": "celery/kombu",
                        "private": false,
                        "owner": {
                            "login": "celery",
                            "id": 319983,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjMxOTk4Mw==",
                            "avatar_url": "https://avatars.githubusercontent.com/u/319983?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/celery",
                            "html_url": "https://github.com/celery",
                            "followers_url": "https://api.github.com/users/celery/followers",
                            "following_url": "https://api.github.com/users/celery/following{/other_user}",
                            "gists_url": "https://api.github.com/users/celery/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/celery/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/celery/subscriptions",
                            "organizations_url": "https://api.github.com/users/celery/orgs",
                            "repos_url": "https://api.github.com/users/celery/repos",
                            "events_url": "https://api.github.com/users/celery/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/celery/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/celery/kombu",
                        "description": "Messaging library for Python.",
                        "fork": false,
                        "url": "https://api.github.com/repos/celery/kombu",
                        "forks_url": "https://api.github.com/repos/celery/kombu/forks",
                        "keys_url": "https://api.github.com/repos/celery/kombu/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/celery/kombu/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/celery/kombu/teams",
                        "hooks_url": "https://api.github.com/repos/celery/kombu/hooks",
                        "issue_events_url": "https://api.github.com/repos/celery/kombu/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/celery/kombu/events",
                        "assignees_url": "https://api.github.com/repos/celery/kombu/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/celery/kombu/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/celery/kombu/tags",
                        "blobs_url": "https://api.github.com/repos/celery/kombu/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/celery/kombu/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/celery/kombu/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/celery/kombu/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/celery/kombu/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/celery/kombu/languages",
                        "stargazers_url": "https://api.github.com/repos/celery/kombu/stargazers",
                        "contributors_url": "https://api.github.com/repos/celery/kombu/contributors",
                        "subscribers_url": "https://api.github.com/repos/celery/kombu/subscribers",
                        "subscription_url": "https://api.github.com/repos/celery/kombu/subscription",
                        "commits_url": "https://api.github.com/repos/celery/kombu/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/celery/kombu/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/celery/kombu/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/celery/kombu/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/celery/kombu/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/celery/kombu/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/celery/kombu/merges",
                        "archive_url": "https://api.github.com/repos/celery/kombu/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/celery/kombu/downloads",
                        "issues_url": "https://api.github.com/repos/celery/kombu/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/celery/kombu/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/celery/kombu/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/celery/kombu/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/celery/kombu/labels{/name}",
                        "releases_url": "https://api.github.com/repos/celery/kombu/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/celery/kombu/deployments",
                        "created_at": "2010-06-23T10:10:24Z",
                        "updated_at": "2023-10-22T12:55:29Z",
                        "pushed_at": "2023-10-23T09:46:26Z",
                        "git_url": "git://github.com/celery/kombu.git",
                        "ssh_url": "git@github.com:celery/kombu.git",
                        "clone_url": "https://github.com/celery/kombu.git",
                        "svn_url": "https://github.com/celery/kombu",
                        "homepage": "http://kombu.readthedocs.org/",
                        "size": 8758,
                        "stargazers_count": 2628,
                        "watchers_count": 2628,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": true,
                        "forks_count": 934,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 191,
                        "license": {
                            "key": "bsd-3-clause",
                            "name": "BSD 3-Clause \"New\" or \"Revised\" License",
                            "spdx_id": "BSD-3-Clause",
                            "url": "https://api.github.com/licenses/bsd-3-clause",
                            "node_id": "MDc6TGljZW5zZTU="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "celery",
                            "kombu",
                            "message-queue",
                            "messaging",
                            "python",
                            "python-3",
                            "python-library",
                            "python3",
                            "rabbitmq",
                            "redis",
                            "sqs"
                        ],
                        "visibility": "public",
                        "forks": 934,
                        "open_issues": 191,
                        "watchers": 2628,
                        "default_branch": "main"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807"
                    },
                    "html": {
                        "href": "https://github.com/celery/kombu/pull/1807"
                    },
                    "issue": {
                        "href": "https://api.github.com/repos/celery/kombu/issues/1807"
                    },
                    "comments": {
                        "href": "https://api.github.com/repos/celery/kombu/issues/1807/comments"
                    },
                    "review_comments": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807/comments"
                    },
                    "review_comment": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/comments{/number}"
                    },
                    "commits": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807/commits"
                    },
                    "statuses": {
                        "href": "https://api.github.com/repos/celery/kombu/statuses/267028503beb03fa549ebd56d829ca7fb0c564c0"
                    }
                },
                "author_association": "CONTRIBUTOR",
                "auto_merge": null,
                "active_lock_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-23T09:46:16Z",
        "org": {
            "id": 319983,
            "login": "celery",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/celery",
            "avatar_url": "https://avatars.githubusercontent.com/u/319983?"
        }
    },
    {
        "id": "32766359458",
        "type": "PullRequestReviewEvent",
        "actor": {
            "id": 442447,
            "login": "rafidka",
            "display_login": "rafidka",
            "gravatar_id": "",
            "url": "https://api.github.com/users/rafidka",
            "avatar_url": "https://avatars.githubusercontent.com/u/442447?"
        },
        "repo": {
            "id": 735498,
            "name": "celery/kombu",
            "url": "https://api.github.com/repos/celery/kombu"
        },
        "payload": {
            "action": "created",
            "review": {
                "id": 1692129536,
                "node_id": "PRR_kwDOAAs5Cs5k29kA",
                "user": {
                    "login": "rafidka",
                    "id": 442447,
                    "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/rafidka",
                    "html_url": "https://github.com/rafidka",
                    "followers_url": "https://api.github.com/users/rafidka/followers",
                    "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                    "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                    "organizations_url": "https://api.github.com/users/rafidka/orgs",
                    "repos_url": "https://api.github.com/users/rafidka/repos",
                    "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/rafidka/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "",
                "commit_id": "fc80dc2aa9eeb632f13387c2946c90c4b723e2a4",
                "submitted_at": "2023-10-23T09:49:21Z",
                "state": "commented",
                "html_url": "https://github.com/celery/kombu/pull/1807#pullrequestreview-1692129536",
                "pull_request_url": "https://api.github.com/repos/celery/kombu/pulls/1807",
                "author_association": "CONTRIBUTOR",
                "_links": {
                    "html": {
                        "href": "https://github.com/celery/kombu/pull/1807#pullrequestreview-1692129536"
                    },
                    "pull_request": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807"
                    }
                }
            },
            "pull_request": {
                "url": "https://api.github.com/repos/celery/kombu/pulls/1807",
                "id": 1548262937,
                "node_id": "PR_kwDOAAs5Cs5cSJ4Z",
                "html_url": "https://github.com/celery/kombu/pull/1807",
                "diff_url": "https://github.com/celery/kombu/pull/1807.diff",
                "patch_url": "https://github.com/celery/kombu/pull/1807.patch",
                "issue_url": "https://api.github.com/repos/celery/kombu/issues/1807",
                "number": 1807,
                "state": "open",
                "locked": false,
                "title": "Use the correct protocol for SQS requests",
                "user": {
                    "login": "rafidka",
                    "id": 442447,
                    "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/rafidka",
                    "html_url": "https://github.com/rafidka",
                    "followers_url": "https://api.github.com/users/rafidka/followers",
                    "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                    "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                    "organizations_url": "https://api.github.com/users/rafidka/orgs",
                    "repos_url": "https://api.github.com/users/rafidka/repos",
                    "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/rafidka/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "TL;DR - The use of boto3 in #1759 resulted in relying on blocking (synchronous) HTTP requests, which caused the performance issue reported in #1783.\r\n\r\n`kombu` previously used to craft AWS requests manually as explained in detail in #1726, which resulted in an outage when botocore temporarily changed the default protocol to JSON (before rolling back due to the impact on celery and airflow.) To fix the issue, I submitted #1759, which changes `kombu` to use `boto3` instead of manually crafting AWS requests. This way when boto3 changes the default protocol, kombu won't be impacted.\r\n\r\nWhile working on #1759, I did extensive debugging to understand the multi-threading nature of kombu. What I discovered is that there isn't an actual multi-threading in the true sense of the word, but an event loop that runs on the same thread and process and orchestrate the communication with SQS. As such, it didn't appear to me that there is anything to worry about my change, and the testing I did didn't discover any issue. However, it turns out that while kombu's event loop doesn't have actual multi-threading, its [reliance on pycurl](https://github.com/celery/kombu/blob/main/kombu/asynchronous/http/curl.py#L48) (and thus libcurl) meant that the requests to AWS were being done asynchronously. On the other hand, boto3 requests are always done synchronously, i.e. they are blocking requests.\r\n\r\nThe above meant that my change introduced blocking on the event loop of kombu. This is fine in most of the cases, since the requests to SQS are pretty fast. However, in the case of using long-polling, a call to SQS's ReceiveMessage can last up to 20 seconds (depending on the user configuration).\r\n\r\nTo solve this problem, I rolled back my earlier changes and, instead, to address the issue reported in #1726, I now changed the `AsyncSQSConnection` class such that it crafts either a `query` or a `json` request depending on the protocol used by the SQS client. Thus, when botocore changes the default protocol of SQS to JSON, kombu won't be impacted, since it crafts its own request and, after my change, it uses a hard-coded protocol based on the crafted requests.\r\n\r\nThis solution shouldn't be the final solution, and it is more of a workaround that does the job for now. The final solution should be to completely rely on boto3 for any communication with AWS, and ensuring that all requests are async in nature (non-blocking.) This, however, is a fundamental change that requires a lot of testing, in particular performance testing.\r\n",
                "created_at": "2023-10-09T17:36:06Z",
                "updated_at": "2023-10-23T09:49:21Z",
                "closed_at": null,
                "merged_at": null,
                "merge_commit_sha": "df494cfcd2ede713124133e2c426f21772dda204",
                "assignee": null,
                "assignees": [],
                "requested_reviewers": [],
                "requested_teams": [],
                "labels": [],
                "milestone": null,
                "draft": false,
                "commits_url": "https://api.github.com/repos/celery/kombu/pulls/1807/commits",
                "review_comments_url": "https://api.github.com/repos/celery/kombu/pulls/1807/comments",
                "review_comment_url": "https://api.github.com/repos/celery/kombu/pulls/comments{/number}",
                "comments_url": "https://api.github.com/repos/celery/kombu/issues/1807/comments",
                "statuses_url": "https://api.github.com/repos/celery/kombu/statuses/267028503beb03fa549ebd56d829ca7fb0c564c0",
                "head": {
                    "label": "rafidka:fix-1783",
                    "ref": "fix-1783",
                    "sha": "267028503beb03fa549ebd56d829ca7fb0c564c0",
                    "user": {
                        "login": "rafidka",
                        "id": 442447,
                        "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                        "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/rafidka",
                        "html_url": "https://github.com/rafidka",
                        "followers_url": "https://api.github.com/users/rafidka/followers",
                        "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                        "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                        "organizations_url": "https://api.github.com/users/rafidka/orgs",
                        "repos_url": "https://api.github.com/users/rafidka/repos",
                        "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/rafidka/received_events",
                        "type": "User",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 655909423,
                        "node_id": "R_kgDOJxhiLw",
                        "name": "kombu",
                        "full_name": "rafidka/kombu",
                        "private": false,
                        "owner": {
                            "login": "rafidka",
                            "id": 442447,
                            "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                            "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/rafidka",
                            "html_url": "https://github.com/rafidka",
                            "followers_url": "https://api.github.com/users/rafidka/followers",
                            "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                            "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                            "organizations_url": "https://api.github.com/users/rafidka/orgs",
                            "repos_url": "https://api.github.com/users/rafidka/repos",
                            "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/rafidka/received_events",
                            "type": "User",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/rafidka/kombu",
                        "description": "Messaging library for Python.",
                        "fork": true,
                        "url": "https://api.github.com/repos/rafidka/kombu",
                        "forks_url": "https://api.github.com/repos/rafidka/kombu/forks",
                        "keys_url": "https://api.github.com/repos/rafidka/kombu/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/rafidka/kombu/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/rafidka/kombu/teams",
                        "hooks_url": "https://api.github.com/repos/rafidka/kombu/hooks",
                        "issue_events_url": "https://api.github.com/repos/rafidka/kombu/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/rafidka/kombu/events",
                        "assignees_url": "https://api.github.com/repos/rafidka/kombu/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/rafidka/kombu/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/rafidka/kombu/tags",
                        "blobs_url": "https://api.github.com/repos/rafidka/kombu/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/rafidka/kombu/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/rafidka/kombu/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/rafidka/kombu/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/rafidka/kombu/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/rafidka/kombu/languages",
                        "stargazers_url": "https://api.github.com/repos/rafidka/kombu/stargazers",
                        "contributors_url": "https://api.github.com/repos/rafidka/kombu/contributors",
                        "subscribers_url": "https://api.github.com/repos/rafidka/kombu/subscribers",
                        "subscription_url": "https://api.github.com/repos/rafidka/kombu/subscription",
                        "commits_url": "https://api.github.com/repos/rafidka/kombu/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/rafidka/kombu/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/rafidka/kombu/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/rafidka/kombu/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/rafidka/kombu/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/rafidka/kombu/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/rafidka/kombu/merges",
                        "archive_url": "https://api.github.com/repos/rafidka/kombu/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/rafidka/kombu/downloads",
                        "issues_url": "https://api.github.com/repos/rafidka/kombu/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/rafidka/kombu/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/rafidka/kombu/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/rafidka/kombu/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/rafidka/kombu/labels{/name}",
                        "releases_url": "https://api.github.com/repos/rafidka/kombu/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/rafidka/kombu/deployments",
                        "created_at": "2023-06-19T21:48:27Z",
                        "updated_at": "2023-10-06T01:42:46Z",
                        "pushed_at": "2023-10-23T09:46:24Z",
                        "git_url": "git://github.com/rafidka/kombu.git",
                        "ssh_url": "git@github.com:rafidka/kombu.git",
                        "clone_url": "https://github.com/rafidka/kombu.git",
                        "svn_url": "https://github.com/rafidka/kombu",
                        "homepage": "http://kombu.readthedocs.org/",
                        "size": 6589,
                        "stargazers_count": 0,
                        "watchers_count": 0,
                        "language": "Python",
                        "has_issues": false,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": false,
                        "has_discussions": false,
                        "forks_count": 0,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 0,
                        "license": {
                            "key": "bsd-3-clause",
                            "name": "BSD 3-Clause \"New\" or \"Revised\" License",
                            "spdx_id": "BSD-3-Clause",
                            "url": "https://api.github.com/licenses/bsd-3-clause",
                            "node_id": "MDc6TGljZW5zZTU="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [],
                        "visibility": "public",
                        "forks": 0,
                        "open_issues": 0,
                        "watchers": 0,
                        "default_branch": "main"
                    }
                },
                "base": {
                    "label": "celery:main",
                    "ref": "main",
                    "sha": "7187021ecc9f65601c50754d0fc6ec6c5264eea1",
                    "user": {
                        "login": "celery",
                        "id": 319983,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjMxOTk4Mw==",
                        "avatar_url": "https://avatars.githubusercontent.com/u/319983?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/celery",
                        "html_url": "https://github.com/celery",
                        "followers_url": "https://api.github.com/users/celery/followers",
                        "following_url": "https://api.github.com/users/celery/following{/other_user}",
                        "gists_url": "https://api.github.com/users/celery/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/celery/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/celery/subscriptions",
                        "organizations_url": "https://api.github.com/users/celery/orgs",
                        "repos_url": "https://api.github.com/users/celery/repos",
                        "events_url": "https://api.github.com/users/celery/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/celery/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 735498,
                        "node_id": "MDEwOlJlcG9zaXRvcnk3MzU0OTg=",
                        "name": "kombu",
                        "full_name": "celery/kombu",
                        "private": false,
                        "owner": {
                            "login": "celery",
                            "id": 319983,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjMxOTk4Mw==",
                            "avatar_url": "https://avatars.githubusercontent.com/u/319983?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/celery",
                            "html_url": "https://github.com/celery",
                            "followers_url": "https://api.github.com/users/celery/followers",
                            "following_url": "https://api.github.com/users/celery/following{/other_user}",
                            "gists_url": "https://api.github.com/users/celery/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/celery/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/celery/subscriptions",
                            "organizations_url": "https://api.github.com/users/celery/orgs",
                            "repos_url": "https://api.github.com/users/celery/repos",
                            "events_url": "https://api.github.com/users/celery/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/celery/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/celery/kombu",
                        "description": "Messaging library for Python.",
                        "fork": false,
                        "url": "https://api.github.com/repos/celery/kombu",
                        "forks_url": "https://api.github.com/repos/celery/kombu/forks",
                        "keys_url": "https://api.github.com/repos/celery/kombu/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/celery/kombu/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/celery/kombu/teams",
                        "hooks_url": "https://api.github.com/repos/celery/kombu/hooks",
                        "issue_events_url": "https://api.github.com/repos/celery/kombu/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/celery/kombu/events",
                        "assignees_url": "https://api.github.com/repos/celery/kombu/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/celery/kombu/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/celery/kombu/tags",
                        "blobs_url": "https://api.github.com/repos/celery/kombu/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/celery/kombu/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/celery/kombu/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/celery/kombu/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/celery/kombu/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/celery/kombu/languages",
                        "stargazers_url": "https://api.github.com/repos/celery/kombu/stargazers",
                        "contributors_url": "https://api.github.com/repos/celery/kombu/contributors",
                        "subscribers_url": "https://api.github.com/repos/celery/kombu/subscribers",
                        "subscription_url": "https://api.github.com/repos/celery/kombu/subscription",
                        "commits_url": "https://api.github.com/repos/celery/kombu/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/celery/kombu/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/celery/kombu/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/celery/kombu/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/celery/kombu/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/celery/kombu/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/celery/kombu/merges",
                        "archive_url": "https://api.github.com/repos/celery/kombu/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/celery/kombu/downloads",
                        "issues_url": "https://api.github.com/repos/celery/kombu/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/celery/kombu/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/celery/kombu/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/celery/kombu/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/celery/kombu/labels{/name}",
                        "releases_url": "https://api.github.com/repos/celery/kombu/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/celery/kombu/deployments",
                        "created_at": "2010-06-23T10:10:24Z",
                        "updated_at": "2023-10-22T12:55:29Z",
                        "pushed_at": "2023-10-23T09:46:26Z",
                        "git_url": "git://github.com/celery/kombu.git",
                        "ssh_url": "git@github.com:celery/kombu.git",
                        "clone_url": "https://github.com/celery/kombu.git",
                        "svn_url": "https://github.com/celery/kombu",
                        "homepage": "http://kombu.readthedocs.org/",
                        "size": 8758,
                        "stargazers_count": 2628,
                        "watchers_count": 2628,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": true,
                        "forks_count": 934,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 191,
                        "license": {
                            "key": "bsd-3-clause",
                            "name": "BSD 3-Clause \"New\" or \"Revised\" License",
                            "spdx_id": "BSD-3-Clause",
                            "url": "https://api.github.com/licenses/bsd-3-clause",
                            "node_id": "MDc6TGljZW5zZTU="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "celery",
                            "kombu",
                            "message-queue",
                            "messaging",
                            "python",
                            "python-3",
                            "python-library",
                            "python3",
                            "rabbitmq",
                            "redis",
                            "sqs"
                        ],
                        "visibility": "public",
                        "forks": 934,
                        "open_issues": 191,
                        "watchers": 2628,
                        "default_branch": "main"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807"
                    },
                    "html": {
                        "href": "https://github.com/celery/kombu/pull/1807"
                    },
                    "issue": {
                        "href": "https://api.github.com/repos/celery/kombu/issues/1807"
                    },
                    "comments": {
                        "href": "https://api.github.com/repos/celery/kombu/issues/1807/comments"
                    },
                    "review_comments": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807/comments"
                    },
                    "review_comment": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/comments{/number}"
                    },
                    "commits": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807/commits"
                    },
                    "statuses": {
                        "href": "https://api.github.com/repos/celery/kombu/statuses/267028503beb03fa549ebd56d829ca7fb0c564c0"
                    }
                },
                "author_association": "CONTRIBUTOR",
                "auto_merge": null,
                "active_lock_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-23T09:49:22Z",
        "org": {
            "id": 319983,
            "login": "celery",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/celery",
            "avatar_url": "https://avatars.githubusercontent.com/u/319983?"
        }
    },
    {
        "id": "32766359358",
        "type": "PullRequestReviewEvent",
        "actor": {
            "id": 442447,
            "login": "rafidka",
            "display_login": "rafidka",
            "gravatar_id": "",
            "url": "https://api.github.com/users/rafidka",
            "avatar_url": "https://avatars.githubusercontent.com/u/442447?"
        },
        "repo": {
            "id": 735498,
            "name": "celery/kombu",
            "url": "https://api.github.com/repos/celery/kombu"
        },
        "payload": {
            "action": "created",
            "review": {
                "id": 1692129536,
                "node_id": "PRR_kwDOAAs5Cs5k29kA",
                "user": {
                    "login": "rafidka",
                    "id": 442447,
                    "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/rafidka",
                    "html_url": "https://github.com/rafidka",
                    "followers_url": "https://api.github.com/users/rafidka/followers",
                    "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                    "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                    "organizations_url": "https://api.github.com/users/rafidka/orgs",
                    "repos_url": "https://api.github.com/users/rafidka/repos",
                    "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/rafidka/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "",
                "commit_id": "fc80dc2aa9eeb632f13387c2946c90c4b723e2a4",
                "submitted_at": "2023-10-23T09:49:21Z",
                "state": "commented",
                "html_url": "https://github.com/celery/kombu/pull/1807#pullrequestreview-1692129536",
                "pull_request_url": "https://api.github.com/repos/celery/kombu/pulls/1807",
                "author_association": "CONTRIBUTOR",
                "_links": {
                    "html": {
                        "href": "https://github.com/celery/kombu/pull/1807#pullrequestreview-1692129536"
                    },
                    "pull_request": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807"
                    }
                }
            },
            "pull_request": {
                "url": "https://api.github.com/repos/celery/kombu/pulls/1807",
                "id": 1548262937,
                "node_id": "PR_kwDOAAs5Cs5cSJ4Z",
                "html_url": "https://github.com/celery/kombu/pull/1807",
                "diff_url": "https://github.com/celery/kombu/pull/1807.diff",
                "patch_url": "https://github.com/celery/kombu/pull/1807.patch",
                "issue_url": "https://api.github.com/repos/celery/kombu/issues/1807",
                "number": 1807,
                "state": "open",
                "locked": false,
                "title": "Use the correct protocol for SQS requests",
                "user": {
                    "login": "rafidka",
                    "id": 442447,
                    "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/rafidka",
                    "html_url": "https://github.com/rafidka",
                    "followers_url": "https://api.github.com/users/rafidka/followers",
                    "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                    "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                    "organizations_url": "https://api.github.com/users/rafidka/orgs",
                    "repos_url": "https://api.github.com/users/rafidka/repos",
                    "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/rafidka/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "TL;DR - The use of boto3 in #1759 resulted in relying on blocking (synchronous) HTTP requests, which caused the performance issue reported in #1783.\r\n\r\n`kombu` previously used to craft AWS requests manually as explained in detail in #1726, which resulted in an outage when botocore temporarily changed the default protocol to JSON (before rolling back due to the impact on celery and airflow.) To fix the issue, I submitted #1759, which changes `kombu` to use `boto3` instead of manually crafting AWS requests. This way when boto3 changes the default protocol, kombu won't be impacted.\r\n\r\nWhile working on #1759, I did extensive debugging to understand the multi-threading nature of kombu. What I discovered is that there isn't an actual multi-threading in the true sense of the word, but an event loop that runs on the same thread and process and orchestrate the communication with SQS. As such, it didn't appear to me that there is anything to worry about my change, and the testing I did didn't discover any issue. However, it turns out that while kombu's event loop doesn't have actual multi-threading, its [reliance on pycurl](https://github.com/celery/kombu/blob/main/kombu/asynchronous/http/curl.py#L48) (and thus libcurl) meant that the requests to AWS were being done asynchronously. On the other hand, boto3 requests are always done synchronously, i.e. they are blocking requests.\r\n\r\nThe above meant that my change introduced blocking on the event loop of kombu. This is fine in most of the cases, since the requests to SQS are pretty fast. However, in the case of using long-polling, a call to SQS's ReceiveMessage can last up to 20 seconds (depending on the user configuration).\r\n\r\nTo solve this problem, I rolled back my earlier changes and, instead, to address the issue reported in #1726, I now changed the `AsyncSQSConnection` class such that it crafts either a `query` or a `json` request depending on the protocol used by the SQS client. Thus, when botocore changes the default protocol of SQS to JSON, kombu won't be impacted, since it crafts its own request and, after my change, it uses a hard-coded protocol based on the crafted requests.\r\n\r\nThis solution shouldn't be the final solution, and it is more of a workaround that does the job for now. The final solution should be to completely rely on boto3 for any communication with AWS, and ensuring that all requests are async in nature (non-blocking.) This, however, is a fundamental change that requires a lot of testing, in particular performance testing.\r\n",
                "created_at": "2023-10-09T17:36:06Z",
                "updated_at": "2023-10-23T09:49:21Z",
                "closed_at": null,
                "merged_at": null,
                "merge_commit_sha": "df494cfcd2ede713124133e2c426f21772dda204",
                "assignee": null,
                "assignees": [],
                "requested_reviewers": [],
                "requested_teams": [],
                "labels": [],
                "milestone": null,
                "draft": false,
                "commits_url": "https://api.github.com/repos/celery/kombu/pulls/1807/commits",
                "review_comments_url": "https://api.github.com/repos/celery/kombu/pulls/1807/comments",
                "review_comment_url": "https://api.github.com/repos/celery/kombu/pulls/comments{/number}",
                "comments_url": "https://api.github.com/repos/celery/kombu/issues/1807/comments",
                "statuses_url": "https://api.github.com/repos/celery/kombu/statuses/267028503beb03fa549ebd56d829ca7fb0c564c0",
                "head": {
                    "label": "rafidka:fix-1783",
                    "ref": "fix-1783",
                    "sha": "267028503beb03fa549ebd56d829ca7fb0c564c0",
                    "user": {
                        "login": "rafidka",
                        "id": 442447,
                        "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                        "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/rafidka",
                        "html_url": "https://github.com/rafidka",
                        "followers_url": "https://api.github.com/users/rafidka/followers",
                        "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                        "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                        "organizations_url": "https://api.github.com/users/rafidka/orgs",
                        "repos_url": "https://api.github.com/users/rafidka/repos",
                        "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/rafidka/received_events",
                        "type": "User",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 655909423,
                        "node_id": "R_kgDOJxhiLw",
                        "name": "kombu",
                        "full_name": "rafidka/kombu",
                        "private": false,
                        "owner": {
                            "login": "rafidka",
                            "id": 442447,
                            "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                            "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/rafidka",
                            "html_url": "https://github.com/rafidka",
                            "followers_url": "https://api.github.com/users/rafidka/followers",
                            "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                            "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                            "organizations_url": "https://api.github.com/users/rafidka/orgs",
                            "repos_url": "https://api.github.com/users/rafidka/repos",
                            "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/rafidka/received_events",
                            "type": "User",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/rafidka/kombu",
                        "description": "Messaging library for Python.",
                        "fork": true,
                        "url": "https://api.github.com/repos/rafidka/kombu",
                        "forks_url": "https://api.github.com/repos/rafidka/kombu/forks",
                        "keys_url": "https://api.github.com/repos/rafidka/kombu/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/rafidka/kombu/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/rafidka/kombu/teams",
                        "hooks_url": "https://api.github.com/repos/rafidka/kombu/hooks",
                        "issue_events_url": "https://api.github.com/repos/rafidka/kombu/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/rafidka/kombu/events",
                        "assignees_url": "https://api.github.com/repos/rafidka/kombu/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/rafidka/kombu/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/rafidka/kombu/tags",
                        "blobs_url": "https://api.github.com/repos/rafidka/kombu/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/rafidka/kombu/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/rafidka/kombu/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/rafidka/kombu/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/rafidka/kombu/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/rafidka/kombu/languages",
                        "stargazers_url": "https://api.github.com/repos/rafidka/kombu/stargazers",
                        "contributors_url": "https://api.github.com/repos/rafidka/kombu/contributors",
                        "subscribers_url": "https://api.github.com/repos/rafidka/kombu/subscribers",
                        "subscription_url": "https://api.github.com/repos/rafidka/kombu/subscription",
                        "commits_url": "https://api.github.com/repos/rafidka/kombu/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/rafidka/kombu/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/rafidka/kombu/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/rafidka/kombu/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/rafidka/kombu/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/rafidka/kombu/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/rafidka/kombu/merges",
                        "archive_url": "https://api.github.com/repos/rafidka/kombu/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/rafidka/kombu/downloads",
                        "issues_url": "https://api.github.com/repos/rafidka/kombu/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/rafidka/kombu/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/rafidka/kombu/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/rafidka/kombu/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/rafidka/kombu/labels{/name}",
                        "releases_url": "https://api.github.com/repos/rafidka/kombu/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/rafidka/kombu/deployments",
                        "created_at": "2023-06-19T21:48:27Z",
                        "updated_at": "2023-10-06T01:42:46Z",
                        "pushed_at": "2023-10-23T09:46:24Z",
                        "git_url": "git://github.com/rafidka/kombu.git",
                        "ssh_url": "git@github.com:rafidka/kombu.git",
                        "clone_url": "https://github.com/rafidka/kombu.git",
                        "svn_url": "https://github.com/rafidka/kombu",
                        "homepage": "http://kombu.readthedocs.org/",
                        "size": 6589,
                        "stargazers_count": 0,
                        "watchers_count": 0,
                        "language": "Python",
                        "has_issues": false,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": false,
                        "has_discussions": false,
                        "forks_count": 0,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 0,
                        "license": {
                            "key": "bsd-3-clause",
                            "name": "BSD 3-Clause \"New\" or \"Revised\" License",
                            "spdx_id": "BSD-3-Clause",
                            "url": "https://api.github.com/licenses/bsd-3-clause",
                            "node_id": "MDc6TGljZW5zZTU="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [],
                        "visibility": "public",
                        "forks": 0,
                        "open_issues": 0,
                        "watchers": 0,
                        "default_branch": "main"
                    }
                },
                "base": {
                    "label": "celery:main",
                    "ref": "main",
                    "sha": "7187021ecc9f65601c50754d0fc6ec6c5264eea1",
                    "user": {
                        "login": "celery",
                        "id": 319983,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjMxOTk4Mw==",
                        "avatar_url": "https://avatars.githubusercontent.com/u/319983?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/celery",
                        "html_url": "https://github.com/celery",
                        "followers_url": "https://api.github.com/users/celery/followers",
                        "following_url": "https://api.github.com/users/celery/following{/other_user}",
                        "gists_url": "https://api.github.com/users/celery/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/celery/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/celery/subscriptions",
                        "organizations_url": "https://api.github.com/users/celery/orgs",
                        "repos_url": "https://api.github.com/users/celery/repos",
                        "events_url": "https://api.github.com/users/celery/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/celery/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 735498,
                        "node_id": "MDEwOlJlcG9zaXRvcnk3MzU0OTg=",
                        "name": "kombu",
                        "full_name": "celery/kombu",
                        "private": false,
                        "owner": {
                            "login": "celery",
                            "id": 319983,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjMxOTk4Mw==",
                            "avatar_url": "https://avatars.githubusercontent.com/u/319983?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/celery",
                            "html_url": "https://github.com/celery",
                            "followers_url": "https://api.github.com/users/celery/followers",
                            "following_url": "https://api.github.com/users/celery/following{/other_user}",
                            "gists_url": "https://api.github.com/users/celery/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/celery/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/celery/subscriptions",
                            "organizations_url": "https://api.github.com/users/celery/orgs",
                            "repos_url": "https://api.github.com/users/celery/repos",
                            "events_url": "https://api.github.com/users/celery/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/celery/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/celery/kombu",
                        "description": "Messaging library for Python.",
                        "fork": false,
                        "url": "https://api.github.com/repos/celery/kombu",
                        "forks_url": "https://api.github.com/repos/celery/kombu/forks",
                        "keys_url": "https://api.github.com/repos/celery/kombu/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/celery/kombu/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/celery/kombu/teams",
                        "hooks_url": "https://api.github.com/repos/celery/kombu/hooks",
                        "issue_events_url": "https://api.github.com/repos/celery/kombu/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/celery/kombu/events",
                        "assignees_url": "https://api.github.com/repos/celery/kombu/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/celery/kombu/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/celery/kombu/tags",
                        "blobs_url": "https://api.github.com/repos/celery/kombu/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/celery/kombu/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/celery/kombu/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/celery/kombu/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/celery/kombu/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/celery/kombu/languages",
                        "stargazers_url": "https://api.github.com/repos/celery/kombu/stargazers",
                        "contributors_url": "https://api.github.com/repos/celery/kombu/contributors",
                        "subscribers_url": "https://api.github.com/repos/celery/kombu/subscribers",
                        "subscription_url": "https://api.github.com/repos/celery/kombu/subscription",
                        "commits_url": "https://api.github.com/repos/celery/kombu/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/celery/kombu/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/celery/kombu/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/celery/kombu/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/celery/kombu/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/celery/kombu/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/celery/kombu/merges",
                        "archive_url": "https://api.github.com/repos/celery/kombu/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/celery/kombu/downloads",
                        "issues_url": "https://api.github.com/repos/celery/kombu/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/celery/kombu/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/celery/kombu/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/celery/kombu/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/celery/kombu/labels{/name}",
                        "releases_url": "https://api.github.com/repos/celery/kombu/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/celery/kombu/deployments",
                        "created_at": "2010-06-23T10:10:24Z",
                        "updated_at": "2023-10-22T12:55:29Z",
                        "pushed_at": "2023-10-23T09:46:26Z",
                        "git_url": "git://github.com/celery/kombu.git",
                        "ssh_url": "git@github.com:celery/kombu.git",
                        "clone_url": "https://github.com/celery/kombu.git",
                        "svn_url": "https://github.com/celery/kombu",
                        "homepage": "http://kombu.readthedocs.org/",
                        "size": 8758,
                        "stargazers_count": 2628,
                        "watchers_count": 2628,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": true,
                        "forks_count": 934,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 191,
                        "license": {
                            "key": "bsd-3-clause",
                            "name": "BSD 3-Clause \"New\" or \"Revised\" License",
                            "spdx_id": "BSD-3-Clause",
                            "url": "https://api.github.com/licenses/bsd-3-clause",
                            "node_id": "MDc6TGljZW5zZTU="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "celery",
                            "kombu",
                            "message-queue",
                            "messaging",
                            "python",
                            "python-3",
                            "python-library",
                            "python3",
                            "rabbitmq",
                            "redis",
                            "sqs"
                        ],
                        "visibility": "public",
                        "forks": 934,
                        "open_issues": 191,
                        "watchers": 2628,
                        "default_branch": "main"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807"
                    },
                    "html": {
                        "href": "https://github.com/celery/kombu/pull/1807"
                    },
                    "issue": {
                        "href": "https://api.github.com/repos/celery/kombu/issues/1807"
                    },
                    "comments": {
                        "href": "https://api.github.com/repos/celery/kombu/issues/1807/comments"
                    },
                    "review_comments": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807/comments"
                    },
                    "review_comment": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/comments{/number}"
                    },
                    "commits": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807/commits"
                    },
                    "statuses": {
                        "href": "https://api.github.com/repos/celery/kombu/statuses/267028503beb03fa549ebd56d829ca7fb0c564c0"
                    }
                },
                "author_association": "CONTRIBUTOR",
                "auto_merge": null,
                "active_lock_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-23T09:49:22Z",
        "org": {
            "id": 319983,
            "login": "celery",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/celery",
            "avatar_url": "https://avatars.githubusercontent.com/u/319983?"
        }
    },
    {
        "id": "32750190370",
        "type": "PullRequestReviewEvent",
        "actor": {
            "id": 6212603,
            "login": "auvipy",
            "display_login": "auvipy",
            "gravatar_id": "",
            "url": "https://api.github.com/users/auvipy",
            "avatar_url": "https://avatars.githubusercontent.com/u/6212603?"
        },
        "repo": {
            "id": 735498,
            "name": "celery/kombu",
            "url": "https://api.github.com/repos/celery/kombu"
        },
        "payload": {
            "action": "created",
            "review": {
                "id": 1691411657,
                "node_id": "PRR_kwDOAAs5Cs5k0OTJ",
                "user": {
                    "login": "auvipy",
                    "id": 6212603,
                    "node_id": "MDQ6VXNlcjYyMTI2MDM=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/6212603?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/auvipy",
                    "html_url": "https://github.com/auvipy",
                    "followers_url": "https://api.github.com/users/auvipy/followers",
                    "following_url": "https://api.github.com/users/auvipy/following{/other_user}",
                    "gists_url": "https://api.github.com/users/auvipy/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/auvipy/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/auvipy/subscriptions",
                    "organizations_url": "https://api.github.com/users/auvipy/orgs",
                    "repos_url": "https://api.github.com/users/auvipy/repos",
                    "events_url": "https://api.github.com/users/auvipy/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/auvipy/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "additional unit test coverage for the new code. and if possible Integration tests. we do not have anything exclusive for SQS right now https://github.com/celery/kombu/tree/main/t/integration",
                "commit_id": "9e903aa9116fa345a68897f67979a4f8a367a71c",
                "submitted_at": "2023-10-22T10:48:29Z",
                "state": "changes_requested",
                "html_url": "https://github.com/celery/kombu/pull/1807#pullrequestreview-1691411657",
                "pull_request_url": "https://api.github.com/repos/celery/kombu/pulls/1807",
                "author_association": "MEMBER",
                "_links": {
                    "html": {
                        "href": "https://github.com/celery/kombu/pull/1807#pullrequestreview-1691411657"
                    },
                    "pull_request": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807"
                    }
                }
            },
            "pull_request": {
                "url": "https://api.github.com/repos/celery/kombu/pulls/1807",
                "id": 1548262937,
                "node_id": "PR_kwDOAAs5Cs5cSJ4Z",
                "html_url": "https://github.com/celery/kombu/pull/1807",
                "diff_url": "https://github.com/celery/kombu/pull/1807.diff",
                "patch_url": "https://github.com/celery/kombu/pull/1807.patch",
                "issue_url": "https://api.github.com/repos/celery/kombu/issues/1807",
                "number": 1807,
                "state": "open",
                "locked": false,
                "title": "[WIP] Use the correct protocol for SQS requests",
                "user": {
                    "login": "rafidka",
                    "id": 442447,
                    "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/rafidka",
                    "html_url": "https://github.com/rafidka",
                    "followers_url": "https://api.github.com/users/rafidka/followers",
                    "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                    "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                    "organizations_url": "https://api.github.com/users/rafidka/orgs",
                    "repos_url": "https://api.github.com/users/rafidka/repos",
                    "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/rafidka/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "TL;DR - The use of boto3 in #1759 resulted in relying on blocking (synchronous) HTTP requests, which caused the performance issue reported in #1783.\r\n\r\n`kombu` previously used to craft AWS requests manually as explained in detail in #1726, which resulted in an outage when botocore temporarily changed the default protocol to JSON (before rolling back due to the impact on celery and airflow.) To fix the issue, I submitted #1759, which changes `kombu` to use `boto3` instead of manually crafting AWS requests. This way when boto3 changes the default protocol, kombu won't be impacted.\r\n\r\nWhile working on #1759, I did extensive debugging to understand the multi-threading nature of kombu. What I discovered is that there isn't an actual multi-threading in the true sense of the word, but an event loop that runs on the same thread and process and orchestrate the communication with SQS. As such, it didn't appear to me that there is anything to worry about my change, and the testing I did didn't discover any issue. However, it turns out that while kombu's event loop doesn't have actual multi-threading, its [reliance on pycurl](https://github.com/celery/kombu/blob/main/kombu/asynchronous/http/curl.py#L48) (and thus libcurl) meant that the requests to AWS were being done asynchronously. On the other hand, boto3 requests are always done synchronously, i.e. they are blocking requests.\r\n\r\nThe above meant that my change introduced blocking on the event loop of kombu. This is fine in most of the cases, since the requests to SQS are pretty fast. However, in the case of using long-polling, a call to SQS's ReceiveMessage can last up to 20 seconds (depending on the user configuration).\r\n\r\nTo solve this problem, I rolled back my earlier changes and, instead, to address the issue reported in #1726, I now changed the `AsyncSQSConnection` class such that it crafts either a `query` or a `json` request depending on the protocol used by the SQS client. Thus, when botocore changes the default protocol of SQS to JSON, kombu won't be impacted, since it crafts its own request and, after my change, it uses a hard-coded protocol based on the crafted requests.\r\n\r\nThis solution shouldn't be the final solution, and it is more of a workaround that does the job for now. The final solution should be to completely rely on boto3 for any communication with AWS, and ensuring that all requests are async in nature (non-blocking.) This, however, is a fundamental change that requires a lot of testing, in particular performance testing.\r\n",
                "created_at": "2023-10-09T17:36:06Z",
                "updated_at": "2023-10-22T10:51:09Z",
                "closed_at": null,
                "merged_at": null,
                "merge_commit_sha": "f6243abe6fb30d7a7b5dfa592e36d02bc35987f3",
                "assignee": null,
                "assignees": [],
                "requested_reviewers": [],
                "requested_teams": [],
                "labels": [],
                "milestone": null,
                "draft": false,
                "commits_url": "https://api.github.com/repos/celery/kombu/pulls/1807/commits",
                "review_comments_url": "https://api.github.com/repos/celery/kombu/pulls/1807/comments",
                "review_comment_url": "https://api.github.com/repos/celery/kombu/pulls/comments{/number}",
                "comments_url": "https://api.github.com/repos/celery/kombu/issues/1807/comments",
                "statuses_url": "https://api.github.com/repos/celery/kombu/statuses/9e903aa9116fa345a68897f67979a4f8a367a71c",
                "head": {
                    "label": "rafidka:fix-1783",
                    "ref": "fix-1783",
                    "sha": "9e903aa9116fa345a68897f67979a4f8a367a71c",
                    "user": {
                        "login": "rafidka",
                        "id": 442447,
                        "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                        "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/rafidka",
                        "html_url": "https://github.com/rafidka",
                        "followers_url": "https://api.github.com/users/rafidka/followers",
                        "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                        "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                        "organizations_url": "https://api.github.com/users/rafidka/orgs",
                        "repos_url": "https://api.github.com/users/rafidka/repos",
                        "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/rafidka/received_events",
                        "type": "User",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 655909423,
                        "node_id": "R_kgDOJxhiLw",
                        "name": "kombu",
                        "full_name": "rafidka/kombu",
                        "private": false,
                        "owner": {
                            "login": "rafidka",
                            "id": 442447,
                            "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                            "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/rafidka",
                            "html_url": "https://github.com/rafidka",
                            "followers_url": "https://api.github.com/users/rafidka/followers",
                            "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                            "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                            "organizations_url": "https://api.github.com/users/rafidka/orgs",
                            "repos_url": "https://api.github.com/users/rafidka/repos",
                            "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/rafidka/received_events",
                            "type": "User",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/rafidka/kombu",
                        "description": "Messaging library for Python.",
                        "fork": true,
                        "url": "https://api.github.com/repos/rafidka/kombu",
                        "forks_url": "https://api.github.com/repos/rafidka/kombu/forks",
                        "keys_url": "https://api.github.com/repos/rafidka/kombu/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/rafidka/kombu/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/rafidka/kombu/teams",
                        "hooks_url": "https://api.github.com/repos/rafidka/kombu/hooks",
                        "issue_events_url": "https://api.github.com/repos/rafidka/kombu/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/rafidka/kombu/events",
                        "assignees_url": "https://api.github.com/repos/rafidka/kombu/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/rafidka/kombu/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/rafidka/kombu/tags",
                        "blobs_url": "https://api.github.com/repos/rafidka/kombu/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/rafidka/kombu/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/rafidka/kombu/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/rafidka/kombu/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/rafidka/kombu/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/rafidka/kombu/languages",
                        "stargazers_url": "https://api.github.com/repos/rafidka/kombu/stargazers",
                        "contributors_url": "https://api.github.com/repos/rafidka/kombu/contributors",
                        "subscribers_url": "https://api.github.com/repos/rafidka/kombu/subscribers",
                        "subscription_url": "https://api.github.com/repos/rafidka/kombu/subscription",
                        "commits_url": "https://api.github.com/repos/rafidka/kombu/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/rafidka/kombu/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/rafidka/kombu/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/rafidka/kombu/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/rafidka/kombu/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/rafidka/kombu/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/rafidka/kombu/merges",
                        "archive_url": "https://api.github.com/repos/rafidka/kombu/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/rafidka/kombu/downloads",
                        "issues_url": "https://api.github.com/repos/rafidka/kombu/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/rafidka/kombu/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/rafidka/kombu/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/rafidka/kombu/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/rafidka/kombu/labels{/name}",
                        "releases_url": "https://api.github.com/repos/rafidka/kombu/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/rafidka/kombu/deployments",
                        "created_at": "2023-06-19T21:48:27Z",
                        "updated_at": "2023-10-06T01:42:46Z",
                        "pushed_at": "2023-10-17T14:10:46Z",
                        "git_url": "git://github.com/rafidka/kombu.git",
                        "ssh_url": "git@github.com:rafidka/kombu.git",
                        "clone_url": "https://github.com/rafidka/kombu.git",
                        "svn_url": "https://github.com/rafidka/kombu",
                        "homepage": "http://kombu.readthedocs.org/",
                        "size": 6589,
                        "stargazers_count": 0,
                        "watchers_count": 0,
                        "language": "Python",
                        "has_issues": false,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": false,
                        "has_discussions": false,
                        "forks_count": 0,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 0,
                        "license": {
                            "key": "bsd-3-clause",
                            "name": "BSD 3-Clause \"New\" or \"Revised\" License",
                            "spdx_id": "BSD-3-Clause",
                            "url": "https://api.github.com/licenses/bsd-3-clause",
                            "node_id": "MDc6TGljZW5zZTU="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [],
                        "visibility": "public",
                        "forks": 0,
                        "open_issues": 0,
                        "watchers": 0,
                        "default_branch": "main"
                    }
                },
                "base": {
                    "label": "celery:main",
                    "ref": "main",
                    "sha": "1dfe4f3c86ab0fd2587a6fe8566bb3cef8c4a5d7",
                    "user": {
                        "login": "celery",
                        "id": 319983,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjMxOTk4Mw==",
                        "avatar_url": "https://avatars.githubusercontent.com/u/319983?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/celery",
                        "html_url": "https://github.com/celery",
                        "followers_url": "https://api.github.com/users/celery/followers",
                        "following_url": "https://api.github.com/users/celery/following{/other_user}",
                        "gists_url": "https://api.github.com/users/celery/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/celery/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/celery/subscriptions",
                        "organizations_url": "https://api.github.com/users/celery/orgs",
                        "repos_url": "https://api.github.com/users/celery/repos",
                        "events_url": "https://api.github.com/users/celery/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/celery/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 735498,
                        "node_id": "MDEwOlJlcG9zaXRvcnk3MzU0OTg=",
                        "name": "kombu",
                        "full_name": "celery/kombu",
                        "private": false,
                        "owner": {
                            "login": "celery",
                            "id": 319983,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjMxOTk4Mw==",
                            "avatar_url": "https://avatars.githubusercontent.com/u/319983?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/celery",
                            "html_url": "https://github.com/celery",
                            "followers_url": "https://api.github.com/users/celery/followers",
                            "following_url": "https://api.github.com/users/celery/following{/other_user}",
                            "gists_url": "https://api.github.com/users/celery/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/celery/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/celery/subscriptions",
                            "organizations_url": "https://api.github.com/users/celery/orgs",
                            "repos_url": "https://api.github.com/users/celery/repos",
                            "events_url": "https://api.github.com/users/celery/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/celery/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/celery/kombu",
                        "description": "Messaging library for Python.",
                        "fork": false,
                        "url": "https://api.github.com/repos/celery/kombu",
                        "forks_url": "https://api.github.com/repos/celery/kombu/forks",
                        "keys_url": "https://api.github.com/repos/celery/kombu/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/celery/kombu/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/celery/kombu/teams",
                        "hooks_url": "https://api.github.com/repos/celery/kombu/hooks",
                        "issue_events_url": "https://api.github.com/repos/celery/kombu/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/celery/kombu/events",
                        "assignees_url": "https://api.github.com/repos/celery/kombu/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/celery/kombu/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/celery/kombu/tags",
                        "blobs_url": "https://api.github.com/repos/celery/kombu/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/celery/kombu/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/celery/kombu/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/celery/kombu/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/celery/kombu/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/celery/kombu/languages",
                        "stargazers_url": "https://api.github.com/repos/celery/kombu/stargazers",
                        "contributors_url": "https://api.github.com/repos/celery/kombu/contributors",
                        "subscribers_url": "https://api.github.com/repos/celery/kombu/subscribers",
                        "subscription_url": "https://api.github.com/repos/celery/kombu/subscription",
                        "commits_url": "https://api.github.com/repos/celery/kombu/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/celery/kombu/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/celery/kombu/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/celery/kombu/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/celery/kombu/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/celery/kombu/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/celery/kombu/merges",
                        "archive_url": "https://api.github.com/repos/celery/kombu/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/celery/kombu/downloads",
                        "issues_url": "https://api.github.com/repos/celery/kombu/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/celery/kombu/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/celery/kombu/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/celery/kombu/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/celery/kombu/labels{/name}",
                        "releases_url": "https://api.github.com/repos/celery/kombu/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/celery/kombu/deployments",
                        "created_at": "2010-06-23T10:10:24Z",
                        "updated_at": "2023-10-19T21:24:17Z",
                        "pushed_at": "2023-10-18T10:14:29Z",
                        "git_url": "git://github.com/celery/kombu.git",
                        "ssh_url": "git@github.com:celery/kombu.git",
                        "clone_url": "https://github.com/celery/kombu.git",
                        "svn_url": "https://github.com/celery/kombu",
                        "homepage": "http://kombu.readthedocs.org/",
                        "size": 8758,
                        "stargazers_count": 2629,
                        "watchers_count": 2629,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": true,
                        "forks_count": 933,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 191,
                        "license": {
                            "key": "bsd-3-clause",
                            "name": "BSD 3-Clause \"New\" or \"Revised\" License",
                            "spdx_id": "BSD-3-Clause",
                            "url": "https://api.github.com/licenses/bsd-3-clause",
                            "node_id": "MDc6TGljZW5zZTU="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "celery",
                            "kombu",
                            "message-queue",
                            "messaging",
                            "python",
                            "python-3",
                            "python-library",
                            "python3",
                            "rabbitmq",
                            "redis",
                            "sqs"
                        ],
                        "visibility": "public",
                        "forks": 933,
                        "open_issues": 191,
                        "watchers": 2629,
                        "default_branch": "main"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807"
                    },
                    "html": {
                        "href": "https://github.com/celery/kombu/pull/1807"
                    },
                    "issue": {
                        "href": "https://api.github.com/repos/celery/kombu/issues/1807"
                    },
                    "comments": {
                        "href": "https://api.github.com/repos/celery/kombu/issues/1807/comments"
                    },
                    "review_comments": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807/comments"
                    },
                    "review_comment": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/comments{/number}"
                    },
                    "commits": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807/commits"
                    },
                    "statuses": {
                        "href": "https://api.github.com/repos/celery/kombu/statuses/9e903aa9116fa345a68897f67979a4f8a367a71c"
                    }
                },
                "author_association": "CONTRIBUTOR",
                "auto_merge": null,
                "active_lock_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-22T10:51:10Z",
        "org": {
            "id": 319983,
            "login": "celery",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/celery",
            "avatar_url": "https://avatars.githubusercontent.com/u/319983?"
        }
    },
    {
        "id": "32750175278",
        "type": "PullRequestReviewEvent",
        "actor": {
            "id": 6212603,
            "login": "auvipy",
            "display_login": "auvipy",
            "gravatar_id": "",
            "url": "https://api.github.com/users/auvipy",
            "avatar_url": "https://avatars.githubusercontent.com/u/6212603?"
        },
        "repo": {
            "id": 735498,
            "name": "celery/kombu",
            "url": "https://api.github.com/repos/celery/kombu"
        },
        "payload": {
            "action": "created",
            "review": {
                "id": 1691411657,
                "node_id": "PRR_kwDOAAs5Cs5k0OTJ",
                "user": {
                    "login": "auvipy",
                    "id": 6212603,
                    "node_id": "MDQ6VXNlcjYyMTI2MDM=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/6212603?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/auvipy",
                    "html_url": "https://github.com/auvipy",
                    "followers_url": "https://api.github.com/users/auvipy/followers",
                    "following_url": "https://api.github.com/users/auvipy/following{/other_user}",
                    "gists_url": "https://api.github.com/users/auvipy/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/auvipy/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/auvipy/subscriptions",
                    "organizations_url": "https://api.github.com/users/auvipy/orgs",
                    "repos_url": "https://api.github.com/users/auvipy/repos",
                    "events_url": "https://api.github.com/users/auvipy/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/auvipy/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "additional unit test coverage for the new code. and if possible Integration tests",
                "commit_id": "9e903aa9116fa345a68897f67979a4f8a367a71c",
                "submitted_at": "2023-10-22T10:48:29Z",
                "state": "changes_requested",
                "html_url": "https://github.com/celery/kombu/pull/1807#pullrequestreview-1691411657",
                "pull_request_url": "https://api.github.com/repos/celery/kombu/pulls/1807",
                "author_association": "MEMBER",
                "_links": {
                    "html": {
                        "href": "https://github.com/celery/kombu/pull/1807#pullrequestreview-1691411657"
                    },
                    "pull_request": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807"
                    }
                }
            },
            "pull_request": {
                "url": "https://api.github.com/repos/celery/kombu/pulls/1807",
                "id": 1548262937,
                "node_id": "PR_kwDOAAs5Cs5cSJ4Z",
                "html_url": "https://github.com/celery/kombu/pull/1807",
                "diff_url": "https://github.com/celery/kombu/pull/1807.diff",
                "patch_url": "https://github.com/celery/kombu/pull/1807.patch",
                "issue_url": "https://api.github.com/repos/celery/kombu/issues/1807",
                "number": 1807,
                "state": "open",
                "locked": false,
                "title": "[WIP] Use the correct protocol for SQS requests",
                "user": {
                    "login": "rafidka",
                    "id": 442447,
                    "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/rafidka",
                    "html_url": "https://github.com/rafidka",
                    "followers_url": "https://api.github.com/users/rafidka/followers",
                    "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                    "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                    "organizations_url": "https://api.github.com/users/rafidka/orgs",
                    "repos_url": "https://api.github.com/users/rafidka/repos",
                    "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/rafidka/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "TL;DR - The use of boto3 in #1759 resulted in relying on blocking (synchronous) HTTP requests, which caused the performance issue reported in #1783.\r\n\r\n`kombu` previously used to craft AWS requests manually as explained in detail in #1726, which resulted in an outage when botocore temporarily changed the default protocol to JSON (before rolling back due to the impact on celery and airflow.) To fix the issue, I submitted #1759, which changes `kombu` to use `boto3` instead of manually crafting AWS requests. This way when boto3 changes the default protocol, kombu won't be impacted.\r\n\r\nWhile working on #1759, I did extensive debugging to understand the multi-threading nature of kombu. What I discovered is that there isn't an actual multi-threading in the true sense of the word, but an event loop that runs on the same thread and process and orchestrate the communication with SQS. As such, it didn't appear to me that there is anything to worry about my change, and the testing I did didn't discover any issue. However, it turns out that while kombu's event loop doesn't have actual multi-threading, its [reliance on pycurl](https://github.com/celery/kombu/blob/main/kombu/asynchronous/http/curl.py#L48) (and thus libcurl) meant that the requests to AWS were being done asynchronously. On the other hand, boto3 requests are always done synchronously, i.e. they are blocking requests.\r\n\r\nThe above meant that my change introduced blocking on the event loop of kombu. This is fine in most of the cases, since the requests to SQS are pretty fast. However, in the case of using long-polling, a call to SQS's ReceiveMessage can last up to 20 seconds (depending on the user configuration).\r\n\r\nTo solve this problem, I rolled back my earlier changes and, instead, to address the issue reported in #1726, I now changed the `AsyncSQSConnection` class such that it crafts either a `query` or a `json` request depending on the protocol used by the SQS client. Thus, when botocore changes the default protocol of SQS to JSON, kombu won't be impacted, since it crafts its own request and, after my change, it uses a hard-coded protocol based on the crafted requests.\r\n\r\nThis solution shouldn't be the final solution, and it is more of a workaround that does the job for now. The final solution should be to completely rely on boto3 for any communication with AWS, and ensuring that all requests are async in nature (non-blocking.) This, however, is a fundamental change that requires a lot of testing, in particular performance testing.\r\n",
                "created_at": "2023-10-09T17:36:06Z",
                "updated_at": "2023-10-22T10:48:54Z",
                "closed_at": null,
                "merged_at": null,
                "merge_commit_sha": "f6243abe6fb30d7a7b5dfa592e36d02bc35987f3",
                "assignee": null,
                "assignees": [],
                "requested_reviewers": [],
                "requested_teams": [],
                "labels": [],
                "milestone": null,
                "draft": false,
                "commits_url": "https://api.github.com/repos/celery/kombu/pulls/1807/commits",
                "review_comments_url": "https://api.github.com/repos/celery/kombu/pulls/1807/comments",
                "review_comment_url": "https://api.github.com/repos/celery/kombu/pulls/comments{/number}",
                "comments_url": "https://api.github.com/repos/celery/kombu/issues/1807/comments",
                "statuses_url": "https://api.github.com/repos/celery/kombu/statuses/9e903aa9116fa345a68897f67979a4f8a367a71c",
                "head": {
                    "label": "rafidka:fix-1783",
                    "ref": "fix-1783",
                    "sha": "9e903aa9116fa345a68897f67979a4f8a367a71c",
                    "user": {
                        "login": "rafidka",
                        "id": 442447,
                        "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                        "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/rafidka",
                        "html_url": "https://github.com/rafidka",
                        "followers_url": "https://api.github.com/users/rafidka/followers",
                        "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                        "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                        "organizations_url": "https://api.github.com/users/rafidka/orgs",
                        "repos_url": "https://api.github.com/users/rafidka/repos",
                        "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/rafidka/received_events",
                        "type": "User",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 655909423,
                        "node_id": "R_kgDOJxhiLw",
                        "name": "kombu",
                        "full_name": "rafidka/kombu",
                        "private": false,
                        "owner": {
                            "login": "rafidka",
                            "id": 442447,
                            "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                            "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/rafidka",
                            "html_url": "https://github.com/rafidka",
                            "followers_url": "https://api.github.com/users/rafidka/followers",
                            "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                            "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                            "organizations_url": "https://api.github.com/users/rafidka/orgs",
                            "repos_url": "https://api.github.com/users/rafidka/repos",
                            "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/rafidka/received_events",
                            "type": "User",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/rafidka/kombu",
                        "description": "Messaging library for Python.",
                        "fork": true,
                        "url": "https://api.github.com/repos/rafidka/kombu",
                        "forks_url": "https://api.github.com/repos/rafidka/kombu/forks",
                        "keys_url": "https://api.github.com/repos/rafidka/kombu/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/rafidka/kombu/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/rafidka/kombu/teams",
                        "hooks_url": "https://api.github.com/repos/rafidka/kombu/hooks",
                        "issue_events_url": "https://api.github.com/repos/rafidka/kombu/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/rafidka/kombu/events",
                        "assignees_url": "https://api.github.com/repos/rafidka/kombu/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/rafidka/kombu/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/rafidka/kombu/tags",
                        "blobs_url": "https://api.github.com/repos/rafidka/kombu/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/rafidka/kombu/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/rafidka/kombu/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/rafidka/kombu/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/rafidka/kombu/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/rafidka/kombu/languages",
                        "stargazers_url": "https://api.github.com/repos/rafidka/kombu/stargazers",
                        "contributors_url": "https://api.github.com/repos/rafidka/kombu/contributors",
                        "subscribers_url": "https://api.github.com/repos/rafidka/kombu/subscribers",
                        "subscription_url": "https://api.github.com/repos/rafidka/kombu/subscription",
                        "commits_url": "https://api.github.com/repos/rafidka/kombu/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/rafidka/kombu/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/rafidka/kombu/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/rafidka/kombu/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/rafidka/kombu/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/rafidka/kombu/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/rafidka/kombu/merges",
                        "archive_url": "https://api.github.com/repos/rafidka/kombu/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/rafidka/kombu/downloads",
                        "issues_url": "https://api.github.com/repos/rafidka/kombu/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/rafidka/kombu/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/rafidka/kombu/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/rafidka/kombu/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/rafidka/kombu/labels{/name}",
                        "releases_url": "https://api.github.com/repos/rafidka/kombu/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/rafidka/kombu/deployments",
                        "created_at": "2023-06-19T21:48:27Z",
                        "updated_at": "2023-10-06T01:42:46Z",
                        "pushed_at": "2023-10-17T14:10:46Z",
                        "git_url": "git://github.com/rafidka/kombu.git",
                        "ssh_url": "git@github.com:rafidka/kombu.git",
                        "clone_url": "https://github.com/rafidka/kombu.git",
                        "svn_url": "https://github.com/rafidka/kombu",
                        "homepage": "http://kombu.readthedocs.org/",
                        "size": 6589,
                        "stargazers_count": 0,
                        "watchers_count": 0,
                        "language": "Python",
                        "has_issues": false,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": false,
                        "has_discussions": false,
                        "forks_count": 0,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 0,
                        "license": {
                            "key": "bsd-3-clause",
                            "name": "BSD 3-Clause \"New\" or \"Revised\" License",
                            "spdx_id": "BSD-3-Clause",
                            "url": "https://api.github.com/licenses/bsd-3-clause",
                            "node_id": "MDc6TGljZW5zZTU="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [],
                        "visibility": "public",
                        "forks": 0,
                        "open_issues": 0,
                        "watchers": 0,
                        "default_branch": "main"
                    }
                },
                "base": {
                    "label": "celery:main",
                    "ref": "main",
                    "sha": "1dfe4f3c86ab0fd2587a6fe8566bb3cef8c4a5d7",
                    "user": {
                        "login": "celery",
                        "id": 319983,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjMxOTk4Mw==",
                        "avatar_url": "https://avatars.githubusercontent.com/u/319983?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/celery",
                        "html_url": "https://github.com/celery",
                        "followers_url": "https://api.github.com/users/celery/followers",
                        "following_url": "https://api.github.com/users/celery/following{/other_user}",
                        "gists_url": "https://api.github.com/users/celery/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/celery/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/celery/subscriptions",
                        "organizations_url": "https://api.github.com/users/celery/orgs",
                        "repos_url": "https://api.github.com/users/celery/repos",
                        "events_url": "https://api.github.com/users/celery/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/celery/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 735498,
                        "node_id": "MDEwOlJlcG9zaXRvcnk3MzU0OTg=",
                        "name": "kombu",
                        "full_name": "celery/kombu",
                        "private": false,
                        "owner": {
                            "login": "celery",
                            "id": 319983,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjMxOTk4Mw==",
                            "avatar_url": "https://avatars.githubusercontent.com/u/319983?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/celery",
                            "html_url": "https://github.com/celery",
                            "followers_url": "https://api.github.com/users/celery/followers",
                            "following_url": "https://api.github.com/users/celery/following{/other_user}",
                            "gists_url": "https://api.github.com/users/celery/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/celery/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/celery/subscriptions",
                            "organizations_url": "https://api.github.com/users/celery/orgs",
                            "repos_url": "https://api.github.com/users/celery/repos",
                            "events_url": "https://api.github.com/users/celery/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/celery/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/celery/kombu",
                        "description": "Messaging library for Python.",
                        "fork": false,
                        "url": "https://api.github.com/repos/celery/kombu",
                        "forks_url": "https://api.github.com/repos/celery/kombu/forks",
                        "keys_url": "https://api.github.com/repos/celery/kombu/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/celery/kombu/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/celery/kombu/teams",
                        "hooks_url": "https://api.github.com/repos/celery/kombu/hooks",
                        "issue_events_url": "https://api.github.com/repos/celery/kombu/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/celery/kombu/events",
                        "assignees_url": "https://api.github.com/repos/celery/kombu/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/celery/kombu/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/celery/kombu/tags",
                        "blobs_url": "https://api.github.com/repos/celery/kombu/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/celery/kombu/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/celery/kombu/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/celery/kombu/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/celery/kombu/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/celery/kombu/languages",
                        "stargazers_url": "https://api.github.com/repos/celery/kombu/stargazers",
                        "contributors_url": "https://api.github.com/repos/celery/kombu/contributors",
                        "subscribers_url": "https://api.github.com/repos/celery/kombu/subscribers",
                        "subscription_url": "https://api.github.com/repos/celery/kombu/subscription",
                        "commits_url": "https://api.github.com/repos/celery/kombu/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/celery/kombu/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/celery/kombu/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/celery/kombu/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/celery/kombu/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/celery/kombu/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/celery/kombu/merges",
                        "archive_url": "https://api.github.com/repos/celery/kombu/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/celery/kombu/downloads",
                        "issues_url": "https://api.github.com/repos/celery/kombu/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/celery/kombu/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/celery/kombu/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/celery/kombu/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/celery/kombu/labels{/name}",
                        "releases_url": "https://api.github.com/repos/celery/kombu/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/celery/kombu/deployments",
                        "created_at": "2010-06-23T10:10:24Z",
                        "updated_at": "2023-10-19T21:24:17Z",
                        "pushed_at": "2023-10-18T10:14:29Z",
                        "git_url": "git://github.com/celery/kombu.git",
                        "ssh_url": "git@github.com:celery/kombu.git",
                        "clone_url": "https://github.com/celery/kombu.git",
                        "svn_url": "https://github.com/celery/kombu",
                        "homepage": "http://kombu.readthedocs.org/",
                        "size": 8758,
                        "stargazers_count": 2629,
                        "watchers_count": 2629,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": true,
                        "forks_count": 933,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 191,
                        "license": {
                            "key": "bsd-3-clause",
                            "name": "BSD 3-Clause \"New\" or \"Revised\" License",
                            "spdx_id": "BSD-3-Clause",
                            "url": "https://api.github.com/licenses/bsd-3-clause",
                            "node_id": "MDc6TGljZW5zZTU="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "celery",
                            "kombu",
                            "message-queue",
                            "messaging",
                            "python",
                            "python-3",
                            "python-library",
                            "python3",
                            "rabbitmq",
                            "redis",
                            "sqs"
                        ],
                        "visibility": "public",
                        "forks": 933,
                        "open_issues": 191,
                        "watchers": 2629,
                        "default_branch": "main"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807"
                    },
                    "html": {
                        "href": "https://github.com/celery/kombu/pull/1807"
                    },
                    "issue": {
                        "href": "https://api.github.com/repos/celery/kombu/issues/1807"
                    },
                    "comments": {
                        "href": "https://api.github.com/repos/celery/kombu/issues/1807/comments"
                    },
                    "review_comments": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807/comments"
                    },
                    "review_comment": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/comments{/number}"
                    },
                    "commits": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807/commits"
                    },
                    "statuses": {
                        "href": "https://api.github.com/repos/celery/kombu/statuses/9e903aa9116fa345a68897f67979a4f8a367a71c"
                    }
                },
                "author_association": "CONTRIBUTOR",
                "auto_merge": null,
                "active_lock_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-22T10:48:54Z",
        "org": {
            "id": 319983,
            "login": "celery",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/celery",
            "avatar_url": "https://avatars.githubusercontent.com/u/319983?"
        }
    },
    {
        "id": "32750172381",
        "type": "PullRequestReviewCommentEvent",
        "actor": {
            "id": 6212603,
            "login": "auvipy",
            "display_login": "auvipy",
            "gravatar_id": "",
            "url": "https://api.github.com/users/auvipy",
            "avatar_url": "https://avatars.githubusercontent.com/u/6212603?"
        },
        "repo": {
            "id": 735498,
            "name": "celery/kombu",
            "url": "https://api.github.com/repos/celery/kombu"
        },
        "payload": {
            "action": "created",
            "comment": {
                "url": "https://api.github.com/repos/celery/kombu/pulls/comments/1367881744",
                "pull_request_review_id": 1691411657,
                "id": 1367881744,
                "node_id": "PRRC_kwDOAAs5Cs5RiDgQ",
                "diff_hunk": "@@ -25,6 +29,76 @@ def __init__(self, sqs_connection, debug=0, region=None, **kwargs):\n             **kwargs\n         )\n \n+    def _create_query_request(self, operation, params, queue_url, method):\n+        params = params.copy()\n+        if operation:\n+            params['Action'] = operation\n+\n+        # defaults for non-get\n+        param_payload = {'data': params}\n+        if method.lower() == 'get':\n+            # query-based opts\n+            param_payload = {'params': params}\n+\n+        return AWSRequest(method=method, url=queue_url, **param_payload)\n+\n+    def _create_json_request(self, operation, params, queue_url):\n+        params = params.copy()\n+        params['QueueUrl'] = queue_url\n+\n+        service_model = self.sqs_connection.meta.service_model\n+        operation_model = service_model.operation_model(operation)\n+\n+        url = self.sqs_connection._endpoint.host\n+\n+        headers = {}\n+        # Content-Type\n+        json_version = operation_model.metadata['jsonVersion']\n+        content_type = f'application/x-amz-json-{json_version}'\n+        headers['Content-Type'] = content_type\n+\n+        # X-Amz-Target\n+        target = '{}.{}'.format(",
                "path": "kombu/asynchronous/aws/sqs/connection.py",
                "commit_id": "9e903aa9116fa345a68897f67979a4f8a367a71c",
                "original_commit_id": "9e903aa9116fa345a68897f67979a4f8a367a71c",
                "user": {
                    "login": "auvipy",
                    "id": 6212603,
                    "node_id": "MDQ6VXNlcjYyMTI2MDM=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/6212603?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/auvipy",
                    "html_url": "https://github.com/auvipy",
                    "followers_url": "https://api.github.com/users/auvipy/followers",
                    "following_url": "https://api.github.com/users/auvipy/following{/other_user}",
                    "gists_url": "https://api.github.com/users/auvipy/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/auvipy/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/auvipy/subscriptions",
                    "organizations_url": "https://api.github.com/users/auvipy/orgs",
                    "repos_url": "https://api.github.com/users/auvipy/repos",
                    "events_url": "https://api.github.com/users/auvipy/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/auvipy/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "can we try f string here? or there are some version restrictions?",
                "created_at": "2023-10-22T10:47:48Z",
                "updated_at": "2023-10-22T10:48:29Z",
                "html_url": "https://github.com/celery/kombu/pull/1807#discussion_r1367881744",
                "pull_request_url": "https://api.github.com/repos/celery/kombu/pulls/1807",
                "author_association": "MEMBER",
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/comments/1367881744"
                    },
                    "html": {
                        "href": "https://github.com/celery/kombu/pull/1807#discussion_r1367881744"
                    },
                    "pull_request": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807"
                    }
                },
                "reactions": {
                    "url": "https://api.github.com/repos/celery/kombu/pulls/comments/1367881744/reactions",
                    "total_count": 0,
                    "+1": 0,
                    "-1": 0,
                    "laugh": 0,
                    "hooray": 0,
                    "confused": 0,
                    "heart": 0,
                    "rocket": 0,
                    "eyes": 0
                },
                "start_line": null,
                "original_start_line": null,
                "start_side": null,
                "line": 61,
                "original_line": 61,
                "side": "RIGHT",
                "original_position": 47,
                "position": 47,
                "subject_type": "line"
            },
            "pull_request": {
                "url": "https://api.github.com/repos/celery/kombu/pulls/1807",
                "id": 1548262937,
                "node_id": "PR_kwDOAAs5Cs5cSJ4Z",
                "html_url": "https://github.com/celery/kombu/pull/1807",
                "diff_url": "https://github.com/celery/kombu/pull/1807.diff",
                "patch_url": "https://github.com/celery/kombu/pull/1807.patch",
                "issue_url": "https://api.github.com/repos/celery/kombu/issues/1807",
                "number": 1807,
                "state": "open",
                "locked": false,
                "title": "[WIP] Use the correct protocol for SQS requests",
                "user": {
                    "login": "rafidka",
                    "id": 442447,
                    "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/rafidka",
                    "html_url": "https://github.com/rafidka",
                    "followers_url": "https://api.github.com/users/rafidka/followers",
                    "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                    "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                    "organizations_url": "https://api.github.com/users/rafidka/orgs",
                    "repos_url": "https://api.github.com/users/rafidka/repos",
                    "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/rafidka/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "TL;DR - The use of boto3 in #1759 resulted in relying on blocking (synchronous) HTTP requests, which caused the performance issue reported in #1783.\r\n\r\n`kombu` previously used to craft AWS requests manually as explained in detail in #1726, which resulted in an outage when botocore temporarily changed the default protocol to JSON (before rolling back due to the impact on celery and airflow.) To fix the issue, I submitted #1759, which changes `kombu` to use `boto3` instead of manually crafting AWS requests. This way when boto3 changes the default protocol, kombu won't be impacted.\r\n\r\nWhile working on #1759, I did extensive debugging to understand the multi-threading nature of kombu. What I discovered is that there isn't an actual multi-threading in the true sense of the word, but an event loop that runs on the same thread and process and orchestrate the communication with SQS. As such, it didn't appear to me that there is anything to worry about my change, and the testing I did didn't discover any issue. However, it turns out that while kombu's event loop doesn't have actual multi-threading, its [reliance on pycurl](https://github.com/celery/kombu/blob/main/kombu/asynchronous/http/curl.py#L48) (and thus libcurl) meant that the requests to AWS were being done asynchronously. On the other hand, boto3 requests are always done synchronously, i.e. they are blocking requests.\r\n\r\nThe above meant that my change introduced blocking on the event loop of kombu. This is fine in most of the cases, since the requests to SQS are pretty fast. However, in the case of using long-polling, a call to SQS's ReceiveMessage can last up to 20 seconds (depending on the user configuration).\r\n\r\nTo solve this problem, I rolled back my earlier changes and, instead, to address the issue reported in #1726, I now changed the `AsyncSQSConnection` class such that it crafts either a `query` or a `json` request depending on the protocol used by the SQS client. Thus, when botocore changes the default protocol of SQS to JSON, kombu won't be impacted, since it crafts its own request and, after my change, it uses a hard-coded protocol based on the crafted requests.\r\n\r\nThis solution shouldn't be the final solution, and it is more of a workaround that does the job for now. The final solution should be to completely rely on boto3 for any communication with AWS, and ensuring that all requests are async in nature (non-blocking.) This, however, is a fundamental change that requires a lot of testing, in particular performance testing.\r\n",
                "created_at": "2023-10-09T17:36:06Z",
                "updated_at": "2023-10-22T10:48:29Z",
                "closed_at": null,
                "merged_at": null,
                "merge_commit_sha": "f6243abe6fb30d7a7b5dfa592e36d02bc35987f3",
                "assignee": null,
                "assignees": [],
                "requested_reviewers": [],
                "requested_teams": [],
                "labels": [],
                "milestone": null,
                "draft": false,
                "commits_url": "https://api.github.com/repos/celery/kombu/pulls/1807/commits",
                "review_comments_url": "https://api.github.com/repos/celery/kombu/pulls/1807/comments",
                "review_comment_url": "https://api.github.com/repos/celery/kombu/pulls/comments{/number}",
                "comments_url": "https://api.github.com/repos/celery/kombu/issues/1807/comments",
                "statuses_url": "https://api.github.com/repos/celery/kombu/statuses/9e903aa9116fa345a68897f67979a4f8a367a71c",
                "head": {
                    "label": "rafidka:fix-1783",
                    "ref": "fix-1783",
                    "sha": "9e903aa9116fa345a68897f67979a4f8a367a71c",
                    "user": {
                        "login": "rafidka",
                        "id": 442447,
                        "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                        "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/rafidka",
                        "html_url": "https://github.com/rafidka",
                        "followers_url": "https://api.github.com/users/rafidka/followers",
                        "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                        "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                        "organizations_url": "https://api.github.com/users/rafidka/orgs",
                        "repos_url": "https://api.github.com/users/rafidka/repos",
                        "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/rafidka/received_events",
                        "type": "User",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 655909423,
                        "node_id": "R_kgDOJxhiLw",
                        "name": "kombu",
                        "full_name": "rafidka/kombu",
                        "private": false,
                        "owner": {
                            "login": "rafidka",
                            "id": 442447,
                            "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                            "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/rafidka",
                            "html_url": "https://github.com/rafidka",
                            "followers_url": "https://api.github.com/users/rafidka/followers",
                            "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                            "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                            "organizations_url": "https://api.github.com/users/rafidka/orgs",
                            "repos_url": "https://api.github.com/users/rafidka/repos",
                            "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/rafidka/received_events",
                            "type": "User",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/rafidka/kombu",
                        "description": "Messaging library for Python.",
                        "fork": true,
                        "url": "https://api.github.com/repos/rafidka/kombu",
                        "forks_url": "https://api.github.com/repos/rafidka/kombu/forks",
                        "keys_url": "https://api.github.com/repos/rafidka/kombu/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/rafidka/kombu/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/rafidka/kombu/teams",
                        "hooks_url": "https://api.github.com/repos/rafidka/kombu/hooks",
                        "issue_events_url": "https://api.github.com/repos/rafidka/kombu/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/rafidka/kombu/events",
                        "assignees_url": "https://api.github.com/repos/rafidka/kombu/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/rafidka/kombu/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/rafidka/kombu/tags",
                        "blobs_url": "https://api.github.com/repos/rafidka/kombu/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/rafidka/kombu/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/rafidka/kombu/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/rafidka/kombu/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/rafidka/kombu/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/rafidka/kombu/languages",
                        "stargazers_url": "https://api.github.com/repos/rafidka/kombu/stargazers",
                        "contributors_url": "https://api.github.com/repos/rafidka/kombu/contributors",
                        "subscribers_url": "https://api.github.com/repos/rafidka/kombu/subscribers",
                        "subscription_url": "https://api.github.com/repos/rafidka/kombu/subscription",
                        "commits_url": "https://api.github.com/repos/rafidka/kombu/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/rafidka/kombu/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/rafidka/kombu/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/rafidka/kombu/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/rafidka/kombu/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/rafidka/kombu/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/rafidka/kombu/merges",
                        "archive_url": "https://api.github.com/repos/rafidka/kombu/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/rafidka/kombu/downloads",
                        "issues_url": "https://api.github.com/repos/rafidka/kombu/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/rafidka/kombu/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/rafidka/kombu/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/rafidka/kombu/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/rafidka/kombu/labels{/name}",
                        "releases_url": "https://api.github.com/repos/rafidka/kombu/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/rafidka/kombu/deployments",
                        "created_at": "2023-06-19T21:48:27Z",
                        "updated_at": "2023-10-06T01:42:46Z",
                        "pushed_at": "2023-10-17T14:10:46Z",
                        "git_url": "git://github.com/rafidka/kombu.git",
                        "ssh_url": "git@github.com:rafidka/kombu.git",
                        "clone_url": "https://github.com/rafidka/kombu.git",
                        "svn_url": "https://github.com/rafidka/kombu",
                        "homepage": "http://kombu.readthedocs.org/",
                        "size": 6589,
                        "stargazers_count": 0,
                        "watchers_count": 0,
                        "language": "Python",
                        "has_issues": false,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": false,
                        "has_discussions": false,
                        "forks_count": 0,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 0,
                        "license": {
                            "key": "bsd-3-clause",
                            "name": "BSD 3-Clause \"New\" or \"Revised\" License",
                            "spdx_id": "BSD-3-Clause",
                            "url": "https://api.github.com/licenses/bsd-3-clause",
                            "node_id": "MDc6TGljZW5zZTU="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [],
                        "visibility": "public",
                        "forks": 0,
                        "open_issues": 0,
                        "watchers": 0,
                        "default_branch": "main"
                    }
                },
                "base": {
                    "label": "celery:main",
                    "ref": "main",
                    "sha": "1dfe4f3c86ab0fd2587a6fe8566bb3cef8c4a5d7",
                    "user": {
                        "login": "celery",
                        "id": 319983,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjMxOTk4Mw==",
                        "avatar_url": "https://avatars.githubusercontent.com/u/319983?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/celery",
                        "html_url": "https://github.com/celery",
                        "followers_url": "https://api.github.com/users/celery/followers",
                        "following_url": "https://api.github.com/users/celery/following{/other_user}",
                        "gists_url": "https://api.github.com/users/celery/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/celery/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/celery/subscriptions",
                        "organizations_url": "https://api.github.com/users/celery/orgs",
                        "repos_url": "https://api.github.com/users/celery/repos",
                        "events_url": "https://api.github.com/users/celery/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/celery/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 735498,
                        "node_id": "MDEwOlJlcG9zaXRvcnk3MzU0OTg=",
                        "name": "kombu",
                        "full_name": "celery/kombu",
                        "private": false,
                        "owner": {
                            "login": "celery",
                            "id": 319983,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjMxOTk4Mw==",
                            "avatar_url": "https://avatars.githubusercontent.com/u/319983?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/celery",
                            "html_url": "https://github.com/celery",
                            "followers_url": "https://api.github.com/users/celery/followers",
                            "following_url": "https://api.github.com/users/celery/following{/other_user}",
                            "gists_url": "https://api.github.com/users/celery/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/celery/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/celery/subscriptions",
                            "organizations_url": "https://api.github.com/users/celery/orgs",
                            "repos_url": "https://api.github.com/users/celery/repos",
                            "events_url": "https://api.github.com/users/celery/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/celery/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/celery/kombu",
                        "description": "Messaging library for Python.",
                        "fork": false,
                        "url": "https://api.github.com/repos/celery/kombu",
                        "forks_url": "https://api.github.com/repos/celery/kombu/forks",
                        "keys_url": "https://api.github.com/repos/celery/kombu/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/celery/kombu/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/celery/kombu/teams",
                        "hooks_url": "https://api.github.com/repos/celery/kombu/hooks",
                        "issue_events_url": "https://api.github.com/repos/celery/kombu/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/celery/kombu/events",
                        "assignees_url": "https://api.github.com/repos/celery/kombu/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/celery/kombu/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/celery/kombu/tags",
                        "blobs_url": "https://api.github.com/repos/celery/kombu/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/celery/kombu/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/celery/kombu/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/celery/kombu/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/celery/kombu/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/celery/kombu/languages",
                        "stargazers_url": "https://api.github.com/repos/celery/kombu/stargazers",
                        "contributors_url": "https://api.github.com/repos/celery/kombu/contributors",
                        "subscribers_url": "https://api.github.com/repos/celery/kombu/subscribers",
                        "subscription_url": "https://api.github.com/repos/celery/kombu/subscription",
                        "commits_url": "https://api.github.com/repos/celery/kombu/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/celery/kombu/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/celery/kombu/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/celery/kombu/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/celery/kombu/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/celery/kombu/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/celery/kombu/merges",
                        "archive_url": "https://api.github.com/repos/celery/kombu/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/celery/kombu/downloads",
                        "issues_url": "https://api.github.com/repos/celery/kombu/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/celery/kombu/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/celery/kombu/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/celery/kombu/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/celery/kombu/labels{/name}",
                        "releases_url": "https://api.github.com/repos/celery/kombu/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/celery/kombu/deployments",
                        "created_at": "2010-06-23T10:10:24Z",
                        "updated_at": "2023-10-19T21:24:17Z",
                        "pushed_at": "2023-10-18T10:14:29Z",
                        "git_url": "git://github.com/celery/kombu.git",
                        "ssh_url": "git@github.com:celery/kombu.git",
                        "clone_url": "https://github.com/celery/kombu.git",
                        "svn_url": "https://github.com/celery/kombu",
                        "homepage": "http://kombu.readthedocs.org/",
                        "size": 8758,
                        "stargazers_count": 2629,
                        "watchers_count": 2629,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": true,
                        "forks_count": 933,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 191,
                        "license": {
                            "key": "bsd-3-clause",
                            "name": "BSD 3-Clause \"New\" or \"Revised\" License",
                            "spdx_id": "BSD-3-Clause",
                            "url": "https://api.github.com/licenses/bsd-3-clause",
                            "node_id": "MDc6TGljZW5zZTU="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "celery",
                            "kombu",
                            "message-queue",
                            "messaging",
                            "python",
                            "python-3",
                            "python-library",
                            "python3",
                            "rabbitmq",
                            "redis",
                            "sqs"
                        ],
                        "visibility": "public",
                        "forks": 933,
                        "open_issues": 191,
                        "watchers": 2629,
                        "default_branch": "main"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807"
                    },
                    "html": {
                        "href": "https://github.com/celery/kombu/pull/1807"
                    },
                    "issue": {
                        "href": "https://api.github.com/repos/celery/kombu/issues/1807"
                    },
                    "comments": {
                        "href": "https://api.github.com/repos/celery/kombu/issues/1807/comments"
                    },
                    "review_comments": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807/comments"
                    },
                    "review_comment": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/comments{/number}"
                    },
                    "commits": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807/commits"
                    },
                    "statuses": {
                        "href": "https://api.github.com/repos/celery/kombu/statuses/9e903aa9116fa345a68897f67979a4f8a367a71c"
                    }
                },
                "author_association": "CONTRIBUTOR",
                "auto_merge": null,
                "active_lock_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-22T10:47:48Z",
        "org": {
            "id": 319983,
            "login": "celery",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/celery",
            "avatar_url": "https://avatars.githubusercontent.com/u/319983?"
        }
    },
    {
        "id": "32750172365",
        "type": "PullRequestReviewEvent",
        "actor": {
            "id": 6212603,
            "login": "auvipy",
            "display_login": "auvipy",
            "gravatar_id": "",
            "url": "https://api.github.com/users/auvipy",
            "avatar_url": "https://avatars.githubusercontent.com/u/6212603?"
        },
        "repo": {
            "id": 735498,
            "name": "celery/kombu",
            "url": "https://api.github.com/repos/celery/kombu"
        },
        "payload": {
            "action": "created",
            "review": {
                "id": 1691411657,
                "node_id": "PRR_kwDOAAs5Cs5k0OTJ",
                "user": {
                    "login": "auvipy",
                    "id": 6212603,
                    "node_id": "MDQ6VXNlcjYyMTI2MDM=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/6212603?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/auvipy",
                    "html_url": "https://github.com/auvipy",
                    "followers_url": "https://api.github.com/users/auvipy/followers",
                    "following_url": "https://api.github.com/users/auvipy/following{/other_user}",
                    "gists_url": "https://api.github.com/users/auvipy/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/auvipy/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/auvipy/subscriptions",
                    "organizations_url": "https://api.github.com/users/auvipy/orgs",
                    "repos_url": "https://api.github.com/users/auvipy/repos",
                    "events_url": "https://api.github.com/users/auvipy/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/auvipy/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "unit test coverage for the new code. and if possible Integration tests",
                "commit_id": "9e903aa9116fa345a68897f67979a4f8a367a71c",
                "submitted_at": "2023-10-22T10:48:29Z",
                "state": "changes_requested",
                "html_url": "https://github.com/celery/kombu/pull/1807#pullrequestreview-1691411657",
                "pull_request_url": "https://api.github.com/repos/celery/kombu/pulls/1807",
                "author_association": "MEMBER",
                "_links": {
                    "html": {
                        "href": "https://github.com/celery/kombu/pull/1807#pullrequestreview-1691411657"
                    },
                    "pull_request": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807"
                    }
                }
            },
            "pull_request": {
                "url": "https://api.github.com/repos/celery/kombu/pulls/1807",
                "id": 1548262937,
                "node_id": "PR_kwDOAAs5Cs5cSJ4Z",
                "html_url": "https://github.com/celery/kombu/pull/1807",
                "diff_url": "https://github.com/celery/kombu/pull/1807.diff",
                "patch_url": "https://github.com/celery/kombu/pull/1807.patch",
                "issue_url": "https://api.github.com/repos/celery/kombu/issues/1807",
                "number": 1807,
                "state": "open",
                "locked": false,
                "title": "[WIP] Use the correct protocol for SQS requests",
                "user": {
                    "login": "rafidka",
                    "id": 442447,
                    "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/rafidka",
                    "html_url": "https://github.com/rafidka",
                    "followers_url": "https://api.github.com/users/rafidka/followers",
                    "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                    "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                    "organizations_url": "https://api.github.com/users/rafidka/orgs",
                    "repos_url": "https://api.github.com/users/rafidka/repos",
                    "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/rafidka/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "TL;DR - The use of boto3 in #1759 resulted in relying on blocking (synchronous) HTTP requests, which caused the performance issue reported in #1783.\r\n\r\n`kombu` previously used to craft AWS requests manually as explained in detail in #1726, which resulted in an outage when botocore temporarily changed the default protocol to JSON (before rolling back due to the impact on celery and airflow.) To fix the issue, I submitted #1759, which changes `kombu` to use `boto3` instead of manually crafting AWS requests. This way when boto3 changes the default protocol, kombu won't be impacted.\r\n\r\nWhile working on #1759, I did extensive debugging to understand the multi-threading nature of kombu. What I discovered is that there isn't an actual multi-threading in the true sense of the word, but an event loop that runs on the same thread and process and orchestrate the communication with SQS. As such, it didn't appear to me that there is anything to worry about my change, and the testing I did didn't discover any issue. However, it turns out that while kombu's event loop doesn't have actual multi-threading, its [reliance on pycurl](https://github.com/celery/kombu/blob/main/kombu/asynchronous/http/curl.py#L48) (and thus libcurl) meant that the requests to AWS were being done asynchronously. On the other hand, boto3 requests are always done synchronously, i.e. they are blocking requests.\r\n\r\nThe above meant that my change introduced blocking on the event loop of kombu. This is fine in most of the cases, since the requests to SQS are pretty fast. However, in the case of using long-polling, a call to SQS's ReceiveMessage can last up to 20 seconds (depending on the user configuration).\r\n\r\nTo solve this problem, I rolled back my earlier changes and, instead, to address the issue reported in #1726, I now changed the `AsyncSQSConnection` class such that it crafts either a `query` or a `json` request depending on the protocol used by the SQS client. Thus, when botocore changes the default protocol of SQS to JSON, kombu won't be impacted, since it crafts its own request and, after my change, it uses a hard-coded protocol based on the crafted requests.\r\n\r\nThis solution shouldn't be the final solution, and it is more of a workaround that does the job for now. The final solution should be to completely rely on boto3 for any communication with AWS, and ensuring that all requests are async in nature (non-blocking.) This, however, is a fundamental change that requires a lot of testing, in particular performance testing.\r\n",
                "created_at": "2023-10-09T17:36:06Z",
                "updated_at": "2023-10-22T10:48:29Z",
                "closed_at": null,
                "merged_at": null,
                "merge_commit_sha": "f6243abe6fb30d7a7b5dfa592e36d02bc35987f3",
                "assignee": null,
                "assignees": [],
                "requested_reviewers": [],
                "requested_teams": [],
                "labels": [],
                "milestone": null,
                "draft": false,
                "commits_url": "https://api.github.com/repos/celery/kombu/pulls/1807/commits",
                "review_comments_url": "https://api.github.com/repos/celery/kombu/pulls/1807/comments",
                "review_comment_url": "https://api.github.com/repos/celery/kombu/pulls/comments{/number}",
                "comments_url": "https://api.github.com/repos/celery/kombu/issues/1807/comments",
                "statuses_url": "https://api.github.com/repos/celery/kombu/statuses/9e903aa9116fa345a68897f67979a4f8a367a71c",
                "head": {
                    "label": "rafidka:fix-1783",
                    "ref": "fix-1783",
                    "sha": "9e903aa9116fa345a68897f67979a4f8a367a71c",
                    "user": {
                        "login": "rafidka",
                        "id": 442447,
                        "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                        "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/rafidka",
                        "html_url": "https://github.com/rafidka",
                        "followers_url": "https://api.github.com/users/rafidka/followers",
                        "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                        "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                        "organizations_url": "https://api.github.com/users/rafidka/orgs",
                        "repos_url": "https://api.github.com/users/rafidka/repos",
                        "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/rafidka/received_events",
                        "type": "User",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 655909423,
                        "node_id": "R_kgDOJxhiLw",
                        "name": "kombu",
                        "full_name": "rafidka/kombu",
                        "private": false,
                        "owner": {
                            "login": "rafidka",
                            "id": 442447,
                            "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                            "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/rafidka",
                            "html_url": "https://github.com/rafidka",
                            "followers_url": "https://api.github.com/users/rafidka/followers",
                            "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                            "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                            "organizations_url": "https://api.github.com/users/rafidka/orgs",
                            "repos_url": "https://api.github.com/users/rafidka/repos",
                            "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/rafidka/received_events",
                            "type": "User",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/rafidka/kombu",
                        "description": "Messaging library for Python.",
                        "fork": true,
                        "url": "https://api.github.com/repos/rafidka/kombu",
                        "forks_url": "https://api.github.com/repos/rafidka/kombu/forks",
                        "keys_url": "https://api.github.com/repos/rafidka/kombu/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/rafidka/kombu/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/rafidka/kombu/teams",
                        "hooks_url": "https://api.github.com/repos/rafidka/kombu/hooks",
                        "issue_events_url": "https://api.github.com/repos/rafidka/kombu/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/rafidka/kombu/events",
                        "assignees_url": "https://api.github.com/repos/rafidka/kombu/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/rafidka/kombu/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/rafidka/kombu/tags",
                        "blobs_url": "https://api.github.com/repos/rafidka/kombu/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/rafidka/kombu/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/rafidka/kombu/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/rafidka/kombu/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/rafidka/kombu/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/rafidka/kombu/languages",
                        "stargazers_url": "https://api.github.com/repos/rafidka/kombu/stargazers",
                        "contributors_url": "https://api.github.com/repos/rafidka/kombu/contributors",
                        "subscribers_url": "https://api.github.com/repos/rafidka/kombu/subscribers",
                        "subscription_url": "https://api.github.com/repos/rafidka/kombu/subscription",
                        "commits_url": "https://api.github.com/repos/rafidka/kombu/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/rafidka/kombu/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/rafidka/kombu/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/rafidka/kombu/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/rafidka/kombu/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/rafidka/kombu/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/rafidka/kombu/merges",
                        "archive_url": "https://api.github.com/repos/rafidka/kombu/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/rafidka/kombu/downloads",
                        "issues_url": "https://api.github.com/repos/rafidka/kombu/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/rafidka/kombu/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/rafidka/kombu/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/rafidka/kombu/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/rafidka/kombu/labels{/name}",
                        "releases_url": "https://api.github.com/repos/rafidka/kombu/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/rafidka/kombu/deployments",
                        "created_at": "2023-06-19T21:48:27Z",
                        "updated_at": "2023-10-06T01:42:46Z",
                        "pushed_at": "2023-10-17T14:10:46Z",
                        "git_url": "git://github.com/rafidka/kombu.git",
                        "ssh_url": "git@github.com:rafidka/kombu.git",
                        "clone_url": "https://github.com/rafidka/kombu.git",
                        "svn_url": "https://github.com/rafidka/kombu",
                        "homepage": "http://kombu.readthedocs.org/",
                        "size": 6589,
                        "stargazers_count": 0,
                        "watchers_count": 0,
                        "language": "Python",
                        "has_issues": false,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": false,
                        "has_discussions": false,
                        "forks_count": 0,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 0,
                        "license": {
                            "key": "bsd-3-clause",
                            "name": "BSD 3-Clause \"New\" or \"Revised\" License",
                            "spdx_id": "BSD-3-Clause",
                            "url": "https://api.github.com/licenses/bsd-3-clause",
                            "node_id": "MDc6TGljZW5zZTU="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [],
                        "visibility": "public",
                        "forks": 0,
                        "open_issues": 0,
                        "watchers": 0,
                        "default_branch": "main"
                    }
                },
                "base": {
                    "label": "celery:main",
                    "ref": "main",
                    "sha": "1dfe4f3c86ab0fd2587a6fe8566bb3cef8c4a5d7",
                    "user": {
                        "login": "celery",
                        "id": 319983,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjMxOTk4Mw==",
                        "avatar_url": "https://avatars.githubusercontent.com/u/319983?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/celery",
                        "html_url": "https://github.com/celery",
                        "followers_url": "https://api.github.com/users/celery/followers",
                        "following_url": "https://api.github.com/users/celery/following{/other_user}",
                        "gists_url": "https://api.github.com/users/celery/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/celery/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/celery/subscriptions",
                        "organizations_url": "https://api.github.com/users/celery/orgs",
                        "repos_url": "https://api.github.com/users/celery/repos",
                        "events_url": "https://api.github.com/users/celery/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/celery/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 735498,
                        "node_id": "MDEwOlJlcG9zaXRvcnk3MzU0OTg=",
                        "name": "kombu",
                        "full_name": "celery/kombu",
                        "private": false,
                        "owner": {
                            "login": "celery",
                            "id": 319983,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjMxOTk4Mw==",
                            "avatar_url": "https://avatars.githubusercontent.com/u/319983?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/celery",
                            "html_url": "https://github.com/celery",
                            "followers_url": "https://api.github.com/users/celery/followers",
                            "following_url": "https://api.github.com/users/celery/following{/other_user}",
                            "gists_url": "https://api.github.com/users/celery/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/celery/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/celery/subscriptions",
                            "organizations_url": "https://api.github.com/users/celery/orgs",
                            "repos_url": "https://api.github.com/users/celery/repos",
                            "events_url": "https://api.github.com/users/celery/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/celery/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/celery/kombu",
                        "description": "Messaging library for Python.",
                        "fork": false,
                        "url": "https://api.github.com/repos/celery/kombu",
                        "forks_url": "https://api.github.com/repos/celery/kombu/forks",
                        "keys_url": "https://api.github.com/repos/celery/kombu/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/celery/kombu/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/celery/kombu/teams",
                        "hooks_url": "https://api.github.com/repos/celery/kombu/hooks",
                        "issue_events_url": "https://api.github.com/repos/celery/kombu/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/celery/kombu/events",
                        "assignees_url": "https://api.github.com/repos/celery/kombu/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/celery/kombu/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/celery/kombu/tags",
                        "blobs_url": "https://api.github.com/repos/celery/kombu/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/celery/kombu/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/celery/kombu/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/celery/kombu/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/celery/kombu/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/celery/kombu/languages",
                        "stargazers_url": "https://api.github.com/repos/celery/kombu/stargazers",
                        "contributors_url": "https://api.github.com/repos/celery/kombu/contributors",
                        "subscribers_url": "https://api.github.com/repos/celery/kombu/subscribers",
                        "subscription_url": "https://api.github.com/repos/celery/kombu/subscription",
                        "commits_url": "https://api.github.com/repos/celery/kombu/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/celery/kombu/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/celery/kombu/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/celery/kombu/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/celery/kombu/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/celery/kombu/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/celery/kombu/merges",
                        "archive_url": "https://api.github.com/repos/celery/kombu/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/celery/kombu/downloads",
                        "issues_url": "https://api.github.com/repos/celery/kombu/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/celery/kombu/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/celery/kombu/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/celery/kombu/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/celery/kombu/labels{/name}",
                        "releases_url": "https://api.github.com/repos/celery/kombu/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/celery/kombu/deployments",
                        "created_at": "2010-06-23T10:10:24Z",
                        "updated_at": "2023-10-19T21:24:17Z",
                        "pushed_at": "2023-10-18T10:14:29Z",
                        "git_url": "git://github.com/celery/kombu.git",
                        "ssh_url": "git@github.com:celery/kombu.git",
                        "clone_url": "https://github.com/celery/kombu.git",
                        "svn_url": "https://github.com/celery/kombu",
                        "homepage": "http://kombu.readthedocs.org/",
                        "size": 8758,
                        "stargazers_count": 2629,
                        "watchers_count": 2629,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": true,
                        "forks_count": 933,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 191,
                        "license": {
                            "key": "bsd-3-clause",
                            "name": "BSD 3-Clause \"New\" or \"Revised\" License",
                            "spdx_id": "BSD-3-Clause",
                            "url": "https://api.github.com/licenses/bsd-3-clause",
                            "node_id": "MDc6TGljZW5zZTU="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "celery",
                            "kombu",
                            "message-queue",
                            "messaging",
                            "python",
                            "python-3",
                            "python-library",
                            "python3",
                            "rabbitmq",
                            "redis",
                            "sqs"
                        ],
                        "visibility": "public",
                        "forks": 933,
                        "open_issues": 191,
                        "watchers": 2629,
                        "default_branch": "main"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807"
                    },
                    "html": {
                        "href": "https://github.com/celery/kombu/pull/1807"
                    },
                    "issue": {
                        "href": "https://api.github.com/repos/celery/kombu/issues/1807"
                    },
                    "comments": {
                        "href": "https://api.github.com/repos/celery/kombu/issues/1807/comments"
                    },
                    "review_comments": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807/comments"
                    },
                    "review_comment": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/comments{/number}"
                    },
                    "commits": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807/commits"
                    },
                    "statuses": {
                        "href": "https://api.github.com/repos/celery/kombu/statuses/9e903aa9116fa345a68897f67979a4f8a367a71c"
                    }
                },
                "author_association": "CONTRIBUTOR",
                "auto_merge": null,
                "active_lock_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-22T10:48:30Z",
        "org": {
            "id": 319983,
            "login": "celery",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/celery",
            "avatar_url": "https://avatars.githubusercontent.com/u/319983?"
        }
    },
    {
        "id": "32750172350",
        "type": "PullRequestReviewEvent",
        "actor": {
            "id": 6212603,
            "login": "auvipy",
            "display_login": "auvipy",
            "gravatar_id": "",
            "url": "https://api.github.com/users/auvipy",
            "avatar_url": "https://avatars.githubusercontent.com/u/6212603?"
        },
        "repo": {
            "id": 735498,
            "name": "celery/kombu",
            "url": "https://api.github.com/repos/celery/kombu"
        },
        "payload": {
            "action": "created",
            "review": {
                "id": 1691411657,
                "node_id": "PRR_kwDOAAs5Cs5k0OTJ",
                "user": {
                    "login": "auvipy",
                    "id": 6212603,
                    "node_id": "MDQ6VXNlcjYyMTI2MDM=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/6212603?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/auvipy",
                    "html_url": "https://github.com/auvipy",
                    "followers_url": "https://api.github.com/users/auvipy/followers",
                    "following_url": "https://api.github.com/users/auvipy/following{/other_user}",
                    "gists_url": "https://api.github.com/users/auvipy/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/auvipy/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/auvipy/subscriptions",
                    "organizations_url": "https://api.github.com/users/auvipy/orgs",
                    "repos_url": "https://api.github.com/users/auvipy/repos",
                    "events_url": "https://api.github.com/users/auvipy/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/auvipy/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "unit test coverage for the new code. and if possible Integration tests",
                "commit_id": "9e903aa9116fa345a68897f67979a4f8a367a71c",
                "submitted_at": "2023-10-22T10:48:29Z",
                "state": "changes_requested",
                "html_url": "https://github.com/celery/kombu/pull/1807#pullrequestreview-1691411657",
                "pull_request_url": "https://api.github.com/repos/celery/kombu/pulls/1807",
                "author_association": "MEMBER",
                "_links": {
                    "html": {
                        "href": "https://github.com/celery/kombu/pull/1807#pullrequestreview-1691411657"
                    },
                    "pull_request": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807"
                    }
                }
            },
            "pull_request": {
                "url": "https://api.github.com/repos/celery/kombu/pulls/1807",
                "id": 1548262937,
                "node_id": "PR_kwDOAAs5Cs5cSJ4Z",
                "html_url": "https://github.com/celery/kombu/pull/1807",
                "diff_url": "https://github.com/celery/kombu/pull/1807.diff",
                "patch_url": "https://github.com/celery/kombu/pull/1807.patch",
                "issue_url": "https://api.github.com/repos/celery/kombu/issues/1807",
                "number": 1807,
                "state": "open",
                "locked": false,
                "title": "[WIP] Use the correct protocol for SQS requests",
                "user": {
                    "login": "rafidka",
                    "id": 442447,
                    "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/rafidka",
                    "html_url": "https://github.com/rafidka",
                    "followers_url": "https://api.github.com/users/rafidka/followers",
                    "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                    "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                    "organizations_url": "https://api.github.com/users/rafidka/orgs",
                    "repos_url": "https://api.github.com/users/rafidka/repos",
                    "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/rafidka/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "TL;DR - The use of boto3 in #1759 resulted in relying on blocking (synchronous) HTTP requests, which caused the performance issue reported in #1783.\r\n\r\n`kombu` previously used to craft AWS requests manually as explained in detail in #1726, which resulted in an outage when botocore temporarily changed the default protocol to JSON (before rolling back due to the impact on celery and airflow.) To fix the issue, I submitted #1759, which changes `kombu` to use `boto3` instead of manually crafting AWS requests. This way when boto3 changes the default protocol, kombu won't be impacted.\r\n\r\nWhile working on #1759, I did extensive debugging to understand the multi-threading nature of kombu. What I discovered is that there isn't an actual multi-threading in the true sense of the word, but an event loop that runs on the same thread and process and orchestrate the communication with SQS. As such, it didn't appear to me that there is anything to worry about my change, and the testing I did didn't discover any issue. However, it turns out that while kombu's event loop doesn't have actual multi-threading, its [reliance on pycurl](https://github.com/celery/kombu/blob/main/kombu/asynchronous/http/curl.py#L48) (and thus libcurl) meant that the requests to AWS were being done asynchronously. On the other hand, boto3 requests are always done synchronously, i.e. they are blocking requests.\r\n\r\nThe above meant that my change introduced blocking on the event loop of kombu. This is fine in most of the cases, since the requests to SQS are pretty fast. However, in the case of using long-polling, a call to SQS's ReceiveMessage can last up to 20 seconds (depending on the user configuration).\r\n\r\nTo solve this problem, I rolled back my earlier changes and, instead, to address the issue reported in #1726, I now changed the `AsyncSQSConnection` class such that it crafts either a `query` or a `json` request depending on the protocol used by the SQS client. Thus, when botocore changes the default protocol of SQS to JSON, kombu won't be impacted, since it crafts its own request and, after my change, it uses a hard-coded protocol based on the crafted requests.\r\n\r\nThis solution shouldn't be the final solution, and it is more of a workaround that does the job for now. The final solution should be to completely rely on boto3 for any communication with AWS, and ensuring that all requests are async in nature (non-blocking.) This, however, is a fundamental change that requires a lot of testing, in particular performance testing.\r\n",
                "created_at": "2023-10-09T17:36:06Z",
                "updated_at": "2023-10-22T10:48:29Z",
                "closed_at": null,
                "merged_at": null,
                "merge_commit_sha": "f6243abe6fb30d7a7b5dfa592e36d02bc35987f3",
                "assignee": null,
                "assignees": [],
                "requested_reviewers": [],
                "requested_teams": [],
                "labels": [],
                "milestone": null,
                "draft": false,
                "commits_url": "https://api.github.com/repos/celery/kombu/pulls/1807/commits",
                "review_comments_url": "https://api.github.com/repos/celery/kombu/pulls/1807/comments",
                "review_comment_url": "https://api.github.com/repos/celery/kombu/pulls/comments{/number}",
                "comments_url": "https://api.github.com/repos/celery/kombu/issues/1807/comments",
                "statuses_url": "https://api.github.com/repos/celery/kombu/statuses/9e903aa9116fa345a68897f67979a4f8a367a71c",
                "head": {
                    "label": "rafidka:fix-1783",
                    "ref": "fix-1783",
                    "sha": "9e903aa9116fa345a68897f67979a4f8a367a71c",
                    "user": {
                        "login": "rafidka",
                        "id": 442447,
                        "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                        "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/rafidka",
                        "html_url": "https://github.com/rafidka",
                        "followers_url": "https://api.github.com/users/rafidka/followers",
                        "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                        "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                        "organizations_url": "https://api.github.com/users/rafidka/orgs",
                        "repos_url": "https://api.github.com/users/rafidka/repos",
                        "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/rafidka/received_events",
                        "type": "User",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 655909423,
                        "node_id": "R_kgDOJxhiLw",
                        "name": "kombu",
                        "full_name": "rafidka/kombu",
                        "private": false,
                        "owner": {
                            "login": "rafidka",
                            "id": 442447,
                            "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                            "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/rafidka",
                            "html_url": "https://github.com/rafidka",
                            "followers_url": "https://api.github.com/users/rafidka/followers",
                            "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                            "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                            "organizations_url": "https://api.github.com/users/rafidka/orgs",
                            "repos_url": "https://api.github.com/users/rafidka/repos",
                            "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/rafidka/received_events",
                            "type": "User",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/rafidka/kombu",
                        "description": "Messaging library for Python.",
                        "fork": true,
                        "url": "https://api.github.com/repos/rafidka/kombu",
                        "forks_url": "https://api.github.com/repos/rafidka/kombu/forks",
                        "keys_url": "https://api.github.com/repos/rafidka/kombu/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/rafidka/kombu/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/rafidka/kombu/teams",
                        "hooks_url": "https://api.github.com/repos/rafidka/kombu/hooks",
                        "issue_events_url": "https://api.github.com/repos/rafidka/kombu/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/rafidka/kombu/events",
                        "assignees_url": "https://api.github.com/repos/rafidka/kombu/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/rafidka/kombu/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/rafidka/kombu/tags",
                        "blobs_url": "https://api.github.com/repos/rafidka/kombu/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/rafidka/kombu/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/rafidka/kombu/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/rafidka/kombu/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/rafidka/kombu/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/rafidka/kombu/languages",
                        "stargazers_url": "https://api.github.com/repos/rafidka/kombu/stargazers",
                        "contributors_url": "https://api.github.com/repos/rafidka/kombu/contributors",
                        "subscribers_url": "https://api.github.com/repos/rafidka/kombu/subscribers",
                        "subscription_url": "https://api.github.com/repos/rafidka/kombu/subscription",
                        "commits_url": "https://api.github.com/repos/rafidka/kombu/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/rafidka/kombu/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/rafidka/kombu/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/rafidka/kombu/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/rafidka/kombu/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/rafidka/kombu/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/rafidka/kombu/merges",
                        "archive_url": "https://api.github.com/repos/rafidka/kombu/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/rafidka/kombu/downloads",
                        "issues_url": "https://api.github.com/repos/rafidka/kombu/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/rafidka/kombu/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/rafidka/kombu/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/rafidka/kombu/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/rafidka/kombu/labels{/name}",
                        "releases_url": "https://api.github.com/repos/rafidka/kombu/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/rafidka/kombu/deployments",
                        "created_at": "2023-06-19T21:48:27Z",
                        "updated_at": "2023-10-06T01:42:46Z",
                        "pushed_at": "2023-10-17T14:10:46Z",
                        "git_url": "git://github.com/rafidka/kombu.git",
                        "ssh_url": "git@github.com:rafidka/kombu.git",
                        "clone_url": "https://github.com/rafidka/kombu.git",
                        "svn_url": "https://github.com/rafidka/kombu",
                        "homepage": "http://kombu.readthedocs.org/",
                        "size": 6589,
                        "stargazers_count": 0,
                        "watchers_count": 0,
                        "language": "Python",
                        "has_issues": false,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": false,
                        "has_discussions": false,
                        "forks_count": 0,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 0,
                        "license": {
                            "key": "bsd-3-clause",
                            "name": "BSD 3-Clause \"New\" or \"Revised\" License",
                            "spdx_id": "BSD-3-Clause",
                            "url": "https://api.github.com/licenses/bsd-3-clause",
                            "node_id": "MDc6TGljZW5zZTU="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [],
                        "visibility": "public",
                        "forks": 0,
                        "open_issues": 0,
                        "watchers": 0,
                        "default_branch": "main"
                    }
                },
                "base": {
                    "label": "celery:main",
                    "ref": "main",
                    "sha": "1dfe4f3c86ab0fd2587a6fe8566bb3cef8c4a5d7",
                    "user": {
                        "login": "celery",
                        "id": 319983,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjMxOTk4Mw==",
                        "avatar_url": "https://avatars.githubusercontent.com/u/319983?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/celery",
                        "html_url": "https://github.com/celery",
                        "followers_url": "https://api.github.com/users/celery/followers",
                        "following_url": "https://api.github.com/users/celery/following{/other_user}",
                        "gists_url": "https://api.github.com/users/celery/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/celery/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/celery/subscriptions",
                        "organizations_url": "https://api.github.com/users/celery/orgs",
                        "repos_url": "https://api.github.com/users/celery/repos",
                        "events_url": "https://api.github.com/users/celery/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/celery/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 735498,
                        "node_id": "MDEwOlJlcG9zaXRvcnk3MzU0OTg=",
                        "name": "kombu",
                        "full_name": "celery/kombu",
                        "private": false,
                        "owner": {
                            "login": "celery",
                            "id": 319983,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjMxOTk4Mw==",
                            "avatar_url": "https://avatars.githubusercontent.com/u/319983?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/celery",
                            "html_url": "https://github.com/celery",
                            "followers_url": "https://api.github.com/users/celery/followers",
                            "following_url": "https://api.github.com/users/celery/following{/other_user}",
                            "gists_url": "https://api.github.com/users/celery/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/celery/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/celery/subscriptions",
                            "organizations_url": "https://api.github.com/users/celery/orgs",
                            "repos_url": "https://api.github.com/users/celery/repos",
                            "events_url": "https://api.github.com/users/celery/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/celery/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/celery/kombu",
                        "description": "Messaging library for Python.",
                        "fork": false,
                        "url": "https://api.github.com/repos/celery/kombu",
                        "forks_url": "https://api.github.com/repos/celery/kombu/forks",
                        "keys_url": "https://api.github.com/repos/celery/kombu/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/celery/kombu/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/celery/kombu/teams",
                        "hooks_url": "https://api.github.com/repos/celery/kombu/hooks",
                        "issue_events_url": "https://api.github.com/repos/celery/kombu/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/celery/kombu/events",
                        "assignees_url": "https://api.github.com/repos/celery/kombu/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/celery/kombu/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/celery/kombu/tags",
                        "blobs_url": "https://api.github.com/repos/celery/kombu/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/celery/kombu/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/celery/kombu/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/celery/kombu/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/celery/kombu/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/celery/kombu/languages",
                        "stargazers_url": "https://api.github.com/repos/celery/kombu/stargazers",
                        "contributors_url": "https://api.github.com/repos/celery/kombu/contributors",
                        "subscribers_url": "https://api.github.com/repos/celery/kombu/subscribers",
                        "subscription_url": "https://api.github.com/repos/celery/kombu/subscription",
                        "commits_url": "https://api.github.com/repos/celery/kombu/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/celery/kombu/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/celery/kombu/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/celery/kombu/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/celery/kombu/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/celery/kombu/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/celery/kombu/merges",
                        "archive_url": "https://api.github.com/repos/celery/kombu/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/celery/kombu/downloads",
                        "issues_url": "https://api.github.com/repos/celery/kombu/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/celery/kombu/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/celery/kombu/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/celery/kombu/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/celery/kombu/labels{/name}",
                        "releases_url": "https://api.github.com/repos/celery/kombu/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/celery/kombu/deployments",
                        "created_at": "2010-06-23T10:10:24Z",
                        "updated_at": "2023-10-19T21:24:17Z",
                        "pushed_at": "2023-10-18T10:14:29Z",
                        "git_url": "git://github.com/celery/kombu.git",
                        "ssh_url": "git@github.com:celery/kombu.git",
                        "clone_url": "https://github.com/celery/kombu.git",
                        "svn_url": "https://github.com/celery/kombu",
                        "homepage": "http://kombu.readthedocs.org/",
                        "size": 8758,
                        "stargazers_count": 2629,
                        "watchers_count": 2629,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": true,
                        "forks_count": 933,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 191,
                        "license": {
                            "key": "bsd-3-clause",
                            "name": "BSD 3-Clause \"New\" or \"Revised\" License",
                            "spdx_id": "BSD-3-Clause",
                            "url": "https://api.github.com/licenses/bsd-3-clause",
                            "node_id": "MDc6TGljZW5zZTU="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "celery",
                            "kombu",
                            "message-queue",
                            "messaging",
                            "python",
                            "python-3",
                            "python-library",
                            "python3",
                            "rabbitmq",
                            "redis",
                            "sqs"
                        ],
                        "visibility": "public",
                        "forks": 933,
                        "open_issues": 191,
                        "watchers": 2629,
                        "default_branch": "main"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807"
                    },
                    "html": {
                        "href": "https://github.com/celery/kombu/pull/1807"
                    },
                    "issue": {
                        "href": "https://api.github.com/repos/celery/kombu/issues/1807"
                    },
                    "comments": {
                        "href": "https://api.github.com/repos/celery/kombu/issues/1807/comments"
                    },
                    "review_comments": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807/comments"
                    },
                    "review_comment": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/comments{/number}"
                    },
                    "commits": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807/commits"
                    },
                    "statuses": {
                        "href": "https://api.github.com/repos/celery/kombu/statuses/9e903aa9116fa345a68897f67979a4f8a367a71c"
                    }
                },
                "author_association": "CONTRIBUTOR",
                "auto_merge": null,
                "active_lock_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-22T10:48:30Z",
        "org": {
            "id": 319983,
            "login": "celery",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/celery",
            "avatar_url": "https://avatars.githubusercontent.com/u/319983?"
        }
    },
    {
        "id": "32739742301",
        "type": "IssueCommentEvent",
        "actor": {
            "id": 442447,
            "login": "rafidka",
            "display_login": "rafidka",
            "gravatar_id": "",
            "url": "https://api.github.com/users/rafidka",
            "avatar_url": "https://avatars.githubusercontent.com/u/442447?"
        },
        "repo": {
            "id": 735498,
            "name": "celery/kombu",
            "url": "https://api.github.com/repos/celery/kombu"
        },
        "payload": {
            "action": "created",
            "issue": {
                "url": "https://api.github.com/repos/celery/kombu/issues/1807",
                "repository_url": "https://api.github.com/repos/celery/kombu",
                "labels_url": "https://api.github.com/repos/celery/kombu/issues/1807/labels{/name}",
                "comments_url": "https://api.github.com/repos/celery/kombu/issues/1807/comments",
                "events_url": "https://api.github.com/repos/celery/kombu/issues/1807/events",
                "html_url": "https://github.com/celery/kombu/pull/1807",
                "id": 1933514281,
                "node_id": "PR_kwDOAAs5Cs5cSJ4Z",
                "number": 1807,
                "title": "[WIP] Use the correct protocol for SQS requests",
                "user": {
                    "login": "rafidka",
                    "id": 442447,
                    "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/rafidka",
                    "html_url": "https://github.com/rafidka",
                    "followers_url": "https://api.github.com/users/rafidka/followers",
                    "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                    "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                    "organizations_url": "https://api.github.com/users/rafidka/orgs",
                    "repos_url": "https://api.github.com/users/rafidka/repos",
                    "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/rafidka/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "labels": [],
                "state": "open",
                "locked": false,
                "assignee": null,
                "assignees": [],
                "milestone": null,
                "comments": 8,
                "created_at": "2023-10-09T17:36:06Z",
                "updated_at": "2023-10-21T08:31:11Z",
                "closed_at": null,
                "author_association": "CONTRIBUTOR",
                "active_lock_reason": null,
                "draft": false,
                "pull_request": {
                    "url": "https://api.github.com/repos/celery/kombu/pulls/1807",
                    "html_url": "https://github.com/celery/kombu/pull/1807",
                    "diff_url": "https://github.com/celery/kombu/pull/1807.diff",
                    "patch_url": "https://github.com/celery/kombu/pull/1807.patch",
                    "merged_at": null
                },
                "body": "TL;DR - The use of boto3 in #1759 resulted in relying on blocking (synchronous) HTTP requests, which caused the performance issue reported in #1783.\r\n\r\n`kombu` previously used to craft AWS requests manually as explained in detail in #1726, which resulted in an outage when botocore temporarily changed the default protocol to JSON (before rolling back due to the impact on celery and airflow.) To fix the issue, I submitted #1759, which changes `kombu` to use `boto3` instead of manually crafting AWS requests. This way when boto3 changes the default protocol, kombu won't be impacted.\r\n\r\nWhile working on #1759, I did extensive debugging to understand the multi-threading nature of kombu. What I discovered is that there isn't an actual multi-threading in the true sense of the word, but an event loop that runs on the same thread and process and orchestrate the communication with SQS. As such, it didn't appear to me that there is anything to worry about my change, and the testing I did didn't discover any issue. However, it turns out that while kombu's event loop doesn't have actual multi-threading, its [reliance on pycurl](https://github.com/celery/kombu/blob/main/kombu/asynchronous/http/curl.py#L48) (and thus libcurl) meant that the requests to AWS were being done asynchronously. On the other hand, boto3 requests are always done synchronously, i.e. they are blocking requests.\r\n\r\nThe above meant that my change introduced blocking on the event loop of kombu. This is fine in most of the cases, since the requests to SQS are pretty fast. However, in the case of using long-polling, a call to SQS's ReceiveMessage can last up to 20 seconds (depending on the user configuration).\r\n\r\nTo solve this problem, I rolled back my earlier changes and, instead, to address the issue reported in #1726, I now changed the `AsyncSQSConnection` class such that it crafts either a `query` or a `json` request depending on the protocol used by the SQS client. Thus, when botocore changes the default protocol of SQS to JSON, kombu won't be impacted, since it crafts its own request and, after my change, it uses a hard-coded protocol based on the crafted requests.\r\n\r\nThis solution shouldn't be the final solution, and it is more of a workaround that does the job for now. The final solution should be to completely rely on boto3 for any communication with AWS, and ensuring that all requests are async in nature (non-blocking.) This, however, is a fundamental change that requires a lot of testing, in particular performance testing.\r\n",
                "reactions": {
                    "url": "https://api.github.com/repos/celery/kombu/issues/1807/reactions",
                    "total_count": 0,
                    "+1": 0,
                    "-1": 0,
                    "laugh": 0,
                    "hooray": 0,
                    "confused": 0,
                    "heart": 0,
                    "rocket": 0,
                    "eyes": 0
                },
                "timeline_url": "https://api.github.com/repos/celery/kombu/issues/1807/timeline",
                "performed_via_github_app": null,
                "state_reason": null
            },
            "comment": {
                "url": "https://api.github.com/repos/celery/kombu/issues/comments/1773717795",
                "html_url": "https://github.com/celery/kombu/pull/1807#issuecomment-1773717795",
                "issue_url": "https://api.github.com/repos/celery/kombu/issues/1807",
                "id": 1773717795,
                "node_id": "IC_kwDOAAs5Cs5puMkj",
                "user": {
                    "login": "rafidka",
                    "id": 442447,
                    "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/rafidka",
                    "html_url": "https://github.com/rafidka",
                    "followers_url": "https://api.github.com/users/rafidka/followers",
                    "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                    "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                    "organizations_url": "https://api.github.com/users/rafidka/orgs",
                    "repos_url": "https://api.github.com/users/rafidka/repos",
                    "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/rafidka/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "created_at": "2023-10-21T08:31:11Z",
                "updated_at": "2023-10-21T08:31:11Z",
                "author_association": "CONTRIBUTOR",
                "body": "> after all process is complete, we will need the test coverage as well.\r\n\r\n@auvipy Can you explain what kind of coverage you are looking for?\r\n",
                "reactions": {
                    "url": "https://api.github.com/repos/celery/kombu/issues/comments/1773717795/reactions",
                    "total_count": 0,
                    "+1": 0,
                    "-1": 0,
                    "laugh": 0,
                    "hooray": 0,
                    "confused": 0,
                    "heart": 0,
                    "rocket": 0,
                    "eyes": 0
                },
                "performed_via_github_app": null
            }
        },
        "public": true,
        "created_at": "2023-10-21T08:31:11Z",
        "org": {
            "id": 319983,
            "login": "celery",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/celery",
            "avatar_url": "https://avatars.githubusercontent.com/u/319983?"
        }
    },
    {
        "id": "32739733326",
        "type": "PullRequestReviewCommentEvent",
        "actor": {
            "id": 442447,
            "login": "rafidka",
            "display_login": "rafidka",
            "gravatar_id": "",
            "url": "https://api.github.com/users/rafidka",
            "avatar_url": "https://avatars.githubusercontent.com/u/442447?"
        },
        "repo": {
            "id": 735498,
            "name": "celery/kombu",
            "url": "https://api.github.com/repos/celery/kombu"
        },
        "payload": {
            "action": "created",
            "comment": {
                "url": "https://api.github.com/repos/celery/kombu/pulls/comments/1367689944",
                "pull_request_review_id": 1691214912,
                "id": 1367689944,
                "node_id": "PRRC_kwDOAAs5Cs5RhUrY",
                "diff_hunk": "@@ -25,6 +29,76 @@ def __init__(self, sqs_connection, debug=0, region=None, **kwargs):\n             **kwargs\n         )\n \n+    def _create_query_request(self, operation, params, queue_url, method):\n+        params = params.copy()\n+        if operation:\n+            params['Action'] = operation\n+\n+        # defaults for non-get\n+        param_payload = {'data': params}\n+        if method.lower() == 'get':\n+            # query-based opts\n+            param_payload = {'params': params}\n+\n+        return AWSRequest(method=method, url=queue_url, **param_payload)\n+\n+    def _create_json_request(self, operation, params, queue_url):\n+        params = params.copy()\n+        params['QueueUrl'] = queue_url\n+\n+        service_model = self.sqs_connection.meta.service_model\n+        operation_model = service_model.operation_model(operation)\n+\n+        url = self.sqs_connection._endpoint.host\n+\n+        headers = {}\n+        # Content-Type\n+        json_version = operation_model.metadata['jsonVersion']\n+        content_type = f'application/x-amz-json-{json_version}'\n+        headers['Content-Type'] = content_type\n+\n+        # X-Amz-Target\n+        target = '{}.{}'.format(\n+            operation_model.metadata['targetPrefix'],\n+            operation_model.name,\n+        )\n+        headers['X-Amz-Target'] = target\n+\n+        param_payload = {\n+            'data': json.dumps(params),\n+            'headers': headers\n+        }\n+\n+        method = operation_model.http.get('method', Serializer.DEFAULT_METHOD)\n+        return AWSRequest(\n+            method=method,\n+            url=url,\n+            **param_payload\n+        )\n+\n+    def make_request(self, operation_name, params, queue_url, verb, callback=None):  # noqa\n+        signer = self.sqs_connection._request_signer\n+\n+        service_model = self.sqs_connection.meta.service_model\n+        protocol = service_model.protocol\n+",
                "path": "kombu/asynchronous/aws/sqs/connection.py",
                "commit_id": "9e903aa9116fa345a68897f67979a4f8a367a71c",
                "original_commit_id": "9e903aa9116fa345a68897f67979a4f8a367a71c",
                "user": {
                    "login": "rafidka",
                    "id": 442447,
                    "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/rafidka",
                    "html_url": "https://github.com/rafidka",
                    "followers_url": "https://api.github.com/users/rafidka/followers",
                    "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                    "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                    "organizations_url": "https://api.github.com/users/rafidka/orgs",
                    "repos_url": "https://api.github.com/users/rafidka/repos",
                    "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/rafidka/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "Totally. I will do that.",
                "created_at": "2023-10-21T08:29:48Z",
                "updated_at": "2023-10-21T08:29:48Z",
                "html_url": "https://github.com/celery/kombu/pull/1807#discussion_r1367689944",
                "pull_request_url": "https://api.github.com/repos/celery/kombu/pulls/1807",
                "author_association": "CONTRIBUTOR",
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/comments/1367689944"
                    },
                    "html": {
                        "href": "https://github.com/celery/kombu/pull/1807#discussion_r1367689944"
                    },
                    "pull_request": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807"
                    }
                },
                "reactions": {
                    "url": "https://api.github.com/repos/celery/kombu/pulls/comments/1367689944/reactions",
                    "total_count": 0,
                    "+1": 0,
                    "-1": 0,
                    "laugh": 0,
                    "hooray": 0,
                    "confused": 0,
                    "heart": 0,
                    "rocket": 0,
                    "eyes": 0
                },
                "start_line": null,
                "original_start_line": null,
                "start_side": null,
                "line": 84,
                "original_line": 84,
                "side": "RIGHT",
                "in_reply_to_id": 1365939212,
                "original_position": 70,
                "position": 70,
                "subject_type": "line"
            },
            "pull_request": {
                "url": "https://api.github.com/repos/celery/kombu/pulls/1807",
                "id": 1548262937,
                "node_id": "PR_kwDOAAs5Cs5cSJ4Z",
                "html_url": "https://github.com/celery/kombu/pull/1807",
                "diff_url": "https://github.com/celery/kombu/pull/1807.diff",
                "patch_url": "https://github.com/celery/kombu/pull/1807.patch",
                "issue_url": "https://api.github.com/repos/celery/kombu/issues/1807",
                "number": 1807,
                "state": "open",
                "locked": false,
                "title": "[WIP] Use the correct protocol for SQS requests",
                "user": {
                    "login": "rafidka",
                    "id": 442447,
                    "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/rafidka",
                    "html_url": "https://github.com/rafidka",
                    "followers_url": "https://api.github.com/users/rafidka/followers",
                    "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                    "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                    "organizations_url": "https://api.github.com/users/rafidka/orgs",
                    "repos_url": "https://api.github.com/users/rafidka/repos",
                    "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/rafidka/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "TL;DR - The use of boto3 in #1759 resulted in relying on blocking (synchronous) HTTP requests, which caused the performance issue reported in #1783.\r\n\r\n`kombu` previously used to craft AWS requests manually as explained in detail in #1726, which resulted in an outage when botocore temporarily changed the default protocol to JSON (before rolling back due to the impact on celery and airflow.) To fix the issue, I submitted #1759, which changes `kombu` to use `boto3` instead of manually crafting AWS requests. This way when boto3 changes the default protocol, kombu won't be impacted.\r\n\r\nWhile working on #1759, I did extensive debugging to understand the multi-threading nature of kombu. What I discovered is that there isn't an actual multi-threading in the true sense of the word, but an event loop that runs on the same thread and process and orchestrate the communication with SQS. As such, it didn't appear to me that there is anything to worry about my change, and the testing I did didn't discover any issue. However, it turns out that while kombu's event loop doesn't have actual multi-threading, its [reliance on pycurl](https://github.com/celery/kombu/blob/main/kombu/asynchronous/http/curl.py#L48) (and thus libcurl) meant that the requests to AWS were being done asynchronously. On the other hand, boto3 requests are always done synchronously, i.e. they are blocking requests.\r\n\r\nThe above meant that my change introduced blocking on the event loop of kombu. This is fine in most of the cases, since the requests to SQS are pretty fast. However, in the case of using long-polling, a call to SQS's ReceiveMessage can last up to 20 seconds (depending on the user configuration).\r\n\r\nTo solve this problem, I rolled back my earlier changes and, instead, to address the issue reported in #1726, I now changed the `AsyncSQSConnection` class such that it crafts either a `query` or a `json` request depending on the protocol used by the SQS client. Thus, when botocore changes the default protocol of SQS to JSON, kombu won't be impacted, since it crafts its own request and, after my change, it uses a hard-coded protocol based on the crafted requests.\r\n\r\nThis solution shouldn't be the final solution, and it is more of a workaround that does the job for now. The final solution should be to completely rely on boto3 for any communication with AWS, and ensuring that all requests are async in nature (non-blocking.) This, however, is a fundamental change that requires a lot of testing, in particular performance testing.\r\n",
                "created_at": "2023-10-09T17:36:06Z",
                "updated_at": "2023-10-21T08:29:48Z",
                "closed_at": null,
                "merged_at": null,
                "merge_commit_sha": "f6243abe6fb30d7a7b5dfa592e36d02bc35987f3",
                "assignee": null,
                "assignees": [],
                "requested_reviewers": [],
                "requested_teams": [],
                "labels": [],
                "milestone": null,
                "draft": false,
                "commits_url": "https://api.github.com/repos/celery/kombu/pulls/1807/commits",
                "review_comments_url": "https://api.github.com/repos/celery/kombu/pulls/1807/comments",
                "review_comment_url": "https://api.github.com/repos/celery/kombu/pulls/comments{/number}",
                "comments_url": "https://api.github.com/repos/celery/kombu/issues/1807/comments",
                "statuses_url": "https://api.github.com/repos/celery/kombu/statuses/9e903aa9116fa345a68897f67979a4f8a367a71c",
                "head": {
                    "label": "rafidka:fix-1783",
                    "ref": "fix-1783",
                    "sha": "9e903aa9116fa345a68897f67979a4f8a367a71c",
                    "user": {
                        "login": "rafidka",
                        "id": 442447,
                        "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                        "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/rafidka",
                        "html_url": "https://github.com/rafidka",
                        "followers_url": "https://api.github.com/users/rafidka/followers",
                        "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                        "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                        "organizations_url": "https://api.github.com/users/rafidka/orgs",
                        "repos_url": "https://api.github.com/users/rafidka/repos",
                        "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/rafidka/received_events",
                        "type": "User",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 655909423,
                        "node_id": "R_kgDOJxhiLw",
                        "name": "kombu",
                        "full_name": "rafidka/kombu",
                        "private": false,
                        "owner": {
                            "login": "rafidka",
                            "id": 442447,
                            "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                            "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/rafidka",
                            "html_url": "https://github.com/rafidka",
                            "followers_url": "https://api.github.com/users/rafidka/followers",
                            "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                            "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                            "organizations_url": "https://api.github.com/users/rafidka/orgs",
                            "repos_url": "https://api.github.com/users/rafidka/repos",
                            "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/rafidka/received_events",
                            "type": "User",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/rafidka/kombu",
                        "description": "Messaging library for Python.",
                        "fork": true,
                        "url": "https://api.github.com/repos/rafidka/kombu",
                        "forks_url": "https://api.github.com/repos/rafidka/kombu/forks",
                        "keys_url": "https://api.github.com/repos/rafidka/kombu/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/rafidka/kombu/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/rafidka/kombu/teams",
                        "hooks_url": "https://api.github.com/repos/rafidka/kombu/hooks",
                        "issue_events_url": "https://api.github.com/repos/rafidka/kombu/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/rafidka/kombu/events",
                        "assignees_url": "https://api.github.com/repos/rafidka/kombu/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/rafidka/kombu/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/rafidka/kombu/tags",
                        "blobs_url": "https://api.github.com/repos/rafidka/kombu/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/rafidka/kombu/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/rafidka/kombu/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/rafidka/kombu/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/rafidka/kombu/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/rafidka/kombu/languages",
                        "stargazers_url": "https://api.github.com/repos/rafidka/kombu/stargazers",
                        "contributors_url": "https://api.github.com/repos/rafidka/kombu/contributors",
                        "subscribers_url": "https://api.github.com/repos/rafidka/kombu/subscribers",
                        "subscription_url": "https://api.github.com/repos/rafidka/kombu/subscription",
                        "commits_url": "https://api.github.com/repos/rafidka/kombu/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/rafidka/kombu/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/rafidka/kombu/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/rafidka/kombu/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/rafidka/kombu/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/rafidka/kombu/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/rafidka/kombu/merges",
                        "archive_url": "https://api.github.com/repos/rafidka/kombu/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/rafidka/kombu/downloads",
                        "issues_url": "https://api.github.com/repos/rafidka/kombu/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/rafidka/kombu/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/rafidka/kombu/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/rafidka/kombu/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/rafidka/kombu/labels{/name}",
                        "releases_url": "https://api.github.com/repos/rafidka/kombu/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/rafidka/kombu/deployments",
                        "created_at": "2023-06-19T21:48:27Z",
                        "updated_at": "2023-10-06T01:42:46Z",
                        "pushed_at": "2023-10-17T14:10:46Z",
                        "git_url": "git://github.com/rafidka/kombu.git",
                        "ssh_url": "git@github.com:rafidka/kombu.git",
                        "clone_url": "https://github.com/rafidka/kombu.git",
                        "svn_url": "https://github.com/rafidka/kombu",
                        "homepage": "http://kombu.readthedocs.org/",
                        "size": 6589,
                        "stargazers_count": 0,
                        "watchers_count": 0,
                        "language": "Python",
                        "has_issues": false,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": false,
                        "has_discussions": false,
                        "forks_count": 0,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 0,
                        "license": {
                            "key": "bsd-3-clause",
                            "name": "BSD 3-Clause \"New\" or \"Revised\" License",
                            "spdx_id": "BSD-3-Clause",
                            "url": "https://api.github.com/licenses/bsd-3-clause",
                            "node_id": "MDc6TGljZW5zZTU="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [],
                        "visibility": "public",
                        "forks": 0,
                        "open_issues": 0,
                        "watchers": 0,
                        "default_branch": "main"
                    }
                },
                "base": {
                    "label": "celery:main",
                    "ref": "main",
                    "sha": "1dfe4f3c86ab0fd2587a6fe8566bb3cef8c4a5d7",
                    "user": {
                        "login": "celery",
                        "id": 319983,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjMxOTk4Mw==",
                        "avatar_url": "https://avatars.githubusercontent.com/u/319983?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/celery",
                        "html_url": "https://github.com/celery",
                        "followers_url": "https://api.github.com/users/celery/followers",
                        "following_url": "https://api.github.com/users/celery/following{/other_user}",
                        "gists_url": "https://api.github.com/users/celery/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/celery/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/celery/subscriptions",
                        "organizations_url": "https://api.github.com/users/celery/orgs",
                        "repos_url": "https://api.github.com/users/celery/repos",
                        "events_url": "https://api.github.com/users/celery/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/celery/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 735498,
                        "node_id": "MDEwOlJlcG9zaXRvcnk3MzU0OTg=",
                        "name": "kombu",
                        "full_name": "celery/kombu",
                        "private": false,
                        "owner": {
                            "login": "celery",
                            "id": 319983,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjMxOTk4Mw==",
                            "avatar_url": "https://avatars.githubusercontent.com/u/319983?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/celery",
                            "html_url": "https://github.com/celery",
                            "followers_url": "https://api.github.com/users/celery/followers",
                            "following_url": "https://api.github.com/users/celery/following{/other_user}",
                            "gists_url": "https://api.github.com/users/celery/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/celery/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/celery/subscriptions",
                            "organizations_url": "https://api.github.com/users/celery/orgs",
                            "repos_url": "https://api.github.com/users/celery/repos",
                            "events_url": "https://api.github.com/users/celery/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/celery/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/celery/kombu",
                        "description": "Messaging library for Python.",
                        "fork": false,
                        "url": "https://api.github.com/repos/celery/kombu",
                        "forks_url": "https://api.github.com/repos/celery/kombu/forks",
                        "keys_url": "https://api.github.com/repos/celery/kombu/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/celery/kombu/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/celery/kombu/teams",
                        "hooks_url": "https://api.github.com/repos/celery/kombu/hooks",
                        "issue_events_url": "https://api.github.com/repos/celery/kombu/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/celery/kombu/events",
                        "assignees_url": "https://api.github.com/repos/celery/kombu/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/celery/kombu/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/celery/kombu/tags",
                        "blobs_url": "https://api.github.com/repos/celery/kombu/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/celery/kombu/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/celery/kombu/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/celery/kombu/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/celery/kombu/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/celery/kombu/languages",
                        "stargazers_url": "https://api.github.com/repos/celery/kombu/stargazers",
                        "contributors_url": "https://api.github.com/repos/celery/kombu/contributors",
                        "subscribers_url": "https://api.github.com/repos/celery/kombu/subscribers",
                        "subscription_url": "https://api.github.com/repos/celery/kombu/subscription",
                        "commits_url": "https://api.github.com/repos/celery/kombu/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/celery/kombu/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/celery/kombu/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/celery/kombu/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/celery/kombu/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/celery/kombu/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/celery/kombu/merges",
                        "archive_url": "https://api.github.com/repos/celery/kombu/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/celery/kombu/downloads",
                        "issues_url": "https://api.github.com/repos/celery/kombu/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/celery/kombu/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/celery/kombu/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/celery/kombu/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/celery/kombu/labels{/name}",
                        "releases_url": "https://api.github.com/repos/celery/kombu/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/celery/kombu/deployments",
                        "created_at": "2010-06-23T10:10:24Z",
                        "updated_at": "2023-10-19T21:24:17Z",
                        "pushed_at": "2023-10-18T10:14:29Z",
                        "git_url": "git://github.com/celery/kombu.git",
                        "ssh_url": "git@github.com:celery/kombu.git",
                        "clone_url": "https://github.com/celery/kombu.git",
                        "svn_url": "https://github.com/celery/kombu",
                        "homepage": "http://kombu.readthedocs.org/",
                        "size": 8758,
                        "stargazers_count": 2629,
                        "watchers_count": 2629,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": true,
                        "forks_count": 933,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 191,
                        "license": {
                            "key": "bsd-3-clause",
                            "name": "BSD 3-Clause \"New\" or \"Revised\" License",
                            "spdx_id": "BSD-3-Clause",
                            "url": "https://api.github.com/licenses/bsd-3-clause",
                            "node_id": "MDc6TGljZW5zZTU="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "celery",
                            "kombu",
                            "message-queue",
                            "messaging",
                            "python",
                            "python-3",
                            "python-library",
                            "python3",
                            "rabbitmq",
                            "redis",
                            "sqs"
                        ],
                        "visibility": "public",
                        "forks": 933,
                        "open_issues": 191,
                        "watchers": 2629,
                        "default_branch": "main"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807"
                    },
                    "html": {
                        "href": "https://github.com/celery/kombu/pull/1807"
                    },
                    "issue": {
                        "href": "https://api.github.com/repos/celery/kombu/issues/1807"
                    },
                    "comments": {
                        "href": "https://api.github.com/repos/celery/kombu/issues/1807/comments"
                    },
                    "review_comments": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807/comments"
                    },
                    "review_comment": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/comments{/number}"
                    },
                    "commits": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807/commits"
                    },
                    "statuses": {
                        "href": "https://api.github.com/repos/celery/kombu/statuses/9e903aa9116fa345a68897f67979a4f8a367a71c"
                    }
                },
                "author_association": "CONTRIBUTOR",
                "auto_merge": null,
                "active_lock_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-21T08:29:48Z",
        "org": {
            "id": 319983,
            "login": "celery",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/celery",
            "avatar_url": "https://avatars.githubusercontent.com/u/319983?"
        }
    },
    {
        "id": "32739733317",
        "type": "PullRequestReviewEvent",
        "actor": {
            "id": 442447,
            "login": "rafidka",
            "display_login": "rafidka",
            "gravatar_id": "",
            "url": "https://api.github.com/users/rafidka",
            "avatar_url": "https://avatars.githubusercontent.com/u/442447?"
        },
        "repo": {
            "id": 735498,
            "name": "celery/kombu",
            "url": "https://api.github.com/repos/celery/kombu"
        },
        "payload": {
            "action": "created",
            "review": {
                "id": 1691214912,
                "node_id": "PRR_kwDOAAs5Cs5kzeRA",
                "user": {
                    "login": "rafidka",
                    "id": 442447,
                    "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/rafidka",
                    "html_url": "https://github.com/rafidka",
                    "followers_url": "https://api.github.com/users/rafidka/followers",
                    "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                    "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                    "organizations_url": "https://api.github.com/users/rafidka/orgs",
                    "repos_url": "https://api.github.com/users/rafidka/repos",
                    "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/rafidka/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": null,
                "commit_id": "9e903aa9116fa345a68897f67979a4f8a367a71c",
                "submitted_at": "2023-10-21T08:29:48Z",
                "state": "commented",
                "html_url": "https://github.com/celery/kombu/pull/1807#pullrequestreview-1691214912",
                "pull_request_url": "https://api.github.com/repos/celery/kombu/pulls/1807",
                "author_association": "CONTRIBUTOR",
                "_links": {
                    "html": {
                        "href": "https://github.com/celery/kombu/pull/1807#pullrequestreview-1691214912"
                    },
                    "pull_request": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807"
                    }
                }
            },
            "pull_request": {
                "url": "https://api.github.com/repos/celery/kombu/pulls/1807",
                "id": 1548262937,
                "node_id": "PR_kwDOAAs5Cs5cSJ4Z",
                "html_url": "https://github.com/celery/kombu/pull/1807",
                "diff_url": "https://github.com/celery/kombu/pull/1807.diff",
                "patch_url": "https://github.com/celery/kombu/pull/1807.patch",
                "issue_url": "https://api.github.com/repos/celery/kombu/issues/1807",
                "number": 1807,
                "state": "open",
                "locked": false,
                "title": "[WIP] Use the correct protocol for SQS requests",
                "user": {
                    "login": "rafidka",
                    "id": 442447,
                    "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/rafidka",
                    "html_url": "https://github.com/rafidka",
                    "followers_url": "https://api.github.com/users/rafidka/followers",
                    "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                    "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                    "organizations_url": "https://api.github.com/users/rafidka/orgs",
                    "repos_url": "https://api.github.com/users/rafidka/repos",
                    "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/rafidka/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "TL;DR - The use of boto3 in #1759 resulted in relying on blocking (synchronous) HTTP requests, which caused the performance issue reported in #1783.\r\n\r\n`kombu` previously used to craft AWS requests manually as explained in detail in #1726, which resulted in an outage when botocore temporarily changed the default protocol to JSON (before rolling back due to the impact on celery and airflow.) To fix the issue, I submitted #1759, which changes `kombu` to use `boto3` instead of manually crafting AWS requests. This way when boto3 changes the default protocol, kombu won't be impacted.\r\n\r\nWhile working on #1759, I did extensive debugging to understand the multi-threading nature of kombu. What I discovered is that there isn't an actual multi-threading in the true sense of the word, but an event loop that runs on the same thread and process and orchestrate the communication with SQS. As such, it didn't appear to me that there is anything to worry about my change, and the testing I did didn't discover any issue. However, it turns out that while kombu's event loop doesn't have actual multi-threading, its [reliance on pycurl](https://github.com/celery/kombu/blob/main/kombu/asynchronous/http/curl.py#L48) (and thus libcurl) meant that the requests to AWS were being done asynchronously. On the other hand, boto3 requests are always done synchronously, i.e. they are blocking requests.\r\n\r\nThe above meant that my change introduced blocking on the event loop of kombu. This is fine in most of the cases, since the requests to SQS are pretty fast. However, in the case of using long-polling, a call to SQS's ReceiveMessage can last up to 20 seconds (depending on the user configuration).\r\n\r\nTo solve this problem, I rolled back my earlier changes and, instead, to address the issue reported in #1726, I now changed the `AsyncSQSConnection` class such that it crafts either a `query` or a `json` request depending on the protocol used by the SQS client. Thus, when botocore changes the default protocol of SQS to JSON, kombu won't be impacted, since it crafts its own request and, after my change, it uses a hard-coded protocol based on the crafted requests.\r\n\r\nThis solution shouldn't be the final solution, and it is more of a workaround that does the job for now. The final solution should be to completely rely on boto3 for any communication with AWS, and ensuring that all requests are async in nature (non-blocking.) This, however, is a fundamental change that requires a lot of testing, in particular performance testing.\r\n",
                "created_at": "2023-10-09T17:36:06Z",
                "updated_at": "2023-10-21T08:29:48Z",
                "closed_at": null,
                "merged_at": null,
                "merge_commit_sha": "f6243abe6fb30d7a7b5dfa592e36d02bc35987f3",
                "assignee": null,
                "assignees": [],
                "requested_reviewers": [],
                "requested_teams": [],
                "labels": [],
                "milestone": null,
                "draft": false,
                "commits_url": "https://api.github.com/repos/celery/kombu/pulls/1807/commits",
                "review_comments_url": "https://api.github.com/repos/celery/kombu/pulls/1807/comments",
                "review_comment_url": "https://api.github.com/repos/celery/kombu/pulls/comments{/number}",
                "comments_url": "https://api.github.com/repos/celery/kombu/issues/1807/comments",
                "statuses_url": "https://api.github.com/repos/celery/kombu/statuses/9e903aa9116fa345a68897f67979a4f8a367a71c",
                "head": {
                    "label": "rafidka:fix-1783",
                    "ref": "fix-1783",
                    "sha": "9e903aa9116fa345a68897f67979a4f8a367a71c",
                    "user": {
                        "login": "rafidka",
                        "id": 442447,
                        "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                        "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/rafidka",
                        "html_url": "https://github.com/rafidka",
                        "followers_url": "https://api.github.com/users/rafidka/followers",
                        "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                        "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                        "organizations_url": "https://api.github.com/users/rafidka/orgs",
                        "repos_url": "https://api.github.com/users/rafidka/repos",
                        "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/rafidka/received_events",
                        "type": "User",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 655909423,
                        "node_id": "R_kgDOJxhiLw",
                        "name": "kombu",
                        "full_name": "rafidka/kombu",
                        "private": false,
                        "owner": {
                            "login": "rafidka",
                            "id": 442447,
                            "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                            "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/rafidka",
                            "html_url": "https://github.com/rafidka",
                            "followers_url": "https://api.github.com/users/rafidka/followers",
                            "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                            "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                            "organizations_url": "https://api.github.com/users/rafidka/orgs",
                            "repos_url": "https://api.github.com/users/rafidka/repos",
                            "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/rafidka/received_events",
                            "type": "User",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/rafidka/kombu",
                        "description": "Messaging library for Python.",
                        "fork": true,
                        "url": "https://api.github.com/repos/rafidka/kombu",
                        "forks_url": "https://api.github.com/repos/rafidka/kombu/forks",
                        "keys_url": "https://api.github.com/repos/rafidka/kombu/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/rafidka/kombu/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/rafidka/kombu/teams",
                        "hooks_url": "https://api.github.com/repos/rafidka/kombu/hooks",
                        "issue_events_url": "https://api.github.com/repos/rafidka/kombu/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/rafidka/kombu/events",
                        "assignees_url": "https://api.github.com/repos/rafidka/kombu/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/rafidka/kombu/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/rafidka/kombu/tags",
                        "blobs_url": "https://api.github.com/repos/rafidka/kombu/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/rafidka/kombu/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/rafidka/kombu/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/rafidka/kombu/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/rafidka/kombu/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/rafidka/kombu/languages",
                        "stargazers_url": "https://api.github.com/repos/rafidka/kombu/stargazers",
                        "contributors_url": "https://api.github.com/repos/rafidka/kombu/contributors",
                        "subscribers_url": "https://api.github.com/repos/rafidka/kombu/subscribers",
                        "subscription_url": "https://api.github.com/repos/rafidka/kombu/subscription",
                        "commits_url": "https://api.github.com/repos/rafidka/kombu/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/rafidka/kombu/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/rafidka/kombu/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/rafidka/kombu/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/rafidka/kombu/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/rafidka/kombu/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/rafidka/kombu/merges",
                        "archive_url": "https://api.github.com/repos/rafidka/kombu/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/rafidka/kombu/downloads",
                        "issues_url": "https://api.github.com/repos/rafidka/kombu/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/rafidka/kombu/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/rafidka/kombu/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/rafidka/kombu/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/rafidka/kombu/labels{/name}",
                        "releases_url": "https://api.github.com/repos/rafidka/kombu/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/rafidka/kombu/deployments",
                        "created_at": "2023-06-19T21:48:27Z",
                        "updated_at": "2023-10-06T01:42:46Z",
                        "pushed_at": "2023-10-17T14:10:46Z",
                        "git_url": "git://github.com/rafidka/kombu.git",
                        "ssh_url": "git@github.com:rafidka/kombu.git",
                        "clone_url": "https://github.com/rafidka/kombu.git",
                        "svn_url": "https://github.com/rafidka/kombu",
                        "homepage": "http://kombu.readthedocs.org/",
                        "size": 6589,
                        "stargazers_count": 0,
                        "watchers_count": 0,
                        "language": "Python",
                        "has_issues": false,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": false,
                        "has_discussions": false,
                        "forks_count": 0,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 0,
                        "license": {
                            "key": "bsd-3-clause",
                            "name": "BSD 3-Clause \"New\" or \"Revised\" License",
                            "spdx_id": "BSD-3-Clause",
                            "url": "https://api.github.com/licenses/bsd-3-clause",
                            "node_id": "MDc6TGljZW5zZTU="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [],
                        "visibility": "public",
                        "forks": 0,
                        "open_issues": 0,
                        "watchers": 0,
                        "default_branch": "main"
                    }
                },
                "base": {
                    "label": "celery:main",
                    "ref": "main",
                    "sha": "1dfe4f3c86ab0fd2587a6fe8566bb3cef8c4a5d7",
                    "user": {
                        "login": "celery",
                        "id": 319983,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjMxOTk4Mw==",
                        "avatar_url": "https://avatars.githubusercontent.com/u/319983?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/celery",
                        "html_url": "https://github.com/celery",
                        "followers_url": "https://api.github.com/users/celery/followers",
                        "following_url": "https://api.github.com/users/celery/following{/other_user}",
                        "gists_url": "https://api.github.com/users/celery/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/celery/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/celery/subscriptions",
                        "organizations_url": "https://api.github.com/users/celery/orgs",
                        "repos_url": "https://api.github.com/users/celery/repos",
                        "events_url": "https://api.github.com/users/celery/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/celery/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 735498,
                        "node_id": "MDEwOlJlcG9zaXRvcnk3MzU0OTg=",
                        "name": "kombu",
                        "full_name": "celery/kombu",
                        "private": false,
                        "owner": {
                            "login": "celery",
                            "id": 319983,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjMxOTk4Mw==",
                            "avatar_url": "https://avatars.githubusercontent.com/u/319983?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/celery",
                            "html_url": "https://github.com/celery",
                            "followers_url": "https://api.github.com/users/celery/followers",
                            "following_url": "https://api.github.com/users/celery/following{/other_user}",
                            "gists_url": "https://api.github.com/users/celery/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/celery/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/celery/subscriptions",
                            "organizations_url": "https://api.github.com/users/celery/orgs",
                            "repos_url": "https://api.github.com/users/celery/repos",
                            "events_url": "https://api.github.com/users/celery/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/celery/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/celery/kombu",
                        "description": "Messaging library for Python.",
                        "fork": false,
                        "url": "https://api.github.com/repos/celery/kombu",
                        "forks_url": "https://api.github.com/repos/celery/kombu/forks",
                        "keys_url": "https://api.github.com/repos/celery/kombu/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/celery/kombu/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/celery/kombu/teams",
                        "hooks_url": "https://api.github.com/repos/celery/kombu/hooks",
                        "issue_events_url": "https://api.github.com/repos/celery/kombu/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/celery/kombu/events",
                        "assignees_url": "https://api.github.com/repos/celery/kombu/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/celery/kombu/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/celery/kombu/tags",
                        "blobs_url": "https://api.github.com/repos/celery/kombu/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/celery/kombu/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/celery/kombu/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/celery/kombu/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/celery/kombu/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/celery/kombu/languages",
                        "stargazers_url": "https://api.github.com/repos/celery/kombu/stargazers",
                        "contributors_url": "https://api.github.com/repos/celery/kombu/contributors",
                        "subscribers_url": "https://api.github.com/repos/celery/kombu/subscribers",
                        "subscription_url": "https://api.github.com/repos/celery/kombu/subscription",
                        "commits_url": "https://api.github.com/repos/celery/kombu/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/celery/kombu/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/celery/kombu/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/celery/kombu/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/celery/kombu/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/celery/kombu/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/celery/kombu/merges",
                        "archive_url": "https://api.github.com/repos/celery/kombu/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/celery/kombu/downloads",
                        "issues_url": "https://api.github.com/repos/celery/kombu/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/celery/kombu/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/celery/kombu/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/celery/kombu/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/celery/kombu/labels{/name}",
                        "releases_url": "https://api.github.com/repos/celery/kombu/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/celery/kombu/deployments",
                        "created_at": "2010-06-23T10:10:24Z",
                        "updated_at": "2023-10-19T21:24:17Z",
                        "pushed_at": "2023-10-18T10:14:29Z",
                        "git_url": "git://github.com/celery/kombu.git",
                        "ssh_url": "git@github.com:celery/kombu.git",
                        "clone_url": "https://github.com/celery/kombu.git",
                        "svn_url": "https://github.com/celery/kombu",
                        "homepage": "http://kombu.readthedocs.org/",
                        "size": 8758,
                        "stargazers_count": 2629,
                        "watchers_count": 2629,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": true,
                        "forks_count": 933,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 191,
                        "license": {
                            "key": "bsd-3-clause",
                            "name": "BSD 3-Clause \"New\" or \"Revised\" License",
                            "spdx_id": "BSD-3-Clause",
                            "url": "https://api.github.com/licenses/bsd-3-clause",
                            "node_id": "MDc6TGljZW5zZTU="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "celery",
                            "kombu",
                            "message-queue",
                            "messaging",
                            "python",
                            "python-3",
                            "python-library",
                            "python3",
                            "rabbitmq",
                            "redis",
                            "sqs"
                        ],
                        "visibility": "public",
                        "forks": 933,
                        "open_issues": 191,
                        "watchers": 2629,
                        "default_branch": "main"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807"
                    },
                    "html": {
                        "href": "https://github.com/celery/kombu/pull/1807"
                    },
                    "issue": {
                        "href": "https://api.github.com/repos/celery/kombu/issues/1807"
                    },
                    "comments": {
                        "href": "https://api.github.com/repos/celery/kombu/issues/1807/comments"
                    },
                    "review_comments": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807/comments"
                    },
                    "review_comment": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/comments{/number}"
                    },
                    "commits": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807/commits"
                    },
                    "statuses": {
                        "href": "https://api.github.com/repos/celery/kombu/statuses/9e903aa9116fa345a68897f67979a4f8a367a71c"
                    }
                },
                "author_association": "CONTRIBUTOR",
                "auto_merge": null,
                "active_lock_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-21T08:29:49Z",
        "org": {
            "id": 319983,
            "login": "celery",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/celery",
            "avatar_url": "https://avatars.githubusercontent.com/u/319983?"
        }
    },
    {
        "id": "32739731280",
        "type": "PullRequestReviewEvent",
        "actor": {
            "id": 442447,
            "login": "rafidka",
            "display_login": "rafidka",
            "gravatar_id": "",
            "url": "https://api.github.com/users/rafidka",
            "avatar_url": "https://avatars.githubusercontent.com/u/442447?"
        },
        "repo": {
            "id": 735498,
            "name": "celery/kombu",
            "url": "https://api.github.com/repos/celery/kombu"
        },
        "payload": {
            "action": "created",
            "review": {
                "id": 1691214872,
                "node_id": "PRR_kwDOAAs5Cs5kzeQY",
                "user": {
                    "login": "rafidka",
                    "id": 442447,
                    "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/rafidka",
                    "html_url": "https://github.com/rafidka",
                    "followers_url": "https://api.github.com/users/rafidka/followers",
                    "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                    "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                    "organizations_url": "https://api.github.com/users/rafidka/orgs",
                    "repos_url": "https://api.github.com/users/rafidka/repos",
                    "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/rafidka/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": null,
                "commit_id": "9e903aa9116fa345a68897f67979a4f8a367a71c",
                "submitted_at": "2023-10-21T08:29:27Z",
                "state": "commented",
                "html_url": "https://github.com/celery/kombu/pull/1807#pullrequestreview-1691214872",
                "pull_request_url": "https://api.github.com/repos/celery/kombu/pulls/1807",
                "author_association": "CONTRIBUTOR",
                "_links": {
                    "html": {
                        "href": "https://github.com/celery/kombu/pull/1807#pullrequestreview-1691214872"
                    },
                    "pull_request": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807"
                    }
                }
            },
            "pull_request": {
                "url": "https://api.github.com/repos/celery/kombu/pulls/1807",
                "id": 1548262937,
                "node_id": "PR_kwDOAAs5Cs5cSJ4Z",
                "html_url": "https://github.com/celery/kombu/pull/1807",
                "diff_url": "https://github.com/celery/kombu/pull/1807.diff",
                "patch_url": "https://github.com/celery/kombu/pull/1807.patch",
                "issue_url": "https://api.github.com/repos/celery/kombu/issues/1807",
                "number": 1807,
                "state": "open",
                "locked": false,
                "title": "[WIP] Use the correct protocol for SQS requests",
                "user": {
                    "login": "rafidka",
                    "id": 442447,
                    "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/rafidka",
                    "html_url": "https://github.com/rafidka",
                    "followers_url": "https://api.github.com/users/rafidka/followers",
                    "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                    "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                    "organizations_url": "https://api.github.com/users/rafidka/orgs",
                    "repos_url": "https://api.github.com/users/rafidka/repos",
                    "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/rafidka/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "TL;DR - The use of boto3 in #1759 resulted in relying on blocking (synchronous) HTTP requests, which caused the performance issue reported in #1783.\r\n\r\n`kombu` previously used to craft AWS requests manually as explained in detail in #1726, which resulted in an outage when botocore temporarily changed the default protocol to JSON (before rolling back due to the impact on celery and airflow.) To fix the issue, I submitted #1759, which changes `kombu` to use `boto3` instead of manually crafting AWS requests. This way when boto3 changes the default protocol, kombu won't be impacted.\r\n\r\nWhile working on #1759, I did extensive debugging to understand the multi-threading nature of kombu. What I discovered is that there isn't an actual multi-threading in the true sense of the word, but an event loop that runs on the same thread and process and orchestrate the communication with SQS. As such, it didn't appear to me that there is anything to worry about my change, and the testing I did didn't discover any issue. However, it turns out that while kombu's event loop doesn't have actual multi-threading, its [reliance on pycurl](https://github.com/celery/kombu/blob/main/kombu/asynchronous/http/curl.py#L48) (and thus libcurl) meant that the requests to AWS were being done asynchronously. On the other hand, boto3 requests are always done synchronously, i.e. they are blocking requests.\r\n\r\nThe above meant that my change introduced blocking on the event loop of kombu. This is fine in most of the cases, since the requests to SQS are pretty fast. However, in the case of using long-polling, a call to SQS's ReceiveMessage can last up to 20 seconds (depending on the user configuration).\r\n\r\nTo solve this problem, I rolled back my earlier changes and, instead, to address the issue reported in #1726, I now changed the `AsyncSQSConnection` class such that it crafts either a `query` or a `json` request depending on the protocol used by the SQS client. Thus, when botocore changes the default protocol of SQS to JSON, kombu won't be impacted, since it crafts its own request and, after my change, it uses a hard-coded protocol based on the crafted requests.\r\n\r\nThis solution shouldn't be the final solution, and it is more of a workaround that does the job for now. The final solution should be to completely rely on boto3 for any communication with AWS, and ensuring that all requests are async in nature (non-blocking.) This, however, is a fundamental change that requires a lot of testing, in particular performance testing.\r\n",
                "created_at": "2023-10-09T17:36:06Z",
                "updated_at": "2023-10-21T08:29:27Z",
                "closed_at": null,
                "merged_at": null,
                "merge_commit_sha": "f6243abe6fb30d7a7b5dfa592e36d02bc35987f3",
                "assignee": null,
                "assignees": [],
                "requested_reviewers": [],
                "requested_teams": [],
                "labels": [],
                "milestone": null,
                "draft": false,
                "commits_url": "https://api.github.com/repos/celery/kombu/pulls/1807/commits",
                "review_comments_url": "https://api.github.com/repos/celery/kombu/pulls/1807/comments",
                "review_comment_url": "https://api.github.com/repos/celery/kombu/pulls/comments{/number}",
                "comments_url": "https://api.github.com/repos/celery/kombu/issues/1807/comments",
                "statuses_url": "https://api.github.com/repos/celery/kombu/statuses/9e903aa9116fa345a68897f67979a4f8a367a71c",
                "head": {
                    "label": "rafidka:fix-1783",
                    "ref": "fix-1783",
                    "sha": "9e903aa9116fa345a68897f67979a4f8a367a71c",
                    "user": {
                        "login": "rafidka",
                        "id": 442447,
                        "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                        "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/rafidka",
                        "html_url": "https://github.com/rafidka",
                        "followers_url": "https://api.github.com/users/rafidka/followers",
                        "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                        "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                        "organizations_url": "https://api.github.com/users/rafidka/orgs",
                        "repos_url": "https://api.github.com/users/rafidka/repos",
                        "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/rafidka/received_events",
                        "type": "User",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 655909423,
                        "node_id": "R_kgDOJxhiLw",
                        "name": "kombu",
                        "full_name": "rafidka/kombu",
                        "private": false,
                        "owner": {
                            "login": "rafidka",
                            "id": 442447,
                            "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                            "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/rafidka",
                            "html_url": "https://github.com/rafidka",
                            "followers_url": "https://api.github.com/users/rafidka/followers",
                            "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                            "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                            "organizations_url": "https://api.github.com/users/rafidka/orgs",
                            "repos_url": "https://api.github.com/users/rafidka/repos",
                            "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/rafidka/received_events",
                            "type": "User",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/rafidka/kombu",
                        "description": "Messaging library for Python.",
                        "fork": true,
                        "url": "https://api.github.com/repos/rafidka/kombu",
                        "forks_url": "https://api.github.com/repos/rafidka/kombu/forks",
                        "keys_url": "https://api.github.com/repos/rafidka/kombu/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/rafidka/kombu/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/rafidka/kombu/teams",
                        "hooks_url": "https://api.github.com/repos/rafidka/kombu/hooks",
                        "issue_events_url": "https://api.github.com/repos/rafidka/kombu/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/rafidka/kombu/events",
                        "assignees_url": "https://api.github.com/repos/rafidka/kombu/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/rafidka/kombu/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/rafidka/kombu/tags",
                        "blobs_url": "https://api.github.com/repos/rafidka/kombu/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/rafidka/kombu/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/rafidka/kombu/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/rafidka/kombu/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/rafidka/kombu/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/rafidka/kombu/languages",
                        "stargazers_url": "https://api.github.com/repos/rafidka/kombu/stargazers",
                        "contributors_url": "https://api.github.com/repos/rafidka/kombu/contributors",
                        "subscribers_url": "https://api.github.com/repos/rafidka/kombu/subscribers",
                        "subscription_url": "https://api.github.com/repos/rafidka/kombu/subscription",
                        "commits_url": "https://api.github.com/repos/rafidka/kombu/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/rafidka/kombu/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/rafidka/kombu/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/rafidka/kombu/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/rafidka/kombu/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/rafidka/kombu/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/rafidka/kombu/merges",
                        "archive_url": "https://api.github.com/repos/rafidka/kombu/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/rafidka/kombu/downloads",
                        "issues_url": "https://api.github.com/repos/rafidka/kombu/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/rafidka/kombu/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/rafidka/kombu/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/rafidka/kombu/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/rafidka/kombu/labels{/name}",
                        "releases_url": "https://api.github.com/repos/rafidka/kombu/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/rafidka/kombu/deployments",
                        "created_at": "2023-06-19T21:48:27Z",
                        "updated_at": "2023-10-06T01:42:46Z",
                        "pushed_at": "2023-10-17T14:10:46Z",
                        "git_url": "git://github.com/rafidka/kombu.git",
                        "ssh_url": "git@github.com:rafidka/kombu.git",
                        "clone_url": "https://github.com/rafidka/kombu.git",
                        "svn_url": "https://github.com/rafidka/kombu",
                        "homepage": "http://kombu.readthedocs.org/",
                        "size": 6589,
                        "stargazers_count": 0,
                        "watchers_count": 0,
                        "language": "Python",
                        "has_issues": false,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": false,
                        "has_discussions": false,
                        "forks_count": 0,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 0,
                        "license": {
                            "key": "bsd-3-clause",
                            "name": "BSD 3-Clause \"New\" or \"Revised\" License",
                            "spdx_id": "BSD-3-Clause",
                            "url": "https://api.github.com/licenses/bsd-3-clause",
                            "node_id": "MDc6TGljZW5zZTU="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [],
                        "visibility": "public",
                        "forks": 0,
                        "open_issues": 0,
                        "watchers": 0,
                        "default_branch": "main"
                    }
                },
                "base": {
                    "label": "celery:main",
                    "ref": "main",
                    "sha": "1dfe4f3c86ab0fd2587a6fe8566bb3cef8c4a5d7",
                    "user": {
                        "login": "celery",
                        "id": 319983,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjMxOTk4Mw==",
                        "avatar_url": "https://avatars.githubusercontent.com/u/319983?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/celery",
                        "html_url": "https://github.com/celery",
                        "followers_url": "https://api.github.com/users/celery/followers",
                        "following_url": "https://api.github.com/users/celery/following{/other_user}",
                        "gists_url": "https://api.github.com/users/celery/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/celery/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/celery/subscriptions",
                        "organizations_url": "https://api.github.com/users/celery/orgs",
                        "repos_url": "https://api.github.com/users/celery/repos",
                        "events_url": "https://api.github.com/users/celery/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/celery/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 735498,
                        "node_id": "MDEwOlJlcG9zaXRvcnk3MzU0OTg=",
                        "name": "kombu",
                        "full_name": "celery/kombu",
                        "private": false,
                        "owner": {
                            "login": "celery",
                            "id": 319983,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjMxOTk4Mw==",
                            "avatar_url": "https://avatars.githubusercontent.com/u/319983?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/celery",
                            "html_url": "https://github.com/celery",
                            "followers_url": "https://api.github.com/users/celery/followers",
                            "following_url": "https://api.github.com/users/celery/following{/other_user}",
                            "gists_url": "https://api.github.com/users/celery/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/celery/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/celery/subscriptions",
                            "organizations_url": "https://api.github.com/users/celery/orgs",
                            "repos_url": "https://api.github.com/users/celery/repos",
                            "events_url": "https://api.github.com/users/celery/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/celery/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/celery/kombu",
                        "description": "Messaging library for Python.",
                        "fork": false,
                        "url": "https://api.github.com/repos/celery/kombu",
                        "forks_url": "https://api.github.com/repos/celery/kombu/forks",
                        "keys_url": "https://api.github.com/repos/celery/kombu/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/celery/kombu/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/celery/kombu/teams",
                        "hooks_url": "https://api.github.com/repos/celery/kombu/hooks",
                        "issue_events_url": "https://api.github.com/repos/celery/kombu/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/celery/kombu/events",
                        "assignees_url": "https://api.github.com/repos/celery/kombu/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/celery/kombu/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/celery/kombu/tags",
                        "blobs_url": "https://api.github.com/repos/celery/kombu/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/celery/kombu/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/celery/kombu/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/celery/kombu/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/celery/kombu/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/celery/kombu/languages",
                        "stargazers_url": "https://api.github.com/repos/celery/kombu/stargazers",
                        "contributors_url": "https://api.github.com/repos/celery/kombu/contributors",
                        "subscribers_url": "https://api.github.com/repos/celery/kombu/subscribers",
                        "subscription_url": "https://api.github.com/repos/celery/kombu/subscription",
                        "commits_url": "https://api.github.com/repos/celery/kombu/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/celery/kombu/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/celery/kombu/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/celery/kombu/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/celery/kombu/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/celery/kombu/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/celery/kombu/merges",
                        "archive_url": "https://api.github.com/repos/celery/kombu/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/celery/kombu/downloads",
                        "issues_url": "https://api.github.com/repos/celery/kombu/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/celery/kombu/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/celery/kombu/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/celery/kombu/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/celery/kombu/labels{/name}",
                        "releases_url": "https://api.github.com/repos/celery/kombu/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/celery/kombu/deployments",
                        "created_at": "2010-06-23T10:10:24Z",
                        "updated_at": "2023-10-19T21:24:17Z",
                        "pushed_at": "2023-10-18T10:14:29Z",
                        "git_url": "git://github.com/celery/kombu.git",
                        "ssh_url": "git@github.com:celery/kombu.git",
                        "clone_url": "https://github.com/celery/kombu.git",
                        "svn_url": "https://github.com/celery/kombu",
                        "homepage": "http://kombu.readthedocs.org/",
                        "size": 8758,
                        "stargazers_count": 2629,
                        "watchers_count": 2629,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": true,
                        "forks_count": 933,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 191,
                        "license": {
                            "key": "bsd-3-clause",
                            "name": "BSD 3-Clause \"New\" or \"Revised\" License",
                            "spdx_id": "BSD-3-Clause",
                            "url": "https://api.github.com/licenses/bsd-3-clause",
                            "node_id": "MDc6TGljZW5zZTU="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "celery",
                            "kombu",
                            "message-queue",
                            "messaging",
                            "python",
                            "python-3",
                            "python-library",
                            "python3",
                            "rabbitmq",
                            "redis",
                            "sqs"
                        ],
                        "visibility": "public",
                        "forks": 933,
                        "open_issues": 191,
                        "watchers": 2629,
                        "default_branch": "main"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807"
                    },
                    "html": {
                        "href": "https://github.com/celery/kombu/pull/1807"
                    },
                    "issue": {
                        "href": "https://api.github.com/repos/celery/kombu/issues/1807"
                    },
                    "comments": {
                        "href": "https://api.github.com/repos/celery/kombu/issues/1807/comments"
                    },
                    "review_comments": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807/comments"
                    },
                    "review_comment": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/comments{/number}"
                    },
                    "commits": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807/commits"
                    },
                    "statuses": {
                        "href": "https://api.github.com/repos/celery/kombu/statuses/9e903aa9116fa345a68897f67979a4f8a367a71c"
                    }
                },
                "author_association": "CONTRIBUTOR",
                "auto_merge": null,
                "active_lock_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-21T08:29:28Z",
        "org": {
            "id": 319983,
            "login": "celery",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/celery",
            "avatar_url": "https://avatars.githubusercontent.com/u/319983?"
        }
    },
    {
        "id": "32739731305",
        "type": "PullRequestReviewCommentEvent",
        "actor": {
            "id": 442447,
            "login": "rafidka",
            "display_login": "rafidka",
            "gravatar_id": "",
            "url": "https://api.github.com/users/rafidka",
            "avatar_url": "https://avatars.githubusercontent.com/u/442447?"
        },
        "repo": {
            "id": 735498,
            "name": "celery/kombu",
            "url": "https://api.github.com/repos/celery/kombu"
        },
        "payload": {
            "action": "created",
            "comment": {
                "url": "https://api.github.com/repos/celery/kombu/pulls/comments/1367689919",
                "pull_request_review_id": 1691214872,
                "id": 1367689919,
                "node_id": "PRRC_kwDOAAs5Cs5RhUq_",
                "diff_hunk": "@@ -25,6 +29,76 @@ def __init__(self, sqs_connection, debug=0, region=None, **kwargs):\n             **kwargs\n         )\n \n+    def _create_query_request(self, operation, params, queue_url, method):\n+        params = params.copy()\n+        if operation:\n+            params['Action'] = operation\n+\n+        # defaults for non-get\n+        param_payload = {'data': params}\n+        if method.lower() == 'get':\n+            # query-based opts\n+            param_payload = {'params': params}\n+\n+        return AWSRequest(method=method, url=queue_url, **param_payload)\n+\n+    def _create_json_request(self, operation, params, queue_url):\n+        params = params.copy()\n+        params['QueueUrl'] = queue_url\n+\n+        service_model = self.sqs_connection.meta.service_model\n+        operation_model = service_model.operation_model(operation)\n+\n+        url = self.sqs_connection._endpoint.host\n+\n+        headers = {}\n+        # Content-Type\n+        json_version = operation_model.metadata['jsonVersion']\n+        content_type = f'application/x-amz-json-{json_version}'\n+        headers['Content-Type'] = content_type\n+\n+        # X-Amz-Target\n+        target = '{}.{}'.format(\n+            operation_model.metadata['targetPrefix'],\n+            operation_model.name,\n+        )\n+        headers['X-Amz-Target'] = target",
                "path": "kombu/asynchronous/aws/sqs/connection.py",
                "commit_id": "9e903aa9116fa345a68897f67979a4f8a367a71c",
                "original_commit_id": "9e903aa9116fa345a68897f67979a4f8a367a71c",
                "user": {
                    "login": "rafidka",
                    "id": 442447,
                    "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/rafidka",
                    "html_url": "https://github.com/rafidka",
                    "followers_url": "https://api.github.com/users/rafidka/followers",
                    "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                    "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                    "organizations_url": "https://api.github.com/users/rafidka/orgs",
                    "repos_url": "https://api.github.com/users/rafidka/repos",
                    "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/rafidka/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "Which document are you referring to?\r\n\r\nWhat I did was to check what botocore is doing in their [JSONSerialiazer](https://github.com/boto/botocore/blob/develop/botocore/serialize.py#L347-L371), and I don't see those fields in there.",
                "created_at": "2023-10-21T08:29:27Z",
                "updated_at": "2023-10-21T08:29:27Z",
                "html_url": "https://github.com/celery/kombu/pull/1807#discussion_r1367689919",
                "pull_request_url": "https://api.github.com/repos/celery/kombu/pulls/1807",
                "author_association": "CONTRIBUTOR",
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/comments/1367689919"
                    },
                    "html": {
                        "href": "https://github.com/celery/kombu/pull/1807#discussion_r1367689919"
                    },
                    "pull_request": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807"
                    }
                },
                "reactions": {
                    "url": "https://api.github.com/repos/celery/kombu/pulls/comments/1367689919/reactions",
                    "total_count": 0,
                    "+1": 0,
                    "-1": 0,
                    "laugh": 0,
                    "hooray": 0,
                    "confused": 0,
                    "heart": 0,
                    "rocket": 0,
                    "eyes": 0
                },
                "start_line": null,
                "original_start_line": null,
                "start_side": null,
                "line": 65,
                "original_line": 65,
                "side": "RIGHT",
                "in_reply_to_id": 1365948322,
                "original_position": 51,
                "position": 51,
                "subject_type": "line"
            },
            "pull_request": {
                "url": "https://api.github.com/repos/celery/kombu/pulls/1807",
                "id": 1548262937,
                "node_id": "PR_kwDOAAs5Cs5cSJ4Z",
                "html_url": "https://github.com/celery/kombu/pull/1807",
                "diff_url": "https://github.com/celery/kombu/pull/1807.diff",
                "patch_url": "https://github.com/celery/kombu/pull/1807.patch",
                "issue_url": "https://api.github.com/repos/celery/kombu/issues/1807",
                "number": 1807,
                "state": "open",
                "locked": false,
                "title": "[WIP] Use the correct protocol for SQS requests",
                "user": {
                    "login": "rafidka",
                    "id": 442447,
                    "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/rafidka",
                    "html_url": "https://github.com/rafidka",
                    "followers_url": "https://api.github.com/users/rafidka/followers",
                    "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                    "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                    "organizations_url": "https://api.github.com/users/rafidka/orgs",
                    "repos_url": "https://api.github.com/users/rafidka/repos",
                    "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/rafidka/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "TL;DR - The use of boto3 in #1759 resulted in relying on blocking (synchronous) HTTP requests, which caused the performance issue reported in #1783.\r\n\r\n`kombu` previously used to craft AWS requests manually as explained in detail in #1726, which resulted in an outage when botocore temporarily changed the default protocol to JSON (before rolling back due to the impact on celery and airflow.) To fix the issue, I submitted #1759, which changes `kombu` to use `boto3` instead of manually crafting AWS requests. This way when boto3 changes the default protocol, kombu won't be impacted.\r\n\r\nWhile working on #1759, I did extensive debugging to understand the multi-threading nature of kombu. What I discovered is that there isn't an actual multi-threading in the true sense of the word, but an event loop that runs on the same thread and process and orchestrate the communication with SQS. As such, it didn't appear to me that there is anything to worry about my change, and the testing I did didn't discover any issue. However, it turns out that while kombu's event loop doesn't have actual multi-threading, its [reliance on pycurl](https://github.com/celery/kombu/blob/main/kombu/asynchronous/http/curl.py#L48) (and thus libcurl) meant that the requests to AWS were being done asynchronously. On the other hand, boto3 requests are always done synchronously, i.e. they are blocking requests.\r\n\r\nThe above meant that my change introduced blocking on the event loop of kombu. This is fine in most of the cases, since the requests to SQS are pretty fast. However, in the case of using long-polling, a call to SQS's ReceiveMessage can last up to 20 seconds (depending on the user configuration).\r\n\r\nTo solve this problem, I rolled back my earlier changes and, instead, to address the issue reported in #1726, I now changed the `AsyncSQSConnection` class such that it crafts either a `query` or a `json` request depending on the protocol used by the SQS client. Thus, when botocore changes the default protocol of SQS to JSON, kombu won't be impacted, since it crafts its own request and, after my change, it uses a hard-coded protocol based on the crafted requests.\r\n\r\nThis solution shouldn't be the final solution, and it is more of a workaround that does the job for now. The final solution should be to completely rely on boto3 for any communication with AWS, and ensuring that all requests are async in nature (non-blocking.) This, however, is a fundamental change that requires a lot of testing, in particular performance testing.\r\n",
                "created_at": "2023-10-09T17:36:06Z",
                "updated_at": "2023-10-21T08:29:27Z",
                "closed_at": null,
                "merged_at": null,
                "merge_commit_sha": "f6243abe6fb30d7a7b5dfa592e36d02bc35987f3",
                "assignee": null,
                "assignees": [],
                "requested_reviewers": [],
                "requested_teams": [],
                "labels": [],
                "milestone": null,
                "draft": false,
                "commits_url": "https://api.github.com/repos/celery/kombu/pulls/1807/commits",
                "review_comments_url": "https://api.github.com/repos/celery/kombu/pulls/1807/comments",
                "review_comment_url": "https://api.github.com/repos/celery/kombu/pulls/comments{/number}",
                "comments_url": "https://api.github.com/repos/celery/kombu/issues/1807/comments",
                "statuses_url": "https://api.github.com/repos/celery/kombu/statuses/9e903aa9116fa345a68897f67979a4f8a367a71c",
                "head": {
                    "label": "rafidka:fix-1783",
                    "ref": "fix-1783",
                    "sha": "9e903aa9116fa345a68897f67979a4f8a367a71c",
                    "user": {
                        "login": "rafidka",
                        "id": 442447,
                        "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                        "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/rafidka",
                        "html_url": "https://github.com/rafidka",
                        "followers_url": "https://api.github.com/users/rafidka/followers",
                        "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                        "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                        "organizations_url": "https://api.github.com/users/rafidka/orgs",
                        "repos_url": "https://api.github.com/users/rafidka/repos",
                        "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/rafidka/received_events",
                        "type": "User",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 655909423,
                        "node_id": "R_kgDOJxhiLw",
                        "name": "kombu",
                        "full_name": "rafidka/kombu",
                        "private": false,
                        "owner": {
                            "login": "rafidka",
                            "id": 442447,
                            "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                            "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/rafidka",
                            "html_url": "https://github.com/rafidka",
                            "followers_url": "https://api.github.com/users/rafidka/followers",
                            "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                            "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                            "organizations_url": "https://api.github.com/users/rafidka/orgs",
                            "repos_url": "https://api.github.com/users/rafidka/repos",
                            "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/rafidka/received_events",
                            "type": "User",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/rafidka/kombu",
                        "description": "Messaging library for Python.",
                        "fork": true,
                        "url": "https://api.github.com/repos/rafidka/kombu",
                        "forks_url": "https://api.github.com/repos/rafidka/kombu/forks",
                        "keys_url": "https://api.github.com/repos/rafidka/kombu/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/rafidka/kombu/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/rafidka/kombu/teams",
                        "hooks_url": "https://api.github.com/repos/rafidka/kombu/hooks",
                        "issue_events_url": "https://api.github.com/repos/rafidka/kombu/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/rafidka/kombu/events",
                        "assignees_url": "https://api.github.com/repos/rafidka/kombu/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/rafidka/kombu/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/rafidka/kombu/tags",
                        "blobs_url": "https://api.github.com/repos/rafidka/kombu/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/rafidka/kombu/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/rafidka/kombu/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/rafidka/kombu/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/rafidka/kombu/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/rafidka/kombu/languages",
                        "stargazers_url": "https://api.github.com/repos/rafidka/kombu/stargazers",
                        "contributors_url": "https://api.github.com/repos/rafidka/kombu/contributors",
                        "subscribers_url": "https://api.github.com/repos/rafidka/kombu/subscribers",
                        "subscription_url": "https://api.github.com/repos/rafidka/kombu/subscription",
                        "commits_url": "https://api.github.com/repos/rafidka/kombu/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/rafidka/kombu/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/rafidka/kombu/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/rafidka/kombu/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/rafidka/kombu/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/rafidka/kombu/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/rafidka/kombu/merges",
                        "archive_url": "https://api.github.com/repos/rafidka/kombu/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/rafidka/kombu/downloads",
                        "issues_url": "https://api.github.com/repos/rafidka/kombu/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/rafidka/kombu/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/rafidka/kombu/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/rafidka/kombu/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/rafidka/kombu/labels{/name}",
                        "releases_url": "https://api.github.com/repos/rafidka/kombu/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/rafidka/kombu/deployments",
                        "created_at": "2023-06-19T21:48:27Z",
                        "updated_at": "2023-10-06T01:42:46Z",
                        "pushed_at": "2023-10-17T14:10:46Z",
                        "git_url": "git://github.com/rafidka/kombu.git",
                        "ssh_url": "git@github.com:rafidka/kombu.git",
                        "clone_url": "https://github.com/rafidka/kombu.git",
                        "svn_url": "https://github.com/rafidka/kombu",
                        "homepage": "http://kombu.readthedocs.org/",
                        "size": 6589,
                        "stargazers_count": 0,
                        "watchers_count": 0,
                        "language": "Python",
                        "has_issues": false,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": false,
                        "has_discussions": false,
                        "forks_count": 0,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 0,
                        "license": {
                            "key": "bsd-3-clause",
                            "name": "BSD 3-Clause \"New\" or \"Revised\" License",
                            "spdx_id": "BSD-3-Clause",
                            "url": "https://api.github.com/licenses/bsd-3-clause",
                            "node_id": "MDc6TGljZW5zZTU="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [],
                        "visibility": "public",
                        "forks": 0,
                        "open_issues": 0,
                        "watchers": 0,
                        "default_branch": "main"
                    }
                },
                "base": {
                    "label": "celery:main",
                    "ref": "main",
                    "sha": "1dfe4f3c86ab0fd2587a6fe8566bb3cef8c4a5d7",
                    "user": {
                        "login": "celery",
                        "id": 319983,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjMxOTk4Mw==",
                        "avatar_url": "https://avatars.githubusercontent.com/u/319983?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/celery",
                        "html_url": "https://github.com/celery",
                        "followers_url": "https://api.github.com/users/celery/followers",
                        "following_url": "https://api.github.com/users/celery/following{/other_user}",
                        "gists_url": "https://api.github.com/users/celery/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/celery/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/celery/subscriptions",
                        "organizations_url": "https://api.github.com/users/celery/orgs",
                        "repos_url": "https://api.github.com/users/celery/repos",
                        "events_url": "https://api.github.com/users/celery/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/celery/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 735498,
                        "node_id": "MDEwOlJlcG9zaXRvcnk3MzU0OTg=",
                        "name": "kombu",
                        "full_name": "celery/kombu",
                        "private": false,
                        "owner": {
                            "login": "celery",
                            "id": 319983,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjMxOTk4Mw==",
                            "avatar_url": "https://avatars.githubusercontent.com/u/319983?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/celery",
                            "html_url": "https://github.com/celery",
                            "followers_url": "https://api.github.com/users/celery/followers",
                            "following_url": "https://api.github.com/users/celery/following{/other_user}",
                            "gists_url": "https://api.github.com/users/celery/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/celery/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/celery/subscriptions",
                            "organizations_url": "https://api.github.com/users/celery/orgs",
                            "repos_url": "https://api.github.com/users/celery/repos",
                            "events_url": "https://api.github.com/users/celery/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/celery/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/celery/kombu",
                        "description": "Messaging library for Python.",
                        "fork": false,
                        "url": "https://api.github.com/repos/celery/kombu",
                        "forks_url": "https://api.github.com/repos/celery/kombu/forks",
                        "keys_url": "https://api.github.com/repos/celery/kombu/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/celery/kombu/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/celery/kombu/teams",
                        "hooks_url": "https://api.github.com/repos/celery/kombu/hooks",
                        "issue_events_url": "https://api.github.com/repos/celery/kombu/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/celery/kombu/events",
                        "assignees_url": "https://api.github.com/repos/celery/kombu/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/celery/kombu/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/celery/kombu/tags",
                        "blobs_url": "https://api.github.com/repos/celery/kombu/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/celery/kombu/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/celery/kombu/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/celery/kombu/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/celery/kombu/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/celery/kombu/languages",
                        "stargazers_url": "https://api.github.com/repos/celery/kombu/stargazers",
                        "contributors_url": "https://api.github.com/repos/celery/kombu/contributors",
                        "subscribers_url": "https://api.github.com/repos/celery/kombu/subscribers",
                        "subscription_url": "https://api.github.com/repos/celery/kombu/subscription",
                        "commits_url": "https://api.github.com/repos/celery/kombu/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/celery/kombu/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/celery/kombu/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/celery/kombu/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/celery/kombu/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/celery/kombu/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/celery/kombu/merges",
                        "archive_url": "https://api.github.com/repos/celery/kombu/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/celery/kombu/downloads",
                        "issues_url": "https://api.github.com/repos/celery/kombu/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/celery/kombu/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/celery/kombu/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/celery/kombu/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/celery/kombu/labels{/name}",
                        "releases_url": "https://api.github.com/repos/celery/kombu/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/celery/kombu/deployments",
                        "created_at": "2010-06-23T10:10:24Z",
                        "updated_at": "2023-10-19T21:24:17Z",
                        "pushed_at": "2023-10-18T10:14:29Z",
                        "git_url": "git://github.com/celery/kombu.git",
                        "ssh_url": "git@github.com:celery/kombu.git",
                        "clone_url": "https://github.com/celery/kombu.git",
                        "svn_url": "https://github.com/celery/kombu",
                        "homepage": "http://kombu.readthedocs.org/",
                        "size": 8758,
                        "stargazers_count": 2629,
                        "watchers_count": 2629,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": true,
                        "forks_count": 933,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 191,
                        "license": {
                            "key": "bsd-3-clause",
                            "name": "BSD 3-Clause \"New\" or \"Revised\" License",
                            "spdx_id": "BSD-3-Clause",
                            "url": "https://api.github.com/licenses/bsd-3-clause",
                            "node_id": "MDc6TGljZW5zZTU="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "celery",
                            "kombu",
                            "message-queue",
                            "messaging",
                            "python",
                            "python-3",
                            "python-library",
                            "python3",
                            "rabbitmq",
                            "redis",
                            "sqs"
                        ],
                        "visibility": "public",
                        "forks": 933,
                        "open_issues": 191,
                        "watchers": 2629,
                        "default_branch": "main"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807"
                    },
                    "html": {
                        "href": "https://github.com/celery/kombu/pull/1807"
                    },
                    "issue": {
                        "href": "https://api.github.com/repos/celery/kombu/issues/1807"
                    },
                    "comments": {
                        "href": "https://api.github.com/repos/celery/kombu/issues/1807/comments"
                    },
                    "review_comments": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807/comments"
                    },
                    "review_comment": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/comments{/number}"
                    },
                    "commits": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807/commits"
                    },
                    "statuses": {
                        "href": "https://api.github.com/repos/celery/kombu/statuses/9e903aa9116fa345a68897f67979a4f8a367a71c"
                    }
                },
                "author_association": "CONTRIBUTOR",
                "auto_merge": null,
                "active_lock_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-21T08:29:27Z",
        "org": {
            "id": 319983,
            "login": "celery",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/celery",
            "avatar_url": "https://avatars.githubusercontent.com/u/319983?"
        }
    },
    {
        "id": "32735123870",
        "type": "ForkEvent",
        "actor": {
            "id": 6527504,
            "login": "scottwittenburg",
            "display_login": "scottwittenburg",
            "gravatar_id": "",
            "url": "https://api.github.com/users/scottwittenburg",
            "avatar_url": "https://avatars.githubusercontent.com/u/6527504?"
        },
        "repo": {
            "id": 735498,
            "name": "celery/kombu",
            "url": "https://api.github.com/repos/celery/kombu"
        },
        "payload": {
            "forkee": {
                "id": 707885055,
                "node_id": "R_kgDOKjF3_w",
                "name": "kombu",
                "full_name": "scottwittenburg/kombu",
                "private": false,
                "owner": {
                    "login": "scottwittenburg",
                    "id": 6527504,
                    "node_id": "MDQ6VXNlcjY1Mjc1MDQ=",
                    "avatar_url": "https://avatars.githubusercontent.com/u/6527504?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/scottwittenburg",
                    "html_url": "https://github.com/scottwittenburg",
                    "followers_url": "https://api.github.com/users/scottwittenburg/followers",
                    "following_url": "https://api.github.com/users/scottwittenburg/following{/other_user}",
                    "gists_url": "https://api.github.com/users/scottwittenburg/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/scottwittenburg/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/scottwittenburg/subscriptions",
                    "organizations_url": "https://api.github.com/users/scottwittenburg/orgs",
                    "repos_url": "https://api.github.com/users/scottwittenburg/repos",
                    "events_url": "https://api.github.com/users/scottwittenburg/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/scottwittenburg/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "html_url": "https://github.com/scottwittenburg/kombu",
                "description": "Messaging library for Python.",
                "fork": true,
                "url": "https://api.github.com/repos/scottwittenburg/kombu",
                "forks_url": "https://api.github.com/repos/scottwittenburg/kombu/forks",
                "keys_url": "https://api.github.com/repos/scottwittenburg/kombu/keys{/key_id}",
                "collaborators_url": "https://api.github.com/repos/scottwittenburg/kombu/collaborators{/collaborator}",
                "teams_url": "https://api.github.com/repos/scottwittenburg/kombu/teams",
                "hooks_url": "https://api.github.com/repos/scottwittenburg/kombu/hooks",
                "issue_events_url": "https://api.github.com/repos/scottwittenburg/kombu/issues/events{/number}",
                "events_url": "https://api.github.com/repos/scottwittenburg/kombu/events",
                "assignees_url": "https://api.github.com/repos/scottwittenburg/kombu/assignees{/user}",
                "branches_url": "https://api.github.com/repos/scottwittenburg/kombu/branches{/branch}",
                "tags_url": "https://api.github.com/repos/scottwittenburg/kombu/tags",
                "blobs_url": "https://api.github.com/repos/scottwittenburg/kombu/git/blobs{/sha}",
                "git_tags_url": "https://api.github.com/repos/scottwittenburg/kombu/git/tags{/sha}",
                "git_refs_url": "https://api.github.com/repos/scottwittenburg/kombu/git/refs{/sha}",
                "trees_url": "https://api.github.com/repos/scottwittenburg/kombu/git/trees{/sha}",
                "statuses_url": "https://api.github.com/repos/scottwittenburg/kombu/statuses/{sha}",
                "languages_url": "https://api.github.com/repos/scottwittenburg/kombu/languages",
                "stargazers_url": "https://api.github.com/repos/scottwittenburg/kombu/stargazers",
                "contributors_url": "https://api.github.com/repos/scottwittenburg/kombu/contributors",
                "subscribers_url": "https://api.github.com/repos/scottwittenburg/kombu/subscribers",
                "subscription_url": "https://api.github.com/repos/scottwittenburg/kombu/subscription",
                "commits_url": "https://api.github.com/repos/scottwittenburg/kombu/commits{/sha}",
                "git_commits_url": "https://api.github.com/repos/scottwittenburg/kombu/git/commits{/sha}",
                "comments_url": "https://api.github.com/repos/scottwittenburg/kombu/comments{/number}",
                "issue_comment_url": "https://api.github.com/repos/scottwittenburg/kombu/issues/comments{/number}",
                "contents_url": "https://api.github.com/repos/scottwittenburg/kombu/contents/{+path}",
                "compare_url": "https://api.github.com/repos/scottwittenburg/kombu/compare/{base}...{head}",
                "merges_url": "https://api.github.com/repos/scottwittenburg/kombu/merges",
                "archive_url": "https://api.github.com/repos/scottwittenburg/kombu/{archive_format}{/ref}",
                "downloads_url": "https://api.github.com/repos/scottwittenburg/kombu/downloads",
                "issues_url": "https://api.github.com/repos/scottwittenburg/kombu/issues{/number}",
                "pulls_url": "https://api.github.com/repos/scottwittenburg/kombu/pulls{/number}",
                "milestones_url": "https://api.github.com/repos/scottwittenburg/kombu/milestones{/number}",
                "notifications_url": "https://api.github.com/repos/scottwittenburg/kombu/notifications{?since,all,participating}",
                "labels_url": "https://api.github.com/repos/scottwittenburg/kombu/labels{/name}",
                "releases_url": "https://api.github.com/repos/scottwittenburg/kombu/releases{/id}",
                "deployments_url": "https://api.github.com/repos/scottwittenburg/kombu/deployments",
                "created_at": "2023-10-20T22:21:57Z",
                "updated_at": "2023-10-20T22:21:57Z",
                "pushed_at": "2023-10-18T10:14:29Z",
                "git_url": "git://github.com/scottwittenburg/kombu.git",
                "ssh_url": "git@github.com:scottwittenburg/kombu.git",
                "clone_url": "https://github.com/scottwittenburg/kombu.git",
                "svn_url": "https://github.com/scottwittenburg/kombu",
                "homepage": "http://kombu.readthedocs.org/",
                "size": 8758,
                "stargazers_count": 0,
                "watchers_count": 0,
                "language": null,
                "has_issues": false,
                "has_projects": true,
                "has_downloads": true,
                "has_wiki": true,
                "has_pages": false,
                "has_discussions": false,
                "forks_count": 0,
                "mirror_url": null,
                "archived": false,
                "disabled": false,
                "open_issues_count": 0,
                "license": null,
                "allow_forking": true,
                "is_template": false,
                "web_commit_signoff_required": false,
                "topics": [],
                "visibility": "public",
                "forks": 0,
                "open_issues": 0,
                "watchers": 0,
                "default_branch": "main",
                "public": true
            }
        },
        "public": true,
        "created_at": "2023-10-20T22:21:58Z",
        "org": {
            "id": 319983,
            "login": "celery",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/celery",
            "avatar_url": "https://avatars.githubusercontent.com/u/319983?"
        }
    },
    {
        "id": "32705081462",
        "type": "WatchEvent",
        "actor": {
            "id": 26347985,
            "login": "moaddib666",
            "display_login": "moaddib666",
            "gravatar_id": "",
            "url": "https://api.github.com/users/moaddib666",
            "avatar_url": "https://avatars.githubusercontent.com/u/26347985?"
        },
        "repo": {
            "id": 735498,
            "name": "celery/kombu",
            "url": "https://api.github.com/repos/celery/kombu"
        },
        "payload": {
            "action": "started"
        },
        "public": true,
        "created_at": "2023-10-19T21:24:17Z",
        "org": {
            "id": 319983,
            "login": "celery",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/celery",
            "avatar_url": "https://avatars.githubusercontent.com/u/319983?"
        }
    },
    {
        "id": "32701061372",
        "type": "PullRequestReviewCommentEvent",
        "actor": {
            "id": 65743084,
            "login": "o-nikolas",
            "display_login": "o-nikolas",
            "gravatar_id": "",
            "url": "https://api.github.com/users/o-nikolas",
            "avatar_url": "https://avatars.githubusercontent.com/u/65743084?"
        },
        "repo": {
            "id": 735498,
            "name": "celery/kombu",
            "url": "https://api.github.com/repos/celery/kombu"
        },
        "payload": {
            "action": "created",
            "comment": {
                "url": "https://api.github.com/repos/celery/kombu/pulls/comments/1365948322",
                "pull_request_review_id": 1688373604,
                "id": 1365948322,
                "node_id": "PRRC_kwDOAAs5Cs5Rarei",
                "diff_hunk": "@@ -25,6 +29,76 @@ def __init__(self, sqs_connection, debug=0, region=None, **kwargs):\n             **kwargs\n         )\n \n+    def _create_query_request(self, operation, params, queue_url, method):\n+        params = params.copy()\n+        if operation:\n+            params['Action'] = operation\n+\n+        # defaults for non-get\n+        param_payload = {'data': params}\n+        if method.lower() == 'get':\n+            # query-based opts\n+            param_payload = {'params': params}\n+\n+        return AWSRequest(method=method, url=queue_url, **param_payload)\n+\n+    def _create_json_request(self, operation, params, queue_url):\n+        params = params.copy()\n+        params['QueueUrl'] = queue_url\n+\n+        service_model = self.sqs_connection.meta.service_model\n+        operation_model = service_model.operation_model(operation)\n+\n+        url = self.sqs_connection._endpoint.host\n+\n+        headers = {}\n+        # Content-Type\n+        json_version = operation_model.metadata['jsonVersion']\n+        content_type = f'application/x-amz-json-{json_version}'\n+        headers['Content-Type'] = content_type\n+\n+        # X-Amz-Target\n+        target = '{}.{}'.format(\n+            operation_model.metadata['targetPrefix'],\n+            operation_model.name,\n+        )\n+        headers['X-Amz-Target'] = target",
                "path": "kombu/asynchronous/aws/sqs/connection.py",
                "commit_id": "9e903aa9116fa345a68897f67979a4f8a367a71c",
                "original_commit_id": "9e903aa9116fa345a68897f67979a4f8a367a71c",
                "user": {
                    "login": "o-nikolas",
                    "id": 65743084,
                    "node_id": "MDQ6VXNlcjY1NzQzMDg0",
                    "avatar_url": "https://avatars.githubusercontent.com/u/65743084?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/o-nikolas",
                    "html_url": "https://github.com/o-nikolas",
                    "followers_url": "https://api.github.com/users/o-nikolas/followers",
                    "following_url": "https://api.github.com/users/o-nikolas/following{/other_user}",
                    "gists_url": "https://api.github.com/users/o-nikolas/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/o-nikolas/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/o-nikolas/subscriptions",
                    "organizations_url": "https://api.github.com/users/o-nikolas/orgs",
                    "repos_url": "https://api.github.com/users/o-nikolas/repos",
                    "events_url": "https://api.github.com/users/o-nikolas/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/o-nikolas/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "Looking at a sample request in the docs I also see `Content-Encoding: amz-1.0`, `X-Amz-Date: <date>` and a few others in the header as well? I suppose those aren't required and we'll have no issues excluding them?",
                "created_at": "2023-10-19T18:23:44Z",
                "updated_at": "2023-10-19T18:24:23Z",
                "html_url": "https://github.com/celery/kombu/pull/1807#discussion_r1365948322",
                "pull_request_url": "https://api.github.com/repos/celery/kombu/pulls/1807",
                "author_association": "NONE",
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/comments/1365948322"
                    },
                    "html": {
                        "href": "https://github.com/celery/kombu/pull/1807#discussion_r1365948322"
                    },
                    "pull_request": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807"
                    }
                },
                "reactions": {
                    "url": "https://api.github.com/repos/celery/kombu/pulls/comments/1365948322/reactions",
                    "total_count": 0,
                    "+1": 0,
                    "-1": 0,
                    "laugh": 0,
                    "hooray": 0,
                    "confused": 0,
                    "heart": 0,
                    "rocket": 0,
                    "eyes": 0
                },
                "start_line": null,
                "original_start_line": null,
                "start_side": null,
                "line": 65,
                "original_line": 65,
                "side": "RIGHT",
                "original_position": 51,
                "position": 51,
                "subject_type": "line"
            },
            "pull_request": {
                "url": "https://api.github.com/repos/celery/kombu/pulls/1807",
                "id": 1548262937,
                "node_id": "PR_kwDOAAs5Cs5cSJ4Z",
                "html_url": "https://github.com/celery/kombu/pull/1807",
                "diff_url": "https://github.com/celery/kombu/pull/1807.diff",
                "patch_url": "https://github.com/celery/kombu/pull/1807.patch",
                "issue_url": "https://api.github.com/repos/celery/kombu/issues/1807",
                "number": 1807,
                "state": "open",
                "locked": false,
                "title": "[WIP] Use the correct protocol for SQS requests",
                "user": {
                    "login": "rafidka",
                    "id": 442447,
                    "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/rafidka",
                    "html_url": "https://github.com/rafidka",
                    "followers_url": "https://api.github.com/users/rafidka/followers",
                    "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                    "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                    "organizations_url": "https://api.github.com/users/rafidka/orgs",
                    "repos_url": "https://api.github.com/users/rafidka/repos",
                    "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/rafidka/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "TL;DR - The use of boto3 in #1759 resulted in relying on blocking (synchronous) HTTP requests, which caused the performance issue reported in #1783.\r\n\r\n`kombu` previously used to craft AWS requests manually as explained in detail in #1726, which resulted in an outage when botocore temporarily changed the default protocol to JSON (before rolling back due to the impact on celery and airflow.) To fix the issue, I submitted #1759, which changes `kombu` to use `boto3` instead of manually crafting AWS requests. This way when boto3 changes the default protocol, kombu won't be impacted.\r\n\r\nWhile working on #1759, I did extensive debugging to understand the multi-threading nature of kombu. What I discovered is that there isn't an actual multi-threading in the true sense of the word, but an event loop that runs on the same thread and process and orchestrate the communication with SQS. As such, it didn't appear to me that there is anything to worry about my change, and the testing I did didn't discover any issue. However, it turns out that while kombu's event loop doesn't have actual multi-threading, its [reliance on pycurl](https://github.com/celery/kombu/blob/main/kombu/asynchronous/http/curl.py#L48) (and thus libcurl) meant that the requests to AWS were being done asynchronously. On the other hand, boto3 requests are always done synchronously, i.e. they are blocking requests.\r\n\r\nThe above meant that my change introduced blocking on the event loop of kombu. This is fine in most of the cases, since the requests to SQS are pretty fast. However, in the case of using long-polling, a call to SQS's ReceiveMessage can last up to 20 seconds (depending on the user configuration).\r\n\r\nTo solve this problem, I rolled back my earlier changes and, instead, to address the issue reported in #1726, I now changed the `AsyncSQSConnection` class such that it crafts either a `query` or a `json` request depending on the protocol used by the SQS client. Thus, when botocore changes the default protocol of SQS to JSON, kombu won't be impacted, since it crafts its own request and, after my change, it uses a hard-coded protocol based on the crafted requests.\r\n\r\nThis solution shouldn't be the final solution, and it is more of a workaround that does the job for now. The final solution should be to completely rely on boto3 for any communication with AWS, and ensuring that all requests are async in nature (non-blocking.) This, however, is a fundamental change that requires a lot of testing, in particular performance testing.\r\n",
                "created_at": "2023-10-09T17:36:06Z",
                "updated_at": "2023-10-19T18:24:23Z",
                "closed_at": null,
                "merged_at": null,
                "merge_commit_sha": "f6243abe6fb30d7a7b5dfa592e36d02bc35987f3",
                "assignee": null,
                "assignees": [],
                "requested_reviewers": [],
                "requested_teams": [],
                "labels": [],
                "milestone": null,
                "draft": false,
                "commits_url": "https://api.github.com/repos/celery/kombu/pulls/1807/commits",
                "review_comments_url": "https://api.github.com/repos/celery/kombu/pulls/1807/comments",
                "review_comment_url": "https://api.github.com/repos/celery/kombu/pulls/comments{/number}",
                "comments_url": "https://api.github.com/repos/celery/kombu/issues/1807/comments",
                "statuses_url": "https://api.github.com/repos/celery/kombu/statuses/9e903aa9116fa345a68897f67979a4f8a367a71c",
                "head": {
                    "label": "rafidka:fix-1783",
                    "ref": "fix-1783",
                    "sha": "9e903aa9116fa345a68897f67979a4f8a367a71c",
                    "user": {
                        "login": "rafidka",
                        "id": 442447,
                        "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                        "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/rafidka",
                        "html_url": "https://github.com/rafidka",
                        "followers_url": "https://api.github.com/users/rafidka/followers",
                        "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                        "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                        "organizations_url": "https://api.github.com/users/rafidka/orgs",
                        "repos_url": "https://api.github.com/users/rafidka/repos",
                        "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/rafidka/received_events",
                        "type": "User",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 655909423,
                        "node_id": "R_kgDOJxhiLw",
                        "name": "kombu",
                        "full_name": "rafidka/kombu",
                        "private": false,
                        "owner": {
                            "login": "rafidka",
                            "id": 442447,
                            "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                            "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/rafidka",
                            "html_url": "https://github.com/rafidka",
                            "followers_url": "https://api.github.com/users/rafidka/followers",
                            "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                            "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                            "organizations_url": "https://api.github.com/users/rafidka/orgs",
                            "repos_url": "https://api.github.com/users/rafidka/repos",
                            "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/rafidka/received_events",
                            "type": "User",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/rafidka/kombu",
                        "description": "Messaging library for Python.",
                        "fork": true,
                        "url": "https://api.github.com/repos/rafidka/kombu",
                        "forks_url": "https://api.github.com/repos/rafidka/kombu/forks",
                        "keys_url": "https://api.github.com/repos/rafidka/kombu/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/rafidka/kombu/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/rafidka/kombu/teams",
                        "hooks_url": "https://api.github.com/repos/rafidka/kombu/hooks",
                        "issue_events_url": "https://api.github.com/repos/rafidka/kombu/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/rafidka/kombu/events",
                        "assignees_url": "https://api.github.com/repos/rafidka/kombu/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/rafidka/kombu/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/rafidka/kombu/tags",
                        "blobs_url": "https://api.github.com/repos/rafidka/kombu/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/rafidka/kombu/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/rafidka/kombu/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/rafidka/kombu/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/rafidka/kombu/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/rafidka/kombu/languages",
                        "stargazers_url": "https://api.github.com/repos/rafidka/kombu/stargazers",
                        "contributors_url": "https://api.github.com/repos/rafidka/kombu/contributors",
                        "subscribers_url": "https://api.github.com/repos/rafidka/kombu/subscribers",
                        "subscription_url": "https://api.github.com/repos/rafidka/kombu/subscription",
                        "commits_url": "https://api.github.com/repos/rafidka/kombu/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/rafidka/kombu/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/rafidka/kombu/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/rafidka/kombu/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/rafidka/kombu/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/rafidka/kombu/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/rafidka/kombu/merges",
                        "archive_url": "https://api.github.com/repos/rafidka/kombu/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/rafidka/kombu/downloads",
                        "issues_url": "https://api.github.com/repos/rafidka/kombu/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/rafidka/kombu/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/rafidka/kombu/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/rafidka/kombu/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/rafidka/kombu/labels{/name}",
                        "releases_url": "https://api.github.com/repos/rafidka/kombu/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/rafidka/kombu/deployments",
                        "created_at": "2023-06-19T21:48:27Z",
                        "updated_at": "2023-10-06T01:42:46Z",
                        "pushed_at": "2023-10-17T14:10:46Z",
                        "git_url": "git://github.com/rafidka/kombu.git",
                        "ssh_url": "git@github.com:rafidka/kombu.git",
                        "clone_url": "https://github.com/rafidka/kombu.git",
                        "svn_url": "https://github.com/rafidka/kombu",
                        "homepage": "http://kombu.readthedocs.org/",
                        "size": 6589,
                        "stargazers_count": 0,
                        "watchers_count": 0,
                        "language": "Python",
                        "has_issues": false,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": false,
                        "has_discussions": false,
                        "forks_count": 0,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 0,
                        "license": {
                            "key": "bsd-3-clause",
                            "name": "BSD 3-Clause \"New\" or \"Revised\" License",
                            "spdx_id": "BSD-3-Clause",
                            "url": "https://api.github.com/licenses/bsd-3-clause",
                            "node_id": "MDc6TGljZW5zZTU="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [],
                        "visibility": "public",
                        "forks": 0,
                        "open_issues": 0,
                        "watchers": 0,
                        "default_branch": "main"
                    }
                },
                "base": {
                    "label": "celery:main",
                    "ref": "main",
                    "sha": "1dfe4f3c86ab0fd2587a6fe8566bb3cef8c4a5d7",
                    "user": {
                        "login": "celery",
                        "id": 319983,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjMxOTk4Mw==",
                        "avatar_url": "https://avatars.githubusercontent.com/u/319983?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/celery",
                        "html_url": "https://github.com/celery",
                        "followers_url": "https://api.github.com/users/celery/followers",
                        "following_url": "https://api.github.com/users/celery/following{/other_user}",
                        "gists_url": "https://api.github.com/users/celery/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/celery/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/celery/subscriptions",
                        "organizations_url": "https://api.github.com/users/celery/orgs",
                        "repos_url": "https://api.github.com/users/celery/repos",
                        "events_url": "https://api.github.com/users/celery/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/celery/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 735498,
                        "node_id": "MDEwOlJlcG9zaXRvcnk3MzU0OTg=",
                        "name": "kombu",
                        "full_name": "celery/kombu",
                        "private": false,
                        "owner": {
                            "login": "celery",
                            "id": 319983,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjMxOTk4Mw==",
                            "avatar_url": "https://avatars.githubusercontent.com/u/319983?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/celery",
                            "html_url": "https://github.com/celery",
                            "followers_url": "https://api.github.com/users/celery/followers",
                            "following_url": "https://api.github.com/users/celery/following{/other_user}",
                            "gists_url": "https://api.github.com/users/celery/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/celery/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/celery/subscriptions",
                            "organizations_url": "https://api.github.com/users/celery/orgs",
                            "repos_url": "https://api.github.com/users/celery/repos",
                            "events_url": "https://api.github.com/users/celery/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/celery/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/celery/kombu",
                        "description": "Messaging library for Python.",
                        "fork": false,
                        "url": "https://api.github.com/repos/celery/kombu",
                        "forks_url": "https://api.github.com/repos/celery/kombu/forks",
                        "keys_url": "https://api.github.com/repos/celery/kombu/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/celery/kombu/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/celery/kombu/teams",
                        "hooks_url": "https://api.github.com/repos/celery/kombu/hooks",
                        "issue_events_url": "https://api.github.com/repos/celery/kombu/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/celery/kombu/events",
                        "assignees_url": "https://api.github.com/repos/celery/kombu/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/celery/kombu/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/celery/kombu/tags",
                        "blobs_url": "https://api.github.com/repos/celery/kombu/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/celery/kombu/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/celery/kombu/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/celery/kombu/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/celery/kombu/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/celery/kombu/languages",
                        "stargazers_url": "https://api.github.com/repos/celery/kombu/stargazers",
                        "contributors_url": "https://api.github.com/repos/celery/kombu/contributors",
                        "subscribers_url": "https://api.github.com/repos/celery/kombu/subscribers",
                        "subscription_url": "https://api.github.com/repos/celery/kombu/subscription",
                        "commits_url": "https://api.github.com/repos/celery/kombu/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/celery/kombu/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/celery/kombu/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/celery/kombu/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/celery/kombu/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/celery/kombu/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/celery/kombu/merges",
                        "archive_url": "https://api.github.com/repos/celery/kombu/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/celery/kombu/downloads",
                        "issues_url": "https://api.github.com/repos/celery/kombu/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/celery/kombu/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/celery/kombu/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/celery/kombu/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/celery/kombu/labels{/name}",
                        "releases_url": "https://api.github.com/repos/celery/kombu/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/celery/kombu/deployments",
                        "created_at": "2010-06-23T10:10:24Z",
                        "updated_at": "2023-10-19T16:28:34Z",
                        "pushed_at": "2023-10-18T10:14:29Z",
                        "git_url": "git://github.com/celery/kombu.git",
                        "ssh_url": "git@github.com:celery/kombu.git",
                        "clone_url": "https://github.com/celery/kombu.git",
                        "svn_url": "https://github.com/celery/kombu",
                        "homepage": "http://kombu.readthedocs.org/",
                        "size": 8758,
                        "stargazers_count": 2628,
                        "watchers_count": 2628,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": true,
                        "forks_count": 932,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 191,
                        "license": {
                            "key": "bsd-3-clause",
                            "name": "BSD 3-Clause \"New\" or \"Revised\" License",
                            "spdx_id": "BSD-3-Clause",
                            "url": "https://api.github.com/licenses/bsd-3-clause",
                            "node_id": "MDc6TGljZW5zZTU="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "celery",
                            "kombu",
                            "message-queue",
                            "messaging",
                            "python",
                            "python-3",
                            "python-library",
                            "python3",
                            "rabbitmq",
                            "redis",
                            "sqs"
                        ],
                        "visibility": "public",
                        "forks": 932,
                        "open_issues": 191,
                        "watchers": 2628,
                        "default_branch": "main"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807"
                    },
                    "html": {
                        "href": "https://github.com/celery/kombu/pull/1807"
                    },
                    "issue": {
                        "href": "https://api.github.com/repos/celery/kombu/issues/1807"
                    },
                    "comments": {
                        "href": "https://api.github.com/repos/celery/kombu/issues/1807/comments"
                    },
                    "review_comments": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807/comments"
                    },
                    "review_comment": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/comments{/number}"
                    },
                    "commits": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807/commits"
                    },
                    "statuses": {
                        "href": "https://api.github.com/repos/celery/kombu/statuses/9e903aa9116fa345a68897f67979a4f8a367a71c"
                    }
                },
                "author_association": "CONTRIBUTOR",
                "auto_merge": null,
                "active_lock_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-19T18:23:44Z",
        "org": {
            "id": 319983,
            "login": "celery",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/celery",
            "avatar_url": "https://avatars.githubusercontent.com/u/319983?"
        }
    },
    {
        "id": "32701061355",
        "type": "PullRequestReviewCommentEvent",
        "actor": {
            "id": 65743084,
            "login": "o-nikolas",
            "display_login": "o-nikolas",
            "gravatar_id": "",
            "url": "https://api.github.com/users/o-nikolas",
            "avatar_url": "https://avatars.githubusercontent.com/u/65743084?"
        },
        "repo": {
            "id": 735498,
            "name": "celery/kombu",
            "url": "https://api.github.com/repos/celery/kombu"
        },
        "payload": {
            "action": "created",
            "comment": {
                "url": "https://api.github.com/repos/celery/kombu/pulls/comments/1365939212",
                "pull_request_review_id": 1688373604,
                "id": 1365939212,
                "node_id": "PRRC_kwDOAAs5Cs5RapQM",
                "diff_hunk": "@@ -25,6 +29,76 @@ def __init__(self, sqs_connection, debug=0, region=None, **kwargs):\n             **kwargs\n         )\n \n+    def _create_query_request(self, operation, params, queue_url, method):\n+        params = params.copy()\n+        if operation:\n+            params['Action'] = operation\n+\n+        # defaults for non-get\n+        param_payload = {'data': params}\n+        if method.lower() == 'get':\n+            # query-based opts\n+            param_payload = {'params': params}\n+\n+        return AWSRequest(method=method, url=queue_url, **param_payload)\n+\n+    def _create_json_request(self, operation, params, queue_url):\n+        params = params.copy()\n+        params['QueueUrl'] = queue_url\n+\n+        service_model = self.sqs_connection.meta.service_model\n+        operation_model = service_model.operation_model(operation)\n+\n+        url = self.sqs_connection._endpoint.host\n+\n+        headers = {}\n+        # Content-Type\n+        json_version = operation_model.metadata['jsonVersion']\n+        content_type = f'application/x-amz-json-{json_version}'\n+        headers['Content-Type'] = content_type\n+\n+        # X-Amz-Target\n+        target = '{}.{}'.format(\n+            operation_model.metadata['targetPrefix'],\n+            operation_model.name,\n+        )\n+        headers['X-Amz-Target'] = target\n+\n+        param_payload = {\n+            'data': json.dumps(params),\n+            'headers': headers\n+        }\n+\n+        method = operation_model.http.get('method', Serializer.DEFAULT_METHOD)\n+        return AWSRequest(\n+            method=method,\n+            url=url,\n+            **param_payload\n+        )\n+\n+    def make_request(self, operation_name, params, queue_url, verb, callback=None):  # noqa\n+        signer = self.sqs_connection._request_signer\n+\n+        service_model = self.sqs_connection.meta.service_model\n+        protocol = service_model.protocol\n+",
                "path": "kombu/asynchronous/aws/sqs/connection.py",
                "commit_id": "9e903aa9116fa345a68897f67979a4f8a367a71c",
                "original_commit_id": "9e903aa9116fa345a68897f67979a4f8a367a71c",
                "user": {
                    "login": "o-nikolas",
                    "id": 65743084,
                    "node_id": "MDQ6VXNlcjY1NzQzMDg0",
                    "avatar_url": "https://avatars.githubusercontent.com/u/65743084?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/o-nikolas",
                    "html_url": "https://github.com/o-nikolas",
                    "followers_url": "https://api.github.com/users/o-nikolas/followers",
                    "following_url": "https://api.github.com/users/o-nikolas/following{/other_user}",
                    "gists_url": "https://api.github.com/users/o-nikolas/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/o-nikolas/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/o-nikolas/subscriptions",
                    "organizations_url": "https://api.github.com/users/o-nikolas/orgs",
                    "repos_url": "https://api.github.com/users/o-nikolas/repos",
                    "events_url": "https://api.github.com/users/o-nikolas/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/o-nikolas/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "It might be worth leaving a comment here explaining why this method is being updated with this branching. Just set a little bit of the context with some links. I know it could be gotten from the git blame/commit, but it's nice to have a bit in the code as well to hint people to go looking.",
                "created_at": "2023-10-19T18:14:31Z",
                "updated_at": "2023-10-19T18:24:23Z",
                "html_url": "https://github.com/celery/kombu/pull/1807#discussion_r1365939212",
                "pull_request_url": "https://api.github.com/repos/celery/kombu/pulls/1807",
                "author_association": "NONE",
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/comments/1365939212"
                    },
                    "html": {
                        "href": "https://github.com/celery/kombu/pull/1807#discussion_r1365939212"
                    },
                    "pull_request": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807"
                    }
                },
                "reactions": {
                    "url": "https://api.github.com/repos/celery/kombu/pulls/comments/1365939212/reactions",
                    "total_count": 0,
                    "+1": 0,
                    "-1": 0,
                    "laugh": 0,
                    "hooray": 0,
                    "confused": 0,
                    "heart": 0,
                    "rocket": 0,
                    "eyes": 0
                },
                "start_line": null,
                "original_start_line": null,
                "start_side": null,
                "line": 84,
                "original_line": 84,
                "side": "RIGHT",
                "original_position": 70,
                "position": 70,
                "subject_type": "line"
            },
            "pull_request": {
                "url": "https://api.github.com/repos/celery/kombu/pulls/1807",
                "id": 1548262937,
                "node_id": "PR_kwDOAAs5Cs5cSJ4Z",
                "html_url": "https://github.com/celery/kombu/pull/1807",
                "diff_url": "https://github.com/celery/kombu/pull/1807.diff",
                "patch_url": "https://github.com/celery/kombu/pull/1807.patch",
                "issue_url": "https://api.github.com/repos/celery/kombu/issues/1807",
                "number": 1807,
                "state": "open",
                "locked": false,
                "title": "[WIP] Use the correct protocol for SQS requests",
                "user": {
                    "login": "rafidka",
                    "id": 442447,
                    "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                    "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                    "gravatar_id": "",
                    "url": "https://api.github.com/users/rafidka",
                    "html_url": "https://github.com/rafidka",
                    "followers_url": "https://api.github.com/users/rafidka/followers",
                    "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                    "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                    "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                    "organizations_url": "https://api.github.com/users/rafidka/orgs",
                    "repos_url": "https://api.github.com/users/rafidka/repos",
                    "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                    "received_events_url": "https://api.github.com/users/rafidka/received_events",
                    "type": "User",
                    "site_admin": false
                },
                "body": "TL;DR - The use of boto3 in #1759 resulted in relying on blocking (synchronous) HTTP requests, which caused the performance issue reported in #1783.\r\n\r\n`kombu` previously used to craft AWS requests manually as explained in detail in #1726, which resulted in an outage when botocore temporarily changed the default protocol to JSON (before rolling back due to the impact on celery and airflow.) To fix the issue, I submitted #1759, which changes `kombu` to use `boto3` instead of manually crafting AWS requests. This way when boto3 changes the default protocol, kombu won't be impacted.\r\n\r\nWhile working on #1759, I did extensive debugging to understand the multi-threading nature of kombu. What I discovered is that there isn't an actual multi-threading in the true sense of the word, but an event loop that runs on the same thread and process and orchestrate the communication with SQS. As such, it didn't appear to me that there is anything to worry about my change, and the testing I did didn't discover any issue. However, it turns out that while kombu's event loop doesn't have actual multi-threading, its [reliance on pycurl](https://github.com/celery/kombu/blob/main/kombu/asynchronous/http/curl.py#L48) (and thus libcurl) meant that the requests to AWS were being done asynchronously. On the other hand, boto3 requests are always done synchronously, i.e. they are blocking requests.\r\n\r\nThe above meant that my change introduced blocking on the event loop of kombu. This is fine in most of the cases, since the requests to SQS are pretty fast. However, in the case of using long-polling, a call to SQS's ReceiveMessage can last up to 20 seconds (depending on the user configuration).\r\n\r\nTo solve this problem, I rolled back my earlier changes and, instead, to address the issue reported in #1726, I now changed the `AsyncSQSConnection` class such that it crafts either a `query` or a `json` request depending on the protocol used by the SQS client. Thus, when botocore changes the default protocol of SQS to JSON, kombu won't be impacted, since it crafts its own request and, after my change, it uses a hard-coded protocol based on the crafted requests.\r\n\r\nThis solution shouldn't be the final solution, and it is more of a workaround that does the job for now. The final solution should be to completely rely on boto3 for any communication with AWS, and ensuring that all requests are async in nature (non-blocking.) This, however, is a fundamental change that requires a lot of testing, in particular performance testing.\r\n",
                "created_at": "2023-10-09T17:36:06Z",
                "updated_at": "2023-10-19T18:24:23Z",
                "closed_at": null,
                "merged_at": null,
                "merge_commit_sha": "f6243abe6fb30d7a7b5dfa592e36d02bc35987f3",
                "assignee": null,
                "assignees": [],
                "requested_reviewers": [],
                "requested_teams": [],
                "labels": [],
                "milestone": null,
                "draft": false,
                "commits_url": "https://api.github.com/repos/celery/kombu/pulls/1807/commits",
                "review_comments_url": "https://api.github.com/repos/celery/kombu/pulls/1807/comments",
                "review_comment_url": "https://api.github.com/repos/celery/kombu/pulls/comments{/number}",
                "comments_url": "https://api.github.com/repos/celery/kombu/issues/1807/comments",
                "statuses_url": "https://api.github.com/repos/celery/kombu/statuses/9e903aa9116fa345a68897f67979a4f8a367a71c",
                "head": {
                    "label": "rafidka:fix-1783",
                    "ref": "fix-1783",
                    "sha": "9e903aa9116fa345a68897f67979a4f8a367a71c",
                    "user": {
                        "login": "rafidka",
                        "id": 442447,
                        "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                        "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/rafidka",
                        "html_url": "https://github.com/rafidka",
                        "followers_url": "https://api.github.com/users/rafidka/followers",
                        "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                        "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                        "organizations_url": "https://api.github.com/users/rafidka/orgs",
                        "repos_url": "https://api.github.com/users/rafidka/repos",
                        "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/rafidka/received_events",
                        "type": "User",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 655909423,
                        "node_id": "R_kgDOJxhiLw",
                        "name": "kombu",
                        "full_name": "rafidka/kombu",
                        "private": false,
                        "owner": {
                            "login": "rafidka",
                            "id": 442447,
                            "node_id": "MDQ6VXNlcjQ0MjQ0Nw==",
                            "avatar_url": "https://avatars.githubusercontent.com/u/442447?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/rafidka",
                            "html_url": "https://github.com/rafidka",
                            "followers_url": "https://api.github.com/users/rafidka/followers",
                            "following_url": "https://api.github.com/users/rafidka/following{/other_user}",
                            "gists_url": "https://api.github.com/users/rafidka/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/rafidka/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/rafidka/subscriptions",
                            "organizations_url": "https://api.github.com/users/rafidka/orgs",
                            "repos_url": "https://api.github.com/users/rafidka/repos",
                            "events_url": "https://api.github.com/users/rafidka/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/rafidka/received_events",
                            "type": "User",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/rafidka/kombu",
                        "description": "Messaging library for Python.",
                        "fork": true,
                        "url": "https://api.github.com/repos/rafidka/kombu",
                        "forks_url": "https://api.github.com/repos/rafidka/kombu/forks",
                        "keys_url": "https://api.github.com/repos/rafidka/kombu/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/rafidka/kombu/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/rafidka/kombu/teams",
                        "hooks_url": "https://api.github.com/repos/rafidka/kombu/hooks",
                        "issue_events_url": "https://api.github.com/repos/rafidka/kombu/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/rafidka/kombu/events",
                        "assignees_url": "https://api.github.com/repos/rafidka/kombu/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/rafidka/kombu/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/rafidka/kombu/tags",
                        "blobs_url": "https://api.github.com/repos/rafidka/kombu/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/rafidka/kombu/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/rafidka/kombu/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/rafidka/kombu/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/rafidka/kombu/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/rafidka/kombu/languages",
                        "stargazers_url": "https://api.github.com/repos/rafidka/kombu/stargazers",
                        "contributors_url": "https://api.github.com/repos/rafidka/kombu/contributors",
                        "subscribers_url": "https://api.github.com/repos/rafidka/kombu/subscribers",
                        "subscription_url": "https://api.github.com/repos/rafidka/kombu/subscription",
                        "commits_url": "https://api.github.com/repos/rafidka/kombu/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/rafidka/kombu/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/rafidka/kombu/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/rafidka/kombu/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/rafidka/kombu/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/rafidka/kombu/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/rafidka/kombu/merges",
                        "archive_url": "https://api.github.com/repos/rafidka/kombu/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/rafidka/kombu/downloads",
                        "issues_url": "https://api.github.com/repos/rafidka/kombu/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/rafidka/kombu/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/rafidka/kombu/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/rafidka/kombu/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/rafidka/kombu/labels{/name}",
                        "releases_url": "https://api.github.com/repos/rafidka/kombu/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/rafidka/kombu/deployments",
                        "created_at": "2023-06-19T21:48:27Z",
                        "updated_at": "2023-10-06T01:42:46Z",
                        "pushed_at": "2023-10-17T14:10:46Z",
                        "git_url": "git://github.com/rafidka/kombu.git",
                        "ssh_url": "git@github.com:rafidka/kombu.git",
                        "clone_url": "https://github.com/rafidka/kombu.git",
                        "svn_url": "https://github.com/rafidka/kombu",
                        "homepage": "http://kombu.readthedocs.org/",
                        "size": 6589,
                        "stargazers_count": 0,
                        "watchers_count": 0,
                        "language": "Python",
                        "has_issues": false,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": false,
                        "has_discussions": false,
                        "forks_count": 0,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 0,
                        "license": {
                            "key": "bsd-3-clause",
                            "name": "BSD 3-Clause \"New\" or \"Revised\" License",
                            "spdx_id": "BSD-3-Clause",
                            "url": "https://api.github.com/licenses/bsd-3-clause",
                            "node_id": "MDc6TGljZW5zZTU="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [],
                        "visibility": "public",
                        "forks": 0,
                        "open_issues": 0,
                        "watchers": 0,
                        "default_branch": "main"
                    }
                },
                "base": {
                    "label": "celery:main",
                    "ref": "main",
                    "sha": "1dfe4f3c86ab0fd2587a6fe8566bb3cef8c4a5d7",
                    "user": {
                        "login": "celery",
                        "id": 319983,
                        "node_id": "MDEyOk9yZ2FuaXphdGlvbjMxOTk4Mw==",
                        "avatar_url": "https://avatars.githubusercontent.com/u/319983?v=4",
                        "gravatar_id": "",
                        "url": "https://api.github.com/users/celery",
                        "html_url": "https://github.com/celery",
                        "followers_url": "https://api.github.com/users/celery/followers",
                        "following_url": "https://api.github.com/users/celery/following{/other_user}",
                        "gists_url": "https://api.github.com/users/celery/gists{/gist_id}",
                        "starred_url": "https://api.github.com/users/celery/starred{/owner}{/repo}",
                        "subscriptions_url": "https://api.github.com/users/celery/subscriptions",
                        "organizations_url": "https://api.github.com/users/celery/orgs",
                        "repos_url": "https://api.github.com/users/celery/repos",
                        "events_url": "https://api.github.com/users/celery/events{/privacy}",
                        "received_events_url": "https://api.github.com/users/celery/received_events",
                        "type": "Organization",
                        "site_admin": false
                    },
                    "repo": {
                        "id": 735498,
                        "node_id": "MDEwOlJlcG9zaXRvcnk3MzU0OTg=",
                        "name": "kombu",
                        "full_name": "celery/kombu",
                        "private": false,
                        "owner": {
                            "login": "celery",
                            "id": 319983,
                            "node_id": "MDEyOk9yZ2FuaXphdGlvbjMxOTk4Mw==",
                            "avatar_url": "https://avatars.githubusercontent.com/u/319983?v=4",
                            "gravatar_id": "",
                            "url": "https://api.github.com/users/celery",
                            "html_url": "https://github.com/celery",
                            "followers_url": "https://api.github.com/users/celery/followers",
                            "following_url": "https://api.github.com/users/celery/following{/other_user}",
                            "gists_url": "https://api.github.com/users/celery/gists{/gist_id}",
                            "starred_url": "https://api.github.com/users/celery/starred{/owner}{/repo}",
                            "subscriptions_url": "https://api.github.com/users/celery/subscriptions",
                            "organizations_url": "https://api.github.com/users/celery/orgs",
                            "repos_url": "https://api.github.com/users/celery/repos",
                            "events_url": "https://api.github.com/users/celery/events{/privacy}",
                            "received_events_url": "https://api.github.com/users/celery/received_events",
                            "type": "Organization",
                            "site_admin": false
                        },
                        "html_url": "https://github.com/celery/kombu",
                        "description": "Messaging library for Python.",
                        "fork": false,
                        "url": "https://api.github.com/repos/celery/kombu",
                        "forks_url": "https://api.github.com/repos/celery/kombu/forks",
                        "keys_url": "https://api.github.com/repos/celery/kombu/keys{/key_id}",
                        "collaborators_url": "https://api.github.com/repos/celery/kombu/collaborators{/collaborator}",
                        "teams_url": "https://api.github.com/repos/celery/kombu/teams",
                        "hooks_url": "https://api.github.com/repos/celery/kombu/hooks",
                        "issue_events_url": "https://api.github.com/repos/celery/kombu/issues/events{/number}",
                        "events_url": "https://api.github.com/repos/celery/kombu/events",
                        "assignees_url": "https://api.github.com/repos/celery/kombu/assignees{/user}",
                        "branches_url": "https://api.github.com/repos/celery/kombu/branches{/branch}",
                        "tags_url": "https://api.github.com/repos/celery/kombu/tags",
                        "blobs_url": "https://api.github.com/repos/celery/kombu/git/blobs{/sha}",
                        "git_tags_url": "https://api.github.com/repos/celery/kombu/git/tags{/sha}",
                        "git_refs_url": "https://api.github.com/repos/celery/kombu/git/refs{/sha}",
                        "trees_url": "https://api.github.com/repos/celery/kombu/git/trees{/sha}",
                        "statuses_url": "https://api.github.com/repos/celery/kombu/statuses/{sha}",
                        "languages_url": "https://api.github.com/repos/celery/kombu/languages",
                        "stargazers_url": "https://api.github.com/repos/celery/kombu/stargazers",
                        "contributors_url": "https://api.github.com/repos/celery/kombu/contributors",
                        "subscribers_url": "https://api.github.com/repos/celery/kombu/subscribers",
                        "subscription_url": "https://api.github.com/repos/celery/kombu/subscription",
                        "commits_url": "https://api.github.com/repos/celery/kombu/commits{/sha}",
                        "git_commits_url": "https://api.github.com/repos/celery/kombu/git/commits{/sha}",
                        "comments_url": "https://api.github.com/repos/celery/kombu/comments{/number}",
                        "issue_comment_url": "https://api.github.com/repos/celery/kombu/issues/comments{/number}",
                        "contents_url": "https://api.github.com/repos/celery/kombu/contents/{+path}",
                        "compare_url": "https://api.github.com/repos/celery/kombu/compare/{base}...{head}",
                        "merges_url": "https://api.github.com/repos/celery/kombu/merges",
                        "archive_url": "https://api.github.com/repos/celery/kombu/{archive_format}{/ref}",
                        "downloads_url": "https://api.github.com/repos/celery/kombu/downloads",
                        "issues_url": "https://api.github.com/repos/celery/kombu/issues{/number}",
                        "pulls_url": "https://api.github.com/repos/celery/kombu/pulls{/number}",
                        "milestones_url": "https://api.github.com/repos/celery/kombu/milestones{/number}",
                        "notifications_url": "https://api.github.com/repos/celery/kombu/notifications{?since,all,participating}",
                        "labels_url": "https://api.github.com/repos/celery/kombu/labels{/name}",
                        "releases_url": "https://api.github.com/repos/celery/kombu/releases{/id}",
                        "deployments_url": "https://api.github.com/repos/celery/kombu/deployments",
                        "created_at": "2010-06-23T10:10:24Z",
                        "updated_at": "2023-10-19T16:28:34Z",
                        "pushed_at": "2023-10-18T10:14:29Z",
                        "git_url": "git://github.com/celery/kombu.git",
                        "ssh_url": "git@github.com:celery/kombu.git",
                        "clone_url": "https://github.com/celery/kombu.git",
                        "svn_url": "https://github.com/celery/kombu",
                        "homepage": "http://kombu.readthedocs.org/",
                        "size": 8758,
                        "stargazers_count": 2628,
                        "watchers_count": 2628,
                        "language": "Python",
                        "has_issues": true,
                        "has_projects": true,
                        "has_downloads": true,
                        "has_wiki": true,
                        "has_pages": true,
                        "has_discussions": true,
                        "forks_count": 932,
                        "mirror_url": null,
                        "archived": false,
                        "disabled": false,
                        "open_issues_count": 191,
                        "license": {
                            "key": "bsd-3-clause",
                            "name": "BSD 3-Clause \"New\" or \"Revised\" License",
                            "spdx_id": "BSD-3-Clause",
                            "url": "https://api.github.com/licenses/bsd-3-clause",
                            "node_id": "MDc6TGljZW5zZTU="
                        },
                        "allow_forking": true,
                        "is_template": false,
                        "web_commit_signoff_required": false,
                        "topics": [
                            "celery",
                            "kombu",
                            "message-queue",
                            "messaging",
                            "python",
                            "python-3",
                            "python-library",
                            "python3",
                            "rabbitmq",
                            "redis",
                            "sqs"
                        ],
                        "visibility": "public",
                        "forks": 932,
                        "open_issues": 191,
                        "watchers": 2628,
                        "default_branch": "main"
                    }
                },
                "_links": {
                    "self": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807"
                    },
                    "html": {
                        "href": "https://github.com/celery/kombu/pull/1807"
                    },
                    "issue": {
                        "href": "https://api.github.com/repos/celery/kombu/issues/1807"
                    },
                    "comments": {
                        "href": "https://api.github.com/repos/celery/kombu/issues/1807/comments"
                    },
                    "review_comments": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807/comments"
                    },
                    "review_comment": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/comments{/number}"
                    },
                    "commits": {
                        "href": "https://api.github.com/repos/celery/kombu/pulls/1807/commits"
                    },
                    "statuses": {
                        "href": "https://api.github.com/repos/celery/kombu/statuses/9e903aa9116fa345a68897f67979a4f8a367a71c"
                    }
                },
                "author_association": "CONTRIBUTOR",
                "auto_merge": null,
                "active_lock_reason": null
            }
        },
        "public": true,
        "created_at": "2023-10-19T18:14:31Z",
        "org": {
            "id": 319983,
            "login": "celery",
            "gravatar_id": "",
            "url": "https://api.github.com/orgs/celery",
            "avatar_url": "https://avatars.githubusercontent.com/u/319983?"
        }
    }
]